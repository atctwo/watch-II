<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>watch 2: components/arduino-esp32/libraries/AzureIoT/src/az_iot/iothub_client/src/iothubtransport_mqtt_common.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">watch 2
   </div>
   <div id="projectbrief">Firmwareforwatch2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_5eb99044ce905dee52e93bf33cea5db4.html">arduino-esp32</a></li><li class="navelem"><a class="el" href="dir_0b98385dcf64e929fcaa5e8c894594ea.html">libraries</a></li><li class="navelem"><a class="el" href="dir_eb555940be421b578cfc4731c861a40a.html">AzureIoT</a></li><li class="navelem"><a class="el" href="dir_540bbe64a9e668446da0d15e64e423e9.html">src</a></li><li class="navelem"><a class="el" href="dir_c4ba8e35b6f312a68ea59c6826b7e111.html">az_iot</a></li><li class="navelem"><a class="el" href="dir_aca63954051b320f4be9d4ad42ba7e2c.html">iothub_client</a></li><li class="navelem"><a class="el" href="dir_3bb4b5621159288e6ee2bb1735d058f1.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">iothubtransport_mqtt_common.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="iothubtransport__mqtt__common_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) Microsoft. All rights reserved.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Licensed under the MIT license. See LICENSE file in the project root for full license information.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="ctype_8h.html">ctype.h</a>&gt;</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="optimize__size_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/optimize_size.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gballoc_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/gballoc.h</a>&quot;</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160; </div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="xlogging_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/xlogging.h</a>&quot;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/strings.h</a>&quot;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="doublylinkedlist_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/doublylinkedlist.h</a>&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="crt__abstractions_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/crt_abstractions.h</a>&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160; </div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;../inc/iothub_client_ll.h&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;../inc/iothub_client_options.h&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;../inc/iothub_client_private.h&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="libraries_2AzureIoT_2src_2az__iot_2umqtt_2inc_2azure__umqtt__c_2mqtt__client_8h.html">az_iot/umqtt/inc/azure_umqtt_c/mqtt_client.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="sastoken_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/sastoken.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tickcounter_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/tickcounter.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tlsio_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/tlsio.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2platform_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/platform.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160; </div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="string__tokenizer_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/string_tokenizer.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="shared__util__options_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/shared_util_options.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="urlencode_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/urlencode.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;../inc/iothub_client_version.h&quot;</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="preprocessor">#include &quot;../inc/iothub_client_retry_control.h&quot;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#include &quot;../inc/iothubtransport_mqtt_common.h&quot;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="preprocessor">#include &lt;stdarg.h&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160; </div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="limits_8h.html">limits.h</a>&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="inttypes_8h.html">inttypes.h</a>&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160; </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="preprocessor">#define SAS_TOKEN_DEFAULT_LIFETIME          3600</span></div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#aa36f2858f563663b71d1d01d6136328a">   39</a></span>&#160;<span class="preprocessor">#define SAS_REFRESH_MULTIPLIER              .8</span></div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#aebe4a395f23a2e353ed6c17770a5cec6">   40</a></span>&#160;<span class="preprocessor">#define EPOCH_TIME_T_VALUE                  0</span></div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#aae6d6188ff0358440fc632e3d54c2113">   41</a></span>&#160;<span class="preprocessor">#define DEFAULT_MQTT_KEEPALIVE              4*60 // 4 min</span></div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a905fb31568fb9ecbdcbeeb4e0795b1b3">   42</a></span>&#160;<span class="preprocessor">#define BUILD_CONFIG_USERNAME               24</span></div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a55dc367a87298454b0b156ec82e538b8">   43</a></span>&#160;<span class="preprocessor">#define SAS_TOKEN_DEFAULT_LEN               10</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a29cd9465d6457e8c8a09262abc647c6b">   44</a></span>&#160;<span class="preprocessor">#define RESEND_TIMEOUT_VALUE_MIN            1*60</span></div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a33c77b72749b1d9d1ab8edf93f28ee8b">   45</a></span>&#160;<span class="preprocessor">#define MAX_SEND_RECOUNT_LIMIT              2</span></div>
<div class="line"><a name="l00046"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#afd1e574a64f8b032be6a5ad196278c1e">   46</a></span>&#160;<span class="preprocessor">#define DEFAULT_CONNECTION_INTERVAL         30</span></div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a1955f8e1f059e8bf1ff051b9f02d3445">   47</a></span>&#160;<span class="preprocessor">#define FAILED_CONN_BACKOFF_VALUE           5</span></div>
<div class="line"><a name="l00048"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#af4ec7909525a41829a3d143fd8b7f1ec">   48</a></span>&#160;<span class="preprocessor">#define STATUS_CODE_FAILURE_VALUE           500</span></div>
<div class="line"><a name="l00049"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae53b6c1f964b3644a4f02862b687faa5">   49</a></span>&#160;<span class="preprocessor">#define STATUS_CODE_TIMEOUT_VALUE           408</span></div>
<div class="line"><a name="l00050"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a19c1223d5f5b9e3cf901ce2d2a657b74">   50</a></span>&#160; </div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="preprocessor">#define DEFAULT_RETRY_POLICY                IOTHUB_CLIENT_RETRY_EXPONENTIAL_BACKOFF_WITH_JITTER</span></div>
<div class="line"><a name="l00052"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a0edd40b1f2abb4aa27d8aa561ae52784">   52</a></span>&#160;<span class="preprocessor">#define DEFAULT_RETRY_TIMEOUT_IN_SECONDS    0</span></div>
<div class="line"><a name="l00053"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a6781b97d6acc03e7bf1c9d619f98abad">   53</a></span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> TOPIC_DEVICE_TWIN_PREFIX[] = <span class="stringliteral">&quot;$iothub/twin&quot;</span>;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> TOPIC_DEVICE_METHOD_PREFIX[] = <span class="stringliteral">&quot;$iothub/methods&quot;</span>;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160; </div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* TOPIC_GET_DESIRED_STATE = <span class="stringliteral">&quot;$iothub/twin/res/#&quot;</span>;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* TOPIC_NOTIFICATION_STATE = <span class="stringliteral">&quot;$iothub/twin/PATCH/properties/desired/#&quot;</span>;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160; </div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* TOPIC_DEVICE_MSG = <span class="stringliteral">&quot;devices/%s/messages/devicebound/#&quot;</span>;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* TOPIC_DEVICE_DEVICE = <span class="stringliteral">&quot;devices/%s/messages/events/&quot;</span>;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160; </div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* TOPIC_DEVICE_METHOD_SUBSCRIBE = <span class="stringliteral">&quot;$iothub/methods/POST/#&quot;</span>;</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* TOPIC_DEVICE_METHOD_RESPONSE = <span class="stringliteral">&quot;$iothub/methods/res&quot;</span>;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160; </div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* IOTHUB_API_VERSION = <span class="stringliteral">&quot;2016-11-14&quot;</span>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160; </div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* PROPERTY_SEPARATOR = <span class="stringliteral">&quot;&amp;&quot;</span>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* REPORTED_PROPERTIES_TOPIC = <span class="stringliteral">&quot;$iothub/twin/PATCH/properties/reported/?$rid=%&quot;</span><a class="code" href="inttypes_8h.html#a86bc00ee87e8e40787e0681fc34c576a">PRIu16</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* GET_PROPERTIES_TOPIC = <span class="stringliteral">&quot;$iothub/twin/GET/?$rid=%&quot;</span><a class="code" href="inttypes_8h.html#a86bc00ee87e8e40787e0681fc34c576a">PRIu16</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* DEVICE_METHOD_RESPONSE_TOPIC = <span class="stringliteral">&quot;$iothub/methods/res/%d/?$rid=%s&quot;</span>;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160; </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* REQUEST_ID_PROPERTY = <span class="stringliteral">&quot;?$rid=&quot;</span>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* MESSAGE_ID_PROPERTY = <span class="stringliteral">&quot;mid&quot;</span>;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* CORRELATION_ID_PROPERTY = <span class="stringliteral">&quot;cid&quot;</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* CONTENT_TYPE_PROPERTY = <span class="stringliteral">&quot;ct&quot;</span>;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* CONTENT_ENCODING_PROPERTY = <span class="stringliteral">&quot;ce&quot;</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160; </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">#define UNSUBSCRIBE_FROM_TOPIC                  0x0000</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a35665d241984eff7e3ab14b0188d4ba8">   81</a></span>&#160;<span class="preprocessor">#define SUBSCRIBE_GET_REPORTED_STATE_TOPIC      0x0001</span></div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a28f1b4f0886bfaf9a00796612117879e">   82</a></span>&#160;<span class="preprocessor">#define SUBSCRIBE_NOTIFICATION_STATE_TOPIC      0x0002</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a7f290bee42e3871e80bdad7432fb1df9">   83</a></span>&#160;<span class="preprocessor">#define SUBSCRIBE_TELEMETRY_TOPIC               0x0004</span></div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a2d2ab9657cc946c76cb9fd383cbc510a">   84</a></span>&#160;<span class="preprocessor">#define SUBSCRIBE_METHODS_TOPIC                 0x0008</span></div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae5cc8784a74f93ceee7cb9c8bb197e14">   85</a></span>&#160;<span class="preprocessor">#define SUBSCRIBE_DEVICE_METHOD_TOPIC           0x0010</span></div>
<div class="line"><a name="l00086"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a067063b96e352df08fbe2c56d3f24e10">   86</a></span>&#160;<span class="preprocessor">#define SUBSCRIBE_TOPIC_COUNT                   4</span></div>
<div class="line"><a name="l00087"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ad19dab2a96d760e17265be294f61a61a">   87</a></span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<a class="code" href="macro__utils_8h.html#a9953147f17615533ea50ed383b0171c1">DEFINE_ENUM_STRINGS</a>(MQTT_CLIENT_EVENT_ERROR, <a class="code" href="libraries_2AzureIoT_2src_2az__iot_2umqtt_2inc_2azure__umqtt__c_2mqtt__client_8h.html#a01d99c6d2271aaf6ff1564802663e263">MQTT_CLIENT_EVENT_ERROR_VALUES</a>)</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160; </div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="structSYSTEM__PROPERTY__INFO__TAG.html">   90</a></span>&#160;typedef struct <a class="code" href="structSYSTEM__PROPERTY__INFO__TAG.html">SYSTEM_PROPERTY_INFO_TAG</a></div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;{</div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="structSYSTEM__PROPERTY__INFO__TAG.html#a61b91aed5569709c123da0fe55f6d3f7">   92</a></span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="structSYSTEM__PROPERTY__INFO__TAG.html#a61b91aed5569709c123da0fe55f6d3f7">propName</a>;</div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="structSYSTEM__PROPERTY__INFO__TAG.html#a9a1a3a891a6c8370f6b9b603f45438b7">   93</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structSYSTEM__PROPERTY__INFO__TAG.html#a9a1a3a891a6c8370f6b9b603f45438b7">propLength</a>;</div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ad4bba49218323e0a70c72a6a6178457c">   94</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#ad4bba49218323e0a70c72a6a6178457c">SYSTEM_PROPERTY_INFO</a>;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; </div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">static</span> <a class="code" href="structSYSTEM__PROPERTY__INFO__TAG.html">SYSTEM_PROPERTY_INFO</a> sysPropList[] = {</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    { <span class="stringliteral">&quot;%24.exp&quot;</span>, 7 },</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    { <span class="stringliteral">&quot;%24.mid&quot;</span>, 7 },</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    { <span class="stringliteral">&quot;%24.uid&quot;</span>, 7 },</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    { <span class="stringliteral">&quot;%24.to&quot;</span>, 6 },</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    { <span class="stringliteral">&quot;%24.cid&quot;</span>, 7 },</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;    { <span class="stringliteral">&quot;%24.ct&quot;</span>, 6 },</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    { <span class="stringliteral">&quot;%24.ce&quot;</span>, 6 },</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    { <span class="stringliteral">&quot;devices/&quot;</span>, 8 },</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    { <span class="stringliteral">&quot;iothub-operation&quot;</span>, 16 },</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    { <span class="stringliteral">&quot;iothub-ack&quot;</span>, 10 }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;};</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053">  109</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053">DEVICE_TWIN_MSG_TYPE_TAG</a></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;{</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053a87a9746e9955eebaafc028505df46f93">  111</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053a87a9746e9955eebaafc028505df46f93">REPORTED_STATE</a>,</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053afd629b7eabf994cb88b008a887ec2533">RETRIEVE_PROPERTIES</a></div>
<div class="line"><a name="l00113"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053afd629b7eabf994cb88b008a887ec2533">  113</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#aa8a6dde4462576eb23c4f1e6d640645f">DEVICE_TWIN_MSG_TYPE</a>;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160; </div>
<div class="line"><a name="l00115"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0">  115</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0">MQTT_TRANSPORT_CREDENTIAL_TYPE_TAG</a></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;{</div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a2567f06e779a42cde83533b1171617c3">  117</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a2567f06e779a42cde83533b1171617c3">CREDENTIAL_NOT_BUILD</a>,</div>
<div class="line"><a name="l00118"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a6585600d59a7f48153f28a436aeac69e">  118</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a6585600d59a7f48153f28a436aeac69e">X509</a>,</div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a8694381c253255173e2c9d72cba04144">  119</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a8694381c253255173e2c9d72cba04144">SAS_TOKEN_FROM_USER</a>,</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a6b23a6df07a7072975fb1c55a7c93600">  120</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a6b23a6df07a7072975fb1c55a7c93600">DEVICE_KEY</a>,</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a9850d77fc0d21328a61d514c66659f7f">  121</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#a9850d77fc0d21328a61d514c66659f7f">MQTT_TRANSPORT_CREDENTIAL_TYPE</a>;</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160; </div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58">  123</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58">MQTT_CLIENT_STATUS_TAG</a></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;{</div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">  125</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a>,</div>
<div class="line"><a name="l00126"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a3d79509b61d6f3b7beeafdf2f01ff9ed">  126</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a3d79509b61d6f3b7beeafdf2f01ff9ed">MQTT_CLIENT_STATUS_CONNECTING</a>,</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a95e7f89d68ab2d1d56387289eb73728c">MQTT_CLIENT_STATUS_CONNECTED</a></div>
<div class="line"><a name="l00128"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a95e7f89d68ab2d1d56387289eb73728c">  128</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#ac137ee6d73d2610092cda83c5c0c7226">MQTT_CLIENT_STATUS</a>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160; </div>
<div class="line"><a name="l00130"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">  130</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA_TAG</a></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;{</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;    <span class="comment">// Topic control</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5d5870c74de2d33a04df2031b3984e7f">  133</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5d5870c74de2d33a04df2031b3984e7f">topic_MqttEvent</a>;</div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">  134</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a>;</div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">  135</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a>;</div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">  136</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a>;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160; </div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">  138</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a>;</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160; </div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">  140</a></span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a>;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;    <span class="comment">// Connection related constants</span></div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aeec3610b18121a94e5e5b1d51f34fdff">  143</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aeec3610b18121a94e5e5b1d51f34fdff">hostAddress</a>;</div>
<div class="line"><a name="l00144"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aa5871196da7d7da7b2d2e7f9f4a55731">  144</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aa5871196da7d7da7b2d2e7f9f4a55731">device_id</a>;</div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad7809e79d2e9e3ef3f471393511ea161">  145</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad7809e79d2e9e3ef3f471393511ea161">devicesPath</a>;</div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#affa3f275f686281b47c0e25de7fcb6e3">  146</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#affa3f275f686281b47c0e25de7fcb6e3">portNum</a>;</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160; </div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a104b92d040ffaefb6fb038c10f440796">  148</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8h.html#aadf70c8c230285569dc7d6ff281fcb21">MQTT_GET_IO_TRANSPORT</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a104b92d040ffaefb6fb038c10f440796">get_io_transport</a>;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160; </div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;    <span class="comment">// The current mqtt iothub implementation requires that the hub name and the domain suffix be passed as the first of a series of segments</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="comment">// passed through the username portion of the connection frame.</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    <span class="comment">// The second segment will contain the device id.  The two segments are delemited by a &quot;/&quot;.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;    <span class="comment">// The first segment can be a maximum 256 characters.</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;    <span class="comment">// The second segment can be a maximum 128 characters.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    <span class="comment">// With the / delimeter you have 384 chars (Plus a terminator of 0).</span></div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad3bb71acb8df8e88bf30e5fa3dc0ea42">  156</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad3bb71acb8df8e88bf30e5fa3dc0ea42">configPassedThroughUsername</a>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160; </div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;    <span class="comment">// Upper layer</span></div>
<div class="line"><a name="l00159"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">  159</a></span>&#160;    <a class="code" href="structIOTHUB__CLIENT__LL__HANDLE__DATA__TAG.html">IOTHUB_CLIENT_LL_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160; </div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="comment">// Protocol </span></div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">  162</a></span>&#160;    <a class="code" href="structMQTT__CLIENT__TAG.html">MQTT_CLIENT_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>;</div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">  163</a></span>&#160;    <a class="code" href="structXIO__INSTANCE__TAG.html">XIO_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a>;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160; </div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    <span class="comment">// Session - connection</span></div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af99d7773335eed48365d6e54abae3ebf">  166</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af99d7773335eed48365d6e54abae3ebf">packetId</a>;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160; </div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;    <span class="comment">// Connection state control</span></div>
<div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7f990671091f2c90d13d7e915633071d">  169</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7f990671091f2c90d13d7e915633071d">isRegistered</a>;</div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">  170</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#ac137ee6d73d2610092cda83c5c0c7226">MQTT_CLIENT_STATUS</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9dcca736d0691d77478439ecc05b4526">  171</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9dcca736d0691d77478439ecc05b4526">isDestroyCalled</a>;</div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">  172</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">device_twin_get_sent</a>;</div>
<div class="line"><a name="l00173"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ada6a6cc45ec43037deb14044b314c717">  173</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ada6a6cc45ec43037deb14044b314c717">isRecoverableError</a>;</div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a2c60bfa3b3743b25707510364154779e">  174</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a2c60bfa3b3743b25707510364154779e">keepAliveValue</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a8d873ed494c3ce1b30a85ab8f4365dc1">  175</a></span>&#160;    <a class="code" href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a8d873ed494c3ce1b30a85ab8f4365dc1">mqtt_connect_time</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a35279fbd52274c99a0d972d377c9cc97">  176</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a35279fbd52274c99a0d972d377c9cc97">connectFailCount</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a47c0d7b06e69bb49120cfde55283fcc7">  177</a></span>&#160;    <a class="code" href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a47c0d7b06e69bb49120cfde55283fcc7">connectTick</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac8e7327a74d3fcd6ed0bc03755768edf">  178</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac8e7327a74d3fcd6ed0bc03755768edf">log_trace</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac73b1fb898e61fb0f8170b745aced031">  179</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac73b1fb898e61fb0f8170b745aced031">raw_trace</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">  180</a></span>&#160;    <a class="code" href="structTICK__COUNTER__INSTANCE__TAG.html">TICK_COUNTER_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">  181</a></span>&#160;    <a class="code" href="structOPTIONHANDLER__HANDLE__DATA__TAG.html">OPTIONHANDLER_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">saved_tls_options</a>;     <span class="comment">// Here are the options from the xio layer if any is saved.</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160; </div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    <span class="comment">// Internal lists for message tracking</span></div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5280afeeba67d2f6e6d4cde3e1b719bf">  184</a></span>&#160;    <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5280afeeba67d2f6e6d4cde3e1b719bf">waitingToSend</a>;</div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">  185</a></span>&#160;    <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">ack_waiting_queue</a>;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160; </div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;    <span class="comment">// Message tracking</span></div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">  188</a></span>&#160;    CONTROL_PACKET_TYPE <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160; </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;    <span class="comment">// Telemetry specific</span></div>
<div class="line"><a name="l00191"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">  191</a></span>&#160;    <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160; </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="comment">// Controls frequency of reconnection logic.</span></div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">  194</a></span>&#160;    <a class="code" href="structRETRY__CONTROL__INSTANCE__TAG.html">RETRY_CONTROL_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">retry_control_handle</a>;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160; </div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    <span class="comment">// Auth module used to generating handle authorization</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="comment">// with either SAS Token, x509 Certs, and Device SAS Token</span></div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">  198</a></span>&#160;    <a class="code" href="structIOTHUB__AUTHORIZATION__DATA__TAG.html">IOTHUB_AUTHORIZATION_HANDLE</a> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">  200</a></span>&#160;    <span class="keywordtype">char</span>* <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a>;</div>
<div class="line"><a name="l00201"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a483c15ac99b09da35b40ad0c7455f3e0">  201</a></span>&#160;    <span class="keywordtype">int</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a483c15ac99b09da35b40ad0c7455f3e0">http_proxy_port</a>;</div>
<div class="line"><a name="l00202"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">  202</a></span>&#160;    <span class="keywordtype">char</span>* <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">http_proxy_username</a>;</div>
<div class="line"><a name="l00203"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">  203</a></span>&#160;    <span class="keywordtype">char</span>* <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">http_proxy_password</a>;</div>
<div class="line"><a name="l00204"></a><span class="lineno"><a class="line" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af03e0416fa3e66f3353ef4f1f1a8d08a">  204</a></span>&#160;    <span class="keywordtype">bool</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af03e0416fa3e66f3353ef4f1f1a8d08a">isProductInfoSet</a>;</div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">  205</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#a5f8ccaa27622eb4a983c1dfd3211922d">MQTTTRANSPORT_HANDLE_DATA</a>, *<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>;</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160; </div>
<div class="line"><a name="l00207"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">  207</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM_TAG</a></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;{</div>
<div class="line"><a name="l00209"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a6cbf7ebcadd8fbedeff684d1571cdfb9">  209</a></span>&#160;    <a class="code" href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a> <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a6cbf7ebcadd8fbedeff684d1571cdfb9">msgPublishTime</a>;</div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a53f4c3d2df8deb260a5aad5bf5a44333">  210</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a53f4c3d2df8deb260a5aad5bf5a44333">retryCount</a>;</div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a3e4877f0d8a7f9c150b2f49045cd751c">  211</a></span>&#160;    IOTHUB_IDENTITY_TYPE <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a3e4877f0d8a7f9c150b2f49045cd751c">iothub_type</a>;</div>
<div class="line"><a name="l00212"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">  212</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a>;</div>
<div class="line"><a name="l00213"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a25b65bcd6d310d91ecc5f962d823977c">  213</a></span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a25b65bcd6d310d91ecc5f962d823977c">iothub_msg_id</a>;</div>
<div class="line"><a name="l00214"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#af4ce9e6cc6550d04c63f2f2e52ddee28">  214</a></span>&#160;    <a class="code" href="structIOTHUB__DEVICE__TWIN__TAG.html">IOTHUB_DEVICE_TWIN</a>* <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#af4ce9e6cc6550d04c63f2f2e52ddee28">device_twin_data</a>;</div>
<div class="line"><a name="l00215"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a7772609c09ce568b73d040081e6a7cc6">  215</a></span>&#160;    <a class="code" href="iothubtransport__mqtt__common_8c.html#aa8a6dde4462576eb23c4f1e6d640645f">DEVICE_TWIN_MSG_TYPE</a> <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a7772609c09ce568b73d040081e6a7cc6">device_twin_msg_type</a>;</div>
<div class="line"><a name="l00216"></a><span class="lineno"><a class="line" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a57376049aa40b9b7ff926302082a300d">  216</a></span>&#160;    <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a57376049aa40b9b7ff926302082a300d">entry</a>;</div>
<div class="line"><a name="l00217"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a2ab3ca33bc3e2806ef0e08b7e1629a1a">  217</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#a2ab3ca33bc3e2806ef0e08b7e1629a1a">MQTT_DEVICE_TWIN_ITEM</a>;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160; </div>
<div class="line"><a name="l00219"></a><span class="lineno"><a class="line" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">  219</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST_TAG</a></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;{</div>
<div class="line"><a name="l00221"></a><span class="lineno"><a class="line" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a62baa2b850b021a73e060abc2abd445e">  221</a></span>&#160;    <a class="code" href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a> <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a62baa2b850b021a73e060abc2abd445e">msgPublishTime</a>;</div>
<div class="line"><a name="l00222"></a><span class="lineno"><a class="line" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a23a9cb715c409bb3717c1cd639420115">  222</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a23a9cb715c409bb3717c1cd639420115">retryCount</a>;</div>
<div class="line"><a name="l00223"></a><span class="lineno"><a class="line" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">  223</a></span>&#160;    <a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html">IOTHUB_MESSAGE_LIST</a>* <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a>;</div>
<div class="line"><a name="l00224"></a><span class="lineno"><a class="line" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a78af22162c3a552f3551875a7e0b14e2">  224</a></span>&#160;    <span class="keywordtype">void</span>* <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a78af22162c3a552f3551875a7e0b14e2">context</a>;</div>
<div class="line"><a name="l00225"></a><span class="lineno"><a class="line" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#ace3e7c2cb335867f8656c2aae59ae45d">  225</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#ace3e7c2cb335867f8656c2aae59ae45d">packet_id</a>;</div>
<div class="line"><a name="l00226"></a><span class="lineno"><a class="line" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a288be39015fc48b7701b36f4d8a6cd5e">  226</a></span>&#160;    <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a288be39015fc48b7701b36f4d8a6cd5e">entry</a>;</div>
<div class="line"><a name="l00227"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#af468c9035b44315d96c7563bd0882aca">  227</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#aa0b36fe7e83a4d575b40390c764c7d04">MQTT_MESSAGE_DETAILS_LIST</a>, *<a class="code" href="iothubtransport__mqtt__common_8c.html#af468c9035b44315d96c7563bd0882aca">PMQTT_MESSAGE_DETAILS_LIST</a>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160; </div>
<div class="line"><a name="l00229"></a><span class="lineno"><a class="line" href="structDEVICE__METHOD__INFO__TAG.html">  229</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structDEVICE__METHOD__INFO__TAG.html">DEVICE_METHOD_INFO_TAG</a></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;{</div>
<div class="line"><a name="l00231"></a><span class="lineno"><a class="line" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">  231</a></span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">request_id</a>;</div>
<div class="line"><a name="l00232"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#adc89704e51e8456f1322146438879d61">  232</a></span>&#160;} <a class="code" href="iothubtransport__mqtt__common_8c.html#adc89704e51e8456f1322146438879d61">DEVICE_METHOD_INFO</a>;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> free_proxy_data(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* mqtt_transport_instance)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;{</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;    <span class="keywordflow">if</span> (mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a>);</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;        mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    }</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    <span class="keywordflow">if</span> (mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">http_proxy_username</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;    {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">http_proxy_username</a>);</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;        mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">http_proxy_username</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    }</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160; </div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;    <span class="keywordflow">if</span> (mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">http_proxy_password</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;    {</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">http_proxy_password</a>);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;        mqtt_transport_instance-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">http_proxy_password</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;    }</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;}</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160; </div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> set_saved_tls_options(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport, <a class="code" href="structOPTIONHANDLER__HANDLE__DATA__TAG.html">OPTIONHANDLER_HANDLE</a> new_options)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;{</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <span class="keywordflow">if</span> (transport-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">saved_tls_options</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    {</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;        <a class="code" href="optionhandler_8c.html#a4b32e141221e6cdfaa44ac5e0e87711f">OptionHandler_Destroy</a>(transport-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">saved_tls_options</a>);</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;    transport-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">saved_tls_options</a> = new_options;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;}</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160; </div>
<div class="line"><a name="l00264"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a8db9bc2e3db478df58b8f27db5d677e3">  264</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a8db9bc2e3db478df58b8f27db5d677e3">IoTHubTransport_MQTT_Common_SetRetryPolicy</a>(<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> handle, IOTHUB_CLIENT_RETRY_POLICY retryPolicy, <span class="keywordtype">size_t</span> retryTimeoutLimitInSeconds)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;{</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160; </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <span class="keywordflow">if</span> (handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    {</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_25_041: [**If any handle is NULL then IoTHubTransport_MQTT_Common_SetRetryPolicy shall return resultant line.] */</span></div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid handle parameter. NULL.&quot;</span>);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    }</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        <a class="code" href="structRETRY__CONTROL__INSTANCE__TAG.html">RETRY_CONTROL_HANDLE</a> new_retry_control_handle;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160; </div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_006: [ IoTHubTransport_MQTT_Common_SetRetryPolicy shall set the retry logic by calling retry_control_create() with retry policy and retryTimeout as parameters]</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_009: [ If retry_control_create() fails then IoTHubTransport_MQTT_Common_SetRetryPolicy shall revert to previous retry policy and return non-zero value ]</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <span class="keywordflow">if</span> ((new_retry_control_handle = <a class="code" href="iothub__client__retry__control_8c.html#a6b39a45fa0661693171238e1e56112f3">retry_control_create</a>(retryPolicy, (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)retryTimeoutLimitInSeconds)) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        {</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed creating new retry control handle&quot;</span>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        {</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <a class="code" href="structRETRY__CONTROL__INSTANCE__TAG.html">RETRY_CONTROL_HANDLE</a> previous_retry_control_handle = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">retry_control_handle</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160; </div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">retry_control_handle</a> = new_retry_control_handle;</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(previous_retry_control_handle);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160; </div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_25_045: [**If retry logic for specified parameters of retry policy and retryTimeoutLimitInSeconds is created successfully then IoTHubTransport_MQTT_Common_SetRetryPolicy shall return 0]*/</span></div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            result = 0;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        }</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;    }</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160; </div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;}</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160; </div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;<span class="keyword">static</span> <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> get_next_packet_id(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data)</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;{</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af99d7773335eed48365d6e54abae3ebf">packetId</a>+1 &gt;= <a class="code" href="limits_8h.html#a689b119da994dece91d44b5aeac643ed">USHRT_MAX</a>)</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    {</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af99d7773335eed48365d6e54abae3ebf">packetId</a> = 1;</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    }</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;    {</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af99d7773335eed48365d6e54abae3ebf">packetId</a>++;</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;    }</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <span class="keywordflow">return</span> transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af99d7773335eed48365d6e54abae3ebf">packetId</a>;</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;}</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160; </div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>* retrieve_mqtt_return_codes(<a class="code" href="mqttconst_8h.html#acebcb96b6f2b1dc376db101b5b763a26">CONNECT_RETURN_CODE</a> rtn_code)</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;{</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordflow">switch</span> (rtn_code)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61ad1e8baf8f019f73c4a13f2f087d96806">CONNECTION_ACCEPTED</a>:</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Accepted&quot;</span>;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a0f5ba76cc3adf64c3f79f71d1cfe226e">CONN_REFUSED_UNACCEPTABLE_VERSION</a>:</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unacceptable Version&quot;</span>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61aecbeec60d028ae11cf66d405507c4848">CONN_REFUSED_ID_REJECTED</a>:</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Id Rejected&quot;</span>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61ad7ad3f0642483fa35a79b11e2e60f767">CONN_REFUSED_SERVER_UNAVAIL</a>:</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Server Unavailable&quot;</span>;</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61afb522d125f454b5343f746711327949d">CONN_REFUSED_BAD_USERNAME_PASSWORD</a>:</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Bad Username/Password&quot;</span>;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a79a2775d065472ffcb445df30fea63fd">CONN_REFUSED_NOT_AUTHORIZED</a>:</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Not Authorized&quot;</span>;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a64078d6ef772f59c0f74510c377641c3">CONN_REFUSED_UNKNOWN</a>:</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordflow">return</span> <span class="stringliteral">&quot;Unknown&quot;</span>;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    }</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;}</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160; </div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> retrieve_device_method_rid_info(<span class="keyword">const</span> <span class="keywordtype">char</span>* resp_topic, <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> method_name, <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> request_id)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;{</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;    <a class="code" href="structSTRING__TOKEN__TAG.html">STRING_TOKENIZER_HANDLE</a> token_handle = <a class="code" href="string__tokenizer_8c.html#a2032010d1f316263b1d1692bafce9888">STRING_TOKENIZER_create_from_char</a>(resp_topic);</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;    <span class="keywordflow">if</span> (token_handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;    {</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed creating token from device twin topic.&quot;</span>);</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;    }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    {</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;        <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> token_value;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <span class="keywordflow">if</span> ((token_value = <a class="code" href="strings_8c.html#ade72be627db6a28a2efe5c0340ae47b3">STRING_new</a>()) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed allocating new string .&quot;</span>);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;        }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;        {</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordtype">size_t</span> token_index = 0;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;            <span class="keywordtype">size_t</span> request_id_length = strlen(REQUEST_ID_PROPERTY);</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            <span class="keywordflow">while</span> (<a class="code" href="string__tokenizer_8c.html#a61087f8cee735b8d1e9149b999cf8955">STRING_TOKENIZER_get_next_token</a>(token_handle, token_value, <span class="stringliteral">&quot;/&quot;</span>) == 0)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;            {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                <span class="keywordflow">if</span> (token_index == 3)</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="strings_8c.html#aa4a3f5638a574f7dfad01419df072e2a">STRING_concat_with_STRING</a>(method_name, token_value) != 0)</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                    {</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed STRING_concat_with_STRING.&quot;</span>);</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                    }</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                }</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token_index == 4)</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                {</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="strings_8c.html#ad5dac28de3fdf01777ac937fa876ac3c">STRING_length</a>(token_value) &gt;= request_id_length)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                    {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span>* request_id_value = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(token_value);</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;                        <span class="keywordflow">if</span> (memcmp(request_id_value, REQUEST_ID_PROPERTY, request_id_length) == 0)</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                        {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="strings_8c.html#ae97f94b5ef464ef7b5fdcf0fb6eb6bf1">STRING_concat</a>(request_id, request_id_value+request_id_length) != 0)</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                            {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed STRING_concat failed.&quot;</span>);</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                            }</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                            {</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                                result = 0;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                            }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                        }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                    }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                token_index++;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;            }</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(token_value);</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;        <a class="code" href="string__tokenizer_8c.html#a9feb65ab75511ffba42b7c1c24aa24fa">STRING_TOKENIZER_destroy</a>(token_handle);</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;    }</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;}</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> parse_device_twin_topic_info(<span class="keyword">const</span> <span class="keywordtype">char</span>* resp_topic, <span class="keywordtype">bool</span>* patch_msg, <span class="keywordtype">size_t</span>* request_id, <span class="keywordtype">int</span>* status_code)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;{</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;    <a class="code" href="structSTRING__TOKEN__TAG.html">STRING_TOKENIZER_HANDLE</a> token_handle = <a class="code" href="string__tokenizer_8c.html#a2032010d1f316263b1d1692bafce9888">STRING_TOKENIZER_create_from_char</a>(resp_topic);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;    <span class="keywordflow">if</span> (token_handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    {</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed creating token from device twin topic.&quot;</span>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        *status_code = 0;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        *request_id = 0;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        *patch_msg = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;    }</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;    {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> token_value;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        <span class="keywordflow">if</span> ((token_value = <a class="code" href="strings_8c.html#ade72be627db6a28a2efe5c0340ae47b3">STRING_new</a>()) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        {</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed allocating new string .&quot;</span>);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;            *status_code = 0;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            *request_id = 0;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            *patch_msg = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;        }</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        {</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordtype">size_t</span> token_count = 0;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">while</span> (<a class="code" href="string__tokenizer_8c.html#a61087f8cee735b8d1e9149b999cf8955">STRING_TOKENIZER_get_next_token</a>(token_handle, token_value, <span class="stringliteral">&quot;/&quot;</span>) == 0)</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;            {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                <span class="keywordflow">if</span> (token_count == 2)</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                {</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                    <span class="keywordflow">if</span> (strcmp(<a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(token_value), <span class="stringliteral">&quot;PATCH&quot;</span>) == 0)</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                    {</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        *patch_msg = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                        *status_code = 0;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                        *request_id = 0;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                        result = 0;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    {</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                        *patch_msg = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                    }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token_count == 3)</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                    *status_code = <a class="code" href="stdlib__noniso_8h.html#a825c37450147a643edbcb1a435518307">atol</a>(<a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(token_value));</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="string__tokenizer_8c.html#a61087f8cee735b8d1e9149b999cf8955">STRING_TOKENIZER_get_next_token</a>(token_handle, token_value, <span class="stringliteral">&quot;/?$rid=&quot;</span>) == 0)</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                    {</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                        *request_id = (size_t)<a class="code" href="stdlib__noniso_8h.html#a825c37450147a643edbcb1a435518307">atol</a>(<a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(token_value));</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                    }</div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;                    *patch_msg = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;                    result = 0;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;                token_count++;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;            }</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(token_value);</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        }</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <a class="code" href="string__tokenizer_8c.html#a9feb65ab75511ffba42b7c1c24aa24fa">STRING_TOKENIZER_destroy</a>(token_handle);</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;    }</div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;}</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160; </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;<span class="keyword">static</span> IOTHUB_IDENTITY_TYPE retrieve_topic_type(<span class="keyword">const</span> <span class="keywordtype">char</span>* topic_resp)</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;{</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;    IOTHUB_IDENTITY_TYPE <a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;    <span class="keywordtype">size_t</span> dev_twin_topic_len = <span class="keyword">sizeof</span>(TOPIC_DEVICE_TWIN_PREFIX)-1;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;    <span class="keywordtype">size_t</span> dev_method_topic_len = <span class="keyword">sizeof</span>(TOPIC_DEVICE_METHOD_PREFIX)-1;</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;    <span class="keywordtype">size_t</span> topic_len = strlen(topic_resp);</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;    <span class="keywordtype">size_t</span> len_to_use = (dev_twin_topic_len &gt; dev_method_topic_len) ? dev_twin_topic_len : dev_method_topic_len;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160; </div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    <span class="keywordtype">bool</span> search_device_twin = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;    <span class="keywordtype">bool</span> search_device_method = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;    <span class="keywordflow">if</span> (topic_len &lt; len_to_use)</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;    {</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;        search_device_twin = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;        search_device_method = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;    {</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        <span class="keywordtype">size_t</span> <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0;</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;        <span class="keywordflow">for</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0; <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &lt; len_to_use &amp;&amp; (search_device_twin || search_device_method); <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;        {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;            <span class="keywordflow">if</span> (search_device_twin)</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;            {</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &gt; dev_twin_topic_len)</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                {</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                    search_device_twin = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                }</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                {</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> == dev_twin_topic_len)</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;                    {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                    }</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="crt__abstractions_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(TOPIC_DEVICE_TWIN_PREFIX[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>]) != <a class="code" href="crt__abstractions_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(topic_resp[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>]))</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;                    {</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                        search_device_twin = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                    }</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;                }</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            }</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            <span class="keywordflow">if</span> (search_device_method)</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;            {</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &gt; dev_method_topic_len)</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                {</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;                    search_device_method = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;                }</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                {</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> == dev_method_topic_len)</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;                    {</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;                    }</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="crt__abstractions_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(TOPIC_DEVICE_METHOD_PREFIX[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>]) != <a class="code" href="crt__abstractions_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a>(topic_resp[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>]))</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;                    {</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;                        search_device_method = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;                    }</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;                }</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            }</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;        }</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    }</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;    <span class="keywordflow">if</span> (search_device_twin)</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;    {</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a> = IOTHUB_TYPE_DEVICE_TWIN;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;    }</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (search_device_method)</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;    {</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a> = IOTHUB_TYPE_DEVICE_METHODS;</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;    }</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;    {</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;        <a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a> = IOTHUB_TYPE_TELEMETRY;</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;    }</div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a>;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;}</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160; </div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> sendMsgComplete(<a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html">IOTHUB_MESSAGE_LIST</a>* iothubMsgList, <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data, IOTHUB_CLIENT_CONFIRMATION_RESULT confirmResult)</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;{</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;    <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> messageCompleted;</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;    <a class="code" href="doublylinkedlist_8c.html#a682ace80db3a8d5af3ba733320f31303">DList_InitializeListHead</a>(&amp;messageCompleted);</div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;    <a class="code" href="doublylinkedlist_8c.html#aed0982baf1c3937160e7a87d92045f10">DList_InsertTailList</a>(&amp;messageCompleted, &amp;(iothubMsgList-&gt;<a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html#aad1c9c47677735aff2e3e6550cdab1e4">entry</a>));</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;    <a class="code" href="iothub__client__ll_8c.html#abe2bd68f404baeadc5e0d2a4e23bfa5b">IoTHubClient_LL_SendComplete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, &amp;messageCompleted, confirmResult);</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;}</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160; </div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="keyword">static</span> <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> addPropertiesTouMqttMessage(<a class="code" href="structIOTHUB__MESSAGE__HANDLE__DATA__TAG.html">IOTHUB_MESSAGE_HANDLE</a> iothub_message_handle, <span class="keyword">const</span> <span class="keywordtype">char</span>* eventTopic)</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;{</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> result = <a class="code" href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a>(eventTopic);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span>* propertyKeys;</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">char</span>* <span class="keyword">const</span>* propertyValues;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;    <span class="keywordtype">size_t</span> propertyCount;</div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160; </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;    <span class="comment">// Construct Properties</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;    <a class="code" href="structMAP__HANDLE__DATA__TAG.html">MAP_HANDLE</a> properties_map = <a class="code" href="iothub__message_8c.html#a2ab46db5ad9db0b497b5171e21b64ea2">IoTHubMessage_Properties</a>(iothub_message_handle);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;    <span class="keywordflow">if</span> (properties_map != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;    {</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="map_8c.html#ac97e499fa2f9b6830679e519185cd260">Map_GetInternals</a>(properties_map, &amp;propertyKeys, &amp;propertyValues, &amp;propertyCount) != MAP_OK)</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;        {</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed to get the internals of the property map.&quot;</span>);</div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(result);</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;            result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;        }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;        {</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            <span class="keywordflow">if</span> (propertyCount != 0)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            {</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                <span class="keywordflow">for</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0; <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &lt; propertyCount &amp;&amp; result != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>; <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++)</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                {</div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab164a927aa4332e08b3698398beb3861">STRING_sprintf</a>(result, <span class="stringliteral">&quot;%s=%s%s&quot;</span>, propertyKeys[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>], propertyValues[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>], propertyCount - 1 == <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> ? <span class="stringliteral">&quot;&quot;</span> : PROPERTY_SEPARATOR) != 0)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                    {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed construting property string.&quot;</span>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(result);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;                        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                    }</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                }</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            }</div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;        }</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;    }</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160; </div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_052: [ IoTHubTransport_MQTT_Common_DoWork shall check for the CorrelationId property and if found add the value as a system property in the format of $.cid=&lt;id&gt; ] */</span></div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;    {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* correlation_id = <a class="code" href="iothub__message_8c.html#aac9f6f33fc89f91ffa7853692a1555b6">IoTHubMessage_GetCorrelationId</a>(iothub_message_handle);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;        <span class="keywordflow">if</span> (correlation_id != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;        {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab164a927aa4332e08b3698398beb3861">STRING_sprintf</a>(result, <span class="stringliteral">&quot;%s%%24.cid=%s&quot;</span>, <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> == 0 ? <span class="stringliteral">&quot;&quot;</span> : PROPERTY_SEPARATOR, correlation_id) != 0)</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            {</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed setting correlation id.&quot;</span>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(result);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            }</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++;</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;        }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;    }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_053: [ IoTHubTransport_MQTT_Common_DoWork shall check for the MessageId property and if found add the value as a system property in the format of $.mid=&lt;id&gt; ] */</span></div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;    {</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* msg_id = <a class="code" href="iothub__message_8c.html#ada4fa36e8ab3af2759a6e5703d55dc29">IoTHubMessage_GetMessageId</a>(iothub_message_handle);</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;        <span class="keywordflow">if</span> (msg_id != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;        {</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab164a927aa4332e08b3698398beb3861">STRING_sprintf</a>(result, <span class="stringliteral">&quot;%s%%24.mid=%s&quot;</span>, <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> == 0 ? <span class="stringliteral">&quot;&quot;</span> : PROPERTY_SEPARATOR, msg_id) != 0)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;            {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed setting message id.&quot;</span>);</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(result);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;                result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            }</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        }</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;    }</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160; </div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_010: [ `IoTHubTransport_MQTT_Common_DoWork` shall check for the ContentType property and if found add the `value` as a system property in the format of `$.ct=&lt;value&gt;` ]</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;    {</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* content_type = <a class="code" href="iothub__message_8c.html#ab01841e548f7119ab833be50695de241">IoTHubMessage_GetContentTypeSystemProperty</a>(iothub_message_handle);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;        <span class="keywordflow">if</span> (content_type != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;        {</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab164a927aa4332e08b3698398beb3861">STRING_sprintf</a>(result, <span class="stringliteral">&quot;%s%%24.%s=%s&quot;</span>, <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> == 0 ? <span class="stringliteral">&quot;&quot;</span> : PROPERTY_SEPARATOR, CONTENT_TYPE_PROPERTY, content_type) != 0)</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed setting content type.&quot;</span>);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(result);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++;</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;        }</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;    }</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;    <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_011: [ `IoTHubTransport_MQTT_Common_DoWork` shall check for the ContentEncoding property and if found add the `value` as a system property in the format of `$.ce=&lt;value&gt;` ]</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    <span class="keywordflow">if</span> (result != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;    {</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* content_encoding = <a class="code" href="iothub__message_8c.html#ab3db6de666d01e3d5730e1d2db592832">IoTHubMessage_GetContentEncodingSystemProperty</a>(iothub_message_handle);</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">if</span> (content_encoding != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;        {</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab164a927aa4332e08b3698398beb3861">STRING_sprintf</a>(result, <span class="stringliteral">&quot;%s%%24.%s=%s&quot;</span>, <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> == 0 ? <span class="stringliteral">&quot;&quot;</span> : PROPERTY_SEPARATOR, CONTENT_ENCODING_PROPERTY, content_encoding) != 0)</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed setting content encoding.&quot;</span>);</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(result);</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;            }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    }</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160; </div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;}</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160; </div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> publish_mqtt_telemetry_msg(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data, <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>* mqttMsgEntry, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* payload, <span class="keywordtype">size_t</span> len)</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;{</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> msgTopic = addPropertiesTouMqttMessage(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a>-&gt;<a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html#a1bbd4c03b7fcff198e14e92d7c36299c">messageHandle</a>, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5d5870c74de2d33a04df2031b3984e7f">topic_MqttEvent</a>));</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="keywordflow">if</span> (msgTopic == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed adding properties to mqtt message&quot;</span>);</div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    }</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    {</div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;        <a class="code" href="structMQTT__MESSAGE__TAG.html">MQTT_MESSAGE_HANDLE</a> mqttMsg = <a class="code" href="mqtt__message_8c.html#a9041854bcbe0282279b3b6a3d026e410">mqttmessage_create</a>(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#ace3e7c2cb335867f8656c2aae59ae45d">packet_id</a>, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(msgTopic), DELIVER_AT_LEAST_ONCE, payload, len);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;        <span class="keywordflow">if</span> (mqttMsg == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        {</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed creating mqtt message&quot;</span>);</div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        }</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>, &amp;mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a62baa2b850b021a73e060abc2abd445e">msgPublishTime</a>) != 0)</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed retrieving tickcounter info&quot;</span>);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            }</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            {</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#ad25607626f5b458479b1b036bd5ece09">mqtt_client_publish</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, mqttMsg) != 0)</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                {</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed attempting to publish mqtt message&quot;</span>);</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;                {</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                    mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a23a9cb715c409bb3717c1cd639420115">retryCount</a>++;</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                    result = 0;</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                }</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;            }</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <a class="code" href="mqtt__message_8c.html#aa989373213799bd06af9a9c464330b43">mqttmessage_destroy</a>(mqttMsg);</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;        }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(msgTopic);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;    }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;}</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160; </div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> publish_device_method_message(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* transport_data, <span class="keywordtype">int</span> status_code, <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> request_id, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* response, <span class="keywordtype">size_t</span> response_size)</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;{</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> packet_id = get_next_packet_id(transport_data);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160; </div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> msg_topic = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(DEVICE_METHOD_RESPONSE_TOPIC, status_code, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(request_id) );</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;    <span class="keywordflow">if</span> (msg_topic == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;    {</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed constructing message topic.&quot;</span>);</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;    }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;    {</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;        <a class="code" href="structMQTT__MESSAGE__TAG.html">MQTT_MESSAGE_HANDLE</a> mqtt_get_msg = <a class="code" href="mqtt__message_8c.html#a9041854bcbe0282279b3b6a3d026e410">mqttmessage_create</a>(packet_id, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(msg_topic), DELIVER_AT_MOST_ONCE, response, response_size);</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">if</span> (mqtt_get_msg == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;        {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed constructing mqtt message.&quot;</span>);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        {</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#ad25607626f5b458479b1b036bd5ece09">mqtt_client_publish</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, mqtt_get_msg) != 0)</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;            {</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed publishing to mqtt client.&quot;</span>);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;                result = 0;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;            }</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;            <a class="code" href="mqtt__message_8c.html#aa989373213799bd06af9a9c464330b43">mqttmessage_destroy</a>(mqtt_get_msg);</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(msg_topic);</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;}</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160; </div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> publish_device_twin_get_message(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* transport_data)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;{</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;    <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>* mqtt_info = (<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>));</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;    <span class="keywordflow">if</span> (mqtt_info == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;    {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed allocating device twin data.&quot;</span>);</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a> = get_next_packet_id(transport_data);</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;        mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a25b65bcd6d310d91ecc5f962d823977c">iothub_msg_id</a> = 0;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;        mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a7772609c09ce568b73d040081e6a7cc6">device_twin_msg_type</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053afd629b7eabf994cb88b008a887ec2533">RETRIEVE_PROPERTIES</a>;</div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;        mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a53f4c3d2df8deb260a5aad5bf5a44333">retryCount</a> = 0;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;        mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a6cbf7ebcadd8fbedeff684d1571cdfb9">msgPublishTime</a> = 0;</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;        mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a3e4877f0d8a7f9c150b2f49045cd751c">iothub_type</a> = IOTHUB_TYPE_DEVICE_TWIN;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#af4ce9e6cc6550d04c63f2f2e52ddee28">device_twin_data</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;        <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> msg_topic = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(GET_PROPERTIES_TOPIC, mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a>);</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;        <span class="keywordflow">if</span> (msg_topic == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;        {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed constructing get Prop topic.&quot;</span>);</div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_info);</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;            <a class="code" href="structMQTT__MESSAGE__TAG.html">MQTT_MESSAGE_HANDLE</a> mqtt_get_msg = <a class="code" href="mqtt__message_8c.html#a9041854bcbe0282279b3b6a3d026e410">mqttmessage_create</a>(mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a>, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(msg_topic), DELIVER_AT_MOST_ONCE, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;            <span class="keywordflow">if</span> (mqtt_get_msg == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed constructing mqtt message.&quot;</span>);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_info);</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;            {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#ad25607626f5b458479b1b036bd5ece09">mqtt_client_publish</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, mqtt_get_msg) != 0)</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                {</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed publishing to mqtt client.&quot;</span>);</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                    <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_info);</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                }</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                {</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                    <a class="code" href="doublylinkedlist_8c.html#aed0982baf1c3937160e7a87d92045f10">DList_InsertTailList</a>(&amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">ack_waiting_queue</a>, &amp;mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a57376049aa40b9b7ff926302082a300d">entry</a>);</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                    result = 0;</div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                }</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                <a class="code" href="mqtt__message_8c.html#aa989373213799bd06af9a9c464330b43">mqttmessage_destroy</a>(mqtt_get_msg);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(msg_topic);</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;        }</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;    }</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;}</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160; </div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> publish_device_twin_message(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* transport_data, <a class="code" href="structIOTHUB__DEVICE__TWIN__TAG.html">IOTHUB_DEVICE_TWIN</a>* device_twin_info, <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>* mqtt_info)</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;{</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;    mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a> = get_next_packet_id(transport_data);</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;    mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a7772609c09ce568b73d040081e6a7cc6">device_twin_msg_type</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053a87a9746e9955eebaafc028505df46f93">REPORTED_STATE</a>;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> msgTopic = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(REPORTED_PROPERTIES_TOPIC, mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a>);</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;    <span class="keywordflow">if</span> (msgTopic == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;    {</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed constructing reported prop topic.&quot;</span>);</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;    }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;    {</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;        <span class="keyword">const</span> <a class="code" href="structCONSTBUFFER__TAG.html">CONSTBUFFER</a>* data_buff = <a class="code" href="constbuffer_8c.html#a931efe3e168c876c6783bfd41b163ea3">CONSTBUFFER_GetContent</a>(device_twin_info-&gt;<a class="code" href="structIOTHUB__DEVICE__TWIN__TAG.html#afb50cd42a753722a68a102552376b0e1">report_data_handle</a>);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;        <a class="code" href="structMQTT__MESSAGE__TAG.html">MQTT_MESSAGE_HANDLE</a> mqtt_rpt_msg = <a class="code" href="mqtt__message_8c.html#a9041854bcbe0282279b3b6a3d026e410">mqttmessage_create</a>(mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a>, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(msgTopic), DELIVER_AT_MOST_ONCE, data_buff-&gt;<a class="code" href="structCONSTBUFFER__TAG.html#ad35ed43e51ef98390f30105439448d6b">buffer</a>, data_buff-&gt;<a class="code" href="structCONSTBUFFER__TAG.html#ac7fbc8670a6b57a2b1c6bea1a5736122">size</a>);</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;        <span class="keywordflow">if</span> (mqtt_rpt_msg == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        {</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed creating mqtt message&quot;</span>);</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;        }</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;        {</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>, &amp;mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a6cbf7ebcadd8fbedeff684d1571cdfb9">msgPublishTime</a>) != 0)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            {</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed retrieving tickcounter info&quot;</span>);</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;            {</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#ad25607626f5b458479b1b036bd5ece09">mqtt_client_publish</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, mqtt_rpt_msg) != 0)</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;                {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed publishing mqtt message&quot;</span>);</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;                }</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;                {</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;                    mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a53f4c3d2df8deb260a5aad5bf5a44333">retryCount</a>++;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;                    result = 0;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;                }</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            }</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            <a class="code" href="mqtt__message_8c.html#aa989373213799bd06af9a9c464330b43">mqttmessage_destroy</a>(mqtt_rpt_msg);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        }</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(msgTopic);</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;}</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160; </div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> isSystemProperty(<span class="keyword">const</span> <span class="keywordtype">char</span>* tokenData)</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;{</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    <span class="keywordtype">bool</span> result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    <span class="keywordtype">size_t</span> propCount = <span class="keyword">sizeof</span>(sysPropList)/<span class="keyword">sizeof</span>(sysPropList[0]);</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;    <span class="keywordflow">for</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0; <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &lt; propCount; <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++)</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    {</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">if</span> (memcmp(tokenData, sysPropList[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>].propName, sysPropList[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>].propLength) == 0)</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            result = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;        }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    }</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;}</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160; </div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> extractMqttProperties(<a class="code" href="structIOTHUB__MESSAGE__HANDLE__DATA__TAG.html">IOTHUB_MESSAGE_HANDLE</a> IoTHubMessage, <span class="keyword">const</span> <span class="keywordtype">char</span>* topic_name)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;{</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> mqttTopic = <a class="code" href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a>(topic_name);</div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <span class="keywordflow">if</span> (mqttTopic == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    {</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure constructing string topic name.&quot;</span>);</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;    }</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    {</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        <a class="code" href="structSTRING__TOKEN__TAG.html">STRING_TOKENIZER_HANDLE</a> token = <a class="code" href="string__tokenizer_8c.html#a8b17e6bd6ded2b367bd6d7f6afe2b748">STRING_TOKENIZER_create</a>(mqttTopic);</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        <span class="keywordflow">if</span> (token != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;        {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <a class="code" href="structMAP__HANDLE__DATA__TAG.html">MAP_HANDLE</a> propertyMap = <a class="code" href="iothub__message_8c.html#a2ab46db5ad9db0b497b5171e21b64ea2">IoTHubMessage_Properties</a>(IoTHubMessage);</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;            <span class="keywordflow">if</span> (propertyMap == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            {</div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure to retrieve IoTHubMessage_properties.&quot;</span>);</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            }</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;            {</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;                <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="tag__strings_8h.html#a7ab6af690f74b3a11c6ec4c691ecae0d">output</a> = <a class="code" href="strings_8c.html#ade72be627db6a28a2efe5c0340ae47b3">STRING_new</a>();</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="tag__strings_8h.html#a7ab6af690f74b3a11c6ec4c691ecae0d">output</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                {</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure to allocate STRING_new.&quot;</span>);</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                }</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                {</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                    result = 0;</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160; </div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                    <span class="keywordflow">while</span> (<a class="code" href="string__tokenizer_8c.html#a61087f8cee735b8d1e9149b999cf8955">STRING_TOKENIZER_get_next_token</a>(token, <a class="code" href="tag__strings_8h.html#a7ab6af690f74b3a11c6ec4c691ecae0d">output</a>, PROPERTY_SEPARATOR) == 0 &amp;&amp; result == 0)</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                    {</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                        <span class="keyword">const</span> <span class="keywordtype">char</span>* tokenData = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(<a class="code" href="tag__strings_8h.html#a7ab6af690f74b3a11c6ec4c691ecae0d">output</a>);</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                        <span class="keywordtype">size_t</span> tokenLen = strlen(tokenData);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                        <span class="keywordflow">if</span> (tokenData == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || tokenLen == 0)</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                        {</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                        }</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                        {</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                            <span class="keywordflow">if</span> (isSystemProperty(tokenData))</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                            {</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">char</span>* iterator = tokenData;</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;                                <span class="keywordflow">while</span> (iterator != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; *iterator != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; result == 0)</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;                                {</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;                                    <span class="keywordflow">if</span> (*iterator == <span class="charliteral">&#39;=&#39;</span>)</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;                                    {</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;                                        <span class="keywordtype">size_t</span> nameLen = iterator - tokenData;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;                                        <span class="keywordtype">char</span>* propName = <a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(nameLen + 1);</div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160; </div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;                                        <span class="keywordtype">size_t</span> valLen = tokenLen - (nameLen + 1) + 1;</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;                                        <span class="keywordtype">char</span>* propValue = <a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(valLen + 1);</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160; </div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;                                        <span class="keywordflow">if</span> (propName == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || propValue == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;                                        {</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;                                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed allocating property name (%p) and/or value (%p)&quot;</span>, propName, propValue);</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;                                            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;                                        }</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;                                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;                                        {</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;                                            strncpy(propName, tokenData, nameLen);</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;                                            propName[nameLen] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160; </div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;                                            strncpy(propValue, iterator + 1, valLen);</div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;                                            propValue[valLen] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160; </div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;                                            <span class="keywordflow">if</span> (nameLen &gt; 2)</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;                                            {</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;                                                <span class="keywordflow">if</span> (nameLen &gt; 3)</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;                                                {</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;                                                    <span class="keywordflow">if</span> (strcmp((<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;propName[nameLen - 3], MESSAGE_ID_PROPERTY) == 0)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                                                    {</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;                                                        <span class="keywordflow">if</span> (<a class="code" href="iothub__message_8c.html#a3d5f3d8a6da59b259f170de613c61cc0">IoTHubMessage_SetMessageId</a>(IoTHubMessage, propValue) != IOTHUB_MESSAGE_OK)</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;                                                        {</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;                                                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed to set IOTHUB_MESSAGE_HANDLE &#39;messageId&#39; property.&quot;</span>);</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                                                            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                                                        }</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;                                                    }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;                                                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp((<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;propName[nameLen - 3], CORRELATION_ID_PROPERTY) == 0)</div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;                                                    {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;                                                        <span class="keywordflow">if</span> (<a class="code" href="iothub__message_8c.html#afcc4a3e4e8ac287b0a9a3850c5a72248">IoTHubMessage_SetCorrelationId</a>(IoTHubMessage, propValue) != IOTHUB_MESSAGE_OK)</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                                                        {</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;                                                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed to set IOTHUB_MESSAGE_HANDLE &#39;correlationId&#39; property.&quot;</span>);</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;                                                            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;                                                        }</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;                                                    }</div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;                                                }</div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160; </div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160;                                                <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_012: [ If type is IOTHUB_TYPE_TELEMETRY and the system property `$.ct` is defined, its value shall be set on the IOTHUB_MESSAGE_HANDLE&#39;s ContentType property ]</span></div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;                                                <span class="keywordflow">if</span> (strcmp((<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;propName[nameLen - 2], CONTENT_TYPE_PROPERTY) == 0)</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;                                                {</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;                                                    <span class="keywordflow">if</span> (<a class="code" href="iothub__message_8c.html#af5961a16ad97a128434cbdde78a91b4c">IoTHubMessage_SetContentTypeSystemProperty</a>(IoTHubMessage, propValue) != IOTHUB_MESSAGE_OK)</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;                                                    {</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;                                                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed to set IOTHUB_MESSAGE_HANDLE &#39;customContentType&#39; property.&quot;</span>);</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;                                                        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;                                                    }</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;                                                }</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;                                                <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_013: [ If type is IOTHUB_TYPE_TELEMETRY and the system property `$.ce` is defined, its value shall be set on the IOTHUB_MESSAGE_HANDLE&#39;s ContentEncoding property ]</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;                                                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp((<span class="keyword">const</span> <span class="keywordtype">char</span>*)&amp;propName[nameLen - 2], CONTENT_ENCODING_PROPERTY) == 0)</div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;                                                {</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;                                                    <span class="keywordflow">if</span> (<a class="code" href="iothub__message_8c.html#abd1c044606f8c70df4f1af9b19a7a85f">IoTHubMessage_SetContentEncodingSystemProperty</a>(IoTHubMessage, propValue) != IOTHUB_MESSAGE_OK)</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160;                                                    {</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;                                                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed to set IOTHUB_MESSAGE_HANDLE &#39;contentEncoding&#39; property.&quot;</span>);</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;                                                        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                                                    }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                                                }</div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                                            }</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                                        }</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(propName);</div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(propValue);</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160; </div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;                                    }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;                                    iterator++;</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;                                }</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;                            }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;                            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;                            {</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;                                <span class="keyword">const</span> <span class="keywordtype">char</span>* iterator = tokenData;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;                                <span class="keywordflow">while</span> (iterator != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; *iterator != <span class="charliteral">&#39;\0&#39;</span> &amp;&amp; result == 0)</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;                                {</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;                                    <span class="keywordflow">if</span> (*iterator == <span class="charliteral">&#39;=&#39;</span>)</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;                                    {</div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;                                        <span class="keywordtype">size_t</span> nameLen = iterator - tokenData;</div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;                                        <span class="keywordtype">char</span>* propName = <a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(nameLen + 1);</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;                                        <span class="keywordtype">size_t</span> valLen = tokenLen - (nameLen + 1) + 1;</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;                                        <span class="keywordtype">char</span>* propValue = <a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(valLen + 1);</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160; </div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;                                        <span class="keywordflow">if</span> (propName == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || propValue == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                                        {</div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                                            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                                        }</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                                        {</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                                            strncpy(propName, tokenData, nameLen);</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;                                            propName[nameLen] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;                                            strncpy(propValue, iterator + 1, valLen);</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;                                            propValue[valLen] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160; </div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;                                            <span class="keywordflow">if</span> (<a class="code" href="map_8c.html#a3c232f8741686b794a1a767117012497">Map_AddOrUpdate</a>(propertyMap, propName, propValue) != MAP_OK)</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;                                            {</div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;                                                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Map_AddOrUpdate failed.&quot;</span>);</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                                                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;                                            }</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                                        }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(propName);</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(propValue);</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160; </div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                                    }</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                                    iterator++;</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                                }</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                            }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;                        }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;                    }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;                    <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="tag__strings_8h.html#a7ab6af690f74b3a11c6ec4c691ecae0d">output</a>);</div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;                }</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            }</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            <a class="code" href="string__tokenizer_8c.html#a9feb65ab75511ffba42b7c1c24aa24fa">STRING_TOKENIZER_destroy</a>(token);</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;        }</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;        {</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Unable to create Tokenizer object.&quot;</span>);</div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;        }</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(mqttTopic);</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;    }</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;}</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160; </div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> mqtt_notification_callback(<a class="code" href="structMQTT__MESSAGE__TAG.html">MQTT_MESSAGE_HANDLE</a> msgHandle, <span class="keywordtype">void</span>* callbackCtx)</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;{</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;    <span class="comment">/* Tests_SRS_IOTHUB_MQTT_TRANSPORT_07_051: [ If msgHandle or callbackCtx is NULL, mqtt_notification_callback shall do nothing. ] */</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="keywordflow">if</span> (msgHandle != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; callbackCtx != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    {</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;        <span class="comment">/* Tests_SRS_IOTHUB_MQTT_TRANSPORT_07_052: [ mqtt_notification_callback shall extract the topic Name from the MQTT_MESSAGE_HANDLE. ] */</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* topic_resp = <a class="code" href="mqtt__message_8c.html#ac072f8e7cbd8caceffa1a562b0419565">mqttmessage_getTopicName</a>(msgHandle);</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="keywordflow">if</span> (topic_resp == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;        {</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: NULL topic name encountered&quot;</span>);</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;        }</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;        {</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;            <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transportData = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)callbackCtx;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160; </div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;            IOTHUB_IDENTITY_TYPE <a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a> = retrieve_topic_type(topic_resp);</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a> == IOTHUB_TYPE_DEVICE_TWIN)</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;            {</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;                <span class="keywordtype">size_t</span> request_id;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;                <span class="keywordtype">int</span> status_code;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                <span class="keywordtype">bool</span> notification_msg;</div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                <span class="keywordflow">if</span> (parse_device_twin_topic_info(topic_resp, &amp;notification_msg, &amp;request_id, &amp;status_code) != 0)</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                {</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: parsing device topic info&quot;</span>);</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                }</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                {</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;                    <span class="keyword">const</span> <a class="code" href="structAPP__PAYLOAD__TAG.html">APP_PAYLOAD</a>* payload = <a class="code" href="mqtt__message_8c.html#a816f9f513ee65874dbf842a656180619">mqttmessage_getApplicationMsg</a>(msgHandle);</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                    <span class="keywordflow">if</span> (notification_msg)</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;                    {</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                        <a class="code" href="iothub__client__ll_8c.html#a10f7edc7fabd44c9c6b4b6f4fdf3ddb7">IoTHubClient_LL_RetrievePropertyComplete</a>(transportData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, DEVICE_TWIN_UPDATE_PARTIAL, payload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a3bd2c590b04276f02341d3f1c03de5b6">message</a>, payload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a71505d1c172b993e9d0841b9eaf33adf">length</a>);</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                    }</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                    {</div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                        <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> dev_twin_item = transportData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">ack_waiting_queue</a>.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                        <span class="keywordflow">while</span> (dev_twin_item != &amp;transportData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">ack_waiting_queue</a>)</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                        {</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                            <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> saveListEntry;</div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                            saveListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a> = dev_twin_item-&gt;<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                            <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>* msg_entry = <a class="code" href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a>(dev_twin_item, <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>, <a class="code" href="structentry.html">entry</a>);</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                            <span class="keywordflow">if</span> (request_id == msg_entry-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">packet_id</a>)</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                            {</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                                (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a>(dev_twin_item);</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                                <span class="keywordflow">if</span> (msg_entry-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a7772609c09ce568b73d040081e6a7cc6">device_twin_msg_type</a> == <a class="code" href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053afd629b7eabf994cb88b008a887ec2533">RETRIEVE_PROPERTIES</a>)</div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                                {</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;                                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_054: [ If type is IOTHUB_TYPE_DEVICE_TWIN, then on success if msg_type is RETRIEVE_PROPERTIES then mqtt_notification_callback shall call IoTHubClient_LL_RetrievePropertyComplete... ] */</span></div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                                    <a class="code" href="iothub__client__ll_8c.html#a10f7edc7fabd44c9c6b4b6f4fdf3ddb7">IoTHubClient_LL_RetrievePropertyComplete</a>(transportData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, DEVICE_TWIN_UPDATE_COMPLETE, payload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a3bd2c590b04276f02341d3f1c03de5b6">message</a>, payload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a71505d1c172b993e9d0841b9eaf33adf">length</a>);</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                                }</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;                                {</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;                                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_055: [ if device_twin_msg_type is not RETRIEVE_PROPERTIES then mqtt_notification_callback shall call IoTHubClient_LL_ReportedStateComplete ] */</span></div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;                                    <a class="code" href="iothub__client__ll_8c.html#a54e92efb1de9dea85d953a42b4bc1352">IoTHubClient_LL_ReportedStateComplete</a>(transportData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, msg_entry-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a25b65bcd6d310d91ecc5f962d823977c">iothub_msg_id</a>, status_code);</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                                }</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                                <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(msg_entry);</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;                                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;                            }</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;                            dev_twin_item = saveListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;                        }</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;                    }</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;                }</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            }</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a> == IOTHUB_TYPE_DEVICE_METHODS)</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            {</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;                <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> method_name = <a class="code" href="strings_8c.html#ade72be627db6a28a2efe5c0340ae47b3">STRING_new</a>();</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;                <span class="keywordflow">if</span> (method_name == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;                {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: allocating method_name string value&quot;</span>);</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                }</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                {</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                    <a class="code" href="structDEVICE__METHOD__INFO__TAG.html">DEVICE_METHOD_INFO</a>* dev_method_info = <a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structDEVICE__METHOD__INFO__TAG.html">DEVICE_METHOD_INFO</a>) );</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;                    <span class="keywordflow">if</span> (dev_method_info == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                    {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: allocating DEVICE_METHOD_INFO object&quot;</span>);</div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                    }</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                    {</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;                        dev_method_info-&gt;<a class="code" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">request_id</a> = <a class="code" href="strings_8c.html#ade72be627db6a28a2efe5c0340ae47b3">STRING_new</a>();</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                        <span class="keywordflow">if</span> (dev_method_info-&gt;<a class="code" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">request_id</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                        {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure constructing request_id string&quot;</span>);</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(dev_method_info);</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                        }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (retrieve_device_method_rid_info(topic_resp, method_name, dev_method_info-&gt;<a class="code" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">request_id</a>) != 0)</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                        {</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: retrieve device topic info&quot;</span>);</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(dev_method_info-&gt;<a class="code" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">request_id</a>);</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;                            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(dev_method_info);</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;                        }</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;                        {</div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;                            <span class="comment">/* CodesSRS_IOTHUB_MQTT_TRANSPORT_07_053: [ If type is IOTHUB_TYPE_DEVICE_METHODS, then on success mqtt_notification_callback shall call IoTHubClient_LL_DeviceMethodComplete. ] */</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;                            <span class="keyword">const</span> <a class="code" href="structAPP__PAYLOAD__TAG.html">APP_PAYLOAD</a>* payload = <a class="code" href="mqtt__message_8c.html#a816f9f513ee65874dbf842a656180619">mqttmessage_getApplicationMsg</a>(msgHandle);</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="iothub__client__ll_8c.html#ae55eb9c9f31aa54050260249b39ace50">IoTHubClient_LL_DeviceMethodComplete</a>(transportData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(method_name), payload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a3bd2c590b04276f02341d3f1c03de5b6">message</a>, payload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a71505d1c172b993e9d0841b9eaf33adf">length</a>, (<span class="keywordtype">void</span>*)dev_method_info) != 0)</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;                            {</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;                                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: IoTHubClient_LL_DeviceMethodComplete&quot;</span>);</div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;                                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(dev_method_info-&gt;request_id);</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;                                <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(dev_method_info);</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;                            }</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;                        }</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;                    }</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;                    <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(method_name);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;                }</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;            }</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            {</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;                <span class="keyword">const</span> <a class="code" href="structAPP__PAYLOAD__TAG.html">APP_PAYLOAD</a>* appPayload = <a class="code" href="mqtt__message_8c.html#a816f9f513ee65874dbf842a656180619">mqttmessage_getApplicationMsg</a>(msgHandle);</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;                <a class="code" href="structIOTHUB__MESSAGE__HANDLE__DATA__TAG.html">IOTHUB_MESSAGE_HANDLE</a> IoTHubMessage = <a class="code" href="iothub__message_8c.html#acaa3b835c12fb0254938af052f0fcb6f">IoTHubMessage_CreateFromByteArray</a>(appPayload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a3bd2c590b04276f02341d3f1c03de5b6">message</a>, appPayload-&gt;<a class="code" href="structAPP__PAYLOAD__TAG.html#a71505d1c172b993e9d0841b9eaf33adf">length</a>);</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;                <span class="keywordflow">if</span> (IoTHubMessage == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;                {</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: IotHub Message creation has failed.&quot;</span>);</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;                }</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;                {</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;                    <span class="comment">// Will need to update this when the service has messages that can be rejected</span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;                    <span class="keywordflow">if</span> (extractMqttProperties(IoTHubMessage, topic_resp) != 0)</div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;                    {</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failure extracting mqtt properties.&quot;</span>);</div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;                    }</div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;                    {</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;                        <a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html">MESSAGE_CALLBACK_INFO</a>* messageData = (<a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html">MESSAGE_CALLBACK_INFO</a>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html">MESSAGE_CALLBACK_INFO</a>));</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;                        <span class="keywordflow">if</span> (messageData == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;                        {</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;malloc failed&quot;</span>);</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                        }</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                        {</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                            messageData-&gt;<a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html#a236b601a4e8c04102c63c85317fde8de">messageHandle</a> = IoTHubMessage;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                            messageData-&gt;<a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html#a0a77346e8715fa38f641ae172e3abc5c">transportContext</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160; </div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;                            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_056: [ If type is IOTHUB_TYPE_TELEMETRY, then on success mqtt_notification_callback shall call IoTHubClient_LL_MessageCallback. ] */</span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;                            <span class="keywordflow">if</span> (!<a class="code" href="iothub__client__ll_8c.html#a9c1cba53bc3e3709c5bfa007297da425">IoTHubClient_LL_MessageCallback</a>(transportData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, messageData))</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;                            {</div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;                                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;IoTHubClient_LL_MessageCallback returned false&quot;</span>);</div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160; </div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;                                <a class="code" href="iothub__message_8c.html#a8303de9790f32c3b0aebac6cfb0e80bf">IoTHubMessage_Destroy</a>(IoTHubMessage);</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;                                <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(messageData);</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;                            }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;                        }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;                    }</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;                }</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;            }</div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        }</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;    }</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;}</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160; </div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> mqtt_operation_complete_callback(<a class="code" href="structMQTT__CLIENT__TAG.html">MQTT_CLIENT_HANDLE</a> handle, MQTT_CLIENT_EVENT_RESULT actionResult, <span class="keyword">const</span> <span class="keywordtype">void</span>* msgInfo, <span class="keywordtype">void</span>* callbackCtx)</div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;{</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)handle;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    <span class="keywordflow">if</span> (callbackCtx != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    {</div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;        <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)callbackCtx;</div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160; </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;        <span class="keywordflow">switch</span> (actionResult)</div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;        {</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_PUBLISH_ACK:</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_PUBLISH_COMP:</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;            {</div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;                <span class="keyword">const</span> <a class="code" href="structPUBLISH__ACK__TAG.html">PUBLISH_ACK</a>* puback = (<span class="keyword">const</span> <a class="code" href="structPUBLISH__ACK__TAG.html">PUBLISH_ACK</a>*)msgInfo;</div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;                <span class="keywordflow">if</span> (puback != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;                {</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;                    <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> currentListEntry = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;                    <span class="keywordflow">while</span> (currentListEntry != &amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>)</div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;                    {</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                        <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>* mqttMsgEntry = <a class="code" href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a>(currentListEntry, <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>, <a class="code" href="structentry.html">entry</a>);</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;                        <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> saveListEntry;</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;                        saveListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a> = currentListEntry-&gt;<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160; </div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                        <span class="keywordflow">if</span> (puback-&gt;<a class="code" href="structPUBLISH__ACK__TAG.html#a1f87faad5366100ab6fc4cf88c6acf6f">packetId</a> == mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#ace3e7c2cb335867f8656c2aae59ae45d">packet_id</a>)</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;                        {</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;                            (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a>(currentListEntry); <span class="comment">//First remove the item from Waiting for Ack List.</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;                            sendMsgComplete(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a>, transport_data, IOTHUB_CLIENT_CONFIRMATION_OK);</div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;                            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqttMsgEntry);</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;                        }</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160;                        currentListEntry = saveListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;                    }</div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;                }</div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;                {</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: MQTT_CLIENT_ON_PUBLISH_ACK publish_ack structure NULL.&quot;</span>);</div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;                }</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;            }</div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_CONNACK:</div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;            {</div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;                <span class="keyword">const</span> <a class="code" href="structCONNECT__ACK__TAG.html">CONNECT_ACK</a>* connack = (<span class="keyword">const</span> <a class="code" href="structCONNECT__ACK__TAG.html">CONNECT_ACK</a>*)msgInfo;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;                <span class="keywordflow">if</span> (connack != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;                {</div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;                    <span class="keywordflow">if</span> (connack-&gt;<a class="code" href="structCONNECT__ACK__TAG.html#a41c1c2947502c861ca9057a63109e14b">returnCode</a> == <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61ad1e8baf8f019f73c4a13f2f087d96806">CONNECTION_ACCEPTED</a>)</div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;                    {</div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;                        <span class="comment">// The connect packet has been acked</span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;                        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = CONNACK_TYPE;</div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;                        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ada6a6cc45ec43037deb14044b314c717">isRecoverableError</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;                        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a95e7f89d68ab2d1d56387289eb73728c">MQTT_CLIENT_STATUS_CONNECTED</a>;</div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160; </div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160;                        <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_008: [ Upon successful connection the retry control shall be reset using retry_control_reset() ]</span></div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;                        <a class="code" href="iothub__client__retry__control_8c.html#a56d2ee1fad11d086b79eae8f8f248aec">retry_control_reset</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">retry_control_handle</a>);</div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160; </div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;                        <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_AUTHENTICATED, IOTHUB_CLIENT_CONNECTION_OK);</div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160;                    }</div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;                    {</div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;                        <span class="keywordflow">if</span> (connack-&gt;<a class="code" href="structCONNECT__ACK__TAG.html#a41c1c2947502c861ca9057a63109e14b">returnCode</a> == <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61afb522d125f454b5343f746711327949d">CONN_REFUSED_BAD_USERNAME_PASSWORD</a>)</div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;                        {</div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160;                            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ada6a6cc45ec43037deb14044b314c717">isRecoverableError</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;                            <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_UNAUTHENTICATED, IOTHUB_CLIENT_CONNECTION_BAD_CREDENTIAL);</div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;                        }</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (connack-&gt;<a class="code" href="structCONNECT__ACK__TAG.html#a41c1c2947502c861ca9057a63109e14b">returnCode</a> == <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a79a2775d065472ffcb445df30fea63fd">CONN_REFUSED_NOT_AUTHORIZED</a>)</div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;                        {</div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;                            <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_UNAUTHENTICATED, IOTHUB_CLIENT_CONNECTION_DEVICE_DISABLED);</div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;                        }</div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;                        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (connack-&gt;<a class="code" href="structCONNECT__ACK__TAG.html#a41c1c2947502c861ca9057a63109e14b">returnCode</a> == <a class="code" href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a0f5ba76cc3adf64c3f79f71d1cfe226e">CONN_REFUSED_UNACCEPTABLE_VERSION</a>)</div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;                        {</div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;                            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ada6a6cc45ec43037deb14044b314c717">isRecoverableError</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;                        }</div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Connection Not Accepted: 0x%x: %s&quot;</span>, connack-&gt;<a class="code" href="structCONNECT__ACK__TAG.html#a41c1c2947502c861ca9057a63109e14b">returnCode</a>, retrieve_mqtt_return_codes(connack-&gt;<a class="code" href="structCONNECT__ACK__TAG.html#a41c1c2947502c861ca9057a63109e14b">returnCode</a>) );</div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;                        (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="mqtt__client_8c.html#aa65f265ee9cbfcae6ebf81df89d5aba5">mqtt_client_disconnect</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;                        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a>;</div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;                        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = PACKET_TYPE_ERROR;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160;                    }</div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;                }</div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;                {</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;MQTT_CLIENT_ON_CONNACK CONNACK parameter is NULL.&quot;</span>);</div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;                }</div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;            }</div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_SUBSCRIBE_ACK:</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;            {</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;                <span class="keyword">const</span> <a class="code" href="structSUBSCRIBE__ACK__TAG.html">SUBSCRIBE_ACK</a>* suback = (<span class="keyword">const</span> <a class="code" href="structSUBSCRIBE__ACK__TAG.html">SUBSCRIBE_ACK</a>*)msgInfo;</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;                <span class="keywordflow">if</span> (suback != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;                {</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160;                    <span class="keywordtype">size_t</span> <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0;</div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;                    <span class="keywordflow">for</span> (<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> = 0; <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a> &lt; suback-&gt;<a class="code" href="structSUBSCRIBE__ACK__TAG.html#aeb753dc68343430d63c4a332ab4e13a3">qosCount</a>; <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>++)</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;                    {</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;                        <span class="keywordflow">if</span> (suback-&gt;<a class="code" href="structSUBSCRIBE__ACK__TAG.html#ab2b68fad7dbe2f3cf5b72ede65a10768">qosReturn</a>[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>] == DELIVER_FAILURE)</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;                        {</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Subscribe delivery failure of subscribe %lu&quot;</span>, <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>);</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;                        }</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;                    }</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;                    <span class="comment">// The connect packet has been acked</span></div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = SUBACK_TYPE;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;                }</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;                {</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: MQTT_CLIENT_ON_SUBSCRIBE_ACK SUBSCRIBE_ACK parameter is NULL.&quot;</span>);</div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160;                }</div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;            }</div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_PUBLISH_RECV:</div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_PUBLISH_REL:</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160;            {</div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;                <span class="comment">// Currently not used</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;            }</div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_DISCONNECT:</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;            {</div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;                <span class="comment">// Close the client so we can reconnect again</span></div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a>;</div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = DISCONNECT_TYPE;</div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160;            }</div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_UNSUBSCRIBE_ACK:</div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_ON_PING_RESPONSE:</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;            <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160;            {</div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;            } </div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;        }</div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160;    }</div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;}</div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160; </div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> DisconnectFromClient(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data)</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;{</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;    {</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;        <a class="code" href="structOPTIONHANDLER__HANDLE__DATA__TAG.html">OPTIONHANDLER_HANDLE</a> options = <a class="code" href="xio_8c.html#a42cdddeb35bf5a6d45a4a730b1b9e4a5">xio_retrieveoptions</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a>);</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160;        set_saved_tls_options(transport_data, options);</div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160; </div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;        (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="mqtt__client_8c.html#aa65f265ee9cbfcae6ebf81df89d5aba5">mqtt_client_disconnect</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        <a class="code" href="xio_8c.html#acf7bf0887a6f4a203740745d27d21bb1">xio_destroy</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a>);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160; </div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a>;</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = DISCONNECT_TYPE;</div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    }</div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;}</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160; </div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> UpdateSubscribeFlag(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data)</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;{</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;    {</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a2d2ab9657cc946c76cb9fd383cbc510a">SUBSCRIBE_TELEMETRY_TOPIC</a>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;    }</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;    {</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a28f1b4f0886bfaf9a00796612117879e">SUBSCRIBE_GET_REPORTED_STATE_TOPIC</a>;</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;    }</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;    {</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a7f290bee42e3871e80bdad7432fb1df9">SUBSCRIBE_NOTIFICATION_STATE_TOPIC</a>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;    }</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;    {</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a067063b96e352df08fbe2c56d3f24e10">SUBSCRIBE_DEVICE_METHOD_TOPIC</a>;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;    }</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;}</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160; </div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> mqtt_error_callback(<a class="code" href="structMQTT__CLIENT__TAG.html">MQTT_CLIENT_HANDLE</a> handle, MQTT_CLIENT_EVENT_ERROR error, <span class="keywordtype">void</span>* callbackCtx)</div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;{</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;    <span class="keywordflow">if</span> (callbackCtx != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;    {</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)callbackCtx;</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="keywordflow">switch</span> (error)</div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;        {</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_CONNECTION_ERROR:</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;            {</div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;                <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_UNAUTHENTICATED, IOTHUB_CLIENT_CONNECTION_NO_NETWORK);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;            }</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_COMMUNICATION_ERROR:</div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;            {</div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;                <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_UNAUTHENTICATED, IOTHUB_CLIENT_CONNECTION_COMMUNICATION_ERROR);</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160;            }</div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_NO_PING_RESPONSE:</div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            {</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Mqtt Ping Response was not encountered.  Reconnecting device...&quot;</span>);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;                DisconnectFromClient(transport_data);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;            }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_PARSE_ERROR:</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_MEMORY_ERROR:</div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;            <span class="keywordflow">case</span> MQTT_CLIENT_UNKNOWN_ERROR: </div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;            {</div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;INTERNAL ERROR: unexpected error value received %s&quot;</span>, <a class="code" href="macro__utils_8h.html#a25551e3ff0e5f7d2457ddf9c155a87c5">ENUM_TO_STRING</a>(MQTT_CLIENT_EVENT_ERROR, error));</div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;            }</div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;        }</div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a>;</div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = PACKET_TYPE_ERROR;</div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">device_twin_get_sent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;        UpdateSubscribeFlag(transport_data);</div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    }</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: mqtt called back with null context.&quot;</span>);</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;    }</div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;}</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160; </div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> SubscribeToMqttProtocol(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data)</div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;{</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> != <a class="code" href="iothubtransport__mqtt__common_8c.html#a35665d241984eff7e3ab14b0188d4ba8">UNSUBSCRIBE_FROM_TOPIC</a>)</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;    {</div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> topic_subscription = 0;</div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;        <span class="keywordtype">size_t</span> subscribe_count = 0;</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;        <a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html">SUBSCRIBE_PAYLOAD</a> subscribe[<a class="code" href="iothubtransport__mqtt__common_8c.html#ad19dab2a96d760e17265be294f61a61a">SUBSCRIBE_TOPIC_COUNT</a>];</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        <span class="keywordflow">if</span> ((transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="iothubtransport__mqtt__common_8c.html#a2d2ab9657cc946c76cb9fd383cbc510a">SUBSCRIBE_TELEMETRY_TOPIC</a> &amp; transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a>))</div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;        {</div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a2d77b40f1e95f10bb0045fa167f127aa">subscribeTopic</a> = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a>);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a528534ecd9c6c7d6ed5736c810519a88">qosReturn</a> = DELIVER_AT_LEAST_ONCE;</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;            topic_subscription |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a2d2ab9657cc946c76cb9fd383cbc510a">SUBSCRIBE_TELEMETRY_TOPIC</a>;</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;            subscribe_count++;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;        }</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;        <span class="keywordflow">if</span> ((transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="iothubtransport__mqtt__common_8c.html#a28f1b4f0886bfaf9a00796612117879e">SUBSCRIBE_GET_REPORTED_STATE_TOPIC</a> &amp; transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a>))</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160;        {</div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a2d77b40f1e95f10bb0045fa167f127aa">subscribeTopic</a> = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a>);</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a528534ecd9c6c7d6ed5736c810519a88">qosReturn</a> = DELIVER_AT_MOST_ONCE;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;            topic_subscription |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a28f1b4f0886bfaf9a00796612117879e">SUBSCRIBE_GET_REPORTED_STATE_TOPIC</a>;</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160;            subscribe_count++;</div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;        }</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;        <span class="keywordflow">if</span> ((transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="iothubtransport__mqtt__common_8c.html#a7f290bee42e3871e80bdad7432fb1df9">SUBSCRIBE_NOTIFICATION_STATE_TOPIC</a> &amp; transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a>))</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;        {</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a2d77b40f1e95f10bb0045fa167f127aa">subscribeTopic</a> = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a>);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a528534ecd9c6c7d6ed5736c810519a88">qosReturn</a> = DELIVER_AT_MOST_ONCE;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;            topic_subscription |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a7f290bee42e3871e80bdad7432fb1df9">SUBSCRIBE_NOTIFICATION_STATE_TOPIC</a>;</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            subscribe_count++;</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;        <span class="keywordflow">if</span> ((transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="iothubtransport__mqtt__common_8c.html#a067063b96e352df08fbe2c56d3f24e10">SUBSCRIBE_DEVICE_METHOD_TOPIC</a> &amp; transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a>))</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;        {</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a2d77b40f1e95f10bb0045fa167f127aa">subscribeTopic</a> = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a>);</div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;            subscribe[subscribe_count].<a class="code" href="structSUBSCRIBE__PAYLOAD__TAG.html#a528534ecd9c6c7d6ed5736c810519a88">qosReturn</a> = DELIVER_AT_MOST_ONCE;</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;            topic_subscription |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a067063b96e352df08fbe2c56d3f24e10">SUBSCRIBE_DEVICE_METHOD_TOPIC</a>;</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;            subscribe_count++;</div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;        }</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160; </div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;        <span class="keywordflow">if</span> (subscribe_count != 0)</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;        {</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_016: [IoTHubTransport_MQTT_Common_Subscribe shall call mqtt_client_subscribe to subscribe to the Message Topic.] */</span></div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#aed460cbad1b51f41759f8ab289ef09d3">mqtt_client_subscribe</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, get_next_packet_id(transport_data), subscribe, subscribe_count) != 0)</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160;            {</div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_017: [Upon failure IoTHubTransport_MQTT_Common_Subscribe shall return a non-zero value.] */</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: mqtt_client_subscribe returned error.&quot;</span>);</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;            }</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            {</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_018: [On success IoTHubTransport_MQTT_Common_Subscribe shall return 0.] */</span></div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> &amp;= ~topic_subscription;</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = SUBSCRIBE_TYPE;</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            }</div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;        }</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;        {</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_017: [Upon failure IoTHubTransport_MQTT_Common_Subscribe shall return a non-zero value.] */</span></div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: subscribe_topic is empty.&quot;</span>);</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160;        }</div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = SUBSCRIBE_TYPE;</div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;    }</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    {</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = PUBLISH_TYPE;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;    }</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160;}</div>
<div class="line"><a name="l01432"></a><span class="lineno"> 1432</span>&#160; </div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* RetrieveMessagePayload(<a class="code" href="structIOTHUB__MESSAGE__HANDLE__DATA__TAG.html">IOTHUB_MESSAGE_HANDLE</a> messageHandle, <span class="keywordtype">size_t</span>* <a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>)</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;{</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* result;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160; </div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    IOTHUBMESSAGE_CONTENT_TYPE contentType = <a class="code" href="iothub__message_8c.html#ae7fd8e5a5844a4346933a86feb577d3c">IoTHubMessage_GetContentType</a>(messageHandle);</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <span class="keywordflow">if</span> (contentType == IOTHUBMESSAGE_BYTEARRAY)</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    {</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="iothub__message_8c.html#afac0461ed8c3d522bbf2a4cfa9f3f957">IoTHubMessage_GetByteArray</a>(messageHandle, &amp;result, <a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>) != IOTHUB_MESSAGE_OK)</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;        {</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure result from IoTHubMessage_GetByteArray&quot;</span>);</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160;            result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01444"></a><span class="lineno"> 1444</span>&#160;            *<a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> = 0;</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;        }</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    }</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (contentType == IOTHUBMESSAGE_STRING)</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    {</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;        result = (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="iothub__message_8c.html#aaf63b9aecdde6f8c90d9fbd0755d0c41">IoTHubMessage_GetString</a>(messageHandle);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;        <span class="keywordflow">if</span> (result == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;        {</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure result from IoTHubMessage_GetString&quot;</span>);</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;            result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160;            *<a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> = 0;</div>
<div class="line"><a name="l01455"></a><span class="lineno"> 1455</span>&#160;        }</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;        {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;            *<a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> = strlen((<span class="keyword">const</span> <span class="keywordtype">char</span>*)result);</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;        }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    }</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    {</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;        *<a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a> = 0;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;    }</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01467"></a><span class="lineno"> 1467</span>&#160;}</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160; </div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> GetTransportProviderIfNecessary(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data)</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;{</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160; </div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    {</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;        <span class="comment">// construct address</span></div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* hostAddress = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aeec3610b18121a94e5e5b1d51f34fdff">hostAddress</a>);</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160;        <a class="code" href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html">MQTT_TRANSPORT_PROXY_OPTIONS</a> mqtt_proxy_options;</div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160; </div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_011: [ If no `proxy_data` option has been set, NULL shall be passed as the argument `mqtt_transport_proxy_options` when calling the function `get_io_transport` passed in `IoTHubTransport_MQTT_Common__Create`. ]*/</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;        mqtt_proxy_options.<a class="code" href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a4542072c0f0e2435719c9cf97c73d666">host_address</a> = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a>;</div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;        mqtt_proxy_options.<a class="code" href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a89564f5229de7990a44d2c1a600b218b">port</a> = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a483c15ac99b09da35b40ad0c7455f3e0">http_proxy_port</a>;</div>
<div class="line"><a name="l01482"></a><span class="lineno"> 1482</span>&#160;        mqtt_proxy_options.<a class="code" href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a3545f76f314f3bf2d06bcd66c866e4fd">username</a> = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">http_proxy_username</a>;</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;        mqtt_proxy_options.<a class="code" href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a2a59f9a0f1f041c5b0d8df9d8d144059">password</a> = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">http_proxy_password</a>;</div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160; </div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_010: [ If the `proxy_data` option has been set, the proxy options shall be filled in the argument `mqtt_transport_proxy_options` when calling the function `get_io_transport` passed in `IoTHubTransport_MQTT_Common__Create` to obtain the underlying IO handle. ]*/</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a> = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a104b92d040ffaefb6fb038c10f440796">get_io_transport</a>(hostAddress, (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ? <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> : &amp;mqtt_proxy_options);</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;        {</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Unable to create the lower level TLS layer.&quot;</span>);</div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160;        }</div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;        {</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="iothub__client__authorization_8c.html#a6a815c201b2a287aa37600f4ab5acc99">IoTHubClient_Auth_Get_Credential_Type</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>) == IOTHUB_CREDENTIAL_TYPE_X509_ECC)</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;            {</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="iothub__client__authorization_8c.html#af440381fa0471d6c75a85df7007646d4">IoTHubClient_Auth_Set_xio_Certificate</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>, transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a>) != 0)</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;                {</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Unable to create the lower level TLS layer.&quot;</span>);</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;                }</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;                {</div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;                    result = 0;</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;                }</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;            }</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;            {</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;                result = 0;</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;            }</div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160; </div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160;            <span class="keywordflow">if</span> (result == 0)</div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;            {</div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160;                <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">saved_tls_options</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;                {</div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="optionhandler_8c.html#afeea10981f7e63a37cb6af40c0a1bff4">OptionHandler_FeedOptions</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">saved_tls_options</a>, transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a>) != OPTIONHANDLER_OK)</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;                    {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed feeding existing options to new TLS instance.&quot;</span>);</div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;                        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;                    }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;                    {</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;                        <span class="comment">// The tlsio has the options, so our copy can be deleted</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;                        set_saved_tls_options(transport_data, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;                        result = 0;</div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;                    }</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;                }</div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;                {</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;                    result = 0;</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;                }</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;            }</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;        }</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    }</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160;    {</div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;        result = 0;</div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    }</div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;}</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160; </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> is_key_validate(<span class="keyword">const</span> <a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html">IOTHUBTRANSPORT_CONFIG</a>* config)</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;{</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    IOTHUB_CREDENTIAL_TYPE cred_type = <a class="code" href="iothub__client__authorization_8c.html#a6a815c201b2a287aa37600f4ab5acc99">IoTHubClient_Auth_Get_Credential_Type</a>(config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#aed64933a7aabd2442da7ba3656ff7e89">auth_module_handle</a>);</div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160;    <span class="keywordflow">if</span> (cred_type == IOTHUB_CREDENTIAL_TYPE_X509 || cred_type == IOTHUB_CREDENTIAL_TYPE_X509_ECC)</div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    {</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        result = 0;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    {</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ad030712a97d1d08abb7d38841417fc2d">deviceKey</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a54b2c744ca9f3dbe94d71753ea36d1dc">deviceSasToken</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;        {</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="iothub__client__authorization_8c.html#a2516a8e0730fe2f737f7d26b680f5256">IoTHubClient_Auth_Get_DeviceKey</a>(config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#aed64933a7aabd2442da7ba3656ff7e89">auth_module_handle</a>) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;            {</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;            }</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160;            {</div>
<div class="line"><a name="l01559"></a><span class="lineno"> 1559</span>&#160;                result = 0;</div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;            }</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;        }</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;        {</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;            result = 0;</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;        }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    }</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;}</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160; </div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> SendMqttConnectMsg(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data)</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160;{</div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160; </div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;    <span class="keywordtype">char</span>* sasToken = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    result = 0;</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160; </div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    IOTHUB_CREDENTIAL_TYPE cred_type = <a class="code" href="iothub__client__authorization_8c.html#a6a815c201b2a287aa37600f4ab5acc99">IoTHubClient_Auth_Get_Credential_Type</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>);</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160;    <span class="keywordflow">if</span> (cred_type == IOTHUB_CREDENTIAL_TYPE_DEVICE_KEY || cred_type == IOTHUB_CREDENTIAL_TYPE_DEVICE_AUTH)</div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    {</div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;        <span class="keywordtype">size_t</span> secSinceEpoch = (size_t)(difftime(<a class="code" href="agenttime_8c.html#ae215665d6ce179d18157b06033082b60">get_time</a>(<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>), <a class="code" href="iothubtransport__mqtt__common_8c.html#aae6d6188ff0358440fc632e3d54c2113">EPOCH_TIME_T_VALUE</a>) + 0);</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <span class="keywordtype">size_t</span> expiryTime = secSinceEpoch + <a class="code" href="iothubtransport__mqtt__common_8c.html#aa36f2858f563663b71d1d01d6136328a">SAS_TOKEN_DEFAULT_LIFETIME</a>;</div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        sasToken = <a class="code" href="iothub__client__authorization_8c.html#a3d8b5e7a2fff306e82f668507ec1d0e7">IoTHubClient_Auth_Get_SasToken</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad7809e79d2e9e3ef3f471393511ea161">devicesPath</a>), expiryTime);</div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;        <span class="keywordflow">if</span> (sasToken == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        {</div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failure getting sas token from IoTHubClient_Auth_Get_SasToken.&quot;</span>);</div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160;        }</div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    }</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (cred_type == IOTHUB_CREDENTIAL_TYPE_SAS_TOKEN)</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160;    {</div>
<div class="line"><a name="l01591"></a><span class="lineno"> 1591</span>&#160;        SAS_TOKEN_STATUS token_status = <a class="code" href="iothub__client__authorization_8c.html#a89cee2cc0727764f01e0835902cf8021">IoTHubClient_Auth_Is_SasToken_Valid</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>);</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;        <span class="keywordflow">if</span> (token_status == SAS_TOKEN_STATUS_INVALID)</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;        {</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;            <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_UNAUTHENTICATED, IOTHUB_CLIENT_CONNECTION_EXPIRED_SAS_TOKEN);</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;        }</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (token_status == SAS_TOKEN_STATUS_FAILED)</div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;        {</div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;            <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_UNAUTHENTICATED, IOTHUB_CLIENT_CONNECTION_BAD_CREDENTIAL);</div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;        }</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        {</div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;            sasToken = <a class="code" href="iothub__client__authorization_8c.html#a3d8b5e7a2fff306e82f668507ec1d0e7">IoTHubClient_Auth_Get_SasToken</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0);</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;            <span class="keywordflow">if</span> (sasToken == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;            {</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failure getting sas Token.&quot;</span>);</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;            }</div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;        }</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;    }</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"> 1613</span>&#160;    <span class="keywordflow">if</span> (result == 0)</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    {</div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="keywordflow">if</span> (!transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af03e0416fa3e66f3353ef4f1f1a8d08a">isProductInfoSet</a>)</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;        {</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;            <span class="comment">// This requires the iothubClientHandle, which sadly the MQTT transport only gets on DoWork, so this code still needs to remain here.</span></div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160;            <span class="comment">// The correct place for this would be in the Create method, but we don&#39;t get the client handle there.</span></div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;            <span class="comment">// Also, when device multiplexing is used, the customer creates the transport directly and explicitly, when the client is still not created.</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;            <span class="comment">// This will be a major hurdle when we add device multiplexing to MQTT transport.</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160; </div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            <span class="keywordtype">void</span>* product_info;</div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;            <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> clone;</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;            <span class="keywordflow">if</span> ((<a class="code" href="iothub__client__ll_8c.html#a4bc23c750582e44563a76c3eb6409bd6">IoTHubClient_LL_GetOption</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, OPTION_PRODUCT_INFO, &amp;product_info) == IOTHUB_CLIENT_ERROR) || (product_info == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;            {</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;                clone = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(<span class="stringliteral">&quot;%s%%2F%s&quot;</span>, <a class="code" href="iothub__client__private_8h.html#af017a165145ff71c161d40d7ce6a92c8">CLIENT_DEVICE_TYPE_PREFIX</a>, <a class="code" href="iothub__client__version_8h.html#ae0748bd999de84277b606395be2fae5f">IOTHUB_SDK_VERSION</a>);</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            }</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            {</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;                clone = <a class="code" href="urlencode_8c.html#a294e4745086de41f1ec0c48ef9b2f90e">URL_Encode</a>(product_info);</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;            }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160; </div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;            <span class="keywordflow">if</span> (clone == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160;            {</div>
<div class="line"><a name="l01635"></a><span class="lineno"> 1635</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed obtaining the product info&quot;</span>);</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;            }</div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;            {</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="strings_8c.html#aa4a3f5638a574f7dfad01419df072e2a">STRING_concat_with_STRING</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad3bb71acb8df8e88bf30e5fa3dc0ea42">configPassedThroughUsername</a>, clone) != 0)</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160;                {</div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed concatenating the product info&quot;</span>);</div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;                }</div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;                {</div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af03e0416fa3e66f3353ef4f1f1a8d08a">isProductInfoSet</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                }</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160; </div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(clone);</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            }</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        }</div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160; </div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        <a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html">MQTT_CLIENT_OPTIONS</a> options = { 0 };</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;        options.<a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html#a4860a4e13fbd8523c016d5db92ba8d76">clientId</a> = (<span class="keywordtype">char</span>*)<a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aa5871196da7d7da7b2d2e7f9f4a55731">device_id</a>);</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;        options.<a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html#a278ea8e632843766efe157bb00e86a38">willMessage</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;        options.<a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html#ac5fc4be196b6b3429a9f6d401adcf015">username</a> = (<span class="keywordtype">char</span>*)<a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad3bb71acb8df8e88bf30e5fa3dc0ea42">configPassedThroughUsername</a>);</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160;        <span class="keywordflow">if</span> (sasToken != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;        {</div>
<div class="line"><a name="l01658"></a><span class="lineno"> 1658</span>&#160;            options.<a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html#aaea729ba9adb6532bf418c0fe54df6dd">password</a> = sasToken;</div>
<div class="line"><a name="l01659"></a><span class="lineno"> 1659</span>&#160;        }</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;        options.<a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html#a19caf9c9a7d11570db75b9ef25cc650e">keepAliveInterval</a> = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a2c60bfa3b3743b25707510364154779e">keepAliveValue</a>;</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;        options.<a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html#a5ab252353b669743ca47d186da92af48">useCleanSession</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        options.<a class="code" href="structMQTT__CLIENT__OPTIONS__TAG.html#a25454feb36c6d1b3cf56ac61dfdb53f6">qualityOfServiceValue</a> = DELIVER_AT_LEAST_ONCE;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160; </div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;        <span class="keywordflow">if</span> (GetTransportProviderIfNecessary(transport_data) == 0)</div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;        {</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#a9ec68776c1334e5c5d5e93251151d626">mqtt_client_connect</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a>, &amp;options) != 0)</div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;            {</div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failure connecting to address %s.&quot;</span>, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aeec3610b18121a94e5e5b1d51f34fdff">hostAddress</a>));</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;            }</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;            {</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;                (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>, &amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a8d873ed494c3ce1b30a85ab8f4365dc1">mqtt_connect_time</a>);</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;                result = 0;</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;            }</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        }</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;        {</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;        }</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;            </div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;        <span class="keywordflow">if</span> (sasToken != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;        {</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(sasToken);</div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;        }</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160;    }</div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160;}</div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160; </div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> InitializeConnection(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data)</div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;{</div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;    <span class="keywordtype">int</span> result = 0;</div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160; </div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;    <span class="comment">// Make sure we&#39;re not destroying the object</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;    <span class="keywordflow">if</span> (!transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9dcca736d0691d77478439ecc05b4526">isDestroyCalled</a>)</div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    {</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;        <a class="code" href="iothub__client__retry__control_8h.html#a44ee4bf0af2bfa80f9e2680f4247ebba">RETRY_ACTION</a> retry_action = <a class="code" href="iothub__client__retry__control_8h.html#ad23f3b31478edd6be6b7692a332a3bd7a1e97263c554fc2dcf72b36ff15b84d45">RETRY_ACTION_RETRY_LATER</a>;</div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160; </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;        <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_007: [ IoTHubTransport_MQTT_Common_DoWork shall try to reconnect according to the current retry policy set ]</span></div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> == <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a> &amp;&amp; transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ada6a6cc45ec43037deb14044b314c717">isRecoverableError</a> &amp;&amp; </div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;            (<a class="code" href="iothub__client__retry__control_8c.html#a73839a9f296482e97add2a7477e41af8">retry_control_should_retry</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">retry_control_handle</a>, &amp;retry_action) != 0 || retry_action == <a class="code" href="iothub__client__retry__control_8h.html#ad23f3b31478edd6be6b7692a332a3bd7ab67743fc9afefaeebb627ae9473724ae">RETRY_ACTION_RETRY_NOW</a>))</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;        {</div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;            <span class="comment">// Note: in case retry_control_should_retry fails, the reconnection shall be attempted anyway (defaulting to policy IOTHUB_CLIENT_RETRY_IMMEDIATE).</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160; </div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>, &amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a47c0d7b06e69bb49120cfde55283fcc7">connectTick</a>) != 0)</div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;            {</div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a35279fbd52274c99a0d972d377c9cc97">connectFailCount</a>++;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;            }</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;            {</div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;                <span class="keywordflow">if</span> (SendMqttConnectMsg(transport_data) != 0)</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;                {</div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a35279fbd52274c99a0d972d377c9cc97">connectFailCount</a>++;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;                }</div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;                {</div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> = <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a3d79509b61d6f3b7beeafdf2f01ff9ed">MQTT_CLIENT_STATUS_CONNECTING</a>;</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a35279fbd52274c99a0d972d377c9cc97">connectFailCount</a> = 0;</div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;                    result = 0;</div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;                }</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;            }</div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;        }</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;        <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_001: [ IoTHubTransport_MQTT_Common_DoWork shall trigger reconnection if the mqtt_client_connect does not complete within `keepalive` seconds]</span></div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> == <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a3d79509b61d6f3b7beeafdf2f01ff9ed">MQTT_CLIENT_STATUS_CONNECTING</a>)</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;        {</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160;            <a class="code" href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a> current_time;</div>
<div class="line"><a name="l01729"></a><span class="lineno"> 1729</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>, &amp;current_time) != 0)</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;            {</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failed verifying MQTT_CLIENT_STATUS_CONNECTING timeout&quot;</span>);</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;            }</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((current_time - transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a8d873ed494c3ce1b30a85ab8f4365dc1">mqtt_connect_time</a>) / 1000 &gt; transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a2c60bfa3b3743b25707510364154779e">keepAliveValue</a>) </div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;            {</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;mqtt_client timed out waiting for CONNACK&quot;</span>);</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;                DisconnectFromClient(transport_data);</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;                result = 0;</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;            }</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;        }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> == <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a95e7f89d68ab2d1d56387289eb73728c">MQTT_CLIENT_STATUS_CONNECTED</a>)</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;        {</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160;            <span class="comment">// We are connected and not being closed, so does SAS need to reconnect?</span></div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160;            <a class="code" href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a> current_time;</div>
<div class="line"><a name="l01745"></a><span class="lineno"> 1745</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>, &amp;current_time) != 0)</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;            {</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a35279fbd52274c99a0d972d377c9cc97">connectFailCount</a>++;</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;            }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;            {</div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160;                <span class="keywordflow">if</span> ((current_time - transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a8d873ed494c3ce1b30a85ab8f4365dc1">mqtt_connect_time</a>) / 1000 &gt; (<a class="code" href="iothubtransport__mqtt__common_8c.html#aa36f2858f563663b71d1d01d6136328a">SAS_TOKEN_DEFAULT_LIFETIME</a> * <a class="code" href="iothubtransport__mqtt__common_8c.html#aebe4a395f23a2e353ed6c17770a5cec6">SAS_REFRESH_MULTIPLIER</a>))</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160;                {</div>
<div class="line"><a name="l01754"></a><span class="lineno"> 1754</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_058: [ If the sas token has timed out IoTHubTransport_MQTT_Common_DoWork shall disconnect from the mqtt client and destroy the transport information and wait for reconnect. ] */</span></div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;                    DisconnectFromClient(transport_data);</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;                    </div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;                    <a class="code" href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, IOTHUB_CLIENT_CONNECTION_UNAUTHENTICATED, IOTHUB_CLIENT_CONNECTION_EXPIRED_SAS_TOKEN);</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;                    </div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">device_twin_get_sent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160;                    UpdateSubscribeFlag(transport_data);</div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;                }</div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;            }</div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;        }</div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;    }</div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;}</div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160; </div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="keyword">static</span> <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> buildConfigForUsername(<span class="keyword">const</span> <a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html">IOTHUB_CLIENT_CONFIG</a>* upperConfig)</div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160;{</div>
<div class="line"><a name="l01771"></a><span class="lineno"> 1771</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(<span class="stringliteral">&quot;%s.%s/%s/api-version=%s&amp;DeviceClientType=&quot;</span>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a6b559edc71ff3b0e8d9f9840cb36b27c">iotHubName</a>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ae54e74d8db92b20f796df76f01d5dd68">iotHubSuffix</a>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#af33000861e1bb43af8e339dee3e689a0">deviceId</a>, IOTHUB_API_VERSION);</div>
<div class="line"><a name="l01772"></a><span class="lineno"> 1772</span>&#160;}</div>
<div class="line"><a name="l01773"></a><span class="lineno"> 1773</span>&#160; </div>
<div class="line"><a name="l01774"></a><span class="lineno"> 1774</span>&#160;<span class="keyword">static</span> <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> InitializeTransportHandleData(<span class="keyword">const</span> <a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html">IOTHUB_CLIENT_CONFIG</a>* upperConfig, <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> waitingToSend, <a class="code" href="structIOTHUB__AUTHORIZATION__DATA__TAG.html">IOTHUB_AUTHORIZATION_HANDLE</a> auth_module)</div>
<div class="line"><a name="l01775"></a><span class="lineno"> 1775</span>&#160;{</div>
<div class="line"><a name="l01776"></a><span class="lineno"> 1776</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> <a class="code" href="structstate.html">state</a> = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>));</div>
<div class="line"><a name="l01777"></a><span class="lineno"> 1777</span>&#160;    <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01778"></a><span class="lineno"> 1778</span>&#160;    {</div>
<div class="line"><a name="l01779"></a><span class="lineno"> 1779</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Could not create MQTT transport state. Memory allocation failed.&quot;</span>);</div>
<div class="line"><a name="l01780"></a><span class="lineno"> 1780</span>&#160;    }</div>
<div class="line"><a name="l01781"></a><span class="lineno"> 1781</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01782"></a><span class="lineno"> 1782</span>&#160;    {</div>
<div class="line"><a name="l01783"></a><span class="lineno"> 1783</span>&#160;        memset(<a class="code" href="structstate.html">state</a>, 0, <span class="keyword">sizeof</span>(<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>) );</div>
<div class="line"><a name="l01784"></a><span class="lineno"> 1784</span>&#160;        <span class="keywordflow">if</span> ((<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter = <a class="code" href="tickcounter_8c.html#a58975c98066c833f9a78ec40f8a9da51">tickcounter_create</a>()) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01785"></a><span class="lineno"> 1785</span>&#160;        {</div>
<div class="line"><a name="l01786"></a><span class="lineno"> 1786</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: iotHubName is empty&quot;</span>);</div>
<div class="line"><a name="l01787"></a><span class="lineno"> 1787</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01788"></a><span class="lineno"> 1788</span>&#160;            <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01789"></a><span class="lineno"> 1789</span>&#160;        }</div>
<div class="line"><a name="l01790"></a><span class="lineno"> 1790</span>&#160;        <span class="comment">// Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_09_005: [ MQTT transport shall use EXPONENTIAL_WITH_BACK_OFF as default retry policy ]</span></div>
<div class="line"><a name="l01791"></a><span class="lineno"> 1791</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="structstate.html">state</a>-&gt;retry_control_handle = <a class="code" href="iothub__client__retry__control_8c.html#a6b39a45fa0661693171238e1e56112f3">retry_control_create</a>(<a class="code" href="iothubtransport__mqtt__common_8c.html#a0edd40b1f2abb4aa27d8aa561ae52784">DEFAULT_RETRY_POLICY</a>, <a class="code" href="iothubtransport__mqtt__common_8c.html#a6781b97d6acc03e7bf1c9d619f98abad">DEFAULT_RETRY_TIMEOUT_IN_SECONDS</a>)) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01792"></a><span class="lineno"> 1792</span>&#160;        {</div>
<div class="line"><a name="l01793"></a><span class="lineno"> 1793</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed creating default retry control&quot;</span>);</div>
<div class="line"><a name="l01794"></a><span class="lineno"> 1794</span>&#160;            <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter);</div>
<div class="line"><a name="l01795"></a><span class="lineno"> 1795</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01796"></a><span class="lineno"> 1796</span>&#160;            <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01797"></a><span class="lineno"> 1797</span>&#160;        }</div>
<div class="line"><a name="l01798"></a><span class="lineno"> 1798</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="structstate.html">state</a>-&gt;device_id = <a class="code" href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a>(upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#af33000861e1bb43af8e339dee3e689a0">deviceId</a>)) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01799"></a><span class="lineno"> 1799</span>&#160;        {</div>
<div class="line"><a name="l01800"></a><span class="lineno"> 1800</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failure constructing device_id.&quot;</span>);</div>
<div class="line"><a name="l01801"></a><span class="lineno"> 1801</span>&#160;            <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;retry_control_handle);</div>
<div class="line"><a name="l01802"></a><span class="lineno"> 1802</span>&#160;            <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter);</div>
<div class="line"><a name="l01803"></a><span class="lineno"> 1803</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01804"></a><span class="lineno"> 1804</span>&#160;            <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01805"></a><span class="lineno"> 1805</span>&#160;        }</div>
<div class="line"><a name="l01806"></a><span class="lineno"> 1806</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="structstate.html">state</a>-&gt;devicesPath = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(<span class="stringliteral">&quot;%s.%s/devices/%s&quot;</span>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a6b559edc71ff3b0e8d9f9840cb36b27c">iotHubName</a>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ae54e74d8db92b20f796df76f01d5dd68">iotHubSuffix</a>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#af33000861e1bb43af8e339dee3e689a0">deviceId</a>)) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01807"></a><span class="lineno"> 1807</span>&#160;        {</div>
<div class="line"><a name="l01808"></a><span class="lineno"> 1808</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;device_id);</div>
<div class="line"><a name="l01809"></a><span class="lineno"> 1809</span>&#160;            <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;retry_control_handle);</div>
<div class="line"><a name="l01810"></a><span class="lineno"> 1810</span>&#160;            <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter);</div>
<div class="line"><a name="l01811"></a><span class="lineno"> 1811</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01812"></a><span class="lineno"> 1812</span>&#160;            <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01813"></a><span class="lineno"> 1813</span>&#160;        }</div>
<div class="line"><a name="l01814"></a><span class="lineno"> 1814</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l01815"></a><span class="lineno"> 1815</span>&#160;        {</div>
<div class="line"><a name="l01816"></a><span class="lineno"> 1816</span>&#160;            <span class="keywordflow">if</span> ( (<a class="code" href="structstate.html">state</a>-&gt;topic_MqttEvent = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(TOPIC_DEVICE_DEVICE, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#af33000861e1bb43af8e339dee3e689a0">deviceId</a>) ) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01817"></a><span class="lineno"> 1817</span>&#160;            {</div>
<div class="line"><a name="l01818"></a><span class="lineno"> 1818</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Could not create topic_MqttEvent for MQTT&quot;</span>);</div>
<div class="line"><a name="l01819"></a><span class="lineno"> 1819</span>&#160;                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;devicesPath);</div>
<div class="line"><a name="l01820"></a><span class="lineno"> 1820</span>&#160;                <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;device_id);</div>
<div class="line"><a name="l01821"></a><span class="lineno"> 1821</span>&#160;                <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;retry_control_handle);</div>
<div class="line"><a name="l01822"></a><span class="lineno"> 1822</span>&#160;                <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter);</div>
<div class="line"><a name="l01823"></a><span class="lineno"> 1823</span>&#160;                <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01824"></a><span class="lineno"> 1824</span>&#160;                <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01825"></a><span class="lineno"> 1825</span>&#160;            }</div>
<div class="line"><a name="l01826"></a><span class="lineno"> 1826</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l01827"></a><span class="lineno"> 1827</span>&#160;            {</div>
<div class="line"><a name="l01828"></a><span class="lineno"> 1828</span>&#160;                <a class="code" href="structstate.html">state</a>-&gt;mqttClient = <a class="code" href="mqtt__client_8c.html#a7d9e8d71c27f2f4150d477431aeaaa54">mqtt_client_init</a>(mqtt_notification_callback, mqtt_operation_complete_callback, <a class="code" href="structstate.html">state</a>, mqtt_error_callback, <a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01829"></a><span class="lineno"> 1829</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a>-&gt;mqttClient == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01830"></a><span class="lineno"> 1830</span>&#160;                {</div>
<div class="line"><a name="l01831"></a><span class="lineno"> 1831</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failure initializing mqtt client.&quot;</span>);</div>
<div class="line"><a name="l01832"></a><span class="lineno"> 1832</span>&#160;                    <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;devicesPath);</div>
<div class="line"><a name="l01833"></a><span class="lineno"> 1833</span>&#160;                    <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;topic_MqttEvent);</div>
<div class="line"><a name="l01834"></a><span class="lineno"> 1834</span>&#160;                    <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;device_id);</div>
<div class="line"><a name="l01835"></a><span class="lineno"> 1835</span>&#160;                    <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;retry_control_handle);</div>
<div class="line"><a name="l01836"></a><span class="lineno"> 1836</span>&#160;                    <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter);</div>
<div class="line"><a name="l01837"></a><span class="lineno"> 1837</span>&#160;                    <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01838"></a><span class="lineno"> 1838</span>&#160;                    <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01839"></a><span class="lineno"> 1839</span>&#160;                }</div>
<div class="line"><a name="l01840"></a><span class="lineno"> 1840</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l01841"></a><span class="lineno"> 1841</span>&#160;                {</div>
<div class="line"><a name="l01842"></a><span class="lineno"> 1842</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_008: [If the upperConfig contains a valid protocolGatewayHostName value the this shall be used for the hostname, otherwise the hostname shall be constructed using the iothubname and iothubSuffix.] */</span></div>
<div class="line"><a name="l01843"></a><span class="lineno"> 1843</span>&#160;                    <span class="keywordflow">if</span> (upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a64f5ccfc18ce46337a09dfa0ac60b8dd">protocolGatewayHostName</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01844"></a><span class="lineno"> 1844</span>&#160;                    {</div>
<div class="line"><a name="l01845"></a><span class="lineno"> 1845</span>&#160;                         <a class="code" href="structstate.html">state</a>-&gt;hostAddress = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(<span class="stringliteral">&quot;%s.%s&quot;</span>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a6b559edc71ff3b0e8d9f9840cb36b27c">iotHubName</a>, upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ae54e74d8db92b20f796df76f01d5dd68">iotHubSuffix</a>);</div>
<div class="line"><a name="l01846"></a><span class="lineno"> 1846</span>&#160;                    }</div>
<div class="line"><a name="l01847"></a><span class="lineno"> 1847</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01848"></a><span class="lineno"> 1848</span>&#160;                    {</div>
<div class="line"><a name="l01849"></a><span class="lineno"> 1849</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;hostAddress = <a class="code" href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a>(upperConfig-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a64f5ccfc18ce46337a09dfa0ac60b8dd">protocolGatewayHostName</a>);</div>
<div class="line"><a name="l01850"></a><span class="lineno"> 1850</span>&#160;                    }</div>
<div class="line"><a name="l01851"></a><span class="lineno"> 1851</span>&#160;                </div>
<div class="line"><a name="l01852"></a><span class="lineno"> 1852</span>&#160;                    <span class="keywordflow">if</span> (<a class="code" href="structstate.html">state</a>-&gt;hostAddress == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01853"></a><span class="lineno"> 1853</span>&#160;                    {</div>
<div class="line"><a name="l01854"></a><span class="lineno"> 1854</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;failure constructing host address.&quot;</span>);</div>
<div class="line"><a name="l01855"></a><span class="lineno"> 1855</span>&#160;                        <a class="code" href="mqtt__client_8c.html#a253f82b1d05114d435979a52c7875813">mqtt_client_deinit</a>(<a class="code" href="structstate.html">state</a>-&gt;mqttClient);</div>
<div class="line"><a name="l01856"></a><span class="lineno"> 1856</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;devicesPath);</div>
<div class="line"><a name="l01857"></a><span class="lineno"> 1857</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;topic_MqttEvent);</div>
<div class="line"><a name="l01858"></a><span class="lineno"> 1858</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;device_id);</div>
<div class="line"><a name="l01859"></a><span class="lineno"> 1859</span>&#160;                        <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;retry_control_handle);</div>
<div class="line"><a name="l01860"></a><span class="lineno"> 1860</span>&#160;                        <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter);</div>
<div class="line"><a name="l01861"></a><span class="lineno"> 1861</span>&#160;                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01862"></a><span class="lineno"> 1862</span>&#160;                        <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01863"></a><span class="lineno"> 1863</span>&#160;                    }</div>
<div class="line"><a name="l01864"></a><span class="lineno"> 1864</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((<a class="code" href="structstate.html">state</a>-&gt;configPassedThroughUsername = buildConfigForUsername(upperConfig)) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01865"></a><span class="lineno"> 1865</span>&#160;                    {</div>
<div class="line"><a name="l01866"></a><span class="lineno"> 1866</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;hostAddress);</div>
<div class="line"><a name="l01867"></a><span class="lineno"> 1867</span>&#160;                        <a class="code" href="mqtt__client_8c.html#a253f82b1d05114d435979a52c7875813">mqtt_client_deinit</a>(<a class="code" href="structstate.html">state</a>-&gt;mqttClient);</div>
<div class="line"><a name="l01868"></a><span class="lineno"> 1868</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;devicesPath);</div>
<div class="line"><a name="l01869"></a><span class="lineno"> 1869</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;topic_MqttEvent);</div>
<div class="line"><a name="l01870"></a><span class="lineno"> 1870</span>&#160;                        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(<a class="code" href="structstate.html">state</a>-&gt;device_id);</div>
<div class="line"><a name="l01871"></a><span class="lineno"> 1871</span>&#160;                        <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;retry_control_handle);</div>
<div class="line"><a name="l01872"></a><span class="lineno"> 1872</span>&#160;                        <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(<a class="code" href="structstate.html">state</a>-&gt;msgTickCounter);</div>
<div class="line"><a name="l01873"></a><span class="lineno"> 1873</span>&#160;                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(<a class="code" href="structstate.html">state</a>);</div>
<div class="line"><a name="l01874"></a><span class="lineno"> 1874</span>&#160;                        <a class="code" href="structstate.html">state</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01875"></a><span class="lineno"> 1875</span>&#160;                    }</div>
<div class="line"><a name="l01876"></a><span class="lineno"> 1876</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01877"></a><span class="lineno"> 1877</span>&#160;                    {</div>
<div class="line"><a name="l01878"></a><span class="lineno"> 1878</span>&#160;                        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_010: [IoTHubTransport_MQTT_Common_Create shall allocate memory to save its internal state where all topics, hostname, device_id, device_key, sasTokenSr and client handle shall be saved.] */</span></div>
<div class="line"><a name="l01879"></a><span class="lineno"> 1879</span>&#160;                        <a class="code" href="doublylinkedlist_8c.html#a682ace80db3a8d5af3ba733320f31303">DList_InitializeListHead</a>(&amp;(<a class="code" href="structstate.html">state</a>-&gt;telemetry_waitingForAck));</div>
<div class="line"><a name="l01880"></a><span class="lineno"> 1880</span>&#160;                        <a class="code" href="doublylinkedlist_8c.html#a682ace80db3a8d5af3ba733320f31303">DList_InitializeListHead</a>(&amp;(<a class="code" href="structstate.html">state</a>-&gt;ack_waiting_queue));</div>
<div class="line"><a name="l01881"></a><span class="lineno"> 1881</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;isDestroyCalled = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01882"></a><span class="lineno"> 1882</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;isRegistered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01883"></a><span class="lineno"> 1883</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;mqttClientStatus = <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a>;</div>
<div class="line"><a name="l01884"></a><span class="lineno"> 1884</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;device_twin_get_sent = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01885"></a><span class="lineno"> 1885</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;isRecoverableError = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01886"></a><span class="lineno"> 1886</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;packetId = 1;</div>
<div class="line"><a name="l01887"></a><span class="lineno"> 1887</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;llClientHandle = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01888"></a><span class="lineno"> 1888</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;xioTransport = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01889"></a><span class="lineno"> 1889</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;portNum = 0;</div>
<div class="line"><a name="l01890"></a><span class="lineno"> 1890</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;waitingToSend = waitingToSend;</div>
<div class="line"><a name="l01891"></a><span class="lineno"> 1891</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;currPacketState = CONNECT_TYPE;</div>
<div class="line"><a name="l01892"></a><span class="lineno"> 1892</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;keepAliveValue = <a class="code" href="iothubtransport__mqtt__common_8c.html#a905fb31568fb9ecbdcbeeb4e0795b1b3">DEFAULT_MQTT_KEEPALIVE</a>;</div>
<div class="line"><a name="l01893"></a><span class="lineno"> 1893</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;connectFailCount = 0;</div>
<div class="line"><a name="l01894"></a><span class="lineno"> 1894</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;connectTick = 0;</div>
<div class="line"><a name="l01895"></a><span class="lineno"> 1895</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;topic_MqttMessage = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01896"></a><span class="lineno"> 1896</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;topic_GetState = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01897"></a><span class="lineno"> 1897</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;topic_NotifyState = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01898"></a><span class="lineno"> 1898</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;topics_ToSubscribe = <a class="code" href="iothubtransport__mqtt__common_8c.html#a35665d241984eff7e3ab14b0188d4ba8">UNSUBSCRIBE_FROM_TOPIC</a>;</div>
<div class="line"><a name="l01899"></a><span class="lineno"> 1899</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;topic_DeviceMethods = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01900"></a><span class="lineno"> 1900</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;log_trace = <a class="code" href="structstate.html">state</a>-&gt;raw_trace = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01901"></a><span class="lineno"> 1901</span>&#160;                        srand((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)<a class="code" href="agenttime_8c.html#ae215665d6ce179d18157b06033082b60">get_time</a>(<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>));</div>
<div class="line"><a name="l01902"></a><span class="lineno"> 1902</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;authorization_module = auth_module;</div>
<div class="line"><a name="l01903"></a><span class="lineno"> 1903</span>&#160;                        <a class="code" href="structstate.html">state</a>-&gt;isProductInfoSet = <span class="keyword">false</span>;</div>
<div class="line"><a name="l01904"></a><span class="lineno"> 1904</span>&#160;                    }</div>
<div class="line"><a name="l01905"></a><span class="lineno"> 1905</span>&#160;                }</div>
<div class="line"><a name="l01906"></a><span class="lineno"> 1906</span>&#160;            }</div>
<div class="line"><a name="l01907"></a><span class="lineno"> 1907</span>&#160;        }</div>
<div class="line"><a name="l01908"></a><span class="lineno"> 1908</span>&#160;    }</div>
<div class="line"><a name="l01909"></a><span class="lineno"> 1909</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="tinyexpr_8c.html#a99852dcb2cc193a859b86bef9805381f">state</a>;</div>
<div class="line"><a name="l01910"></a><span class="lineno"> 1910</span>&#160;}</div>
<div class="line"><a name="l01911"></a><span class="lineno"> 1911</span>&#160; </div>
<div class="line"><a name="l01912"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a60afc0a2e32dc67731e11894f9ba3381"> 1912</a></span>&#160;<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> <a class="code" href="iothubtransport__mqtt__common_8c.html#a60afc0a2e32dc67731e11894f9ba3381">IoTHubTransport_MQTT_Common_Create</a>(<span class="keyword">const</span> <a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html">IOTHUBTRANSPORT_CONFIG</a>* config, <a class="code" href="iothubtransport__mqtt__common_8h.html#aadf70c8c230285569dc7d6ff281fcb21">MQTT_GET_IO_TRANSPORT</a> get_io_transport)</div>
<div class="line"><a name="l01913"></a><span class="lineno"> 1913</span>&#160;{</div>
<div class="line"><a name="l01914"></a><span class="lineno"> 1914</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> result;</div>
<div class="line"><a name="l01915"></a><span class="lineno"> 1915</span>&#160;    <span class="keywordtype">size_t</span> deviceIdSize;</div>
<div class="line"><a name="l01916"></a><span class="lineno"> 1916</span>&#160; </div>
<div class="line"><a name="l01917"></a><span class="lineno"> 1917</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_001: [If parameter config is NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01918"></a><span class="lineno"> 1918</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_041: [ if get_io_transport is NULL then IoTHubTransport_MQTT_Common_Create shall return NULL. ] */</span></div>
<div class="line"><a name="l01919"></a><span class="lineno"> 1919</span>&#160;    <span class="keywordflow">if</span> (config == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || get_io_transport == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01920"></a><span class="lineno"> 1920</span>&#160;    {</div>
<div class="line"><a name="l01921"></a><span class="lineno"> 1921</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: Config Parameter is NULL.&quot;</span>);</div>
<div class="line"><a name="l01922"></a><span class="lineno"> 1922</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01923"></a><span class="lineno"> 1923</span>&#160;    }</div>
<div class="line"><a name="l01924"></a><span class="lineno"> 1924</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_002: [If the parameter config&#39;s variables upperConfig, auth_module_handle or waitingToSend are NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01925"></a><span class="lineno"> 1925</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#aed64933a7aabd2442da7ba3656ff7e89">auth_module_handle</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01926"></a><span class="lineno"> 1926</span>&#160;    {</div>
<div class="line"><a name="l01927"></a><span class="lineno"> 1927</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: auth_module_handle is NULL)&quot;</span>);</div>
<div class="line"><a name="l01928"></a><span class="lineno"> 1928</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01929"></a><span class="lineno"> 1929</span>&#160;    }</div>
<div class="line"><a name="l01930"></a><span class="lineno"> 1930</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_002: [If the parameter config&#39;s variables upperConfig or waitingToSend are NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01931"></a><span class="lineno"> 1931</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_003: [If the upperConfig&#39;s variables deviceId, both deviceKey and deviceSasToken, iotHubName, protocol, or iotHubSuffix are NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01932"></a><span class="lineno"> 1932</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_03_003: [If both deviceKey &amp; deviceSasToken fields are NOT NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01933"></a><span class="lineno"> 1933</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> ||</div>
<div class="line"><a name="l01934"></a><span class="lineno"> 1934</span>&#160;             config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#aa7753cf96255b57c65c56d8fedd3d7ca">protocol</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || </div>
<div class="line"><a name="l01935"></a><span class="lineno"> 1935</span>&#160;             config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#af33000861e1bb43af8e339dee3e689a0">deviceId</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || </div>
<div class="line"><a name="l01936"></a><span class="lineno"> 1936</span>&#160;             ((config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ad030712a97d1d08abb7d38841417fc2d">deviceKey</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a54b2c744ca9f3dbe94d71753ea36d1dc">deviceSasToken</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) ||</div>
<div class="line"><a name="l01937"></a><span class="lineno"> 1937</span>&#160;             <span class="comment">//is_key_validate(config) != 0 ||</span></div>
<div class="line"><a name="l01938"></a><span class="lineno"> 1938</span>&#160;             config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a6b559edc71ff3b0e8d9f9840cb36b27c">iotHubName</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || </div>
<div class="line"><a name="l01939"></a><span class="lineno"> 1939</span>&#160;             config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ae54e74d8db92b20f796df76f01d5dd68">iotHubSuffix</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01940"></a><span class="lineno"> 1940</span>&#160;    {</div>
<div class="line"><a name="l01941"></a><span class="lineno"> 1941</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: upperConfig structure contains an invalid parameter&quot;</span>);</div>
<div class="line"><a name="l01942"></a><span class="lineno"> 1942</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01943"></a><span class="lineno"> 1943</span>&#160;    }</div>
<div class="line"><a name="l01944"></a><span class="lineno"> 1944</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_002: [If the parameter config&#39;s variables upperConfig, auth_module_handle or waitingToSend are NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01945"></a><span class="lineno"> 1945</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#abd716d885797e2963c500c2315554ff7">waitingToSend</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01946"></a><span class="lineno"> 1946</span>&#160;    {</div>
<div class="line"><a name="l01947"></a><span class="lineno"> 1947</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: waitingToSend is NULL)&quot;</span>);</div>
<div class="line"><a name="l01948"></a><span class="lineno"> 1948</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01949"></a><span class="lineno"> 1949</span>&#160;    }</div>
<div class="line"><a name="l01950"></a><span class="lineno"> 1950</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_006: [If the upperConfig&#39;s variables deviceId is an empty strings or length is greater then 128 then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01951"></a><span class="lineno"> 1951</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( ( (deviceIdSize = strlen(config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#af33000861e1bb43af8e339dee3e689a0">deviceId</a>)) &gt; 128U) || (deviceIdSize == 0) )</div>
<div class="line"><a name="l01952"></a><span class="lineno"> 1952</span>&#160;    {</div>
<div class="line"><a name="l01953"></a><span class="lineno"> 1953</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: DeviceId is of an invalid size&quot;</span>);</div>
<div class="line"><a name="l01954"></a><span class="lineno"> 1954</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01955"></a><span class="lineno"> 1955</span>&#160;    }</div>
<div class="line"><a name="l01956"></a><span class="lineno"> 1956</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_003: [If the upperConfig&#39;s variables deviceId, both deviceKey and deviceSasToken, iotHubName, protocol, or iotHubSuffix are NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01957"></a><span class="lineno"> 1957</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ad030712a97d1d08abb7d38841417fc2d">deviceKey</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (strlen(config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#ad030712a97d1d08abb7d38841417fc2d">deviceKey</a>) == 0))</div>
<div class="line"><a name="l01958"></a><span class="lineno"> 1958</span>&#160;    {</div>
<div class="line"><a name="l01959"></a><span class="lineno"> 1959</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: deviceKey is empty&quot;</span>);</div>
<div class="line"><a name="l01960"></a><span class="lineno"> 1960</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01961"></a><span class="lineno"> 1961</span>&#160;    }</div>
<div class="line"><a name="l01962"></a><span class="lineno"> 1962</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_003: [If the upperConfig&#39;s variables deviceId, both deviceKey and deviceSasToken, iotHubName, protocol, or iotHubSuffix are NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01963"></a><span class="lineno"> 1963</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a54b2c744ca9f3dbe94d71753ea36d1dc">deviceSasToken</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (strlen(config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a54b2c744ca9f3dbe94d71753ea36d1dc">deviceSasToken</a>) == 0))</div>
<div class="line"><a name="l01964"></a><span class="lineno"> 1964</span>&#160;    {</div>
<div class="line"><a name="l01965"></a><span class="lineno"> 1965</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: deviceSasToken is empty&quot;</span>);</div>
<div class="line"><a name="l01966"></a><span class="lineno"> 1966</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01967"></a><span class="lineno"> 1967</span>&#160;    }</div>
<div class="line"><a name="l01968"></a><span class="lineno"> 1968</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_003: [If the upperConfig&#39;s variables deviceId, deviceKey, iotHubName, protocol, or iotHubSuffix are NULL then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01969"></a><span class="lineno"> 1969</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strlen(config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>-&gt;<a class="code" href="structIOTHUB__CLIENT__CONFIG__TAG.html#a6b559edc71ff3b0e8d9f9840cb36b27c">iotHubName</a>) == 0)</div>
<div class="line"><a name="l01970"></a><span class="lineno"> 1970</span>&#160;    {</div>
<div class="line"><a name="l01971"></a><span class="lineno"> 1971</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid Argument: iotHubName is empty&quot;</span>);</div>
<div class="line"><a name="l01972"></a><span class="lineno"> 1972</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01973"></a><span class="lineno"> 1973</span>&#160;    }</div>
<div class="line"><a name="l01974"></a><span class="lineno"> 1974</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l01975"></a><span class="lineno"> 1975</span>&#160;    {</div>
<div class="line"><a name="l01976"></a><span class="lineno"> 1976</span>&#160;        result = InitializeTransportHandleData(config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">upperConfig</a>, config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#abd716d885797e2963c500c2315554ff7">waitingToSend</a>, config-&gt;<a class="code" href="structIOTHUBTRANSPORT__CONFIG__TAG.html#aed64933a7aabd2442da7ba3656ff7e89">auth_module_handle</a>);</div>
<div class="line"><a name="l01977"></a><span class="lineno"> 1977</span>&#160;        <span class="keywordflow">if</span> (result != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01978"></a><span class="lineno"> 1978</span>&#160;        {</div>
<div class="line"><a name="l01979"></a><span class="lineno"> 1979</span>&#160;            result-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a104b92d040ffaefb6fb038c10f440796">get_io_transport</a> = get_io_transport;</div>
<div class="line"><a name="l01980"></a><span class="lineno"> 1980</span>&#160;            result-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01981"></a><span class="lineno"> 1981</span>&#160;            result-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">http_proxy_username</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01982"></a><span class="lineno"> 1982</span>&#160;            result-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">http_proxy_password</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01983"></a><span class="lineno"> 1983</span>&#160;        }</div>
<div class="line"><a name="l01984"></a><span class="lineno"> 1984</span>&#160;    }</div>
<div class="line"><a name="l01985"></a><span class="lineno"> 1985</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_009: [If any error is encountered then IoTHubTransport_MQTT_Common_Create shall return NULL.] */</span></div>
<div class="line"><a name="l01986"></a><span class="lineno"> 1986</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_011: [On Success IoTHubTransport_MQTT_Common_Create shall return a non-NULL value.] */</span></div>
<div class="line"><a name="l01987"></a><span class="lineno"> 1987</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01988"></a><span class="lineno"> 1988</span>&#160;}</div>
<div class="line"><a name="l01989"></a><span class="lineno"> 1989</span>&#160; </div>
<div class="line"><a name="l01990"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a60a7b7fa1d57870506d7c8198f2bf055"> 1990</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a60a7b7fa1d57870506d7c8198f2bf055">IoTHubTransport_MQTT_Common_Destroy</a>(<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> handle)</div>
<div class="line"><a name="l01991"></a><span class="lineno"> 1991</span>&#160;{</div>
<div class="line"><a name="l01992"></a><span class="lineno"> 1992</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_012: [IoTHubTransport_MQTT_Common_Destroy shall do nothing if parameter handle is NULL.] */</span></div>
<div class="line"><a name="l01993"></a><span class="lineno"> 1993</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l01994"></a><span class="lineno"> 1994</span>&#160;    <span class="keywordflow">if</span> (transport_data != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l01995"></a><span class="lineno"> 1995</span>&#160;    {</div>
<div class="line"><a name="l01996"></a><span class="lineno"> 1996</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9dcca736d0691d77478439ecc05b4526">isDestroyCalled</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l01997"></a><span class="lineno"> 1997</span>&#160; </div>
<div class="line"><a name="l01998"></a><span class="lineno"> 1998</span>&#160;        DisconnectFromClient(transport_data);</div>
<div class="line"><a name="l01999"></a><span class="lineno"> 1999</span>&#160; </div>
<div class="line"><a name="l02000"></a><span class="lineno"> 2000</span>&#160;        <span class="comment">//Empty the Waiting for Ack Messages.</span></div>
<div class="line"><a name="l02001"></a><span class="lineno"> 2001</span>&#160;        <span class="keywordflow">while</span> (!<a class="code" href="doublylinkedlist_8c.html#aaab37bb1e203dc4dc3d259cdea440a92">DList_IsListEmpty</a>(&amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>))</div>
<div class="line"><a name="l02002"></a><span class="lineno"> 2002</span>&#160;        {</div>
<div class="line"><a name="l02003"></a><span class="lineno"> 2003</span>&#160;            <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> currentEntry = <a class="code" href="doublylinkedlist_8c.html#a19216dad2b49004f6a1bcbf433f85201">DList_RemoveHeadList</a>(&amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>);</div>
<div class="line"><a name="l02004"></a><span class="lineno"> 2004</span>&#160;            <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>* mqttMsgEntry = <a class="code" href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a>(currentEntry, <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>, <a class="code" href="structentry.html">entry</a>);</div>
<div class="line"><a name="l02005"></a><span class="lineno"> 2005</span>&#160;            sendMsgComplete(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a>, transport_data, IOTHUB_CLIENT_CONFIRMATION_BECAUSE_DESTROY);</div>
<div class="line"><a name="l02006"></a><span class="lineno"> 2006</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqttMsgEntry);</div>
<div class="line"><a name="l02007"></a><span class="lineno"> 2007</span>&#160;        }</div>
<div class="line"><a name="l02008"></a><span class="lineno"> 2008</span>&#160;        <span class="keywordflow">while</span> (!<a class="code" href="doublylinkedlist_8c.html#aaab37bb1e203dc4dc3d259cdea440a92">DList_IsListEmpty</a>(&amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">ack_waiting_queue</a>))</div>
<div class="line"><a name="l02009"></a><span class="lineno"> 2009</span>&#160;        {</div>
<div class="line"><a name="l02010"></a><span class="lineno"> 2010</span>&#160;            <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> currentEntry = <a class="code" href="doublylinkedlist_8c.html#a19216dad2b49004f6a1bcbf433f85201">DList_RemoveHeadList</a>(&amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">ack_waiting_queue</a>);</div>
<div class="line"><a name="l02011"></a><span class="lineno"> 2011</span>&#160;            <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>* mqtt_device_twin = <a class="code" href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a>(currentEntry, <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>, <a class="code" href="structentry.html">entry</a>);</div>
<div class="line"><a name="l02012"></a><span class="lineno"> 2012</span>&#160;            <a class="code" href="iothub__client__ll_8c.html#a54e92efb1de9dea85d953a42b4bc1352">IoTHubClient_LL_ReportedStateComplete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a>, mqtt_device_twin-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a25b65bcd6d310d91ecc5f962d823977c">iothub_msg_id</a>, <a class="code" href="iothubtransport__mqtt__common_8c.html#a19c1223d5f5b9e3cf901ce2d2a657b74">STATUS_CODE_TIMEOUT_VALUE</a>);</div>
<div class="line"><a name="l02013"></a><span class="lineno"> 2013</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_device_twin);</div>
<div class="line"><a name="l02014"></a><span class="lineno"> 2014</span>&#160;        }</div>
<div class="line"><a name="l02015"></a><span class="lineno"> 2015</span>&#160; </div>
<div class="line"><a name="l02016"></a><span class="lineno"> 2016</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad7809e79d2e9e3ef3f471393511ea161">devicesPath</a>);</div>
<div class="line"><a name="l02017"></a><span class="lineno"> 2017</span>&#160; </div>
<div class="line"><a name="l02018"></a><span class="lineno"> 2018</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_014: [IoTHubTransport_MQTT_Common_Destroy shall free all the resources currently in use.] */</span></div>
<div class="line"><a name="l02019"></a><span class="lineno"> 2019</span>&#160;        <a class="code" href="mqtt__client_8c.html#a253f82b1d05114d435979a52c7875813">mqtt_client_deinit</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>);</div>
<div class="line"><a name="l02020"></a><span class="lineno"> 2020</span>&#160;        <a class="code" href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">retry_control_handle</a>);</div>
<div class="line"><a name="l02021"></a><span class="lineno"> 2021</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5d5870c74de2d33a04df2031b3984e7f">topic_MqttEvent</a>);</div>
<div class="line"><a name="l02022"></a><span class="lineno"> 2022</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a>);</div>
<div class="line"><a name="l02023"></a><span class="lineno"> 2023</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aa5871196da7d7da7b2d2e7f9f4a55731">device_id</a>);</div>
<div class="line"><a name="l02024"></a><span class="lineno"> 2024</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aeec3610b18121a94e5e5b1d51f34fdff">hostAddress</a>);</div>
<div class="line"><a name="l02025"></a><span class="lineno"> 2025</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad3bb71acb8df8e88bf30e5fa3dc0ea42">configPassedThroughUsername</a>);</div>
<div class="line"><a name="l02026"></a><span class="lineno"> 2026</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a>);</div>
<div class="line"><a name="l02027"></a><span class="lineno"> 2027</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a>);</div>
<div class="line"><a name="l02028"></a><span class="lineno"> 2028</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a>);</div>
<div class="line"><a name="l02029"></a><span class="lineno"> 2029</span>&#160; </div>
<div class="line"><a name="l02030"></a><span class="lineno"> 2030</span>&#160;        set_saved_tls_options(transport_data, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l02031"></a><span class="lineno"> 2031</span>&#160; </div>
<div class="line"><a name="l02032"></a><span class="lineno"> 2032</span>&#160;        <a class="code" href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>);</div>
<div class="line"><a name="l02033"></a><span class="lineno"> 2033</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_012: [ `IoTHubTransport_MQTT_Common_Destroy` shall free the stored proxy options. ]*/</span></div>
<div class="line"><a name="l02034"></a><span class="lineno"> 2034</span>&#160;        free_proxy_data(transport_data);</div>
<div class="line"><a name="l02035"></a><span class="lineno"> 2035</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(transport_data);</div>
<div class="line"><a name="l02036"></a><span class="lineno"> 2036</span>&#160;    }</div>
<div class="line"><a name="l02037"></a><span class="lineno"> 2037</span>&#160;}</div>
<div class="line"><a name="l02038"></a><span class="lineno"> 2038</span>&#160; </div>
<div class="line"><a name="l02039"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a6459574e19405348bb38dcbfa874613d"> 2039</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a6459574e19405348bb38dcbfa874613d">IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle)</div>
<div class="line"><a name="l02040"></a><span class="lineno"> 2040</span>&#160;{</div>
<div class="line"><a name="l02041"></a><span class="lineno"> 2041</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l02042"></a><span class="lineno"> 2042</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02043"></a><span class="lineno"> 2043</span>&#160;    <span class="keywordflow">if</span> (transport_data == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02044"></a><span class="lineno"> 2044</span>&#160;    {</div>
<div class="line"><a name="l02045"></a><span class="lineno"> 2045</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_042: [If the parameter handle is NULL than IoTHubTransport_MQTT_Common_Subscribe shall return a non-zero value.] */</span></div>
<div class="line"><a name="l02046"></a><span class="lineno"> 2046</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid handle parameter. NULL.&quot;</span>);</div>
<div class="line"><a name="l02047"></a><span class="lineno"> 2047</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02048"></a><span class="lineno"> 2048</span>&#160;    }</div>
<div class="line"><a name="l02049"></a><span class="lineno"> 2049</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02050"></a><span class="lineno"> 2050</span>&#160;    {</div>
<div class="line"><a name="l02051"></a><span class="lineno"> 2051</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02052"></a><span class="lineno"> 2052</span>&#160;        {</div>
<div class="line"><a name="l02053"></a><span class="lineno"> 2053</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_044: [IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin shall construct the get state topic string and the notify state topic string.] */</span></div>
<div class="line"><a name="l02054"></a><span class="lineno"> 2054</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> = <a class="code" href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a>(TOPIC_GET_DESIRED_STATE);</div>
<div class="line"><a name="l02055"></a><span class="lineno"> 2055</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02056"></a><span class="lineno"> 2056</span>&#160;            {</div>
<div class="line"><a name="l02057"></a><span class="lineno"> 2057</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_046: [Upon failure IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin shall return a non-zero value.] */</span></div>
<div class="line"><a name="l02058"></a><span class="lineno"> 2058</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: unable constructing reported state topic&quot;</span>);</div>
<div class="line"><a name="l02059"></a><span class="lineno"> 2059</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02060"></a><span class="lineno"> 2060</span>&#160;            }</div>
<div class="line"><a name="l02061"></a><span class="lineno"> 2061</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02062"></a><span class="lineno"> 2062</span>&#160;            {</div>
<div class="line"><a name="l02063"></a><span class="lineno"> 2063</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_047: [On success IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin shall return 0.] */</span></div>
<div class="line"><a name="l02064"></a><span class="lineno"> 2064</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a28f1b4f0886bfaf9a00796612117879e">SUBSCRIBE_GET_REPORTED_STATE_TOPIC</a>;</div>
<div class="line"><a name="l02065"></a><span class="lineno"> 2065</span>&#160;                result = 0;</div>
<div class="line"><a name="l02066"></a><span class="lineno"> 2066</span>&#160;            }</div>
<div class="line"><a name="l02067"></a><span class="lineno"> 2067</span>&#160;        }</div>
<div class="line"><a name="l02068"></a><span class="lineno"> 2068</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02069"></a><span class="lineno"> 2069</span>&#160;        {</div>
<div class="line"><a name="l02070"></a><span class="lineno"> 2070</span>&#160;            result = 0;</div>
<div class="line"><a name="l02071"></a><span class="lineno"> 2071</span>&#160;        }</div>
<div class="line"><a name="l02072"></a><span class="lineno"> 2072</span>&#160;        <span class="keywordflow">if</span> (result == 0 &amp;&amp; transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02073"></a><span class="lineno"> 2073</span>&#160;        {</div>
<div class="line"><a name="l02074"></a><span class="lineno"> 2074</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_044: [`IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin` shall construct the get state topic string and the notify state topic string.] */</span></div>
<div class="line"><a name="l02075"></a><span class="lineno"> 2075</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> = <a class="code" href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a>(TOPIC_NOTIFICATION_STATE);</div>
<div class="line"><a name="l02076"></a><span class="lineno"> 2076</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02077"></a><span class="lineno"> 2077</span>&#160;            {</div>
<div class="line"><a name="l02078"></a><span class="lineno"> 2078</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: unable constructing notify state topic&quot;</span>);</div>
<div class="line"><a name="l02079"></a><span class="lineno"> 2079</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02080"></a><span class="lineno"> 2080</span>&#160;            }</div>
<div class="line"><a name="l02081"></a><span class="lineno"> 2081</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02082"></a><span class="lineno"> 2082</span>&#160;            {</div>
<div class="line"><a name="l02083"></a><span class="lineno"> 2083</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_047: [On success IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin shall return 0.] */</span></div>
<div class="line"><a name="l02084"></a><span class="lineno"> 2084</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a7f290bee42e3871e80bdad7432fb1df9">SUBSCRIBE_NOTIFICATION_STATE_TOPIC</a>;</div>
<div class="line"><a name="l02085"></a><span class="lineno"> 2085</span>&#160;                result = 0;</div>
<div class="line"><a name="l02086"></a><span class="lineno"> 2086</span>&#160;            }</div>
<div class="line"><a name="l02087"></a><span class="lineno"> 2087</span>&#160;        }</div>
<div class="line"><a name="l02088"></a><span class="lineno"> 2088</span>&#160;        <span class="keywordflow">if</span> (result == 0)</div>
<div class="line"><a name="l02089"></a><span class="lineno"> 2089</span>&#160;        {</div>
<div class="line"><a name="l02090"></a><span class="lineno"> 2090</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != CONNACK_TYPE &amp;&amp;</div>
<div class="line"><a name="l02091"></a><span class="lineno"> 2091</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != CONNECT_TYPE &amp;&amp;</div>
<div class="line"><a name="l02092"></a><span class="lineno"> 2092</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != DISCONNECT_TYPE &amp;&amp;</div>
<div class="line"><a name="l02093"></a><span class="lineno"> 2093</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != PACKET_TYPE_ERROR)</div>
<div class="line"><a name="l02094"></a><span class="lineno"> 2094</span>&#160;            {</div>
<div class="line"><a name="l02095"></a><span class="lineno"> 2095</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = SUBSCRIBE_TYPE;</div>
<div class="line"><a name="l02096"></a><span class="lineno"> 2096</span>&#160;            }</div>
<div class="line"><a name="l02097"></a><span class="lineno"> 2097</span>&#160;        }</div>
<div class="line"><a name="l02098"></a><span class="lineno"> 2098</span>&#160;    }</div>
<div class="line"><a name="l02099"></a><span class="lineno"> 2099</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02100"></a><span class="lineno"> 2100</span>&#160;}</div>
<div class="line"><a name="l02101"></a><span class="lineno"> 2101</span>&#160; </div>
<div class="line"><a name="l02102"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#afe8e3a02ff7275f8dbf4b2ff2dd4513e"> 2102</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#afe8e3a02ff7275f8dbf4b2ff2dd4513e">IoTHubTransport_MQTT_Common_Unsubscribe_DeviceTwin</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle)</div>
<div class="line"><a name="l02103"></a><span class="lineno"> 2103</span>&#160;{</div>
<div class="line"><a name="l02104"></a><span class="lineno"> 2104</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02105"></a><span class="lineno"> 2105</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_048: [If the parameter handle is NULL than IoTHubTransport_MQTT_Common_Unsubscribe_DeviceTwin shall do nothing.] */</span></div>
<div class="line"><a name="l02106"></a><span class="lineno"> 2106</span>&#160;    <span class="keywordflow">if</span> (transport_data != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02107"></a><span class="lineno"> 2107</span>&#160;    {</div>
<div class="line"><a name="l02108"></a><span class="lineno"> 2108</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02109"></a><span class="lineno"> 2109</span>&#160;        {</div>
<div class="line"><a name="l02110"></a><span class="lineno"> 2110</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_049: [If subscribe_state is set to IOTHUB_DEVICE_TWIN_DESIRED_STATE then IoTHubTransport_MQTT_Common_Unsubscribe_DeviceTwin shall unsubscribe from the topic_GetState to the mqtt client.] */</span></div>
<div class="line"><a name="l02111"></a><span class="lineno"> 2111</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> &amp;= ~<a class="code" href="iothubtransport__mqtt__common_8c.html#a28f1b4f0886bfaf9a00796612117879e">SUBSCRIBE_GET_REPORTED_STATE_TOPIC</a>;</div>
<div class="line"><a name="l02112"></a><span class="lineno"> 2112</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a>);</div>
<div class="line"><a name="l02113"></a><span class="lineno"> 2113</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02114"></a><span class="lineno"> 2114</span>&#160;        }</div>
<div class="line"><a name="l02115"></a><span class="lineno"> 2115</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02116"></a><span class="lineno"> 2116</span>&#160;        {</div>
<div class="line"><a name="l02117"></a><span class="lineno"> 2117</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_050: [If subscribe_state is set to IOTHUB_DEVICE_TWIN_NOTIFICATION_STATE then IoTHubTransport_MQTT_Common_Unsubscribe_DeviceTwin shall unsubscribe from the topic_NotifyState to the mqtt client.] */</span></div>
<div class="line"><a name="l02118"></a><span class="lineno"> 2118</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> &amp;= ~<a class="code" href="iothubtransport__mqtt__common_8c.html#a7f290bee42e3871e80bdad7432fb1df9">SUBSCRIBE_NOTIFICATION_STATE_TOPIC</a>;</div>
<div class="line"><a name="l02119"></a><span class="lineno"> 2119</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a>);</div>
<div class="line"><a name="l02120"></a><span class="lineno"> 2120</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02121"></a><span class="lineno"> 2121</span>&#160;        }</div>
<div class="line"><a name="l02122"></a><span class="lineno"> 2122</span>&#160;    }</div>
<div class="line"><a name="l02123"></a><span class="lineno"> 2123</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02124"></a><span class="lineno"> 2124</span>&#160;    {</div>
<div class="line"><a name="l02125"></a><span class="lineno"> 2125</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid argument to unsubscribe (handle is NULL).&quot;</span>);</div>
<div class="line"><a name="l02126"></a><span class="lineno"> 2126</span>&#160;    }</div>
<div class="line"><a name="l02127"></a><span class="lineno"> 2127</span>&#160;}</div>
<div class="line"><a name="l02128"></a><span class="lineno"> 2128</span>&#160; </div>
<div class="line"><a name="l02129"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a2711aa32fdfa812d68e6b35acc470ac7"> 2129</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a2711aa32fdfa812d68e6b35acc470ac7">IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle)</div>
<div class="line"><a name="l02130"></a><span class="lineno"> 2130</span>&#160;{</div>
<div class="line"><a name="l02131"></a><span class="lineno"> 2131</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l02132"></a><span class="lineno"> 2132</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02133"></a><span class="lineno"> 2133</span>&#160; </div>
<div class="line"><a name="l02134"></a><span class="lineno"> 2134</span>&#160;    <span class="keywordflow">if</span> (transport_data == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02135"></a><span class="lineno"> 2135</span>&#160;    {</div>
<div class="line"><a name="l02136"></a><span class="lineno"> 2136</span>&#160;        <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_001 : [If the parameter handle is NULL than IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod shall return a non - zero value.]*/</span></div>
<div class="line"><a name="l02137"></a><span class="lineno"> 2137</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid handle parameter. NULL.&quot;</span>);</div>
<div class="line"><a name="l02138"></a><span class="lineno"> 2138</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02139"></a><span class="lineno"> 2139</span>&#160;    }</div>
<div class="line"><a name="l02140"></a><span class="lineno"> 2140</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02141"></a><span class="lineno"> 2141</span>&#160;    {</div>
<div class="line"><a name="l02142"></a><span class="lineno"> 2142</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02143"></a><span class="lineno"> 2143</span>&#160;        {</div>
<div class="line"><a name="l02144"></a><span class="lineno"> 2144</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_004 : [IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod shall construct the DEVICE_METHOD topic string for subscribe.]*/</span></div>
<div class="line"><a name="l02145"></a><span class="lineno"> 2145</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a> = <a class="code" href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a>(TOPIC_DEVICE_METHOD_SUBSCRIBE);</div>
<div class="line"><a name="l02146"></a><span class="lineno"> 2146</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02147"></a><span class="lineno"> 2147</span>&#160;            {</div>
<div class="line"><a name="l02148"></a><span class="lineno"> 2148</span>&#160;                <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_006 : [Upon failure IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod shall return a non - zero value.]*/</span></div>
<div class="line"><a name="l02149"></a><span class="lineno"> 2149</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: unable constructing device method subscribe topic&quot;</span>);</div>
<div class="line"><a name="l02150"></a><span class="lineno"> 2150</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02151"></a><span class="lineno"> 2151</span>&#160;            }</div>
<div class="line"><a name="l02152"></a><span class="lineno"> 2152</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02153"></a><span class="lineno"> 2153</span>&#160;            {</div>
<div class="line"><a name="l02154"></a><span class="lineno"> 2154</span>&#160;                <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_003 : [IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod shall set the signaling flag for DEVICE_METHOD topic for the receiver&#39;s topic list. ]*/</span></div>
<div class="line"><a name="l02155"></a><span class="lineno"> 2155</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a067063b96e352df08fbe2c56d3f24e10">SUBSCRIBE_DEVICE_METHOD_TOPIC</a>;</div>
<div class="line"><a name="l02156"></a><span class="lineno"> 2156</span>&#160;                result = 0;</div>
<div class="line"><a name="l02157"></a><span class="lineno"> 2157</span>&#160;            }</div>
<div class="line"><a name="l02158"></a><span class="lineno"> 2158</span>&#160;        }</div>
<div class="line"><a name="l02159"></a><span class="lineno"> 2159</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02160"></a><span class="lineno"> 2160</span>&#160;        {</div>
<div class="line"><a name="l02161"></a><span class="lineno"> 2161</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_002 : [If the MQTT transport has been previously subscribed to DEVICE_METHOD topic IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod shall do nothing and return 0.]*/</span></div>
<div class="line"><a name="l02162"></a><span class="lineno"> 2162</span>&#160;            result = 0;</div>
<div class="line"><a name="l02163"></a><span class="lineno"> 2163</span>&#160;        }</div>
<div class="line"><a name="l02164"></a><span class="lineno"> 2164</span>&#160; </div>
<div class="line"><a name="l02165"></a><span class="lineno"> 2165</span>&#160;        <span class="keywordflow">if</span> (result == 0)</div>
<div class="line"><a name="l02166"></a><span class="lineno"> 2166</span>&#160;        {</div>
<div class="line"><a name="l02167"></a><span class="lineno"> 2167</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_005 : [IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod shall schedule the send of the subscription.]*/</span></div>
<div class="line"><a name="l02168"></a><span class="lineno"> 2168</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_007 : [On success IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod shall return 0.]*/</span></div>
<div class="line"><a name="l02169"></a><span class="lineno"> 2169</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != CONNACK_TYPE &amp;&amp;</div>
<div class="line"><a name="l02170"></a><span class="lineno"> 2170</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != CONNECT_TYPE &amp;&amp;</div>
<div class="line"><a name="l02171"></a><span class="lineno"> 2171</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != DISCONNECT_TYPE &amp;&amp;</div>
<div class="line"><a name="l02172"></a><span class="lineno"> 2172</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != PACKET_TYPE_ERROR)</div>
<div class="line"><a name="l02173"></a><span class="lineno"> 2173</span>&#160;            {</div>
<div class="line"><a name="l02174"></a><span class="lineno"> 2174</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = SUBSCRIBE_TYPE;</div>
<div class="line"><a name="l02175"></a><span class="lineno"> 2175</span>&#160;            }</div>
<div class="line"><a name="l02176"></a><span class="lineno"> 2176</span>&#160;        }</div>
<div class="line"><a name="l02177"></a><span class="lineno"> 2177</span>&#160;    }</div>
<div class="line"><a name="l02178"></a><span class="lineno"> 2178</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02179"></a><span class="lineno"> 2179</span>&#160;}</div>
<div class="line"><a name="l02180"></a><span class="lineno"> 2180</span>&#160; </div>
<div class="line"><a name="l02181"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a9292e92f5705a4379829878a1c71528c"> 2181</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a9292e92f5705a4379829878a1c71528c">IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle)</div>
<div class="line"><a name="l02182"></a><span class="lineno"> 2182</span>&#160;{</div>
<div class="line"><a name="l02183"></a><span class="lineno"> 2183</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02184"></a><span class="lineno"> 2184</span>&#160;    <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_008 : [If the parameter handle is NULL than IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod shall do nothing and return.]*/</span></div>
<div class="line"><a name="l02185"></a><span class="lineno"> 2185</span>&#160;    <span class="keywordflow">if</span> (transport_data != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02186"></a><span class="lineno"> 2186</span>&#160;    {</div>
<div class="line"><a name="l02187"></a><span class="lineno"> 2187</span>&#160;        <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_009 : [If the MQTT transport has not been subscribed to DEVICE_METHOD topic IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod shall do nothing and return.]*/</span></div>
<div class="line"><a name="l02188"></a><span class="lineno"> 2188</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02189"></a><span class="lineno"> 2189</span>&#160;        {</div>
<div class="line"><a name="l02190"></a><span class="lineno"> 2190</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_010 : [IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod shall construct the DEVICE_METHOD topic string for unsubscribe.]*/</span></div>
<div class="line"><a name="l02191"></a><span class="lineno"> 2191</span>&#160;            <span class="keyword">const</span> <span class="keywordtype">char</span>* unsubscribe[1];</div>
<div class="line"><a name="l02192"></a><span class="lineno"> 2192</span>&#160;            unsubscribe[0] = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a>);</div>
<div class="line"><a name="l02193"></a><span class="lineno"> 2193</span>&#160; </div>
<div class="line"><a name="l02194"></a><span class="lineno"> 2194</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_011 : [IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod shall send the unsubscribe.]*/</span></div>
<div class="line"><a name="l02195"></a><span class="lineno"> 2195</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#a98bf6bb3417212c2d8d79bcb068d0dc3">mqtt_client_unsubscribe</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, get_next_packet_id(transport_data), unsubscribe, 1) != 0)</div>
<div class="line"><a name="l02196"></a><span class="lineno"> 2196</span>&#160;            {</div>
<div class="line"><a name="l02197"></a><span class="lineno"> 2197</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure calling mqtt_client_unsubscribe&quot;</span>);</div>
<div class="line"><a name="l02198"></a><span class="lineno"> 2198</span>&#160;            }</div>
<div class="line"><a name="l02199"></a><span class="lineno"> 2199</span>&#160; </div>
<div class="line"><a name="l02200"></a><span class="lineno"> 2200</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_12_012 : [IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod shall removes the signaling flag for DEVICE_METHOD topic from the receiver&#39;s topic list. ]*/</span></div>
<div class="line"><a name="l02201"></a><span class="lineno"> 2201</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a>);</div>
<div class="line"><a name="l02202"></a><span class="lineno"> 2202</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">topic_DeviceMethods</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02203"></a><span class="lineno"> 2203</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> &amp;= ~<a class="code" href="iothubtransport__mqtt__common_8c.html#a067063b96e352df08fbe2c56d3f24e10">SUBSCRIBE_DEVICE_METHOD_TOPIC</a>;</div>
<div class="line"><a name="l02204"></a><span class="lineno"> 2204</span>&#160;        }</div>
<div class="line"><a name="l02205"></a><span class="lineno"> 2205</span>&#160;    }</div>
<div class="line"><a name="l02206"></a><span class="lineno"> 2206</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02207"></a><span class="lineno"> 2207</span>&#160;    {</div>
<div class="line"><a name="l02208"></a><span class="lineno"> 2208</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid argument to unsubscribe (NULL).&quot;</span>);</div>
<div class="line"><a name="l02209"></a><span class="lineno"> 2209</span>&#160;    }</div>
<div class="line"><a name="l02210"></a><span class="lineno"> 2210</span>&#160;}</div>
<div class="line"><a name="l02211"></a><span class="lineno"> 2211</span>&#160; </div>
<div class="line"><a name="l02212"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#aa582051eca99872a0ade9b49d7f9cd77"> 2212</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#aa582051eca99872a0ade9b49d7f9cd77">IoTHubTransport_MQTT_Common_DeviceMethod_Response</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle, <a class="code" href="iothub__transport__ll_8h.html#a1cc79695294f89e97fb945066a3b3d77">METHOD_HANDLE</a> methodId, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* response, <span class="keywordtype">size_t</span> respSize, <span class="keywordtype">int</span> <a class="code" href="namespacegen__esp32part.html#a614575e8b56274b0a0bafca473224e5e">status</a>)</div>
<div class="line"><a name="l02213"></a><span class="lineno"> 2213</span>&#160;{</div>
<div class="line"><a name="l02214"></a><span class="lineno"> 2214</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l02215"></a><span class="lineno"> 2215</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* transport_data = (<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>*)handle;</div>
<div class="line"><a name="l02216"></a><span class="lineno"> 2216</span>&#160;    <span class="keywordflow">if</span> (transport_data != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02217"></a><span class="lineno"> 2217</span>&#160;    {</div>
<div class="line"><a name="l02218"></a><span class="lineno"> 2218</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_042: [ IoTHubTransport_MQTT_Common_DeviceMethod_Response shall publish an mqtt message for the device method response. ] */</span></div>
<div class="line"><a name="l02219"></a><span class="lineno"> 2219</span>&#160;        <a class="code" href="structDEVICE__METHOD__INFO__TAG.html">DEVICE_METHOD_INFO</a>* dev_method_info = (<a class="code" href="structDEVICE__METHOD__INFO__TAG.html">DEVICE_METHOD_INFO</a>*)methodId;</div>
<div class="line"><a name="l02220"></a><span class="lineno"> 2220</span>&#160;        <span class="keywordflow">if</span> (dev_method_info == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02221"></a><span class="lineno"> 2221</span>&#160;        {</div>
<div class="line"><a name="l02222"></a><span class="lineno"> 2222</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: DEVICE_METHOD_INFO was NULL&quot;</span>);</div>
<div class="line"><a name="l02223"></a><span class="lineno"> 2223</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02224"></a><span class="lineno"> 2224</span>&#160;        }</div>
<div class="line"><a name="l02225"></a><span class="lineno"> 2225</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02226"></a><span class="lineno"> 2226</span>&#160;        {</div>
<div class="line"><a name="l02227"></a><span class="lineno"> 2227</span>&#160;            <span class="keywordflow">if</span> (publish_device_method_message(transport_data, <a class="code" href="namespacegen__esp32part.html#a614575e8b56274b0a0bafca473224e5e">status</a>, dev_method_info-&gt;<a class="code" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">request_id</a>, response, respSize) != 0)</div>
<div class="line"><a name="l02228"></a><span class="lineno"> 2228</span>&#160;            {</div>
<div class="line"><a name="l02229"></a><span class="lineno"> 2229</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_051: [ If any error is encountered, IoTHubTransport_MQTT_Common_DeviceMethod_Response shall return a non-zero value. ] */</span></div>
<div class="line"><a name="l02230"></a><span class="lineno"> 2230</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: publishing device method response&quot;</span>);</div>
<div class="line"><a name="l02231"></a><span class="lineno"> 2231</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02232"></a><span class="lineno"> 2232</span>&#160;            }</div>
<div class="line"><a name="l02233"></a><span class="lineno"> 2233</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02234"></a><span class="lineno"> 2234</span>&#160;            {</div>
<div class="line"><a name="l02235"></a><span class="lineno"> 2235</span>&#160;                result = 0;</div>
<div class="line"><a name="l02236"></a><span class="lineno"> 2236</span>&#160;            }</div>
<div class="line"><a name="l02237"></a><span class="lineno"> 2237</span>&#160;            <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(dev_method_info-&gt;<a class="code" href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">request_id</a>);</div>
<div class="line"><a name="l02238"></a><span class="lineno"> 2238</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(dev_method_info);</div>
<div class="line"><a name="l02239"></a><span class="lineno"> 2239</span>&#160;        }</div>
<div class="line"><a name="l02240"></a><span class="lineno"> 2240</span>&#160;    }</div>
<div class="line"><a name="l02241"></a><span class="lineno"> 2241</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02242"></a><span class="lineno"> 2242</span>&#160;    {</div>
<div class="line"><a name="l02243"></a><span class="lineno"> 2243</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_041: [ If the parameter handle is NULL than IoTHubTransport_MQTT_Common_DeviceMethod_Response shall return a non-zero value. ] */</span></div>
<div class="line"><a name="l02244"></a><span class="lineno"> 2244</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02245"></a><span class="lineno"> 2245</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: invalid IOTHUB_DEVICE_HANDLE parameter specified&quot;</span>);</div>
<div class="line"><a name="l02246"></a><span class="lineno"> 2246</span>&#160;    }</div>
<div class="line"><a name="l02247"></a><span class="lineno"> 2247</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02248"></a><span class="lineno"> 2248</span>&#160;}</div>
<div class="line"><a name="l02249"></a><span class="lineno"> 2249</span>&#160; </div>
<div class="line"><a name="l02250"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#aef4eaf36a7e31478f440c5fd8d4201b9"> 2250</a></span>&#160;<span class="keywordtype">int</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#aef4eaf36a7e31478f440c5fd8d4201b9">IoTHubTransport_MQTT_Common_Subscribe</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle)</div>
<div class="line"><a name="l02251"></a><span class="lineno"> 2251</span>&#160;{</div>
<div class="line"><a name="l02252"></a><span class="lineno"> 2252</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l02253"></a><span class="lineno"> 2253</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02254"></a><span class="lineno"> 2254</span>&#160;    <span class="keywordflow">if</span> (transport_data == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02255"></a><span class="lineno"> 2255</span>&#160;    {</div>
<div class="line"><a name="l02256"></a><span class="lineno"> 2256</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_015: [If parameter handle is NULL than IoTHubTransport_MQTT_Common_Subscribe shall return a non-zero value.] */</span></div>
<div class="line"><a name="l02257"></a><span class="lineno"> 2257</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid handle parameter. NULL.&quot;</span>);</div>
<div class="line"><a name="l02258"></a><span class="lineno"> 2258</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02259"></a><span class="lineno"> 2259</span>&#160;    }</div>
<div class="line"><a name="l02260"></a><span class="lineno"> 2260</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02261"></a><span class="lineno"> 2261</span>&#160;    {</div>
<div class="line"><a name="l02262"></a><span class="lineno"> 2262</span>&#160;        <span class="comment">/* Code_SRS_IOTHUB_MQTT_TRANSPORT_07_016: [IoTHubTransport_MQTT_Common_Subscribe shall set a flag to enable mqtt_client_subscribe to be called to subscribe to the Message Topic.] */</span></div>
<div class="line"><a name="l02263"></a><span class="lineno"> 2263</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a> = <a class="code" href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a>(TOPIC_DEVICE_MSG, <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aa5871196da7d7da7b2d2e7f9f4a55731">device_id</a>) );</div>
<div class="line"><a name="l02264"></a><span class="lineno"> 2264</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02265"></a><span class="lineno"> 2265</span>&#160;        {</div>
<div class="line"><a name="l02266"></a><span class="lineno"> 2266</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure constructing Message Topic&quot;</span>);</div>
<div class="line"><a name="l02267"></a><span class="lineno"> 2267</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l02268"></a><span class="lineno"> 2268</span>&#160;        }</div>
<div class="line"><a name="l02269"></a><span class="lineno"> 2269</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02270"></a><span class="lineno"> 2270</span>&#160;        {</div>
<div class="line"><a name="l02271"></a><span class="lineno"> 2271</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> |= <a class="code" href="iothubtransport__mqtt__common_8c.html#a2d2ab9657cc946c76cb9fd383cbc510a">SUBSCRIBE_TELEMETRY_TOPIC</a>;</div>
<div class="line"><a name="l02272"></a><span class="lineno"> 2272</span>&#160;            <span class="comment">/* Code_SRS_IOTHUB_MQTT_TRANSPORT_07_035: [If current packet state is not CONNACT, DISCONNECT_TYPE, or PACKET_TYPE_ERROR then IoTHubTransport_MQTT_Common_Subscribe shall set the packet state to SUBSCRIBE_TYPE.]*/</span></div>
<div class="line"><a name="l02273"></a><span class="lineno"> 2273</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != CONNACK_TYPE &amp;&amp;</div>
<div class="line"><a name="l02274"></a><span class="lineno"> 2274</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != CONNECT_TYPE &amp;&amp;</div>
<div class="line"><a name="l02275"></a><span class="lineno"> 2275</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != DISCONNECT_TYPE &amp;&amp;</div>
<div class="line"><a name="l02276"></a><span class="lineno"> 2276</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> != PACKET_TYPE_ERROR)</div>
<div class="line"><a name="l02277"></a><span class="lineno"> 2277</span>&#160;            {</div>
<div class="line"><a name="l02278"></a><span class="lineno"> 2278</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = SUBSCRIBE_TYPE;</div>
<div class="line"><a name="l02279"></a><span class="lineno"> 2279</span>&#160;            }</div>
<div class="line"><a name="l02280"></a><span class="lineno"> 2280</span>&#160;            result = 0;</div>
<div class="line"><a name="l02281"></a><span class="lineno"> 2281</span>&#160;        }</div>
<div class="line"><a name="l02282"></a><span class="lineno"> 2282</span>&#160;    }</div>
<div class="line"><a name="l02283"></a><span class="lineno"> 2283</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02284"></a><span class="lineno"> 2284</span>&#160;}</div>
<div class="line"><a name="l02285"></a><span class="lineno"> 2285</span>&#160; </div>
<div class="line"><a name="l02286"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a8f3836e19c295f06c2387c8d9af9cc2c"> 2286</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a8f3836e19c295f06c2387c8d9af9cc2c">IoTHubTransport_MQTT_Common_Unsubscribe</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle)</div>
<div class="line"><a name="l02287"></a><span class="lineno"> 2287</span>&#160;{</div>
<div class="line"><a name="l02288"></a><span class="lineno"> 2288</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02289"></a><span class="lineno"> 2289</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_019: [If parameter handle is NULL then IoTHubTransport_MQTT_Common_Unsubscribe shall do nothing.] */</span></div>
<div class="line"><a name="l02290"></a><span class="lineno"> 2290</span>&#160;    <span class="keywordflow">if</span> (transport_data != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02291"></a><span class="lineno"> 2291</span>&#160;    {</div>
<div class="line"><a name="l02292"></a><span class="lineno"> 2292</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_020: [IoTHubTransport_MQTT_Common_Unsubscribe shall call mqtt_client_unsubscribe to unsubscribe the mqtt message topic.] */</span></div>
<div class="line"><a name="l02293"></a><span class="lineno"> 2293</span>&#160;        <span class="keyword">const</span> <span class="keywordtype">char</span>* unsubscribe[1];</div>
<div class="line"><a name="l02294"></a><span class="lineno"> 2294</span>&#160;        unsubscribe[0] = <a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a>);</div>
<div class="line"><a name="l02295"></a><span class="lineno"> 2295</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="mqtt__client_8c.html#a98bf6bb3417212c2d8d79bcb068d0dc3">mqtt_client_unsubscribe</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, get_next_packet_id(transport_data), unsubscribe, 1) != 0)</div>
<div class="line"><a name="l02296"></a><span class="lineno"> 2296</span>&#160;        {</div>
<div class="line"><a name="l02297"></a><span class="lineno"> 2297</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure calling mqtt_client_unsubscribe&quot;</span>);</div>
<div class="line"><a name="l02298"></a><span class="lineno"> 2298</span>&#160;        }</div>
<div class="line"><a name="l02299"></a><span class="lineno"> 2299</span>&#160;        <a class="code" href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a>);</div>
<div class="line"><a name="l02300"></a><span class="lineno"> 2300</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">topic_MqttMessage</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02301"></a><span class="lineno"> 2301</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">topics_ToSubscribe</a> &amp;= ~<a class="code" href="iothubtransport__mqtt__common_8c.html#a2d2ab9657cc946c76cb9fd383cbc510a">SUBSCRIBE_TELEMETRY_TOPIC</a>;</div>
<div class="line"><a name="l02302"></a><span class="lineno"> 2302</span>&#160;    }</div>
<div class="line"><a name="l02303"></a><span class="lineno"> 2303</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02304"></a><span class="lineno"> 2304</span>&#160;    {</div>
<div class="line"><a name="l02305"></a><span class="lineno"> 2305</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid argument to unsubscribe (NULL).&quot;</span>);</div>
<div class="line"><a name="l02306"></a><span class="lineno"> 2306</span>&#160;    }</div>
<div class="line"><a name="l02307"></a><span class="lineno"> 2307</span>&#160;}</div>
<div class="line"><a name="l02308"></a><span class="lineno"> 2308</span>&#160; </div>
<div class="line"><a name="l02309"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae450c1cb06546a36229076f07f86f2ec"> 2309</a></span>&#160;IOTHUB_PROCESS_ITEM_RESULT <a class="code" href="iothubtransport__mqtt__common_8c.html#ae450c1cb06546a36229076f07f86f2ec">IoTHubTransport_MQTT_Common_ProcessItem</a>(<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> handle, IOTHUB_IDENTITY_TYPE item_type, <a class="code" href="unionIOTHUB__IDENTITY__INFO__TAG.html">IOTHUB_IDENTITY_INFO</a>* iothub_item)</div>
<div class="line"><a name="l02310"></a><span class="lineno"> 2310</span>&#160;{</div>
<div class="line"><a name="l02311"></a><span class="lineno"> 2311</span>&#160;    IOTHUB_PROCESS_ITEM_RESULT result;</div>
<div class="line"><a name="l02312"></a><span class="lineno"> 2312</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUBCLIENT_LL_07_001: [ If handle or iothub_item are NULL then IoTHubTransport_MQTT_Common_ProcessItem shall return IOTHUB_PROCESS_ERROR. ]*/</span></div>
<div class="line"><a name="l02313"></a><span class="lineno"> 2313</span>&#160;    <span class="keywordflow">if</span> (handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || iothub_item == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02314"></a><span class="lineno"> 2314</span>&#160;    {</div>
<div class="line"><a name="l02315"></a><span class="lineno"> 2315</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid handle parameter iothub_item=%p&quot;</span>, iothub_item);</div>
<div class="line"><a name="l02316"></a><span class="lineno"> 2316</span>&#160;        result = IOTHUB_PROCESS_ERROR;</div>
<div class="line"><a name="l02317"></a><span class="lineno"> 2317</span>&#160;    }</div>
<div class="line"><a name="l02318"></a><span class="lineno"> 2318</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02319"></a><span class="lineno"> 2319</span>&#160;    {</div>
<div class="line"><a name="l02320"></a><span class="lineno"> 2320</span>&#160;        <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02321"></a><span class="lineno"> 2321</span>&#160; </div>
<div class="line"><a name="l02322"></a><span class="lineno"> 2322</span>&#160;        <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> == PUBLISH_TYPE)</div>
<div class="line"><a name="l02323"></a><span class="lineno"> 2323</span>&#160;        {</div>
<div class="line"><a name="l02324"></a><span class="lineno"> 2324</span>&#160;            <span class="keywordflow">if</span> (item_type == IOTHUB_TYPE_DEVICE_TWIN)</div>
<div class="line"><a name="l02325"></a><span class="lineno"> 2325</span>&#160;            {</div>
<div class="line"><a name="l02326"></a><span class="lineno"> 2326</span>&#160;                <a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>* mqtt_info = (<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM</a>));</div>
<div class="line"><a name="l02327"></a><span class="lineno"> 2327</span>&#160;                <span class="keywordflow">if</span> (mqtt_info == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02328"></a><span class="lineno"> 2328</span>&#160;                {</div>
<div class="line"><a name="l02329"></a><span class="lineno"> 2329</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUBCLIENT_LL_07_004: [ If any errors are encountered IoTHubTransport_MQTT_Common_ProcessItem shall return IOTHUB_PROCESS_ERROR. ]*/</span></div>
<div class="line"><a name="l02330"></a><span class="lineno"> 2330</span>&#160;                    result = IOTHUB_PROCESS_ERROR;</div>
<div class="line"><a name="l02331"></a><span class="lineno"> 2331</span>&#160;                }</div>
<div class="line"><a name="l02332"></a><span class="lineno"> 2332</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02333"></a><span class="lineno"> 2333</span>&#160;                {</div>
<div class="line"><a name="l02334"></a><span class="lineno"> 2334</span>&#160;                    <span class="comment">/*Codes_SRS_IOTHUBCLIENT_LL_07_003: [ IoTHubTransport_MQTT_Common_ProcessItem shall publish a message to the mqtt protocol with the message topic for the message type.]*/</span></div>
<div class="line"><a name="l02335"></a><span class="lineno"> 2335</span>&#160;                    mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a3e4877f0d8a7f9c150b2f49045cd751c">iothub_type</a> = item_type;</div>
<div class="line"><a name="l02336"></a><span class="lineno"> 2336</span>&#160;                    mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a25b65bcd6d310d91ecc5f962d823977c">iothub_msg_id</a> = iothub_item-&gt;<a class="code" href="unionIOTHUB__IDENTITY__INFO__TAG.html#a8de54ec066823f63fffeb477b640b981">device_twin</a>-&gt;<a class="code" href="structIOTHUB__DEVICE__TWIN__TAG.html#a4476afa977a129094769793ebe9f7bd6">item_id</a>;</div>
<div class="line"><a name="l02337"></a><span class="lineno"> 2337</span>&#160;                    mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a53f4c3d2df8deb260a5aad5bf5a44333">retryCount</a> = 0;</div>
<div class="line"><a name="l02338"></a><span class="lineno"> 2338</span>&#160;                    </div>
<div class="line"><a name="l02339"></a><span class="lineno"> 2339</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUBCLIENT_LL_07_005: [ If successful IoTHubTransport_MQTT_Common_ProcessItem shall add mqtt info structure acknowledgement queue. ] */</span></div>
<div class="line"><a name="l02340"></a><span class="lineno"> 2340</span>&#160;                    <a class="code" href="doublylinkedlist_8c.html#aed0982baf1c3937160e7a87d92045f10">DList_InsertTailList</a>(&amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">ack_waiting_queue</a>, &amp;mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a57376049aa40b9b7ff926302082a300d">entry</a>);</div>
<div class="line"><a name="l02341"></a><span class="lineno"> 2341</span>&#160; </div>
<div class="line"><a name="l02342"></a><span class="lineno"> 2342</span>&#160;                    <span class="keywordflow">if</span> (publish_device_twin_message(transport_data, iothub_item-&gt;<a class="code" href="unionIOTHUB__IDENTITY__INFO__TAG.html#a8de54ec066823f63fffeb477b640b981">device_twin</a>, mqtt_info) != 0)</div>
<div class="line"><a name="l02343"></a><span class="lineno"> 2343</span>&#160;                    {</div>
<div class="line"><a name="l02344"></a><span class="lineno"> 2344</span>&#160;                        <a class="code" href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a>(&amp;mqtt_info-&gt;<a class="code" href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a57376049aa40b9b7ff926302082a300d">entry</a>);</div>
<div class="line"><a name="l02345"></a><span class="lineno"> 2345</span>&#160; </div>
<div class="line"><a name="l02346"></a><span class="lineno"> 2346</span>&#160;                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqtt_info);</div>
<div class="line"><a name="l02347"></a><span class="lineno"> 2347</span>&#160;                        <span class="comment">/* Codes_SRS_IOTHUBCLIENT_LL_07_004: [ If any errors are encountered IoTHubTransport_MQTT_Common_ProcessItem shall return IOTHUB_PROCESS_ERROR. ]*/</span></div>
<div class="line"><a name="l02348"></a><span class="lineno"> 2348</span>&#160;                        result = IOTHUB_PROCESS_ERROR;</div>
<div class="line"><a name="l02349"></a><span class="lineno"> 2349</span>&#160;                    }</div>
<div class="line"><a name="l02350"></a><span class="lineno"> 2350</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02351"></a><span class="lineno"> 2351</span>&#160;                    {</div>
<div class="line"><a name="l02352"></a><span class="lineno"> 2352</span>&#160;                        result = IOTHUB_PROCESS_OK;</div>
<div class="line"><a name="l02353"></a><span class="lineno"> 2353</span>&#160;                    }</div>
<div class="line"><a name="l02354"></a><span class="lineno"> 2354</span>&#160;                }</div>
<div class="line"><a name="l02355"></a><span class="lineno"> 2355</span>&#160;            }</div>
<div class="line"><a name="l02356"></a><span class="lineno"> 2356</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02357"></a><span class="lineno"> 2357</span>&#160;            {</div>
<div class="line"><a name="l02358"></a><span class="lineno"> 2358</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUBCLIENT_LL_07_006: [ If the item_type is not a supported type IoTHubTransport_MQTT_Common_ProcessItem shall return IOTHUB_PROCESS_CONTINUE. ]*/</span></div>
<div class="line"><a name="l02359"></a><span class="lineno"> 2359</span>&#160;                result = IOTHUB_PROCESS_CONTINUE;</div>
<div class="line"><a name="l02360"></a><span class="lineno"> 2360</span>&#160;            }</div>
<div class="line"><a name="l02361"></a><span class="lineno"> 2361</span>&#160;        }</div>
<div class="line"><a name="l02362"></a><span class="lineno"> 2362</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02363"></a><span class="lineno"> 2363</span>&#160;        {</div>
<div class="line"><a name="l02364"></a><span class="lineno"> 2364</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUBCLIENT_LL_07_002: [ If the mqtt is not ready to publish messages IoTHubTransport_MQTT_Common_ProcessItem shall return IOTHUB_PROCESS_NOT_CONNECTED. ] */</span></div>
<div class="line"><a name="l02365"></a><span class="lineno"> 2365</span>&#160;            result = IOTHUB_PROCESS_NOT_CONNECTED;</div>
<div class="line"><a name="l02366"></a><span class="lineno"> 2366</span>&#160;        }</div>
<div class="line"><a name="l02367"></a><span class="lineno"> 2367</span>&#160;    }</div>
<div class="line"><a name="l02368"></a><span class="lineno"> 2368</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02369"></a><span class="lineno"> 2369</span>&#160;}</div>
<div class="line"><a name="l02370"></a><span class="lineno"> 2370</span>&#160; </div>
<div class="line"><a name="l02371"></a><span class="lineno"> 2371</span>&#160;<span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_054: [ IoTHubTransport_MQTT_Common_DoWork shall subscribe to the Notification and get_state Topics if they are defined. ] */</span></div>
<div class="line"><a name="l02372"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a3257671a34610dc91baf5c1bedd2c468"> 2372</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a3257671a34610dc91baf5c1bedd2c468">IoTHubTransport_MQTT_Common_DoWork</a>(<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> handle, <a class="code" href="structIOTHUB__CLIENT__LL__HANDLE__DATA__TAG.html">IOTHUB_CLIENT_LL_HANDLE</a> iotHubClientHandle)</div>
<div class="line"><a name="l02373"></a><span class="lineno"> 2373</span>&#160;{</div>
<div class="line"><a name="l02374"></a><span class="lineno"> 2374</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_026: [IoTHubTransport_MQTT_Common_DoWork shall do nothing if parameter handle and/or iotHubClientHandle is NULL.] */</span></div>
<div class="line"><a name="l02375"></a><span class="lineno"> 2375</span>&#160;    <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">PMQTTTRANSPORT_HANDLE_DATA</a> transport_data = (<a class="code" href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a>)handle;</div>
<div class="line"><a name="l02376"></a><span class="lineno"> 2376</span>&#160;    <span class="keywordflow">if</span> (transport_data != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> &amp;&amp; iotHubClientHandle != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02377"></a><span class="lineno"> 2377</span>&#160;    {</div>
<div class="line"><a name="l02378"></a><span class="lineno"> 2378</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">llClientHandle</a> = iotHubClientHandle;</div>
<div class="line"><a name="l02379"></a><span class="lineno"> 2379</span>&#160; </div>
<div class="line"><a name="l02380"></a><span class="lineno"> 2380</span>&#160;        <span class="keywordflow">if</span> (InitializeConnection(transport_data) != 0)</div>
<div class="line"><a name="l02381"></a><span class="lineno"> 2381</span>&#160;        {</div>
<div class="line"><a name="l02382"></a><span class="lineno"> 2382</span>&#160;            <span class="comment">// Don&#39;t want to flood the logs with failures here</span></div>
<div class="line"><a name="l02383"></a><span class="lineno"> 2383</span>&#160;        }</div>
<div class="line"><a name="l02384"></a><span class="lineno"> 2384</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02385"></a><span class="lineno"> 2385</span>&#160;        {</div>
<div class="line"><a name="l02386"></a><span class="lineno"> 2386</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> == CONNACK_TYPE || transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> == SUBSCRIBE_TYPE)</div>
<div class="line"><a name="l02387"></a><span class="lineno"> 2387</span>&#160;            {</div>
<div class="line"><a name="l02388"></a><span class="lineno"> 2388</span>&#160;                SubscribeToMqttProtocol(transport_data);</div>
<div class="line"><a name="l02389"></a><span class="lineno"> 2389</span>&#160;            }</div>
<div class="line"><a name="l02390"></a><span class="lineno"> 2390</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> == SUBACK_TYPE)</div>
<div class="line"><a name="l02391"></a><span class="lineno"> 2391</span>&#160;            {</div>
<div class="line"><a name="l02392"></a><span class="lineno"> 2392</span>&#160;                <span class="keywordflow">if</span> ((transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">topic_NotifyState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">topic_GetState</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp;</div>
<div class="line"><a name="l02393"></a><span class="lineno"> 2393</span>&#160;                    !transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">device_twin_get_sent</a>)</div>
<div class="line"><a name="l02394"></a><span class="lineno"> 2394</span>&#160;                {</div>
<div class="line"><a name="l02395"></a><span class="lineno"> 2395</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_055: [ IoTHubTransport_MQTT_Common_DoWork shall send a device twin get property message upon successfully retrieving a SUBACK on device twin topics. ] */</span></div>
<div class="line"><a name="l02396"></a><span class="lineno"> 2396</span>&#160;                    <span class="keywordflow">if</span> (publish_device_twin_get_message(transport_data) == 0)</div>
<div class="line"><a name="l02397"></a><span class="lineno"> 2397</span>&#160;                    {</div>
<div class="line"><a name="l02398"></a><span class="lineno"> 2398</span>&#160;                        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">device_twin_get_sent</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02399"></a><span class="lineno"> 2399</span>&#160;                    }</div>
<div class="line"><a name="l02400"></a><span class="lineno"> 2400</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02401"></a><span class="lineno"> 2401</span>&#160;                    {</div>
<div class="line"><a name="l02402"></a><span class="lineno"> 2402</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure: sending device twin get property command.&quot;</span>);</div>
<div class="line"><a name="l02403"></a><span class="lineno"> 2403</span>&#160;                    }</div>
<div class="line"><a name="l02404"></a><span class="lineno"> 2404</span>&#160;                }</div>
<div class="line"><a name="l02405"></a><span class="lineno"> 2405</span>&#160;                <span class="comment">// Publish can be called now</span></div>
<div class="line"><a name="l02406"></a><span class="lineno"> 2406</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = PUBLISH_TYPE;</div>
<div class="line"><a name="l02407"></a><span class="lineno"> 2407</span>&#160;            }</div>
<div class="line"><a name="l02408"></a><span class="lineno"> 2408</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> == PUBLISH_TYPE)</div>
<div class="line"><a name="l02409"></a><span class="lineno"> 2409</span>&#160;            {</div>
<div class="line"><a name="l02410"></a><span class="lineno"> 2410</span>&#160;                <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> currentListEntry = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02411"></a><span class="lineno"> 2411</span>&#160;                <span class="keywordflow">while</span> (currentListEntry != &amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>)</div>
<div class="line"><a name="l02412"></a><span class="lineno"> 2412</span>&#160;                {</div>
<div class="line"><a name="l02413"></a><span class="lineno"> 2413</span>&#160;                    <a class="code" href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a> current_ms;</div>
<div class="line"><a name="l02414"></a><span class="lineno"> 2414</span>&#160;                    <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>* mqttMsgEntry = <a class="code" href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a>(currentListEntry, <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>, <a class="code" href="structentry.html">entry</a>);</div>
<div class="line"><a name="l02415"></a><span class="lineno"> 2415</span>&#160;                    <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> nextListEntry;</div>
<div class="line"><a name="l02416"></a><span class="lineno"> 2416</span>&#160;                    nextListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a> = currentListEntry-&gt;<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02417"></a><span class="lineno"> 2417</span>&#160; </div>
<div class="line"><a name="l02418"></a><span class="lineno"> 2418</span>&#160;                    (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">msgTickCounter</a>, &amp;current_ms);</div>
<div class="line"><a name="l02419"></a><span class="lineno"> 2419</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_033: [IoTHubTransport_MQTT_Common_DoWork shall iterate through the Waiting Acknowledge messages looking for any message that has been waiting longer than 2 min.]*/</span></div>
<div class="line"><a name="l02420"></a><span class="lineno"> 2420</span>&#160;                    <span class="keywordflow">if</span> (((current_ms - mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a62baa2b850b021a73e060abc2abd445e">msgPublishTime</a>) / 1000) &gt; <a class="code" href="iothubtransport__mqtt__common_8c.html#a33c77b72749b1d9d1ab8edf93f28ee8b">RESEND_TIMEOUT_VALUE_MIN</a>)</div>
<div class="line"><a name="l02421"></a><span class="lineno"> 2421</span>&#160;                    {</div>
<div class="line"><a name="l02422"></a><span class="lineno"> 2422</span>&#160;                        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_034: [If IoTHubTransport_MQTT_Common_DoWork has resent the message two times then it shall fail the message and reconnect to IoTHub ... ] */</span></div>
<div class="line"><a name="l02423"></a><span class="lineno"> 2423</span>&#160;                        <span class="keywordflow">if</span> (mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a23a9cb715c409bb3717c1cd639420115">retryCount</a> &gt;= <a class="code" href="iothubtransport__mqtt__common_8c.html#afd1e574a64f8b032be6a5ad196278c1e">MAX_SEND_RECOUNT_LIMIT</a>)</div>
<div class="line"><a name="l02424"></a><span class="lineno"> 2424</span>&#160;                        {</div>
<div class="line"><a name="l02425"></a><span class="lineno"> 2425</span>&#160;                            <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> current_entry;</div>
<div class="line"><a name="l02426"></a><span class="lineno"> 2426</span>&#160;                            (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a>(currentListEntry);</div>
<div class="line"><a name="l02427"></a><span class="lineno"> 2427</span>&#160;                            sendMsgComplete(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a>, transport_data, IOTHUB_CLIENT_CONFIRMATION_MESSAGE_TIMEOUT);</div>
<div class="line"><a name="l02428"></a><span class="lineno"> 2428</span>&#160;                            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqttMsgEntry);</div>
<div class="line"><a name="l02429"></a><span class="lineno"> 2429</span>&#160;                                                        </div>
<div class="line"><a name="l02430"></a><span class="lineno"> 2430</span>&#160;                            <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_07_057: [ ... then go through all the rest of the waiting messages and reset the retryCount on the message. ]*/</span></div>
<div class="line"><a name="l02431"></a><span class="lineno"> 2431</span>&#160;                            current_entry = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02432"></a><span class="lineno"> 2432</span>&#160;                            <span class="keywordflow">while</span> (current_entry != &amp;transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>)</div>
<div class="line"><a name="l02433"></a><span class="lineno"> 2433</span>&#160;                            {</div>
<div class="line"><a name="l02434"></a><span class="lineno"> 2434</span>&#160;                                <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>* msg_reset_entry;</div>
<div class="line"><a name="l02435"></a><span class="lineno"> 2435</span>&#160;                                msg_reset_entry = <a class="code" href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a>(current_entry, <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>, <a class="code" href="structentry.html">entry</a>);</div>
<div class="line"><a name="l02436"></a><span class="lineno"> 2436</span>&#160;                                msg_reset_entry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a23a9cb715c409bb3717c1cd639420115">retryCount</a> = 0;</div>
<div class="line"><a name="l02437"></a><span class="lineno"> 2437</span>&#160;                                current_entry = current_entry-&gt;<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02438"></a><span class="lineno"> 2438</span>&#160;                            }</div>
<div class="line"><a name="l02439"></a><span class="lineno"> 2439</span>&#160; </div>
<div class="line"><a name="l02440"></a><span class="lineno"> 2440</span>&#160;                            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">currPacketState</a> = PACKET_TYPE_ERROR;</div>
<div class="line"><a name="l02441"></a><span class="lineno"> 2441</span>&#160;                            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">device_twin_get_sent</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02442"></a><span class="lineno"> 2442</span>&#160;                            DisconnectFromClient(transport_data);</div>
<div class="line"><a name="l02443"></a><span class="lineno"> 2443</span>&#160;                            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l02444"></a><span class="lineno"> 2444</span>&#160;                        }</div>
<div class="line"><a name="l02445"></a><span class="lineno"> 2445</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02446"></a><span class="lineno"> 2446</span>&#160;                        {</div>
<div class="line"><a name="l02447"></a><span class="lineno"> 2447</span>&#160;                            <span class="keywordtype">size_t</span> messageLength;</div>
<div class="line"><a name="l02448"></a><span class="lineno"> 2448</span>&#160;                            <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* messagePayload = RetrieveMessagePayload(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a>-&gt;<a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html#a1bbd4c03b7fcff198e14e92d7c36299c">messageHandle</a>, &amp;messageLength);</div>
<div class="line"><a name="l02449"></a><span class="lineno"> 2449</span>&#160;                            <span class="keywordflow">if</span> (messageLength == 0 || messagePayload == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02450"></a><span class="lineno"> 2450</span>&#160;                            {</div>
<div class="line"><a name="l02451"></a><span class="lineno"> 2451</span>&#160;                                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure from creating Message IoTHubMessage_GetData&quot;</span>);</div>
<div class="line"><a name="l02452"></a><span class="lineno"> 2452</span>&#160;                            }</div>
<div class="line"><a name="l02453"></a><span class="lineno"> 2453</span>&#160;                            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02454"></a><span class="lineno"> 2454</span>&#160;                            {</div>
<div class="line"><a name="l02455"></a><span class="lineno"> 2455</span>&#160;                                <span class="keywordflow">if</span> (publish_mqtt_telemetry_msg(transport_data, mqttMsgEntry, messagePayload, messageLength) != 0)</div>
<div class="line"><a name="l02456"></a><span class="lineno"> 2456</span>&#160;                                {</div>
<div class="line"><a name="l02457"></a><span class="lineno"> 2457</span>&#160;                                    (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a>(currentListEntry);</div>
<div class="line"><a name="l02458"></a><span class="lineno"> 2458</span>&#160;                                    sendMsgComplete(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a>, transport_data, IOTHUB_CLIENT_CONFIRMATION_ERROR);</div>
<div class="line"><a name="l02459"></a><span class="lineno"> 2459</span>&#160;                                    <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqttMsgEntry);</div>
<div class="line"><a name="l02460"></a><span class="lineno"> 2460</span>&#160;                                }</div>
<div class="line"><a name="l02461"></a><span class="lineno"> 2461</span>&#160;                            }</div>
<div class="line"><a name="l02462"></a><span class="lineno"> 2462</span>&#160;                        }</div>
<div class="line"><a name="l02463"></a><span class="lineno"> 2463</span>&#160;                    }</div>
<div class="line"><a name="l02464"></a><span class="lineno"> 2464</span>&#160;                    currentListEntry = nextListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02465"></a><span class="lineno"> 2465</span>&#160;                }</div>
<div class="line"><a name="l02466"></a><span class="lineno"> 2466</span>&#160; </div>
<div class="line"><a name="l02467"></a><span class="lineno"> 2467</span>&#160;                currentListEntry = transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5280afeeba67d2f6e6d4cde3e1b719bf">waitingToSend</a>-&gt;<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02468"></a><span class="lineno"> 2468</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_027: [IoTHubTransport_MQTT_Common_DoWork shall inspect the &quot;waitingToSend&quot; DLIST passed in config structure.] */</span></div>
<div class="line"><a name="l02469"></a><span class="lineno"> 2469</span>&#160;                <span class="keywordflow">while</span> (currentListEntry != transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5280afeeba67d2f6e6d4cde3e1b719bf">waitingToSend</a>)</div>
<div class="line"><a name="l02470"></a><span class="lineno"> 2470</span>&#160;                {</div>
<div class="line"><a name="l02471"></a><span class="lineno"> 2471</span>&#160;                    <a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html">IOTHUB_MESSAGE_LIST</a>* iothubMsgList = <a class="code" href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a>(currentListEntry, <a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html">IOTHUB_MESSAGE_LIST</a>, <a class="code" href="structentry.html">entry</a>);</div>
<div class="line"><a name="l02472"></a><span class="lineno"> 2472</span>&#160;                    <a class="code" href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY</a> savedFromCurrentListEntry;</div>
<div class="line"><a name="l02473"></a><span class="lineno"> 2473</span>&#160;                    savedFromCurrentListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a> = currentListEntry-&gt;<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02474"></a><span class="lineno"> 2474</span>&#160; </div>
<div class="line"><a name="l02475"></a><span class="lineno"> 2475</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_027: [IoTHubTransport_MQTT_Common_DoWork shall inspect the &quot;waitingToSend&quot; DLIST passed in config structure.] */</span></div>
<div class="line"><a name="l02476"></a><span class="lineno"> 2476</span>&#160;                    <span class="keywordtype">size_t</span> messageLength;</div>
<div class="line"><a name="l02477"></a><span class="lineno"> 2477</span>&#160;                    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* messagePayload = RetrieveMessagePayload(iothubMsgList-&gt;<a class="code" href="structIOTHUB__MESSAGE__LIST__TAG.html#a1bbd4c03b7fcff198e14e92d7c36299c">messageHandle</a>, &amp;messageLength);</div>
<div class="line"><a name="l02478"></a><span class="lineno"> 2478</span>&#160;                    <span class="keywordflow">if</span> (messageLength == 0 || messagePayload == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02479"></a><span class="lineno"> 2479</span>&#160;                    {</div>
<div class="line"><a name="l02480"></a><span class="lineno"> 2480</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failure result from IoTHubMessage_GetData&quot;</span>);</div>
<div class="line"><a name="l02481"></a><span class="lineno"> 2481</span>&#160;                    }</div>
<div class="line"><a name="l02482"></a><span class="lineno"> 2482</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02483"></a><span class="lineno"> 2483</span>&#160;                    {</div>
<div class="line"><a name="l02484"></a><span class="lineno"> 2484</span>&#160;                        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_029: [IoTHubTransport_MQTT_Common_DoWork shall create a MQTT_MESSAGE_HANDLE and pass this to a call to mqtt_client_publish.] */</span></div>
<div class="line"><a name="l02485"></a><span class="lineno"> 2485</span>&#160;                        <a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>* mqttMsgEntry = (<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST</a>));</div>
<div class="line"><a name="l02486"></a><span class="lineno"> 2486</span>&#160;                        <span class="keywordflow">if</span> (mqttMsgEntry == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02487"></a><span class="lineno"> 2487</span>&#160;                        {</div>
<div class="line"><a name="l02488"></a><span class="lineno"> 2488</span>&#160;                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Allocation Error: Failure allocating MQTT Message Detail List.&quot;</span>);</div>
<div class="line"><a name="l02489"></a><span class="lineno"> 2489</span>&#160;                        }</div>
<div class="line"><a name="l02490"></a><span class="lineno"> 2490</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02491"></a><span class="lineno"> 2491</span>&#160;                        {</div>
<div class="line"><a name="l02492"></a><span class="lineno"> 2492</span>&#160;                            mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a23a9cb715c409bb3717c1cd639420115">retryCount</a> = 0;</div>
<div class="line"><a name="l02493"></a><span class="lineno"> 2493</span>&#160;                            mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">iotHubMessageEntry</a> = iothubMsgList;</div>
<div class="line"><a name="l02494"></a><span class="lineno"> 2494</span>&#160;                            mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#ace3e7c2cb335867f8656c2aae59ae45d">packet_id</a> = get_next_packet_id(transport_data);</div>
<div class="line"><a name="l02495"></a><span class="lineno"> 2495</span>&#160;                            <span class="keywordflow">if</span> (publish_mqtt_telemetry_msg(transport_data, mqttMsgEntry, messagePayload, messageLength) != 0)</div>
<div class="line"><a name="l02496"></a><span class="lineno"> 2496</span>&#160;                            {</div>
<div class="line"><a name="l02497"></a><span class="lineno"> 2497</span>&#160;                                (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)(<a class="code" href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a>(currentListEntry));</div>
<div class="line"><a name="l02498"></a><span class="lineno"> 2498</span>&#160;                                sendMsgComplete(iothubMsgList, transport_data, IOTHUB_CLIENT_CONFIRMATION_ERROR);</div>
<div class="line"><a name="l02499"></a><span class="lineno"> 2499</span>&#160;                                <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(mqttMsgEntry);</div>
<div class="line"><a name="l02500"></a><span class="lineno"> 2500</span>&#160;                            }</div>
<div class="line"><a name="l02501"></a><span class="lineno"> 2501</span>&#160;                            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02502"></a><span class="lineno"> 2502</span>&#160;                            {</div>
<div class="line"><a name="l02503"></a><span class="lineno"> 2503</span>&#160;                                (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)(<a class="code" href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a>(currentListEntry));</div>
<div class="line"><a name="l02504"></a><span class="lineno"> 2504</span>&#160;                                <a class="code" href="doublylinkedlist_8c.html#aed0982baf1c3937160e7a87d92045f10">DList_InsertTailList</a>(&amp;(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>), &amp;(mqttMsgEntry-&gt;<a class="code" href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a288be39015fc48b7701b36f4d8a6cd5e">entry</a>));</div>
<div class="line"><a name="l02505"></a><span class="lineno"> 2505</span>&#160;                            }</div>
<div class="line"><a name="l02506"></a><span class="lineno"> 2506</span>&#160;                        }</div>
<div class="line"><a name="l02507"></a><span class="lineno"> 2507</span>&#160;                    }</div>
<div class="line"><a name="l02508"></a><span class="lineno"> 2508</span>&#160;                    currentListEntry = savedFromCurrentListEntry.<a class="code" href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">Flink</a>;</div>
<div class="line"><a name="l02509"></a><span class="lineno"> 2509</span>&#160;                }</div>
<div class="line"><a name="l02510"></a><span class="lineno"> 2510</span>&#160;            }</div>
<div class="line"><a name="l02511"></a><span class="lineno"> 2511</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_030: [IoTHubTransport_MQTT_Common_DoWork shall call mqtt_client_dowork everytime it is called if it is connected.] */</span></div>
<div class="line"><a name="l02512"></a><span class="lineno"> 2512</span>&#160;            <a class="code" href="mqtt__client_8c.html#a53d52bdf5a10f069c2157898ea174ca4">mqtt_client_dowork</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>);</div>
<div class="line"><a name="l02513"></a><span class="lineno"> 2513</span>&#160;        }</div>
<div class="line"><a name="l02514"></a><span class="lineno"> 2514</span>&#160;    }</div>
<div class="line"><a name="l02515"></a><span class="lineno"> 2515</span>&#160;}</div>
<div class="line"><a name="l02516"></a><span class="lineno"> 2516</span>&#160; </div>
<div class="line"><a name="l02517"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#add857ad96e28f92aa825fa961769ad37"> 2517</a></span>&#160;IOTHUB_CLIENT_RESULT <a class="code" href="iothubtransport__mqtt__common_8c.html#add857ad96e28f92aa825fa961769ad37">IoTHubTransport_MQTT_Common_GetSendStatus</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> handle, IOTHUB_CLIENT_STATUS *iotHubClientStatus)</div>
<div class="line"><a name="l02518"></a><span class="lineno"> 2518</span>&#160;{</div>
<div class="line"><a name="l02519"></a><span class="lineno"> 2519</span>&#160;    IOTHUB_CLIENT_RESULT result;</div>
<div class="line"><a name="l02520"></a><span class="lineno"> 2520</span>&#160; </div>
<div class="line"><a name="l02521"></a><span class="lineno"> 2521</span>&#160;    <span class="keywordflow">if</span> (handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a> || iotHubClientStatus == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02522"></a><span class="lineno"> 2522</span>&#160;    {</div>
<div class="line"><a name="l02523"></a><span class="lineno"> 2523</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_023: [IoTHubTransport_MQTT_Common_GetSendStatus shall return IOTHUB_CLIENT_INVALID_ARG if called with NULL parameter.] */</span></div>
<div class="line"><a name="l02524"></a><span class="lineno"> 2524</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;invalid arument.&quot;</span>);</div>
<div class="line"><a name="l02525"></a><span class="lineno"> 2525</span>&#160;        result = IOTHUB_CLIENT_INVALID_ARG;</div>
<div class="line"><a name="l02526"></a><span class="lineno"> 2526</span>&#160;    }</div>
<div class="line"><a name="l02527"></a><span class="lineno"> 2527</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02528"></a><span class="lineno"> 2528</span>&#160;    {</div>
<div class="line"><a name="l02529"></a><span class="lineno"> 2529</span>&#160;        <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* handleData = (<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>*)handle;</div>
<div class="line"><a name="l02530"></a><span class="lineno"> 2530</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="doublylinkedlist_8c.html#aaab37bb1e203dc4dc3d259cdea440a92">DList_IsListEmpty</a>(handleData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5280afeeba67d2f6e6d4cde3e1b719bf">waitingToSend</a>) || !<a class="code" href="doublylinkedlist_8c.html#aaab37bb1e203dc4dc3d259cdea440a92">DList_IsListEmpty</a>(&amp;(handleData-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">telemetry_waitingForAck</a>)))</div>
<div class="line"><a name="l02531"></a><span class="lineno"> 2531</span>&#160;        {</div>
<div class="line"><a name="l02532"></a><span class="lineno"> 2532</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_025: [IoTHubTransport_MQTT_Common_GetSendStatus shall return IOTHUB_CLIENT_OK and status IOTHUB_CLIENT_SEND_STATUS_BUSY if there are currently event items to be sent or being sent.] */</span></div>
<div class="line"><a name="l02533"></a><span class="lineno"> 2533</span>&#160;            *iotHubClientStatus = IOTHUB_CLIENT_SEND_STATUS_BUSY;</div>
<div class="line"><a name="l02534"></a><span class="lineno"> 2534</span>&#160;        }</div>
<div class="line"><a name="l02535"></a><span class="lineno"> 2535</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02536"></a><span class="lineno"> 2536</span>&#160;        {</div>
<div class="line"><a name="l02537"></a><span class="lineno"> 2537</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_024: [IoTHubTransport_MQTT_Common_GetSendStatus shall return IOTHUB_CLIENT_OK and status IOTHUB_CLIENT_SEND_STATUS_IDLE if there are currently no event items to be sent or being sent.] */</span></div>
<div class="line"><a name="l02538"></a><span class="lineno"> 2538</span>&#160;            *iotHubClientStatus = IOTHUB_CLIENT_SEND_STATUS_IDLE;</div>
<div class="line"><a name="l02539"></a><span class="lineno"> 2539</span>&#160;        }</div>
<div class="line"><a name="l02540"></a><span class="lineno"> 2540</span>&#160;        result = IOTHUB_CLIENT_OK;</div>
<div class="line"><a name="l02541"></a><span class="lineno"> 2541</span>&#160;    }</div>
<div class="line"><a name="l02542"></a><span class="lineno"> 2542</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02543"></a><span class="lineno"> 2543</span>&#160;}</div>
<div class="line"><a name="l02544"></a><span class="lineno"> 2544</span>&#160; </div>
<div class="line"><a name="l02545"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#adbf04b18827920a1d99a94022a026d29"> 2545</a></span>&#160;IOTHUB_CLIENT_RESULT <a class="code" href="iothubtransport__mqtt__common_8c.html#adbf04b18827920a1d99a94022a026d29">IoTHubTransport_MQTT_Common_SetOption</a>(<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> handle, <span class="keyword">const</span> <span class="keywordtype">char</span>* <a class="code" href="structoption.html">option</a>, <span class="keyword">const</span> <span class="keywordtype">void</span>* <a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>)</div>
<div class="line"><a name="l02546"></a><span class="lineno"> 2546</span>&#160;{</div>
<div class="line"><a name="l02547"></a><span class="lineno"> 2547</span>&#160;    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_021: [If any parameter is NULL then IoTHubTransport_MQTT_Common_SetOption shall return IOTHUB_CLIENT_INVALID_ARG.] */</span></div>
<div class="line"><a name="l02548"></a><span class="lineno"> 2548</span>&#160;    IOTHUB_CLIENT_RESULT result;</div>
<div class="line"><a name="l02549"></a><span class="lineno"> 2549</span>&#160;    <span class="keywordflow">if</span> (</div>
<div class="line"><a name="l02550"></a><span class="lineno"> 2550</span>&#160;        (handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||</div>
<div class="line"><a name="l02551"></a><span class="lineno"> 2551</span>&#160;        (<a class="code" href="structoption.html">option</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) ||</div>
<div class="line"><a name="l02552"></a><span class="lineno"> 2552</span>&#160;        (<a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02553"></a><span class="lineno"> 2553</span>&#160;        )</div>
<div class="line"><a name="l02554"></a><span class="lineno"> 2554</span>&#160;    {</div>
<div class="line"><a name="l02555"></a><span class="lineno"> 2555</span>&#160;        result = IOTHUB_CLIENT_INVALID_ARG;</div>
<div class="line"><a name="l02556"></a><span class="lineno"> 2556</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;invalid parameter (NULL) passed to IoTHubTransport_MQTT_Common_SetOption.&quot;</span>);</div>
<div class="line"><a name="l02557"></a><span class="lineno"> 2557</span>&#160;    }</div>
<div class="line"><a name="l02558"></a><span class="lineno"> 2558</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02559"></a><span class="lineno"> 2559</span>&#160;    {</div>
<div class="line"><a name="l02560"></a><span class="lineno"> 2560</span>&#160;        <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* transport_data = (<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>*)handle;</div>
<div class="line"><a name="l02561"></a><span class="lineno"> 2561</span>&#160; </div>
<div class="line"><a name="l02562"></a><span class="lineno"> 2562</span>&#160;        IOTHUB_CREDENTIAL_TYPE cred_type = <a class="code" href="iothub__client__authorization_8c.html#a6a815c201b2a287aa37600f4ab5acc99">IoTHubClient_Auth_Get_Credential_Type</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>);</div>
<div class="line"><a name="l02563"></a><span class="lineno"> 2563</span>&#160; </div>
<div class="line"><a name="l02564"></a><span class="lineno"> 2564</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_031: [If the option parameter is set to &quot;logtrace&quot; then the value shall be a bool_ptr and the value will determine if the mqtt client log is on or off.] */</span></div>
<div class="line"><a name="l02565"></a><span class="lineno"> 2565</span>&#160;        <span class="keywordflow">if</span> (strcmp(OPTION_LOG_TRACE, <a class="code" href="structoption.html">option</a>) == 0)</div>
<div class="line"><a name="l02566"></a><span class="lineno"> 2566</span>&#160;        {</div>
<div class="line"><a name="l02567"></a><span class="lineno"> 2567</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac8e7327a74d3fcd6ed0bc03755768edf">log_trace</a> = *((<span class="keywordtype">bool</span>*)<a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>);</div>
<div class="line"><a name="l02568"></a><span class="lineno"> 2568</span>&#160;            <a class="code" href="mqtt__client_8c.html#a46bb7da64768d0bae997366dd8d022d6">mqtt_client_set_trace</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac8e7327a74d3fcd6ed0bc03755768edf">log_trace</a>, transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac73b1fb898e61fb0f8170b745aced031">raw_trace</a>);</div>
<div class="line"><a name="l02569"></a><span class="lineno"> 2569</span>&#160;            result = IOTHUB_CLIENT_OK;</div>
<div class="line"><a name="l02570"></a><span class="lineno"> 2570</span>&#160;        }</div>
<div class="line"><a name="l02571"></a><span class="lineno"> 2571</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(<span class="stringliteral">&quot;rawlogtrace&quot;</span>, <a class="code" href="structoption.html">option</a>) == 0)</div>
<div class="line"><a name="l02572"></a><span class="lineno"> 2572</span>&#160;        {</div>
<div class="line"><a name="l02573"></a><span class="lineno"> 2573</span>&#160;            transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac73b1fb898e61fb0f8170b745aced031">raw_trace</a> = *((<span class="keywordtype">bool</span>*)<a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>);</div>
<div class="line"><a name="l02574"></a><span class="lineno"> 2574</span>&#160;            <a class="code" href="mqtt__client_8c.html#a46bb7da64768d0bae997366dd8d022d6">mqtt_client_set_trace</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">mqttClient</a>, transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac8e7327a74d3fcd6ed0bc03755768edf">log_trace</a>, transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac73b1fb898e61fb0f8170b745aced031">raw_trace</a>);</div>
<div class="line"><a name="l02575"></a><span class="lineno"> 2575</span>&#160;            result = IOTHUB_CLIENT_OK;</div>
<div class="line"><a name="l02576"></a><span class="lineno"> 2576</span>&#160;        }</div>
<div class="line"><a name="l02577"></a><span class="lineno"> 2577</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(OPTION_KEEP_ALIVE, <a class="code" href="structoption.html">option</a>) == 0)</div>
<div class="line"><a name="l02578"></a><span class="lineno"> 2578</span>&#160;        {</div>
<div class="line"><a name="l02579"></a><span class="lineno"> 2579</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_036: [If the option parameter is set to &quot;keepalive&quot; then the value shall be a int_ptr and the value will determine the mqtt keepalive time that is set for pings.] */</span></div>
<div class="line"><a name="l02580"></a><span class="lineno"> 2580</span>&#160;            <span class="keywordtype">int</span>* keepAliveOption = (<span class="keywordtype">int</span>*)<a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>;</div>
<div class="line"><a name="l02581"></a><span class="lineno"> 2581</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_037 : [If the option parameter is set to supplied int_ptr keepalive is the same value as the existing keepalive then IoTHubTransport_MQTT_Common_SetOption shall do nothing.] */</span></div>
<div class="line"><a name="l02582"></a><span class="lineno"> 2582</span>&#160;            <span class="keywordflow">if</span> (*keepAliveOption != transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a2c60bfa3b3743b25707510364154779e">keepAliveValue</a>)</div>
<div class="line"><a name="l02583"></a><span class="lineno"> 2583</span>&#160;            {</div>
<div class="line"><a name="l02584"></a><span class="lineno"> 2584</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a2c60bfa3b3743b25707510364154779e">keepAliveValue</a> = (<a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a>)(*keepAliveOption);</div>
<div class="line"><a name="l02585"></a><span class="lineno"> 2585</span>&#160;                <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">mqttClientStatus</a> != <a class="code" href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a>)</div>
<div class="line"><a name="l02586"></a><span class="lineno"> 2586</span>&#160;                {</div>
<div class="line"><a name="l02587"></a><span class="lineno"> 2587</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_038: [If the client is connected when the keepalive is set then IoTHubTransport_MQTT_Common_SetOption shall disconnect and reconnect with the specified keepalive value.] */</span></div>
<div class="line"><a name="l02588"></a><span class="lineno"> 2588</span>&#160;                    DisconnectFromClient(transport_data);</div>
<div class="line"><a name="l02589"></a><span class="lineno"> 2589</span>&#160;                }</div>
<div class="line"><a name="l02590"></a><span class="lineno"> 2590</span>&#160;            }</div>
<div class="line"><a name="l02591"></a><span class="lineno"> 2591</span>&#160;            result = IOTHUB_CLIENT_OK;</div>
<div class="line"><a name="l02592"></a><span class="lineno"> 2592</span>&#160;        }</div>
<div class="line"><a name="l02593"></a><span class="lineno"> 2593</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_039: [If the option parameter is set to &quot;x509certificate&quot; then the value shall be a const char of the certificate to be used for x509.] */</span></div>
<div class="line"><a name="l02594"></a><span class="lineno"> 2594</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((strcmp(OPTION_X509_CERT, <a class="code" href="structoption.html">option</a>) == 0) &amp;&amp; (cred_type != IOTHUB_CREDENTIAL_TYPE_X509 &amp;&amp; cred_type != IOTHUB_CREDENTIAL_TYPE_UNKNOWN))</div>
<div class="line"><a name="l02595"></a><span class="lineno"> 2595</span>&#160;        {</div>
<div class="line"><a name="l02596"></a><span class="lineno"> 2596</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;x509certificate specified, but authentication method is not x509&quot;</span>);</div>
<div class="line"><a name="l02597"></a><span class="lineno"> 2597</span>&#160;            result = IOTHUB_CLIENT_INVALID_ARG;</div>
<div class="line"><a name="l02598"></a><span class="lineno"> 2598</span>&#160;        }</div>
<div class="line"><a name="l02599"></a><span class="lineno"> 2599</span>&#160;        <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_040: [If the option parameter is set to &quot;x509privatekey&quot; then the value shall be a const char of the RSA Private Key to be used for x509.] */</span></div>
<div class="line"><a name="l02600"></a><span class="lineno"> 2600</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((strcmp(OPTION_X509_PRIVATE_KEY, <a class="code" href="structoption.html">option</a>) == 0) &amp;&amp; (cred_type != IOTHUB_CREDENTIAL_TYPE_X509 &amp;&amp; cred_type != IOTHUB_CREDENTIAL_TYPE_UNKNOWN))</div>
<div class="line"><a name="l02601"></a><span class="lineno"> 2601</span>&#160;        {</div>
<div class="line"><a name="l02602"></a><span class="lineno"> 2602</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;x509privatekey specified, but authentication method is not x509&quot;</span>);</div>
<div class="line"><a name="l02603"></a><span class="lineno"> 2603</span>&#160;            result = IOTHUB_CLIENT_INVALID_ARG;</div>
<div class="line"><a name="l02604"></a><span class="lineno"> 2604</span>&#160;        }</div>
<div class="line"><a name="l02605"></a><span class="lineno"> 2605</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (strcmp(OPTION_HTTP_PROXY, <a class="code" href="structoption.html">option</a>) == 0)</div>
<div class="line"><a name="l02606"></a><span class="lineno"> 2606</span>&#160;        {</div>
<div class="line"><a name="l02607"></a><span class="lineno"> 2607</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_001: [ If `option` is `proxy_data`, `value` shall be used as an `HTTP_PROXY_OPTIONS*`. ]*/</span></div>
<div class="line"><a name="l02608"></a><span class="lineno"> 2608</span>&#160;            <a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html">HTTP_PROXY_OPTIONS</a>* proxy_options = (<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html">HTTP_PROXY_OPTIONS</a>*)<a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>;</div>
<div class="line"><a name="l02609"></a><span class="lineno"> 2609</span>&#160; </div>
<div class="line"><a name="l02610"></a><span class="lineno"> 2610</span>&#160;            <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02611"></a><span class="lineno"> 2611</span>&#160;            {</div>
<div class="line"><a name="l02612"></a><span class="lineno"> 2612</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_007: [ If the underlying IO has already been created, then `IoTHubTransport_MQTT_Common_SetOption` shall fail and return `IOTHUB_CLIENT_ERROR`. ]*/</span></div>
<div class="line"><a name="l02613"></a><span class="lineno"> 2613</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Cannot set proxy option once the underlying IO is created&quot;</span>);</div>
<div class="line"><a name="l02614"></a><span class="lineno"> 2614</span>&#160;                result = IOTHUB_CLIENT_ERROR;</div>
<div class="line"><a name="l02615"></a><span class="lineno"> 2615</span>&#160;            }</div>
<div class="line"><a name="l02616"></a><span class="lineno"> 2616</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#a73c53f8a166a8c1e2007e6644a6400af">host_address</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02617"></a><span class="lineno"> 2617</span>&#160;            {</div>
<div class="line"><a name="l02618"></a><span class="lineno"> 2618</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_003: [ If `host_address` is NULL, `IoTHubTransport_MQTT_Common_SetOption` shall fail and return `IOTHUB_CLIENT_INVALID_ARG`. ]*/</span></div>
<div class="line"><a name="l02619"></a><span class="lineno"> 2619</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL host_address in proxy options&quot;</span>);</div>
<div class="line"><a name="l02620"></a><span class="lineno"> 2620</span>&#160;                result = IOTHUB_CLIENT_INVALID_ARG;</div>
<div class="line"><a name="l02621"></a><span class="lineno"> 2621</span>&#160;            }</div>
<div class="line"><a name="l02622"></a><span class="lineno"> 2622</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_006: [ If only one of `username` and `password` is NULL, `IoTHubTransport_MQTT_Common_SetOption` shall fail and return `IOTHUB_CLIENT_INVALID_ARG`. ]*/</span></div>
<div class="line"><a name="l02623"></a><span class="lineno"> 2623</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (((proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#ae6cee5a2da074b448078837f2fedcd05">username</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#aa030f52cf1b0651b09e1489612995e10">password</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)) &amp;&amp;</div>
<div class="line"><a name="l02624"></a><span class="lineno"> 2624</span>&#160;                (proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#ae6cee5a2da074b448078837f2fedcd05">username</a> != proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#aa030f52cf1b0651b09e1489612995e10">password</a>))</div>
<div class="line"><a name="l02625"></a><span class="lineno"> 2625</span>&#160;            {</div>
<div class="line"><a name="l02626"></a><span class="lineno"> 2626</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Only one of username and password for proxy settings was NULL&quot;</span>);</div>
<div class="line"><a name="l02627"></a><span class="lineno"> 2627</span>&#160;                result = IOTHUB_CLIENT_INVALID_ARG;</div>
<div class="line"><a name="l02628"></a><span class="lineno"> 2628</span>&#160;            }</div>
<div class="line"><a name="l02629"></a><span class="lineno"> 2629</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02630"></a><span class="lineno"> 2630</span>&#160;            {</div>
<div class="line"><a name="l02631"></a><span class="lineno"> 2631</span>&#160;                <span class="keywordtype">char</span>* copied_proxy_hostname = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02632"></a><span class="lineno"> 2632</span>&#160;                <span class="keywordtype">char</span>* copied_proxy_username = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02633"></a><span class="lineno"> 2633</span>&#160;                <span class="keywordtype">char</span>* copied_proxy_password = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02634"></a><span class="lineno"> 2634</span>&#160; </div>
<div class="line"><a name="l02635"></a><span class="lineno"> 2635</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_002: [ The fields `host_address`, `port`, `username` and `password` shall be saved for later used (needed when creating the underlying IO to be used by the transport). ]*/</span></div>
<div class="line"><a name="l02636"></a><span class="lineno"> 2636</span>&#160;                transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a483c15ac99b09da35b40ad0c7455f3e0">http_proxy_port</a> = proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#a25110c13d4cfe369dbcaf8ee15f6d687">port</a>;</div>
<div class="line"><a name="l02637"></a><span class="lineno"> 2637</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="crt__abstractions_8c.html#a867b1509b0b0a16b1bae1d829679c484">mallocAndStrcpy_s</a>(&amp;copied_proxy_hostname, proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#a73c53f8a166a8c1e2007e6644a6400af">host_address</a>) != 0)</div>
<div class="line"><a name="l02638"></a><span class="lineno"> 2638</span>&#160;                {</div>
<div class="line"><a name="l02639"></a><span class="lineno"> 2639</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_004: [ If copying `host_address`, `username` or `password` fails, `IoTHubTransport_MQTT_Common_SetOption` shall fail and return `IOTHUB_CLIENT_ERROR`. ]*/</span></div>
<div class="line"><a name="l02640"></a><span class="lineno"> 2640</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Cannot copy HTTP proxy hostname&quot;</span>);</div>
<div class="line"><a name="l02641"></a><span class="lineno"> 2641</span>&#160;                    result = IOTHUB_CLIENT_ERROR;</div>
<div class="line"><a name="l02642"></a><span class="lineno"> 2642</span>&#160;                }</div>
<div class="line"><a name="l02643"></a><span class="lineno"> 2643</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_005: [ `username` and `password` shall be allowed to be NULL. ]*/</span></div>
<div class="line"><a name="l02644"></a><span class="lineno"> 2644</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#ae6cee5a2da074b448078837f2fedcd05">username</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="crt__abstractions_8c.html#a867b1509b0b0a16b1bae1d829679c484">mallocAndStrcpy_s</a>(&amp;copied_proxy_username, proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#ae6cee5a2da074b448078837f2fedcd05">username</a>) != 0))</div>
<div class="line"><a name="l02645"></a><span class="lineno"> 2645</span>&#160;                {</div>
<div class="line"><a name="l02646"></a><span class="lineno"> 2646</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_004: [ If copying `host_address`, `username` or `password` fails, `IoTHubTransport_MQTT_Common_SetOption` shall fail and return `IOTHUB_CLIENT_ERROR`. ]*/</span></div>
<div class="line"><a name="l02647"></a><span class="lineno"> 2647</span>&#160;                    <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(copied_proxy_hostname);</div>
<div class="line"><a name="l02648"></a><span class="lineno"> 2648</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Cannot copy HTTP proxy username&quot;</span>);</div>
<div class="line"><a name="l02649"></a><span class="lineno"> 2649</span>&#160;                    result = IOTHUB_CLIENT_ERROR;</div>
<div class="line"><a name="l02650"></a><span class="lineno"> 2650</span>&#160;                }</div>
<div class="line"><a name="l02651"></a><span class="lineno"> 2651</span>&#160;                <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_005: [ `username` and `password` shall be allowed to be NULL. ]*/</span></div>
<div class="line"><a name="l02652"></a><span class="lineno"> 2652</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#aa030f52cf1b0651b09e1489612995e10">password</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (<a class="code" href="crt__abstractions_8c.html#a867b1509b0b0a16b1bae1d829679c484">mallocAndStrcpy_s</a>(&amp;copied_proxy_password, proxy_options-&gt;<a class="code" href="structHTTP__PROXY__OPTIONS__TAG.html#aa030f52cf1b0651b09e1489612995e10">password</a>) != 0))</div>
<div class="line"><a name="l02653"></a><span class="lineno"> 2653</span>&#160;                {</div>
<div class="line"><a name="l02654"></a><span class="lineno"> 2654</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_004: [ If copying `host_address`, `username` or `password` fails, `IoTHubTransport_MQTT_Common_SetOption` shall fail and return `IOTHUB_CLIENT_ERROR`. ]*/</span></div>
<div class="line"><a name="l02655"></a><span class="lineno"> 2655</span>&#160;                    <span class="keywordflow">if</span> (copied_proxy_username != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02656"></a><span class="lineno"> 2656</span>&#160;                    {</div>
<div class="line"><a name="l02657"></a><span class="lineno"> 2657</span>&#160;                        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(copied_proxy_username);</div>
<div class="line"><a name="l02658"></a><span class="lineno"> 2658</span>&#160;                    }</div>
<div class="line"><a name="l02659"></a><span class="lineno"> 2659</span>&#160;                    <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(copied_proxy_hostname);</div>
<div class="line"><a name="l02660"></a><span class="lineno"> 2660</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Cannot copy HTTP proxy password&quot;</span>);</div>
<div class="line"><a name="l02661"></a><span class="lineno"> 2661</span>&#160;                    result = IOTHUB_CLIENT_ERROR;</div>
<div class="line"><a name="l02662"></a><span class="lineno"> 2662</span>&#160;                }</div>
<div class="line"><a name="l02663"></a><span class="lineno"> 2663</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02664"></a><span class="lineno"> 2664</span>&#160;                {</div>
<div class="line"><a name="l02665"></a><span class="lineno"> 2665</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_009: [ When setting the proxy options succeeds any previously saved proxy options shall be freed. ]*/</span></div>
<div class="line"><a name="l02666"></a><span class="lineno"> 2666</span>&#160;                    free_proxy_data(transport_data);</div>
<div class="line"><a name="l02667"></a><span class="lineno"> 2667</span>&#160; </div>
<div class="line"><a name="l02668"></a><span class="lineno"> 2668</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">http_proxy_hostname</a> = copied_proxy_hostname;</div>
<div class="line"><a name="l02669"></a><span class="lineno"> 2669</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">http_proxy_username</a> = copied_proxy_username;</div>
<div class="line"><a name="l02670"></a><span class="lineno"> 2670</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">http_proxy_password</a> = copied_proxy_password;</div>
<div class="line"><a name="l02671"></a><span class="lineno"> 2671</span>&#160; </div>
<div class="line"><a name="l02672"></a><span class="lineno"> 2672</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_TRANSPORT_MQTT_COMMON_01_008: [ If setting the `proxy_data` option suceeds, `IoTHubTransport_MQTT_Common_SetOption` shall return `IOTHUB_CLIENT_OK` ]*/</span></div>
<div class="line"><a name="l02673"></a><span class="lineno"> 2673</span>&#160;                    result = IOTHUB_CLIENT_OK;</div>
<div class="line"><a name="l02674"></a><span class="lineno"> 2674</span>&#160;                }</div>
<div class="line"><a name="l02675"></a><span class="lineno"> 2675</span>&#160;            }</div>
<div class="line"><a name="l02676"></a><span class="lineno"> 2676</span>&#160;        }</div>
<div class="line"><a name="l02677"></a><span class="lineno"> 2677</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02678"></a><span class="lineno"> 2678</span>&#160;        {</div>
<div class="line"><a name="l02679"></a><span class="lineno"> 2679</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_039: [If the option parameter is set to &quot;x509certificate&quot; then the value shall be a const char of the certificate to be used for x509.] */</span></div>
<div class="line"><a name="l02680"></a><span class="lineno"> 2680</span>&#160;            <span class="keywordflow">if</span> ( ((strcmp(OPTION_X509_CERT, <a class="code" href="structoption.html">option</a>) == 0) || (strcmp(OPTION_X509_PRIVATE_KEY, <a class="code" href="structoption.html">option</a>) == 0)) &amp;&amp; (cred_type != IOTHUB_CREDENTIAL_TYPE_X509) )</div>
<div class="line"><a name="l02681"></a><span class="lineno"> 2681</span>&#160;            {</div>
<div class="line"><a name="l02682"></a><span class="lineno"> 2682</span>&#160;                <a class="code" href="iothub__client__authorization_8c.html#ab152ed6998a4d74434b072c12458dc3f">IoTHubClient_Auth_Set_x509_Type</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l02683"></a><span class="lineno"> 2683</span>&#160;            }</div>
<div class="line"><a name="l02684"></a><span class="lineno"> 2684</span>&#160; </div>
<div class="line"><a name="l02685"></a><span class="lineno"> 2685</span>&#160;            <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_032: [IoTHubTransport_MQTT_Common_SetOption shall pass down the option to xio_setoption if the option parameter is not a known option string for the MQTT transport.] */</span></div>
<div class="line"><a name="l02686"></a><span class="lineno"> 2686</span>&#160;            <span class="keywordflow">if</span> (GetTransportProviderIfNecessary(transport_data) == 0)</div>
<div class="line"><a name="l02687"></a><span class="lineno"> 2687</span>&#160;            {</div>
<div class="line"><a name="l02688"></a><span class="lineno"> 2688</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="xio_8c.html#ab842aa9de72d9359ac059be7428c59d5">xio_setoption</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">xioTransport</a>, <a class="code" href="structoption.html">option</a>, <a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>) == 0)</div>
<div class="line"><a name="l02689"></a><span class="lineno"> 2689</span>&#160;                {</div>
<div class="line"><a name="l02690"></a><span class="lineno"> 2690</span>&#160;                    result = IOTHUB_CLIENT_OK;</div>
<div class="line"><a name="l02691"></a><span class="lineno"> 2691</span>&#160;                }</div>
<div class="line"><a name="l02692"></a><span class="lineno"> 2692</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02693"></a><span class="lineno"> 2693</span>&#160;                {</div>
<div class="line"><a name="l02694"></a><span class="lineno"> 2694</span>&#160;                    <span class="comment">/* Codes_SRS_IOTHUB_MQTT_TRANSPORT_07_132: [IoTHubTransport_MQTT_Common_SetOption shall return IOTHUB_CLIENT_INVALID_ARG xio_setoption fails] */</span></div>
<div class="line"><a name="l02695"></a><span class="lineno"> 2695</span>&#160;                    result = IOTHUB_CLIENT_INVALID_ARG;</div>
<div class="line"><a name="l02696"></a><span class="lineno"> 2696</span>&#160;                }</div>
<div class="line"><a name="l02697"></a><span class="lineno"> 2697</span>&#160;            }</div>
<div class="line"><a name="l02698"></a><span class="lineno"> 2698</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02699"></a><span class="lineno"> 2699</span>&#160;            {</div>
<div class="line"><a name="l02700"></a><span class="lineno"> 2700</span>&#160;                result = IOTHUB_CLIENT_ERROR;</div>
<div class="line"><a name="l02701"></a><span class="lineno"> 2701</span>&#160;            }</div>
<div class="line"><a name="l02702"></a><span class="lineno"> 2702</span>&#160;        }</div>
<div class="line"><a name="l02703"></a><span class="lineno"> 2703</span>&#160;    }</div>
<div class="line"><a name="l02704"></a><span class="lineno"> 2704</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02705"></a><span class="lineno"> 2705</span>&#160;}</div>
<div class="line"><a name="l02706"></a><span class="lineno"> 2706</span>&#160; </div>
<div class="line"><a name="l02707"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a340db2681e4ab55c3994f84a0a580911"> 2707</a></span>&#160;<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> <a class="code" href="iothubtransport__mqtt__common_8c.html#a340db2681e4ab55c3994f84a0a580911">IoTHubTransport_MQTT_Common_Register</a>(<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> handle, <span class="keyword">const</span> <a class="code" href="structIOTHUB__DEVICE__CONFIG__TAG.html">IOTHUB_DEVICE_CONFIG</a>* device, <a class="code" href="structIOTHUB__CLIENT__LL__HANDLE__DATA__TAG.html">IOTHUB_CLIENT_LL_HANDLE</a> iotHubClientHandle, <a class="code" href="structDLIST__ENTRY__TAG.html">PDLIST_ENTRY</a> waitingToSend)</div>
<div class="line"><a name="l02708"></a><span class="lineno"> 2708</span>&#160;{</div>
<div class="line"><a name="l02709"></a><span class="lineno"> 2709</span>&#160;    <a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02710"></a><span class="lineno"> 2710</span>&#160;    (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)iotHubClientHandle;</div>
<div class="line"><a name="l02711"></a><span class="lineno"> 2711</span>&#160; </div>
<div class="line"><a name="l02712"></a><span class="lineno"> 2712</span>&#160;    <span class="comment">// Codes_SRS_IOTHUB_MQTT_TRANSPORT_17_001: [ IoTHubTransport_MQTT_Common_Register shall return NULL if the TRANSPORT_LL_HANDLE is NULL.]</span></div>
<div class="line"><a name="l02713"></a><span class="lineno"> 2713</span>&#160;    <span class="comment">// Codes_SRS_IOTHUB_MQTT_TRANSPORT_17_002: [ IoTHubTransport_MQTT_Common_Register shall return NULL if device or waitingToSend are NULL.]</span></div>
<div class="line"><a name="l02714"></a><span class="lineno"> 2714</span>&#160;    <span class="keywordflow">if</span> ((handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (device == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) || (waitingToSend == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))</div>
<div class="line"><a name="l02715"></a><span class="lineno"> 2715</span>&#160;    {</div>
<div class="line"><a name="l02716"></a><span class="lineno"> 2716</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;IoTHubTransport_MQTT_Common_Register: handle, device or waitingToSend is NULL.&quot;</span>);</div>
<div class="line"><a name="l02717"></a><span class="lineno"> 2717</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02718"></a><span class="lineno"> 2718</span>&#160;    }</div>
<div class="line"><a name="l02719"></a><span class="lineno"> 2719</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02720"></a><span class="lineno"> 2720</span>&#160;    {</div>
<div class="line"><a name="l02721"></a><span class="lineno"> 2721</span>&#160;        <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* transport_data = (<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>*)handle;</div>
<div class="line"><a name="l02722"></a><span class="lineno"> 2722</span>&#160; </div>
<div class="line"><a name="l02723"></a><span class="lineno"> 2723</span>&#160;        <span class="comment">// Codes_SRS_IOTHUB_MQTT_TRANSPORT_03_001: [ IoTHubTransport_MQTT_Common_Register shall return NULL if deviceId, or both deviceKey and deviceSasToken are NULL.]</span></div>
<div class="line"><a name="l02724"></a><span class="lineno"> 2724</span>&#160;        <span class="keywordflow">if</span> (device-&gt;<a class="code" href="structIOTHUB__DEVICE__CONFIG__TAG.html#a86dab4b782bc2e22300e256a126484a2">deviceId</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02725"></a><span class="lineno"> 2725</span>&#160;        {</div>
<div class="line"><a name="l02726"></a><span class="lineno"> 2726</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;IoTHubTransport_MQTT_Common_Register: deviceId is NULL.&quot;</span>);</div>
<div class="line"><a name="l02727"></a><span class="lineno"> 2727</span>&#160;            result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02728"></a><span class="lineno"> 2728</span>&#160;        }</div>
<div class="line"><a name="l02729"></a><span class="lineno"> 2729</span>&#160;        <span class="comment">// Codes_SRS_IOTHUB_MQTT_TRANSPORT_03_002: [ IoTHubTransport_MQTT_Common_Register shall return NULL if both deviceKey and deviceSasToken are provided.]</span></div>
<div class="line"><a name="l02730"></a><span class="lineno"> 2730</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((device-&gt;<a class="code" href="structIOTHUB__DEVICE__CONFIG__TAG.html#a7893f64cc9203bd1a938ae94b5c7d8b4">deviceKey</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) &amp;&amp; (device-&gt;<a class="code" href="structIOTHUB__DEVICE__CONFIG__TAG.html#a87e34933a1a56a42bcf0e77df365bd76">deviceSasToken</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))</div>
<div class="line"><a name="l02731"></a><span class="lineno"> 2731</span>&#160;        {</div>
<div class="line"><a name="l02732"></a><span class="lineno"> 2732</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;IoTHubTransport_MQTT_Common_Register: Both deviceKey and deviceSasToken are defined. Only one can be used.&quot;</span>);</div>
<div class="line"><a name="l02733"></a><span class="lineno"> 2733</span>&#160;            result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02734"></a><span class="lineno"> 2734</span>&#160;        }</div>
<div class="line"><a name="l02735"></a><span class="lineno"> 2735</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02736"></a><span class="lineno"> 2736</span>&#160;        {</div>
<div class="line"><a name="l02737"></a><span class="lineno"> 2737</span>&#160;            <span class="comment">// Codes_SRS_IOTHUB_MQTT_TRANSPORT_17_003: [ IoTHubTransport_MQTT_Common_Register shall return NULL if deviceId or deviceKey do not match the deviceId and deviceKey passed in during IoTHubTransport_MQTT_Common_Create.]</span></div>
<div class="line"><a name="l02738"></a><span class="lineno"> 2738</span>&#160;            <span class="keywordflow">if</span> (strcmp(<a class="code" href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aa5871196da7d7da7b2d2e7f9f4a55731">device_id</a>), device-&gt;<a class="code" href="structIOTHUB__DEVICE__CONFIG__TAG.html#a86dab4b782bc2e22300e256a126484a2">deviceId</a>) != 0)</div>
<div class="line"><a name="l02739"></a><span class="lineno"> 2739</span>&#160;            {</div>
<div class="line"><a name="l02740"></a><span class="lineno"> 2740</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;IoTHubTransport_MQTT_Common_Register: deviceId does not match.&quot;</span>);</div>
<div class="line"><a name="l02741"></a><span class="lineno"> 2741</span>&#160;                result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02742"></a><span class="lineno"> 2742</span>&#160;            }</div>
<div class="line"><a name="l02743"></a><span class="lineno"> 2743</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code" href="iothub__client__authorization_8c.html#a6a815c201b2a287aa37600f4ab5acc99">IoTHubClient_Auth_Get_Credential_Type</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>) == IOTHUB_CREDENTIAL_TYPE_DEVICE_KEY &amp;&amp; </div>
<div class="line"><a name="l02744"></a><span class="lineno"> 2744</span>&#160;                (strcmp(<a class="code" href="iothub__client__authorization_8c.html#a2516a8e0730fe2f737f7d26b680f5256">IoTHubClient_Auth_Get_DeviceKey</a>(transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">authorization_module</a>), device-&gt;<a class="code" href="structIOTHUB__DEVICE__CONFIG__TAG.html#a7893f64cc9203bd1a938ae94b5c7d8b4">deviceKey</a>) != 0))</div>
<div class="line"><a name="l02745"></a><span class="lineno"> 2745</span>&#160;            {</div>
<div class="line"><a name="l02746"></a><span class="lineno"> 2746</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;IoTHubTransport_MQTT_Common_Register: deviceKey does not match.&quot;</span>);</div>
<div class="line"><a name="l02747"></a><span class="lineno"> 2747</span>&#160;                result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02748"></a><span class="lineno"> 2748</span>&#160;            }</div>
<div class="line"><a name="l02749"></a><span class="lineno"> 2749</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l02750"></a><span class="lineno"> 2750</span>&#160;            {</div>
<div class="line"><a name="l02751"></a><span class="lineno"> 2751</span>&#160;                <span class="keywordflow">if</span> (transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7f990671091f2c90d13d7e915633071d">isRegistered</a> == <span class="keyword">true</span>)</div>
<div class="line"><a name="l02752"></a><span class="lineno"> 2752</span>&#160;                {</div>
<div class="line"><a name="l02753"></a><span class="lineno"> 2753</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Transport already has device registered by id: [%s]&quot;</span>, device-&gt;<a class="code" href="structIOTHUB__DEVICE__CONFIG__TAG.html#a86dab4b782bc2e22300e256a126484a2">deviceId</a>);</div>
<div class="line"><a name="l02754"></a><span class="lineno"> 2754</span>&#160;                    result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02755"></a><span class="lineno"> 2755</span>&#160;                }</div>
<div class="line"><a name="l02756"></a><span class="lineno"> 2756</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l02757"></a><span class="lineno"> 2757</span>&#160;                {</div>
<div class="line"><a name="l02758"></a><span class="lineno"> 2758</span>&#160;                    transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7f990671091f2c90d13d7e915633071d">isRegistered</a> = <span class="keyword">true</span>;</div>
<div class="line"><a name="l02759"></a><span class="lineno"> 2759</span>&#160;                    <span class="comment">// Codes_SRS_IOTHUB_MQTT_TRANSPORT_17_004: [ IoTHubTransport_MQTT_Common_Register shall return the TRANSPORT_LL_HANDLE as the IOTHUB_DEVICE_HANDLE. ]</span></div>
<div class="line"><a name="l02760"></a><span class="lineno"> 2760</span>&#160;                    result = (<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a>)handle;</div>
<div class="line"><a name="l02761"></a><span class="lineno"> 2761</span>&#160;                }</div>
<div class="line"><a name="l02762"></a><span class="lineno"> 2762</span>&#160;            }</div>
<div class="line"><a name="l02763"></a><span class="lineno"> 2763</span>&#160;        }</div>
<div class="line"><a name="l02764"></a><span class="lineno"> 2764</span>&#160;    }</div>
<div class="line"><a name="l02765"></a><span class="lineno"> 2765</span>&#160; </div>
<div class="line"><a name="l02766"></a><span class="lineno"> 2766</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02767"></a><span class="lineno"> 2767</span>&#160;}</div>
<div class="line"><a name="l02768"></a><span class="lineno"> 2768</span>&#160; </div>
<div class="line"><a name="l02769"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a5e876bed0b075e30903a560fa1e18449"> 2769</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="iothubtransport__mqtt__common_8c.html#a5e876bed0b075e30903a560fa1e18449">IoTHubTransport_MQTT_Common_Unregister</a>(<a class="code" href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a> deviceHandle)</div>
<div class="line"><a name="l02770"></a><span class="lineno"> 2770</span>&#160;{</div>
<div class="line"><a name="l02771"></a><span class="lineno"> 2771</span>&#160;    <span class="comment">// Codes_SRS_IOTHUB_MQTT_TRANSPORT_17_005: [ If deviceHandle is NULL `IoTHubTransport_MQTT_Common_Unregister` shall do nothing. ]</span></div>
<div class="line"><a name="l02772"></a><span class="lineno"> 2772</span>&#160;    <span class="keywordflow">if</span> (deviceHandle != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02773"></a><span class="lineno"> 2773</span>&#160;    {</div>
<div class="line"><a name="l02774"></a><span class="lineno"> 2774</span>&#160;        <a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>* transport_data = (<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>*)deviceHandle;</div>
<div class="line"><a name="l02775"></a><span class="lineno"> 2775</span>&#160; </div>
<div class="line"><a name="l02776"></a><span class="lineno"> 2776</span>&#160;        transport_data-&gt;<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7f990671091f2c90d13d7e915633071d">isRegistered</a> = <span class="keyword">false</span>;</div>
<div class="line"><a name="l02777"></a><span class="lineno"> 2777</span>&#160;    }</div>
<div class="line"><a name="l02778"></a><span class="lineno"> 2778</span>&#160;}</div>
<div class="line"><a name="l02779"></a><span class="lineno"> 2779</span>&#160; </div>
<div class="line"><a name="l02780"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#ae47738116e8e6c4a0b93b9a64d6f8a37"> 2780</a></span>&#160;<a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> <a class="code" href="iothubtransport__mqtt__common_8c.html#ae47738116e8e6c4a0b93b9a64d6f8a37">IoTHubTransport_MQTT_Common_GetHostname</a>(<a class="code" href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a> handle)</div>
<div class="line"><a name="l02781"></a><span class="lineno"> 2781</span>&#160;{</div>
<div class="line"><a name="l02782"></a><span class="lineno"> 2782</span>&#160;    <a class="code" href="structSTRING__TAG.html">STRING_HANDLE</a> result;</div>
<div class="line"><a name="l02783"></a><span class="lineno"> 2783</span>&#160;    <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_02_001: [ If handle is NULL then IoTHubTransport_MQTT_Common_GetHostname shall fail and return NULL. ]*/</span></div>
<div class="line"><a name="l02784"></a><span class="lineno"> 2784</span>&#160;    <span class="keywordflow">if</span> (handle == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02785"></a><span class="lineno"> 2785</span>&#160;    {</div>
<div class="line"><a name="l02786"></a><span class="lineno"> 2786</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l02787"></a><span class="lineno"> 2787</span>&#160;    }</div>
<div class="line"><a name="l02788"></a><span class="lineno"> 2788</span>&#160;    <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_02_002: [ Otherwise IoTHubTransport_MQTT_Common_GetHostname shall return a non-NULL STRING_HANDLE containg the hostname. ]*/</span></div>
<div class="line"><a name="l02789"></a><span class="lineno"> 2789</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((result = <a class="code" href="strings_8c.html#ac700e7a0a099bc7ac42abba74b9fd874">STRING_clone</a>(((<a class="code" href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA</a>*)(handle))-&gt;hostAddress)) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l02790"></a><span class="lineno"> 2790</span>&#160;    {</div>
<div class="line"><a name="l02791"></a><span class="lineno"> 2791</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Cannot provide the target host name (STRING_clone failed).&quot;</span>);</div>
<div class="line"><a name="l02792"></a><span class="lineno"> 2792</span>&#160;    }</div>
<div class="line"><a name="l02793"></a><span class="lineno"> 2793</span>&#160; </div>
<div class="line"><a name="l02794"></a><span class="lineno"> 2794</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02795"></a><span class="lineno"> 2795</span>&#160;}</div>
<div class="line"><a name="l02796"></a><span class="lineno"> 2796</span>&#160; </div>
<div class="line"><a name="l02797"></a><span class="lineno"><a class="line" href="iothubtransport__mqtt__common_8c.html#a22f0af96e6836836e4c087ddd7972342"> 2797</a></span>&#160;IOTHUB_CLIENT_RESULT <a class="code" href="iothubtransport__mqtt__common_8c.html#a22f0af96e6836836e4c087ddd7972342">IoTHubTransport_MQTT_Common_SendMessageDisposition</a>(<a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html">MESSAGE_CALLBACK_INFO</a>* message_data, IOTHUBMESSAGE_DISPOSITION_RESULT disposition)</div>
<div class="line"><a name="l02798"></a><span class="lineno"> 2798</span>&#160;{</div>
<div class="line"><a name="l02799"></a><span class="lineno"> 2799</span>&#160;    (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)disposition;</div>
<div class="line"><a name="l02800"></a><span class="lineno"> 2800</span>&#160; </div>
<div class="line"><a name="l02801"></a><span class="lineno"> 2801</span>&#160;    IOTHUB_CLIENT_RESULT result;</div>
<div class="line"><a name="l02802"></a><span class="lineno"> 2802</span>&#160;    <span class="keywordflow">if</span> (message_data)</div>
<div class="line"><a name="l02803"></a><span class="lineno"> 2803</span>&#160;    {</div>
<div class="line"><a name="l02804"></a><span class="lineno"> 2804</span>&#160;        <span class="keywordflow">if</span> (message_data-&gt;<a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html#a236b601a4e8c04102c63c85317fde8de">messageHandle</a>)</div>
<div class="line"><a name="l02805"></a><span class="lineno"> 2805</span>&#160;        {</div>
<div class="line"><a name="l02806"></a><span class="lineno"> 2806</span>&#160;            <a class="code" href="iothub__message_8c.html#a8303de9790f32c3b0aebac6cfb0e80bf">IoTHubMessage_Destroy</a>(message_data-&gt;<a class="code" href="structMESSAGE__CALLBACK__INFO__TAG.html#a236b601a4e8c04102c63c85317fde8de">messageHandle</a>);</div>
<div class="line"><a name="l02807"></a><span class="lineno"> 2807</span>&#160;            result = IOTHUB_CLIENT_OK;</div>
<div class="line"><a name="l02808"></a><span class="lineno"> 2808</span>&#160;        }</div>
<div class="line"><a name="l02809"></a><span class="lineno"> 2809</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l02810"></a><span class="lineno"> 2810</span>&#160;        {</div>
<div class="line"><a name="l02811"></a><span class="lineno"> 2811</span>&#160;            <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_10_002: [If any of the messageData fields are NULL, IoTHubTransport_MQTT_Common_SendMessageDisposition shall fail and return IOTHUB_CLIENT_ERROR. ]*/</span></div>
<div class="line"><a name="l02812"></a><span class="lineno"> 2812</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;message handle is NULL&quot;</span>);</div>
<div class="line"><a name="l02813"></a><span class="lineno"> 2813</span>&#160;            result = IOTHUB_CLIENT_ERROR;</div>
<div class="line"><a name="l02814"></a><span class="lineno"> 2814</span>&#160;        }</div>
<div class="line"><a name="l02815"></a><span class="lineno"> 2815</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(message_data);</div>
<div class="line"><a name="l02816"></a><span class="lineno"> 2816</span>&#160;    }</div>
<div class="line"><a name="l02817"></a><span class="lineno"> 2817</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l02818"></a><span class="lineno"> 2818</span>&#160;    {</div>
<div class="line"><a name="l02819"></a><span class="lineno"> 2819</span>&#160;        <span class="comment">/*Codes_SRS_IOTHUB_MQTT_TRANSPORT_10_001: [If messageData is NULL, IoTHubTransport_MQTT_Common_SendMessageDisposition shall fail and return IOTHUB_CLIENT_ERROR. ]*/</span></div>
<div class="line"><a name="l02820"></a><span class="lineno"> 2820</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;message_data is NULL&quot;</span>);</div>
<div class="line"><a name="l02821"></a><span class="lineno"> 2821</span>&#160;        result = IOTHUB_CLIENT_ERROR;</div>
<div class="line"><a name="l02822"></a><span class="lineno"> 2822</span>&#160;    }</div>
<div class="line"><a name="l02823"></a><span class="lineno"> 2823</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l02824"></a><span class="lineno"> 2824</span>&#160;}</div>
<div class="line"><a name="l02825"></a><span class="lineno"> 2825</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="astructMQTT__MESSAGE__DETAILS__LIST__TAG_html_a78af22162c3a552f3551875a7e0b14e2"><div class="ttname"><a href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a78af22162c3a552f3551875a7e0b14e2">MQTT_MESSAGE_DETAILS_LIST_TAG::context</a></div><div class="ttdeci">void * context</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00224">iothubtransport_mqtt_common.c:224</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a5f8ccaa27622eb4a983c1dfd3211922d"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a5f8ccaa27622eb4a983c1dfd3211922d">MQTTTRANSPORT_HANDLE_DATA</a></div><div class="ttdeci">struct MQTTTRANSPORT_HANDLE_DATA_TAG MQTTTRANSPORT_HANDLE_DATA</div></div>
<div class="ttc" id="aiothub__client__ll_8c_html_ae55eb9c9f31aa54050260249b39ace50"><div class="ttname"><a href="iothub__client__ll_8c.html#ae55eb9c9f31aa54050260249b39ace50">IoTHubClient_LL_DeviceMethodComplete</a></div><div class="ttdeci">int IoTHubClient_LL_DeviceMethodComplete(IOTHUB_CLIENT_LL_HANDLE handle, const char *method_name, const unsigned char *payLoad, size_t size, METHOD_HANDLE response_id)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l01356">iothub_client_ll.c:1356</a></div></div>
<div class="ttc" id="aiothub__client__version_8h_html_ae0748bd999de84277b606395be2fae5f"><div class="ttname"><a href="iothub__client__version_8h.html#ae0748bd999de84277b606395be2fae5f">IOTHUB_SDK_VERSION</a></div><div class="ttdeci">#define IOTHUB_SDK_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__version_8h_source.html#l00012">iothub_client_version.h:11</a></div></div>
<div class="ttc" id="aFatStructs_8h_html_a1d127017fb298b889f4ba24752d08b8e"><div class="ttname"><a href="FatStructs_8h.html#a1d127017fb298b889f4ba24752d08b8e">type</a></div><div class="ttdeci">uint8_t type</div><div class="ttdef"><b>Definition:</b> <a href="FatStructs_8h_source.html#l00027">FatStructs.h:27</a></div></div>
<div class="ttc" id="amqtt__message_8c_html_a9041854bcbe0282279b3b6a3d026e410"><div class="ttname"><a href="mqtt__message_8c.html#a9041854bcbe0282279b3b6a3d026e410">mqttmessage_create</a></div><div class="ttdeci">MQTT_MESSAGE_HANDLE mqttmessage_create(uint16_t packetId, const char *topicName, QOS_VALUE qosValue, const uint8_t *appMsg, size_t appMsgLength)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__message_8c_source.html#l00064">mqtt_message.c:64</a></div></div>
<div class="ttc" id="amacro__utils_8h_html_aa8c798c7579b5c5a23a87b213f9accd6"><div class="ttname"><a href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a></div><div class="ttdeci">#define __FAILURE__</div><div class="ttdef"><b>Definition:</b> <a href="macro__utils_8h_source.html#l00019">macro_utils.h:18</a></div></div>
<div class="ttc" id="acomponents_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h_html_ab164a927aa4332e08b3698398beb3861"><div class="ttname"><a href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab164a927aa4332e08b3698398beb3861">STRING_sprintf</a></div><div class="ttdeci">int STRING_sprintf(STRING_HANDLE s1, const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00516">strings.c:516</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_af99d7773335eed48365d6e54abae3ebf"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af99d7773335eed48365d6e54abae3ebf">MQTTTRANSPORT_HANDLE_DATA_TAG::packetId</a></div><div class="ttdeci">uint16_t packetId</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00166">iothubtransport_mqtt_common.c:166</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ac739d30e56141ad8a0164273a7629468"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac739d30e56141ad8a0164273a7629468">MQTTTRANSPORT_HANDLE_DATA_TAG::topics_ToSubscribe</a></div><div class="ttdeci">uint32_t topics_ToSubscribe</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00140">iothubtransport_mqtt_common.c:140</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_aa582051eca99872a0ade9b49d7f9cd77"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#aa582051eca99872a0ade9b49d7f9cd77">IoTHubTransport_MQTT_Common_DeviceMethod_Response</a></div><div class="ttdeci">int IoTHubTransport_MQTT_Common_DeviceMethod_Response(IOTHUB_DEVICE_HANDLE handle, METHOD_HANDLE methodId, const unsigned char *response, size_t respSize, int status)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02212">iothubtransport_mqtt_common.c:2212</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html_a4860a4e13fbd8523c016d5db92ba8d76"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html#a4860a4e13fbd8523c016d5db92ba8d76">MQTT_CLIENT_OPTIONS_TAG::clientId</a></div><div class="ttdeci">char * clientId</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00054">mqttconst.h:54</a></div></div>
<div class="ttc" id="adoublylinkedlist_8h_html"><div class="ttname"><a href="doublylinkedlist_8h.html">doublylinkedlist.h</a></div></div>
<div class="ttc" id="amqtt__message_8c_html_aa989373213799bd06af9a9c464330b43"><div class="ttname"><a href="mqtt__message_8c.html#aa989373213799bd06af9a9c464330b43">mqttmessage_destroy</a></div><div class="ttdeci">void mqttmessage_destroy(MQTT_MESSAGE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__message_8c_source.html#l00121">mqtt_message.c:121</a></div></div>
<div class="ttc" id="aiothub__client__ll_8c_html_a10f7edc7fabd44c9c6b4b6f4fdf3ddb7"><div class="ttname"><a href="iothub__client__ll_8c.html#a10f7edc7fabd44c9c6b4b6f4fdf3ddb7">IoTHubClient_LL_RetrievePropertyComplete</a></div><div class="ttdeci">void IoTHubClient_LL_RetrievePropertyComplete(IOTHUB_CLIENT_LL_HANDLE handle, DEVICE_TWIN_UPDATE_STATE update_state, const unsigned char *payLoad, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l01403">iothub_client_ll.c:1403</a></div></div>
<div class="ttc" id="aiothub__client__ll_8c_html_a4bc23c750582e44563a76c3eb6409bd6"><div class="ttname"><a href="iothub__client__ll_8c.html#a4bc23c750582e44563a76c3eb6409bd6">IoTHubClient_LL_GetOption</a></div><div class="ttdeci">IOTHUB_CLIENT_RESULT IoTHubClient_LL_GetOption(IOTHUB_CLIENT_LL_HANDLE iotHubClientHandle, const char *optionName, void **value)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l01748">iothub_client_ll.c:1748</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__TAG_html"><div class="ttname"><a href="structMQTT__CLIENT__TAG.html">MQTT_CLIENT_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l00035">mqtt_client.c:36</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a3257671a34610dc91baf5c1bedd2c468"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a3257671a34610dc91baf5c1bedd2c468">IoTHubTransport_MQTT_Common_DoWork</a></div><div class="ttdeci">void IoTHubTransport_MQTT_Common_DoWork(TRANSPORT_LL_HANDLE handle, IOTHUB_CLIENT_LL_HANDLE iotHubClientHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02372">iothubtransport_mqtt_common.c:2372</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a54ad79d09d70f8012aa882fde9867efa"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a54ad79d09d70f8012aa882fde9867efa">MQTTTRANSPORT_HANDLE_DATA_TAG::device_twin_get_sent</a></div><div class="ttdeci">bool device_twin_get_sent</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00172">iothubtransport_mqtt_common.c:172</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_aeec3610b18121a94e5e5b1d51f34fdff"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aeec3610b18121a94e5e5b1d51f34fdff">MQTTTRANSPORT_HANDLE_DATA_TAG::hostAddress</a></div><div class="ttdeci">STRING_HANDLE hostAddress</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00143">iothubtransport_mqtt_common.c:143</a></div></div>
<div class="ttc" id="astring__tokenizer_8c_html_a8b17e6bd6ded2b367bd6d7f6afe2b748"><div class="ttname"><a href="string__tokenizer_8c.html#a8b17e6bd6ded2b367bd6d7f6afe2b748">STRING_TOKENIZER_create</a></div><div class="ttdeci">STRING_TOKENIZER_HANDLE STRING_TOKENIZER_create(STRING_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="string__tokenizer_8c_source.html#l00019">string_tokenizer.c:19</a></div></div>
<div class="ttc" id="astdint_8h_html_a281b4b5562236420969a830503b0ba19"><div class="ttname"><a href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a></div><div class="ttdeci">__uint16_t uint16_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00033">stdint.h:33</a></div></div>
<div class="ttc" id="astructMQTT__MESSAGE__DETAILS__LIST__TAG_html_a288be39015fc48b7701b36f4d8a6cd5e"><div class="ttname"><a href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a288be39015fc48b7701b36f4d8a6cd5e">MQTT_MESSAGE_DETAILS_LIST_TAG::entry</a></div><div class="ttdeci">DLIST_ENTRY entry</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00226">iothubtransport_mqtt_common.c:226</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a5bbe060d4a011e5a5c9030bd4e27c68a"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5bbe060d4a011e5a5c9030bd4e27c68a">MQTTTRANSPORT_HANDLE_DATA_TAG::ack_waiting_queue</a></div><div class="ttdeci">DLIST_ENTRY ack_waiting_queue</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00185">iothubtransport_mqtt_common.c:185</a></div></div>
<div class="ttc" id="atickcounter_8c_html_a3e8011efd045ca7d0dcd23759578e5af"><div class="ttname"><a href="tickcounter_8c.html#a3e8011efd045ca7d0dcd23759578e5af">tickcounter_destroy</a></div><div class="ttdeci">void tickcounter_destroy(TICK_COUNTER_HANDLE tick_counter)</div><div class="ttdef"><b>Definition:</b> <a href="tickcounter_8c_source.html#l00043">tickcounter.c:43</a></div></div>
<div class="ttc" id="astructSYSTEM__PROPERTY__INFO__TAG_html_a61b91aed5569709c123da0fe55f6d3f7"><div class="ttname"><a href="structSYSTEM__PROPERTY__INFO__TAG.html#a61b91aed5569709c123da0fe55f6d3f7">SYSTEM_PROPERTY_INFO_TAG::propName</a></div><div class="ttdeci">const char * propName</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00092">iothubtransport_mqtt_common.c:92</a></div></div>
<div class="ttc" id="aiothub__client__retry__control_8c_html_a86f226b0df2fbc56406863a5c32abfaa"><div class="ttname"><a href="iothub__client__retry__control_8c.html#a86f226b0df2fbc56406863a5c32abfaa">retry_control_destroy</a></div><div class="ttdeci">void retry_control_destroy(RETRY_CONTROL_HANDLE retry_control_handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__retry__control_8c_source.html#l00347">iothub_client_retry_control.c:347</a></div></div>
<div class="ttc" id="aiothub__client__retry__control_8c_html_a73839a9f296482e97add2a7477e41af8"><div class="ttname"><a href="iothub__client__retry__control_8c.html#a73839a9f296482e97add2a7477e41af8">retry_control_should_retry</a></div><div class="ttdeci">int retry_control_should_retry(RETRY_CONTROL_HANDLE retry_control_handle, RETRY_ACTION *retry_action)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__retry__control_8c_source.html#l00361">iothub_client_retry_control.c:361</a></div></div>
<div class="ttc" id="ainttypes_8h_html_a86bc00ee87e8e40787e0681fc34c576a"><div class="ttname"><a href="inttypes_8h.html#a86bc00ee87e8e40787e0681fc34c576a">PRIu16</a></div><div class="ttdeci">#define PRIu16</div><div class="ttdef"><b>Definition:</b> <a href="inttypes_8h_source.html#l00106">inttypes.h:105</a></div></div>
<div class="ttc" id="astructSUBSCRIBE__ACK__TAG_html"><div class="ttname"><a href="structSUBSCRIBE__ACK__TAG.html">SUBSCRIBE_ACK_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00089">mqttconst.h:90</a></div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_a57376049aa40b9b7ff926302082a300d"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a57376049aa40b9b7ff926302082a300d">MQTT_DEVICE_TWIN_ITEM_TAG::entry</a></div><div class="ttdeci">DLIST_ENTRY entry</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00216">iothubtransport_mqtt_common.c:216</a></div></div>
<div class="ttc" id="astructHTTP__PROXY__OPTIONS__TAG_html_aa030f52cf1b0651b09e1489612995e10"><div class="ttname"><a href="structHTTP__PROXY__OPTIONS__TAG.html#aa030f52cf1b0651b09e1489612995e10">HTTP_PROXY_OPTIONS_TAG::password</a></div><div class="ttdeci">const char * password</div><div class="ttdef"><b>Definition:</b> <a href="shared__util__options_8h_source.html#l00017">shared_util_options.h:17</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ada6a6cc45ec43037deb14044b314c717"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ada6a6cc45ec43037deb14044b314c717">MQTTTRANSPORT_HANDLE_DATA_TAG::isRecoverableError</a></div><div class="ttdeci">bool isRecoverableError</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00173">iothubtransport_mqtt_common.c:173</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ac8e7327a74d3fcd6ed0bc03755768edf"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac8e7327a74d3fcd6ed0bc03755768edf">MQTTTRANSPORT_HANDLE_DATA_TAG::log_trace</a></div><div class="ttdeci">bool log_trace</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00178">iothubtransport_mqtt_common.c:178</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_abd1c044606f8c70df4f1af9b19a7a85f"><div class="ttname"><a href="iothub__message_8c.html#abd1c044606f8c70df4f1af9b19a7a85f">IoTHubMessage_SetContentEncodingSystemProperty</a></div><div class="ttdeci">IOTHUB_MESSAGE_RESULT IoTHubMessage_SetContentEncodingSystemProperty(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle, const char *contentEncoding)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00618">iothub_message.c:618</a></div></div>
<div class="ttc" id="astructMQTT__TRANSPORT__PROXY__OPTIONS__TAG_html_a4542072c0f0e2435719c9cf97c73d666"><div class="ttname"><a href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a4542072c0f0e2435719c9cf97c73d666">MQTT_TRANSPORT_PROXY_OPTIONS_TAG::host_address</a></div><div class="ttdeci">const char * host_address</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8h_source.html#l00017">iothubtransport_mqtt_common.h:17</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_a8303de9790f32c3b0aebac6cfb0e80bf"><div class="ttname"><a href="iothub__message_8c.html#a8303de9790f32c3b0aebac6cfb0e80bf">IoTHubMessage_Destroy</a></div><div class="ttdeci">void IoTHubMessage_Destroy(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00676">iothub_message.c:676</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ae463d24be606b809c652d543d1c11b58"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58">MQTT_CLIENT_STATUS_TAG</a></div><div class="ttdeci">MQTT_CLIENT_STATUS_TAG</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00123">iothubtransport_mqtt_common.c:124</a></div></div>
<div class="ttc" id="astructSTRING__TAG_html"><div class="ttname"><a href="structSTRING__TAG.html">STRING_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00024">strings.c:25</a></div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_a53f4c3d2df8deb260a5aad5bf5a44333"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a53f4c3d2df8deb260a5aad5bf5a44333">MQTT_DEVICE_TWIN_ITEM_TAG::retryCount</a></div><div class="ttdeci">size_t retryCount</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00210">iothubtransport_mqtt_common.c:210</a></div></div>
<div class="ttc" id="atickcounter_8h_html"><div class="ttname"><a href="tickcounter_8h.html">tickcounter.h</a></div></div>
<div class="ttc" id="astructMQTT__MESSAGE__TAG_html"><div class="ttname"><a href="structMQTT__MESSAGE__TAG.html">MQTT_MESSAGE_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqtt__message_8c_source.html#l00010">mqtt_message.c:11</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a0edd40b1f2abb4aa27d8aa561ae52784"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a0edd40b1f2abb4aa27d8aa561ae52784">DEFAULT_RETRY_POLICY</a></div><div class="ttdeci">#define DEFAULT_RETRY_POLICY</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00052">iothubtransport_mqtt_common.c:51</a></div></div>
<div class="ttc" id="aiothub__client__authorization_8c_html_a3d8b5e7a2fff306e82f668507ec1d0e7"><div class="ttname"><a href="iothub__client__authorization_8c.html#a3d8b5e7a2fff306e82f668507ec1d0e7">IoTHubClient_Auth_Get_SasToken</a></div><div class="ttdeci">char * IoTHubClient_Auth_Get_SasToken(IOTHUB_AUTHORIZATION_HANDLE handle, const char *scope, size_t expire_time)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__authorization_8c_source.html#l00293">iothub_client_authorization.c:293</a></div></div>
<div class="ttc" id="adoublylinkedlist_8c_html_aed0982baf1c3937160e7a87d92045f10"><div class="ttname"><a href="doublylinkedlist_8c.html#aed0982baf1c3937160e7a87d92045f10">DList_InsertTailList</a></div><div class="ttdeci">void DList_InsertTailList(PDLIST_ENTRY ListHead, PDLIST_ENTRY Entry)</div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8c_source.html#l00066">doublylinkedlist.c:66</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a211cf7c0c537341fc5a30b8cbba87b50"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a211cf7c0c537341fc5a30b8cbba87b50">MQTTTRANSPORT_HANDLE_DATA_TAG::retry_control_handle</a></div><div class="ttdeci">RETRY_CONTROL_HANDLE retry_control_handle</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00194">iothubtransport_mqtt_common.c:194</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html_a19caf9c9a7d11570db75b9ef25cc650e"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html#a19caf9c9a7d11570db75b9ef25cc650e">MQTT_CLIENT_OPTIONS_TAG::keepAliveInterval</a></div><div class="ttdeci">uint16_t keepAliveInterval</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00059">mqttconst.h:59</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_adbf04b18827920a1d99a94022a026d29"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#adbf04b18827920a1d99a94022a026d29">IoTHubTransport_MQTT_Common_SetOption</a></div><div class="ttdeci">IOTHUB_CLIENT_RESULT IoTHubTransport_MQTT_Common_SetOption(TRANSPORT_LL_HANDLE handle, const char *option, const void *value)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02545">iothubtransport_mqtt_common.c:2545</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__LL__HANDLE__DATA__TAG_html"><div class="ttname"><a href="structIOTHUB__CLIENT__LL__HANDLE__DATA__TAG.html">IOTHUB_CLIENT_LL_HANDLE_DATA_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l00061">iothub_client_ll.c:62</a></div></div>
<div class="ttc" id="astructRETRY__CONTROL__INSTANCE__TAG_html"><div class="ttname"><a href="structRETRY__CONTROL__INSTANCE__TAG.html">RETRY_CONTROL_INSTANCE_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__retry__control_8c_source.html#l00016">iothub_client_retry_control.c:17</a></div></div>
<div class="ttc" id="atlsio_8h_html"><div class="ttname"><a href="tlsio_8h.html">tlsio.h</a></div></div>
<div class="ttc" id="astructIOTHUB__DEVICE__CONFIG__TAG_html"><div class="ttname"><a href="structIOTHUB__DEVICE__CONFIG__TAG.html">IOTHUB_DEVICE_CONFIG_TAG</a></div><div class="ttdoc">This struct captures device configuration.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00040">iothub_transport_ll.h:41</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html_ae54e74d8db92b20f796df76f01d5dd68"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html#ae54e74d8db92b20f796df76f01d5dd68">IOTHUB_CLIENT_CONFIG_TAG::iotHubSuffix</a></div><div class="ttdeci">const char * iotHubSuffix</div><div class="ttdoc">IoT Hub suffix goes here, e.g., private.azure-devices-int.net.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00199">iothub_client_ll.h:199</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a9745ba1489250c08d8ce845ed0392351"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a9745ba1489250c08d8ce845ed0392351">PMQTTTRANSPORT_HANDLE_DATA</a></div><div class="ttdeci">struct MQTTTRANSPORT_HANDLE_DATA_TAG * PMQTTTRANSPORT_HANDLE_DATA</div></div>
<div class="ttc" id="aoptimize__size_8h_html"><div class="ttname"><a href="optimize__size_8h.html">optimize_size.h</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ae463d24be606b809c652d543d1c11b58a95e7f89d68ab2d1d56387289eb73728c"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a95e7f89d68ab2d1d56387289eb73728c">MQTT_CLIENT_STATUS_CONNECTED</a></div><div class="ttdeci">@ MQTT_CLIENT_STATUS_CONNECTED</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00128">iothubtransport_mqtt_common.c:127</a></div></div>
<div class="ttc" id="astructPUBLISH__ACK__TAG_html_a1f87faad5366100ab6fc4cf88c6acf6f"><div class="ttname"><a href="structPUBLISH__ACK__TAG.html#a1f87faad5366100ab6fc4cf88c6acf6f">PUBLISH_ACK_TAG::packetId</a></div><div class="ttdeci">uint16_t packetId</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00103">mqttconst.h:103</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a3e3220028f64f2ec0c9a16cbb3ac6fc2"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a3e3220028f64f2ec0c9a16cbb3ac6fc2">MQTTTRANSPORT_HANDLE_DATA_TAG::topic_NotifyState</a></div><div class="ttdeci">STRING_HANDLE topic_NotifyState</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00136">iothubtransport_mqtt_common.c:136</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ad8e0b56ae4df837d385cd2eda7c90d84"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad8e0b56ae4df837d385cd2eda7c90d84">MQTTTRANSPORT_HANDLE_DATA_TAG::msgTickCounter</a></div><div class="ttdeci">TICK_COUNTER_HANDLE msgTickCounter</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00180">iothubtransport_mqtt_common.c:180</a></div></div>
<div class="ttc" id="astructDEVICE__METHOD__INFO__TAG_html"><div class="ttname"><a href="structDEVICE__METHOD__INFO__TAG.html">DEVICE_METHOD_INFO_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00229">iothubtransport_mqtt_common.c:230</a></div></div>
<div class="ttc" id="amqtt__message_8c_html_a816f9f513ee65874dbf842a656180619"><div class="ttname"><a href="mqtt__message_8c.html#a816f9f513ee65874dbf842a656180619">mqttmessage_getApplicationMsg</a></div><div class="ttdeci">const APP_PAYLOAD * mqttmessage_getApplicationMsg(MQTT_MESSAGE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__message_8c_source.html#l00298">mqtt_message.c:298</a></div></div>
<div class="ttc" id="acrt__abstractions_8c_html_a867b1509b0b0a16b1bae1d829679c484"><div class="ttname"><a href="crt__abstractions_8c.html#a867b1509b0b0a16b1bae1d829679c484">mallocAndStrcpy_s</a></div><div class="ttdeci">int mallocAndStrcpy_s(char **destination, const char *source)</div><div class="ttdef"><b>Definition:</b> <a href="crt__abstractions_8c_source.html#l00681">crt_abstractions.c:681</a></div></div>
<div class="ttc" id="astructAPP__PAYLOAD__TAG_html"><div class="ttname"><a href="structAPP__PAYLOAD__TAG.html">APP_PAYLOAD_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00046">mqttconst.h:47</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html_aa7753cf96255b57c65c56d8fedd3d7ca"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html#aa7753cf96255b57c65c56d8fedd3d7ca">IOTHUB_CLIENT_CONFIG_TAG::protocol</a></div><div class="ttdeci">IOTHUB_CLIENT_TRANSPORT_PROVIDER protocol</div><div class="ttdoc">A function pointer that is passed into the IoTHubClientCreate. A function definition for AMQP is defi...</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00182">iothub_client_ll.h:182</a></div></div>
<div class="ttc" id="astructIOTHUB__DEVICE__TWIN__TAG_html_afb50cd42a753722a68a102552376b0e1"><div class="ttname"><a href="structIOTHUB__DEVICE__TWIN__TAG.html#afb50cd42a753722a68a102552376b0e1">IOTHUB_DEVICE_TWIN_TAG::report_data_handle</a></div><div class="ttdeci">CONSTBUFFER_HANDLE report_data_handle</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00061">iothub_client_private.h:61</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_a2ab46db5ad9db0b497b5171e21b64ea2"><div class="ttname"><a href="iothub__message_8c.html#a2ab46db5ad9db0b497b5171e21b64ea2">IoTHubMessage_Properties</a></div><div class="ttdeci">MAP_HANDLE IoTHubMessage_Properties(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00441">iothub_message.c:441</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_afd1e574a64f8b032be6a5ad196278c1e"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#afd1e574a64f8b032be6a5ad196278c1e">MAX_SEND_RECOUNT_LIMIT</a></div><div class="ttdeci">#define MAX_SEND_RECOUNT_LIMIT</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00046">iothubtransport_mqtt_common.c:45</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ad3bb71acb8df8e88bf30e5fa3dc0ea42"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad3bb71acb8df8e88bf30e5fa3dc0ea42">MQTTTRANSPORT_HANDLE_DATA_TAG::configPassedThroughUsername</a></div><div class="ttdeci">STRING_HANDLE configPassedThroughUsername</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00156">iothubtransport_mqtt_common.c:156</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a07488a0c591bfe49d015b8ed68303053afd629b7eabf994cb88b008a887ec2533"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053afd629b7eabf994cb88b008a887ec2533">RETRIEVE_PROPERTIES</a></div><div class="ttdeci">@ RETRIEVE_PROPERTIES</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00113">iothubtransport_mqtt_common.c:112</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_ae7fd8e5a5844a4346933a86feb577d3c"><div class="ttname"><a href="iothub__message_8c.html#ae7fd8e5a5844a4346933a86feb577d3c">IoTHubMessage_GetContentType</a></div><div class="ttdeci">IOTHUBMESSAGE_CONTENT_TYPE IoTHubMessage_GetContentType(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00424">iothub_message.c:424</a></div></div>
<div class="ttc" id="aiothub__client__ll_8c_html_abe2bd68f404baeadc5e0d2a4e23bfa5b"><div class="ttname"><a href="iothub__client__ll_8c.html#abe2bd68f404baeadc5e0d2a4e23bfa5b">IoTHubClient_LL_SendComplete</a></div><div class="ttdeci">void IoTHubClient_LL_SendComplete(IOTHUB_CLIENT_LL_HANDLE handle, PDLIST_ENTRY completed, IOTHUB_CLIENT_CONFIRMATION_RESULT result)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l01326">iothub_client_ll.c:1326</a></div></div>
<div class="ttc" id="anamespacegen__esp32part_html_a614575e8b56274b0a0bafca473224e5e"><div class="ttname"><a href="namespacegen__esp32part.html#a614575e8b56274b0a0bafca473224e5e">gen_esp32part.status</a></div><div class="ttdeci">def status(msg)</div><div class="ttdef"><b>Definition:</b> <a href="gen__esp32part_8py_source.html#l00076">gen_esp32part.py:76</a></div></div>
<div class="ttc" id="astrings_8c_html_ade72be627db6a28a2efe5c0340ae47b3"><div class="ttname"><a href="strings_8c.html#ade72be627db6a28a2efe5c0340ae47b3">STRING_new</a></div><div class="ttdeci">STRING_HANDLE STRING_new(void)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00032">strings.c:32</a></div></div>
<div class="ttc" id="astructAPP__PAYLOAD__TAG_html_a71505d1c172b993e9d0841b9eaf33adf"><div class="ttname"><a href="structAPP__PAYLOAD__TAG.html#a71505d1c172b993e9d0841b9eaf33adf">APP_PAYLOAD_TAG::length</a></div><div class="ttdeci">size_t length</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00049">mqttconst.h:49</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ac73b1fb898e61fb0f8170b745aced031"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ac73b1fb898e61fb0f8170b745aced031">MQTTTRANSPORT_HANDLE_DATA_TAG::raw_trace</a></div><div class="ttdeci">bool raw_trace</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00179">iothubtransport_mqtt_common.c:179</a></div></div>
<div class="ttc" id="astructMESSAGE__CALLBACK__INFO__TAG_html_a0a77346e8715fa38f641ae172e3abc5c"><div class="ttname"><a href="structMESSAGE__CALLBACK__INFO__TAG.html#a0a77346e8715fa38f641ae172e3abc5c">MESSAGE_CALLBACK_INFO_TAG::transportContext</a></div><div class="ttdeci">MESSAGE_DISPOSITION_CONTEXT_HANDLE transportContext</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00029">iothub_transport_ll.h:29</a></div></div>
<div class="ttc" id="astructSTRING__TOKEN__TAG_html"><div class="ttname"><a href="structSTRING__TOKEN__TAG.html">STRING_TOKEN_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="string__tokenizer_8c_source.html#l00012">string_tokenizer.c:13</a></div></div>
<div class="ttc" id="alibraries_2AzureIoT_2src_2az__iot_2umqtt_2inc_2azure__umqtt__c_2mqtt__client_8h_html_a01d99c6d2271aaf6ff1564802663e263"><div class="ttname"><a href="libraries_2AzureIoT_2src_2az__iot_2umqtt_2inc_2azure__umqtt__c_2mqtt__client_8h.html#a01d99c6d2271aaf6ff1564802663e263">MQTT_CLIENT_EVENT_ERROR_VALUES</a></div><div class="ttdeci">#define MQTT_CLIENT_EVENT_ERROR_VALUES</div><div class="ttdef"><b>Definition:</b> <a href="libraries_2AzureIoT_2src_2az__iot_2umqtt_2inc_2azure__umqtt__c_2mqtt__client_8h_source.html#l00036">mqtt_client.h:35</a></div></div>
<div class="ttc" id="aurlencode_8c_html_a294e4745086de41f1ec0c48ef9b2f90e"><div class="ttname"><a href="urlencode_8c.html#a294e4745086de41f1ec0c48ef9b2f90e">URL_Encode</a></div><div class="ttdeci">STRING_HANDLE URL_Encode(STRING_HANDLE input)</div><div class="ttdef"><b>Definition:</b> <a href="urlencode_8c_source.html#l00120">urlencode.c:120</a></div></div>
<div class="ttc" id="astructMQTT__TRANSPORT__PROXY__OPTIONS__TAG_html_a2a59f9a0f1f041c5b0d8df9d8d144059"><div class="ttname"><a href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a2a59f9a0f1f041c5b0d8df9d8d144059">MQTT_TRANSPORT_PROXY_OPTIONS_TAG::password</a></div><div class="ttdeci">const char * password</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8h_source.html#l00020">iothubtransport_mqtt_common.h:20</a></div></div>
<div class="ttc" id="aRPSL_8txt_html_ae227cfd33a5880ffce840d383c2fbff3"><div class="ttname"><a href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a></div><div class="ttdeci">Conditions &amp;Restrictions Subject to the terms and conditions of this Licensor hereby grants effective on the date You accept this a royalty free</div><div class="ttdef"><b>Definition:</b> <a href="RPSL_8txt_source.html#l00105">RPSL.txt:105</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_aae6d6188ff0358440fc632e3d54c2113"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#aae6d6188ff0358440fc632e3d54c2113">EPOCH_TIME_T_VALUE</a></div><div class="ttdeci">#define EPOCH_TIME_T_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00041">iothubtransport_mqtt_common.c:40</a></div></div>
<div class="ttc" id="astructIOTHUB__DEVICE__TWIN__TAG_html_a4476afa977a129094769793ebe9f7bd6"><div class="ttname"><a href="structIOTHUB__DEVICE__TWIN__TAG.html#a4476afa977a129094769793ebe9f7bd6">IOTHUB_DEVICE_TWIN_TAG::item_id</a></div><div class="ttdeci">uint32_t item_id</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00058">iothub_client_private.h:58</a></div></div>
<div class="ttc" id="amqttconst_8h_html_aa393db33c1dfb0ce811219ce02e08e61aecbeec60d028ae11cf66d405507c4848"><div class="ttname"><a href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61aecbeec60d028ae11cf66d405507c4848">CONN_REFUSED_ID_REJECTED</a></div><div class="ttdeci">@ CONN_REFUSED_ID_REJECTED</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00070">mqttconst.h:70</a></div></div>
<div class="ttc" id="astructMQTT__MESSAGE__DETAILS__LIST__TAG_html_a23a9cb715c409bb3717c1cd639420115"><div class="ttname"><a href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a23a9cb715c409bb3717c1cd639420115">MQTT_MESSAGE_DETAILS_LIST_TAG::retryCount</a></div><div class="ttdeci">size_t retryCount</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00222">iothubtransport_mqtt_common.c:222</a></div></div>
<div class="ttc" id="aiothub__client__retry__control_8c_html_a6b39a45fa0661693171238e1e56112f3"><div class="ttname"><a href="iothub__client__retry__control_8c.html#a6b39a45fa0661693171238e1e56112f3">retry_control_create</a></div><div class="ttdeci">RETRY_CONTROL_HANDLE retry_control_create(IOTHUB_CLIENT_RETRY_POLICY policy, unsigned int max_retry_time_in_secs)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__retry__control_8c_source.html#l00307">iothub_client_retry_control.c:307</a></div></div>
<div class="ttc" id="astring__tokenizer_8h_html"><div class="ttname"><a href="string__tokenizer_8h.html">string_tokenizer.h</a></div></div>
<div class="ttc" id="aiothub__client__ll_8c_html_a9c1cba53bc3e3709c5bfa007297da425"><div class="ttname"><a href="iothub__client__ll_8c.html#a9c1cba53bc3e3709c5bfa007297da425">IoTHubClient_LL_MessageCallback</a></div><div class="ttdeci">bool IoTHubClient_LL_MessageCallback(IOTHUB_CLIENT_LL_HANDLE handle, MESSAGE_CALLBACK_INFO *messageData)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l01464">iothub_client_ll.c:1464</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a8d873ed494c3ce1b30a85ab8f4365dc1"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a8d873ed494c3ce1b30a85ab8f4365dc1">MQTTTRANSPORT_HANDLE_DATA_TAG::mqtt_connect_time</a></div><div class="ttdeci">tickcounter_ms_t mqtt_connect_time</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00175">iothubtransport_mqtt_common.c:175</a></div></div>
<div class="ttc" id="asastoken_8h_html"><div class="ttname"><a href="sastoken_8h.html">sastoken.h</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_afe8e3a02ff7275f8dbf4b2ff2dd4513e"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#afe8e3a02ff7275f8dbf4b2ff2dd4513e">IoTHubTransport_MQTT_Common_Unsubscribe_DeviceTwin</a></div><div class="ttdeci">void IoTHubTransport_MQTT_Common_Unsubscribe_DeviceTwin(IOTHUB_DEVICE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02102">iothubtransport_mqtt_common.c:2102</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_aac9f6f33fc89f91ffa7853692a1555b6"><div class="ttname"><a href="iothub__message_8c.html#aac9f6f33fc89f91ffa7853692a1555b6">IoTHubMessage_GetCorrelationId</a></div><div class="ttdeci">const char * IoTHubMessage_GetCorrelationId(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00459">iothub_message.c:459</a></div></div>
<div class="ttc" id="astructDLIST__ENTRY__TAG_html_a6d2f8f6151752cac15bd0851edf7ba24"><div class="ttname"><a href="structDLIST__ENTRY__TAG.html#a6d2f8f6151752cac15bd0851edf7ba24">DLIST_ENTRY_TAG::Flink</a></div><div class="ttdeci">struct DLIST_ENTRY_TAG * Flink</div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8h_source.html#l00020">doublylinkedlist.h:20</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a826b9a63aee7138a05a1c8fedf0240c0a6585600d59a7f48153f28a436aeac69e"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a6585600d59a7f48153f28a436aeac69e">X509</a></div><div class="ttdeci">@ X509</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00118">iothubtransport_mqtt_common.c:118</a></div></div>
<div class="ttc" id="aiothub__client__retry__control_8c_html_a56d2ee1fad11d086b79eae8f8f248aec"><div class="ttname"><a href="iothub__client__retry__control_8c.html#a56d2ee1fad11d086b79eae8f8f248aec">retry_control_reset</a></div><div class="ttdeci">void retry_control_reset(RETRY_CONTROL_HANDLE retry_control_handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__retry__control_8c_source.html#l00288">iothub_client_retry_control.c:288</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a9292e92f5705a4379829878a1c71528c"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a9292e92f5705a4379829878a1c71528c">IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod</a></div><div class="ttdeci">void IoTHubTransport_MQTT_Common_Unsubscribe_DeviceMethod(IOTHUB_DEVICE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02181">iothubtransport_mqtt_common.c:2181</a></div></div>
<div class="ttc" id="aconstbuffer_8c_html_a931efe3e168c876c6783bfd41b163ea3"><div class="ttname"><a href="constbuffer_8c.html#a931efe3e168c876c6783bfd41b163ea3">CONSTBUFFER_GetContent</a></div><div class="ttdeci">const CONSTBUFFER * CONSTBUFFER_GetContent(CONSTBUFFER_HANDLE constbufferHandle)</div><div class="ttdef"><b>Definition:</b> <a href="constbuffer_8c_source.html#l00120">constbuffer.c:120</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_afc2eec77a7b914cf3eefe854bedf2040"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#afc2eec77a7b914cf3eefe854bedf2040">MQTTTRANSPORT_HANDLE_DATA_TAG::http_proxy_password</a></div><div class="ttdeci">char * http_proxy_password</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00203">iothubtransport_mqtt_common.c:203</a></div></div>
<div class="ttc" id="astructIOTHUB__MESSAGE__HANDLE__DATA__TAG_html"><div class="ttname"><a href="structIOTHUB__MESSAGE__HANDLE__DATA__TAG.html">IOTHUB_MESSAGE_HANDLE_DATA_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00018">iothub_message.c:19</a></div></div>
<div class="ttc" id="aiothub__transport__ll_8h_html_a1cc79695294f89e97fb945066a3b3d77"><div class="ttname"><a href="iothub__transport__ll_8h.html#a1cc79695294f89e97fb945066a3b3d77">METHOD_HANDLE</a></div><div class="ttdeci">void * METHOD_HANDLE</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00017">iothub_transport_ll.h:17</a></div></div>
<div class="ttc" id="alimits_8h_html_a689b119da994dece91d44b5aeac643ed"><div class="ttname"><a href="limits_8h.html#a689b119da994dece91d44b5aeac643ed">USHRT_MAX</a></div><div class="ttdeci">#define USHRT_MAX</div><div class="ttdef"><b>Definition:</b> <a href="limits_8h_source.html#l00063">limits.h:62</a></div></div>
<div class="ttc" id="acJSON_8h_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="cJSON_8h_source.html#l00168">cJSON.h:168</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_aed460cbad1b51f41759f8ab289ef09d3"><div class="ttname"><a href="mqtt__client_8c.html#aed460cbad1b51f41759f8ab289ef09d3">mqtt_client_subscribe</a></div><div class="ttdeci">int mqtt_client_subscribe(MQTT_CLIENT_HANDLE handle, uint16_t packetId, SUBSCRIBE_PAYLOAD *subscribeList, size_t count)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l01049">mqtt_client.c:1049</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ae450c1cb06546a36229076f07f86f2ec"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ae450c1cb06546a36229076f07f86f2ec">IoTHubTransport_MQTT_Common_ProcessItem</a></div><div class="ttdeci">IOTHUB_PROCESS_ITEM_RESULT IoTHubTransport_MQTT_Common_ProcessItem(TRANSPORT_LL_HANDLE handle, IOTHUB_IDENTITY_TYPE item_type, IOTHUB_IDENTITY_INFO *iothub_item)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02309">iothubtransport_mqtt_common.c:2309</a></div></div>
<div class="ttc" id="astructSUBSCRIBE__PAYLOAD__TAG_html"><div class="ttname"><a href="structSUBSCRIBE__PAYLOAD__TAG.html">SUBSCRIBE_PAYLOAD_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00083">mqttconst.h:84</a></div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_a6cbf7ebcadd8fbedeff684d1571cdfb9"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a6cbf7ebcadd8fbedeff684d1571cdfb9">MQTT_DEVICE_TWIN_ITEM_TAG::msgPublishTime</a></div><div class="ttdeci">tickcounter_ms_t msgPublishTime</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00209">iothubtransport_mqtt_common.c:209</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ad04fb507626a86b71b05a49678ec5330"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad04fb507626a86b71b05a49678ec5330">MQTTTRANSPORT_HANDLE_DATA_TAG::currPacketState</a></div><div class="ttdeci">CONTROL_PACKET_TYPE currPacketState</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00188">iothubtransport_mqtt_common.c:188</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_af468c9035b44315d96c7563bd0882aca"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#af468c9035b44315d96c7563bd0882aca">PMQTT_MESSAGE_DETAILS_LIST</a></div><div class="ttdeci">struct MQTT_MESSAGE_DETAILS_LIST_TAG * PMQTT_MESSAGE_DETAILS_LIST</div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_af4ce9e6cc6550d04c63f2f2e52ddee28"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#af4ce9e6cc6550d04c63f2f2e52ddee28">MQTT_DEVICE_TWIN_ITEM_TAG::device_twin_data</a></div><div class="ttdeci">IOTHUB_DEVICE_TWIN * device_twin_data</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00214">iothubtransport_mqtt_common.c:214</a></div></div>
<div class="ttc" id="atinyexpr_8c_html_a99852dcb2cc193a859b86bef9805381f"><div class="ttname"><a href="tinyexpr_8c.html#a99852dcb2cc193a859b86bef9805381f">state</a></div><div class="ttdeci">struct state state</div></div>
<div class="ttc" id="astructHTTP__PROXY__OPTIONS__TAG_html"><div class="ttname"><a href="structHTTP__PROXY__OPTIONS__TAG.html">HTTP_PROXY_OPTIONS_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="shared__util__options_8h_source.html#l00012">shared_util_options.h:13</a></div></div>
<div class="ttc" id="astructHTTP__PROXY__OPTIONS__TAG_html_ae6cee5a2da074b448078837f2fedcd05"><div class="ttname"><a href="structHTTP__PROXY__OPTIONS__TAG.html#ae6cee5a2da074b448078837f2fedcd05">HTTP_PROXY_OPTIONS_TAG::username</a></div><div class="ttdeci">const char * username</div><div class="ttdef"><b>Definition:</b> <a href="shared__util__options_8h_source.html#l00016">shared_util_options.h:16</a></div></div>
<div class="ttc" id="astructIOTHUB__DEVICE__CONFIG__TAG_html_a7893f64cc9203bd1a938ae94b5c7d8b4"><div class="ttname"><a href="structIOTHUB__DEVICE__CONFIG__TAG.html#a7893f64cc9203bd1a938ae94b5c7d8b4">IOTHUB_DEVICE_CONFIG_TAG::deviceKey</a></div><div class="ttdeci">const char * deviceKey</div><div class="ttdoc">The device key used to authenticate the device.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00046">iothub_transport_ll.h:46</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a6001bd6584c0dfcd55a5dde7aa92b158"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6001bd6584c0dfcd55a5dde7aa92b158">MQTTTRANSPORT_HANDLE_DATA_TAG::xioTransport</a></div><div class="ttdeci">XIO_HANDLE xioTransport</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00163">iothubtransport_mqtt_common.c:163</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a2711aa32fdfa812d68e6b35acc470ac7"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a2711aa32fdfa812d68e6b35acc470ac7">IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod</a></div><div class="ttdeci">int IoTHubTransport_MQTT_Common_Subscribe_DeviceMethod(IOTHUB_DEVICE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02129">iothubtransport_mqtt_common.c:2129</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a07488a0c591bfe49d015b8ed68303053a87a9746e9955eebaafc028505df46f93"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053a87a9746e9955eebaafc028505df46f93">REPORTED_STATE</a></div><div class="ttdeci">@ REPORTED_STATE</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00111">iothubtransport_mqtt_common.c:111</a></div></div>
<div class="ttc" id="atag__strings_8h_html_a7ab6af690f74b3a11c6ec4c691ecae0d"><div class="ttname"><a href="tag__strings_8h.html#a7ab6af690f74b3a11c6ec4c691ecae0d">output</a></div><div class="ttdeci">annotation output</div><div class="ttdef"><b>Definition:</b> <a href="tag__strings_8h_source.html#l00121">tag_strings.h:121</a></div></div>
<div class="ttc" id="astructMESSAGE__CALLBACK__INFO__TAG_html"><div class="ttname"><a href="structMESSAGE__CALLBACK__INFO__TAG.html">MESSAGE_CALLBACK_INFO_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00026">iothub_transport_ll.h:27</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a905fb31568fb9ecbdcbeeb4e0795b1b3"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a905fb31568fb9ecbdcbeeb4e0795b1b3">DEFAULT_MQTT_KEEPALIVE</a></div><div class="ttdeci">#define DEFAULT_MQTT_KEEPALIVE</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00042">iothubtransport_mqtt_common.c:41</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_aa8a6dde4462576eb23c4f1e6d640645f"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#aa8a6dde4462576eb23c4f1e6d640645f">DEVICE_TWIN_MSG_TYPE</a></div><div class="ttdeci">enum DEVICE_TWIN_MSG_TYPE_TAG DEVICE_TWIN_MSG_TYPE</div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_a7772609c09ce568b73d040081e6a7cc6"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a7772609c09ce568b73d040081e6a7cc6">MQTT_DEVICE_TWIN_ITEM_TAG::device_twin_msg_type</a></div><div class="ttdeci">DEVICE_TWIN_MSG_TYPE device_twin_msg_type</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00215">iothubtransport_mqtt_common.c:215</a></div></div>
<div class="ttc" id="astructIOTHUBTRANSPORT__CONFIG__TAG_html_aed64933a7aabd2442da7ba3656ff7e89"><div class="ttname"><a href="structIOTHUBTRANSPORT__CONFIG__TAG.html#aed64933a7aabd2442da7ba3656ff7e89">IOTHUBTRANSPORT_CONFIG_TAG::auth_module_handle</a></div><div class="ttdeci">IOTHUB_AUTHORIZATION_HANDLE auth_module_handle</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00233">iothub_client_ll.h:233</a></div></div>
<div class="ttc" id="astructSYSTEM__PROPERTY__INFO__TAG_html"><div class="ttname"><a href="structSYSTEM__PROPERTY__INFO__TAG.html">SYSTEM_PROPERTY_INFO_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00090">iothubtransport_mqtt_common.c:91</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_acaa3b835c12fb0254938af052f0fcb6f"><div class="ttname"><a href="iothub__message_8c.html#acaa3b835c12fb0254938af052f0fcb6f">IoTHubMessage_CreateFromByteArray</a></div><div class="ttdeci">IOTHUB_MESSAGE_HANDLE IoTHubMessage_CreateFromByteArray(const unsigned char *byteArray, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00065">iothub_message.c:65</a></div></div>
<div class="ttc" id="alimits_8h_html"><div class="ttname"><a href="limits_8h.html">limits.h</a></div></div>
<div class="ttc" id="astructMQTT__MESSAGE__DETAILS__LIST__TAG_html_ace3e7c2cb335867f8656c2aae59ae45d"><div class="ttname"><a href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#ace3e7c2cb335867f8656c2aae59ae45d">MQTT_MESSAGE_DETAILS_LIST_TAG::packet_id</a></div><div class="ttdeci">uint16_t packet_id</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00225">iothubtransport_mqtt_common.c:225</a></div></div>
<div class="ttc" id="astring__tokenizer_8c_html_a61087f8cee735b8d1e9149b999cf8955"><div class="ttname"><a href="string__tokenizer_8c.html#a61087f8cee735b8d1e9149b999cf8955">STRING_TOKENIZER_get_next_token</a></div><div class="ttdeci">int STRING_TOKENIZER_get_next_token(STRING_TOKENIZER_HANDLE tokenizer, STRING_HANDLE output, const char *delimiters)</div><div class="ttdef"><b>Definition:</b> <a href="string__tokenizer_8c_source.html#l00069">string_tokenizer.c:69</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a5d5870c74de2d33a04df2031b3984e7f"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5d5870c74de2d33a04df2031b3984e7f">MQTTTRANSPORT_HANDLE_DATA_TAG::topic_MqttEvent</a></div><div class="ttdeci">STRING_HANDLE topic_MqttEvent</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00133">iothubtransport_mqtt_common.c:133</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_aa65f265ee9cbfcae6ebf81df89d5aba5"><div class="ttname"><a href="mqtt__client_8c.html#aa65f265ee9cbfcae6ebf81df89d5aba5">mqtt_client_disconnect</a></div><div class="ttdeci">int mqtt_client_disconnect(MQTT_CLIENT_HANDLE handle, ON_MQTT_DISCONNECTED_CALLBACK callback, void *ctx)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l01145">mqtt_client.c:1145</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_affa3f275f686281b47c0e25de7fcb6e3"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#affa3f275f686281b47c0e25de7fcb6e3">MQTTTRANSPORT_HANDLE_DATA_TAG::portNum</a></div><div class="ttdeci">int portNum</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00146">iothubtransport_mqtt_common.c:146</a></div></div>
<div class="ttc" id="actype_8h_html"><div class="ttname"><a href="ctype_8h.html">ctype.h</a></div></div>
<div class="ttc" id="astructMAP__HANDLE__DATA__TAG_html"><div class="ttname"><a href="structMAP__HANDLE__DATA__TAG.html">MAP_HANDLE_DATA_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="map_8c_source.html#l00013">map.c:14</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ad19dab2a96d760e17265be294f61a61a"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ad19dab2a96d760e17265be294f61a61a">SUBSCRIBE_TOPIC_COUNT</a></div><div class="ttdeci">#define SUBSCRIBE_TOPIC_COUNT</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00087">iothubtransport_mqtt_common.c:86</a></div></div>
<div class="ttc" id="aiothub__client__ll_8c_html_a54e92efb1de9dea85d953a42b4bc1352"><div class="ttname"><a href="iothub__client__ll_8c.html#a54e92efb1de9dea85d953a42b4bc1352">IoTHubClient_LL_ReportedStateComplete</a></div><div class="ttdeci">void IoTHubClient_LL_ReportedStateComplete(IOTHUB_CLIENT_LL_HANDLE handle, uint32_t item_id, int status_code)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l01430">iothub_client_ll.c:1430</a></div></div>
<div class="ttc" id="aiothub__client__authorization_8c_html_af440381fa0471d6c75a85df7007646d4"><div class="ttname"><a href="iothub__client__authorization_8c.html#af440381fa0471d6c75a85df7007646d4">IoTHubClient_Auth_Set_xio_Certificate</a></div><div class="ttdeci">int IoTHubClient_Auth_Set_xio_Certificate(IOTHUB_AUTHORIZATION_HANDLE handle, XIO_HANDLE xio)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__authorization_8c_source.html#l00228">iothub_client_authorization.c:228</a></div></div>
<div class="ttc" id="astructCONNECT__ACK__TAG_html_a41c1c2947502c861ca9057a63109e14b"><div class="ttname"><a href="structCONNECT__ACK__TAG.html#a41c1c2947502c861ca9057a63109e14b">CONNECT_ACK_TAG::returnCode</a></div><div class="ttdeci">CONNECT_RETURN_CODE returnCode</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00080">mqttconst.h:80</a></div></div>
<div class="ttc" id="astructIOTHUB__MESSAGE__LIST__TAG_html_aad1c9c47677735aff2e3e6550cdab1e4"><div class="ttname"><a href="structIOTHUB__MESSAGE__LIST__TAG.html#aad1c9c47677735aff2e3e6550cdab1e4">IOTHUB_MESSAGE_LIST_TAG::entry</a></div><div class="ttdeci">DLIST_ENTRY entry</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00052">iothub_client_private.h:52</a></div></div>
<div class="ttc" id="astructCONSTBUFFER__TAG_html_ac7fbc8670a6b57a2b1c6bea1a5736122"><div class="ttname"><a href="structCONSTBUFFER__TAG.html#ac7fbc8670a6b57a2b1c6bea1a5736122">CONSTBUFFER_TAG::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="constbuffer_8h_source.html#l00026">constbuffer.h:26</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8h_html_aadf70c8c230285569dc7d6ff281fcb21"><div class="ttname"><a href="iothubtransport__mqtt__common_8h.html#aadf70c8c230285569dc7d6ff281fcb21">MQTT_GET_IO_TRANSPORT</a></div><div class="ttdeci">XIO_HANDLE(* MQTT_GET_IO_TRANSPORT)(const char *fully_qualified_name, const MQTT_TRANSPORT_PROXY_OPTIONS *mqtt_transport_proxy_options)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8h_source.html#l00023">iothubtransport_mqtt_common.h:23</a></div></div>
<div class="ttc" id="astructIOTHUBTRANSPORT__CONFIG__TAG_html_a85d409da42f91612597756a81de437e8"><div class="ttname"><a href="structIOTHUBTRANSPORT__CONFIG__TAG.html#a85d409da42f91612597756a81de437e8">IOTHUBTRANSPORT_CONFIG_TAG::upperConfig</a></div><div class="ttdeci">const IOTHUB_CLIENT_CONFIG * upperConfig</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00231">iothub_client_ll.h:231</a></div></div>
<div class="ttc" id="astructHTTP__PROXY__OPTIONS__TAG_html_a73c53f8a166a8c1e2007e6644a6400af"><div class="ttname"><a href="structHTTP__PROXY__OPTIONS__TAG.html#a73c53f8a166a8c1e2007e6644a6400af">HTTP_PROXY_OPTIONS_TAG::host_address</a></div><div class="ttdeci">const char * host_address</div><div class="ttdef"><b>Definition:</b> <a href="shared__util__options_8h_source.html#l00014">shared_util_options.h:14</a></div></div>
<div class="ttc" id="astrings_8c_html_a14f1a6a01de229149d3810d4d06816a2"><div class="ttname"><a href="strings_8c.html#a14f1a6a01de229149d3810d4d06816a2">STRING_delete</a></div><div class="ttdeci">void STRING_delete(STRING_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00654">strings.c:654</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html_af33000861e1bb43af8e339dee3e689a0"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html#af33000861e1bb43af8e339dee3e689a0">IOTHUB_CLIENT_CONFIG_TAG::deviceId</a></div><div class="ttdeci">const char * deviceId</div><div class="ttdoc">A string that identifies the device.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00185">iothub_client_ll.h:185</a></div></div>
<div class="ttc" id="astructIOTHUB__MESSAGE__LIST__TAG_html_a1bbd4c03b7fcff198e14e92d7c36299c"><div class="ttname"><a href="structIOTHUB__MESSAGE__LIST__TAG.html#a1bbd4c03b7fcff198e14e92d7c36299c">IOTHUB_MESSAGE_LIST_TAG::messageHandle</a></div><div class="ttdeci">IOTHUB_MESSAGE_HANDLE messageHandle</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00049">iothub_client_private.h:49</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_aa0b36fe7e83a4d575b40390c764c7d04"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#aa0b36fe7e83a4d575b40390c764c7d04">MQTT_MESSAGE_DETAILS_LIST</a></div><div class="ttdeci">struct MQTT_MESSAGE_DETAILS_LIST_TAG MQTT_MESSAGE_DETAILS_LIST</div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a917ec0ac30f52875fe2fac75a747670e">MQTT_CLIENT_STATUS_NOT_CONNECTED</a></div><div class="ttdeci">@ MQTT_CLIENT_STATUS_NOT_CONNECTED</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00125">iothubtransport_mqtt_common.c:125</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a7f990671091f2c90d13d7e915633071d"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7f990671091f2c90d13d7e915633071d">MQTTTRANSPORT_HANDLE_DATA_TAG::isRegistered</a></div><div class="ttdeci">bool isRegistered</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00169">iothubtransport_mqtt_common.c:169</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a104b92d040ffaefb6fb038c10f440796"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a104b92d040ffaefb6fb038c10f440796">MQTTTRANSPORT_HANDLE_DATA_TAG::get_io_transport</a></div><div class="ttdeci">MQTT_GET_IO_TRANSPORT get_io_transport</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00148">iothubtransport_mqtt_common.c:148</a></div></div>
<div class="ttc" id="astructCONSTBUFFER__TAG_html_ad35ed43e51ef98390f30105439448d6b"><div class="ttname"><a href="structCONSTBUFFER__TAG.html#ad35ed43e51ef98390f30105439448d6b">CONSTBUFFER_TAG::buffer</a></div><div class="ttdeci">const unsigned char * buffer</div><div class="ttdef"><b>Definition:</b> <a href="constbuffer_8h_source.html#l00025">constbuffer.h:25</a></div></div>
<div class="ttc" id="astring__tokenizer_8c_html_a9feb65ab75511ffba42b7c1c24aa24fa"><div class="ttname"><a href="string__tokenizer_8c.html#a9feb65ab75511ffba42b7c1c24aa24fa">STRING_TOKENIZER_destroy</a></div><div class="ttdeci">void STRING_TOKENIZER_destroy(STRING_TOKENIZER_HANDLE t)</div><div class="ttdef"><b>Definition:</b> <a href="string__tokenizer_8c_source.html#l00191">string_tokenizer.c:191</a></div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_a25b65bcd6d310d91ecc5f962d823977c"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a25b65bcd6d310d91ecc5f962d823977c">MQTT_DEVICE_TWIN_ITEM_TAG::iothub_msg_id</a></div><div class="ttdeci">uint32_t iothub_msg_id</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00213">iothubtransport_mqtt_common.c:213</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a067063b96e352df08fbe2c56d3f24e10"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a067063b96e352df08fbe2c56d3f24e10">SUBSCRIBE_DEVICE_METHOD_TOPIC</a></div><div class="ttdeci">#define SUBSCRIBE_DEVICE_METHOD_TOPIC</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00086">iothubtransport_mqtt_common.c:85</a></div></div>
<div class="ttc" id="atickcounter_8c_html_ae17afabcfd8497d6b95689f620ddac3a"><div class="ttname"><a href="tickcounter_8c.html#ae17afabcfd8497d6b95689f620ddac3a">tickcounter_get_current_ms</a></div><div class="ttdeci">int tickcounter_get_current_ms(TICK_COUNTER_HANDLE tick_counter, tickcounter_ms_t *current_ms)</div><div class="ttdef"><b>Definition:</b> <a href="tickcounter_8c_source.html#l00053">tickcounter.c:53</a></div></div>
<div class="ttc" id="acrt__abstractions_8h_html_ab54417c7c018570043920af66ba7457f"><div class="ttname"><a href="crt__abstractions_8h.html#ab54417c7c018570043920af66ba7457f">TOUPPER</a></div><div class="ttdeci">#define TOUPPER(c)</div><div class="ttdef"><b>Definition:</b> <a href="crt__abstractions_8h_source.html#l00116">crt_abstractions.h:115</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_aef4eaf36a7e31478f440c5fd8d4201b9"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#aef4eaf36a7e31478f440c5fd8d4201b9">IoTHubTransport_MQTT_Common_Subscribe</a></div><div class="ttdeci">int IoTHubTransport_MQTT_Common_Subscribe(IOTHUB_DEVICE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02250">iothubtransport_mqtt_common.c:2250</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_add857ad96e28f92aa825fa961769ad37"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#add857ad96e28f92aa825fa961769ad37">IoTHubTransport_MQTT_Common_GetSendStatus</a></div><div class="ttdeci">IOTHUB_CLIENT_RESULT IoTHubTransport_MQTT_Common_GetSendStatus(IOTHUB_DEVICE_HANDLE handle, IOTHUB_CLIENT_STATUS *iotHubClientStatus)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02517">iothubtransport_mqtt_common.c:2517</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html_a278ea8e632843766efe157bb00e86a38"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html#a278ea8e632843766efe157bb00e86a38">MQTT_CLIENT_OPTIONS_TAG::willMessage</a></div><div class="ttdeci">char * willMessage</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00056">mqttconst.h:56</a></div></div>
<div class="ttc" id="aiothub__transport__ll_8h_html_ada7e11bd73c3ce69a051872fd00692dc"><div class="ttname"><a href="iothub__transport__ll_8h.html#ada7e11bd73c3ce69a051872fd00692dc">IOTHUB_DEVICE_HANDLE</a></div><div class="ttdeci">void * IOTHUB_DEVICE_HANDLE</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00009">iothub_transport_ll.h:9</a></div></div>
<div class="ttc" id="adef_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="def_8h_source.html#l00071">def.h:70</a></div></div>
<div class="ttc" id="amacro__utils_8h_html_a9953147f17615533ea50ed383b0171c1"><div class="ttname"><a href="macro__utils_8h.html#a9953147f17615533ea50ed383b0171c1">DEFINE_ENUM_STRINGS</a></div><div class="ttdeci">#define DEFINE_ENUM_STRINGS(enumName,...)</div><div class="ttdef"><b>Definition:</b> <a href="macro__utils_8h_source.html#l12578">macro_utils.h:12577</a></div></div>
<div class="ttc" id="astructMQTT__MESSAGE__DETAILS__LIST__TAG_html_a62baa2b850b021a73e060abc2abd445e"><div class="ttname"><a href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#a62baa2b850b021a73e060abc2abd445e">MQTT_MESSAGE_DETAILS_LIST_TAG::msgPublishTime</a></div><div class="ttdeci">tickcounter_ms_t msgPublishTime</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00221">iothubtransport_mqtt_common.c:221</a></div></div>
<div class="ttc" id="astructTICK__COUNTER__INSTANCE__TAG_html"><div class="ttname"><a href="structTICK__COUNTER__INSTANCE__TAG.html">TICK_COUNTER_INSTANCE_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="tickcounter_8c_source.html#l00018">tickcounter.c:19</a></div></div>
<div class="ttc" id="astructIOTHUBTRANSPORT__CONFIG__TAG_html"><div class="ttname"><a href="structIOTHUBTRANSPORT__CONFIG__TAG.html">IOTHUBTRANSPORT_CONFIG_TAG</a></div><div class="ttdoc">This struct captures IoTHub transport configuration.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00229">iothub_client_ll.h:230</a></div></div>
<div class="ttc" id="adoublylinkedlist_8h_html_acdd1d99b1d03205d80018ae93bc48606"><div class="ttname"><a href="doublylinkedlist_8h.html#acdd1d99b1d03205d80018ae93bc48606">containingRecord</a></div><div class="ttdeci">#define containingRecord(address, type, field)</div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8h_source.html#l00037">doublylinkedlist.h:36</a></div></div>
<div class="ttc" id="amacro__utils_8h_html_a25551e3ff0e5f7d2457ddf9c155a87c5"><div class="ttname"><a href="macro__utils_8h.html#a25551e3ff0e5f7d2457ddf9c155a87c5">ENUM_TO_STRING</a></div><div class="ttdeci">#define ENUM_TO_STRING(enumName, enumValue)</div><div class="ttdef"><b>Definition:</b> <a href="macro__utils_8h_source.html#l12629">macro_utils.h:12628</a></div></div>
<div class="ttc" id="amqtt__message_8c_html_ac072f8e7cbd8caceffa1a562b0419565"><div class="ttname"><a href="mqtt__message_8c.html#ac072f8e7cbd8caceffa1a562b0419565">mqttmessage_getTopicName</a></div><div class="ttdeci">const char * mqttmessage_getTopicName(MQTT_MESSAGE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__message_8c_source.html#l00181">mqtt_message.c:181</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_a53d52bdf5a10f069c2157898ea174ca4"><div class="ttname"><a href="mqtt__client_8c.html#a53d52bdf5a10f069c2157898ea174ca4">mqtt_client_dowork</a></div><div class="ttdeci">void mqtt_client_dowork(MQTT_CLIENT_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l01197">mqtt_client.c:1197</a></div></div>
<div class="ttc" id="aArduino-IRremote_2LICENSE_8txt_html_a3b083519fd2b41d83363afcfd5ebad9d"><div class="ttname"><a href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a></div><div class="ttdeci">if the work is an executable linked with the with the complete machine readable work that uses the as object code and or source so that the user can modify the Library and then relink to produce a modified executable containing the modified rather than copying library functions into the if the user installs as long as the modified version is interface compatible with the version that the work was made with c Accompany the work with a written valid for at least three to give the same user the materials specified in for a charge no more than the cost of performing this distribution d If distribution of the work is made by offering access to copy from a designated offer equivalent access to copy the above specified materials from the same place e Verify that the user has already received a copy of these materials or that you have already sent this user a copy For an the required form of the work that uses the Library must include any data and utility programs needed for reproducing the executable from it as a special the materials to be distributed need not include anything that is normally and so on of the operating system on which the executable unless that component itself accompanies the executable It may happen that this requirement contradicts the license restrictions of other proprietary libraries that do not normally accompany the operating system Such a contradiction means you cannot use both them and the Library together in an executable that you distribute You may place library facilities that are a work based on the Library side by side in a single library together with other library facilities not covered by this and distribute such a combined provided that the separate distribution of the work based on the Library and of the other library facilities is otherwise and provided that you do these two uncombined with any other library facilities This must be distributed under the terms of the Sections above b Give prominent notice with the combined library of the fact that part of it is a work based on the and explaining where to find the accompanying uncombined form of the same work You may not link or distribute the Library except as expressly provided under this License Any attempt otherwise to link or distribute the Library is void</div><div class="ttdef"><b>Definition:</b> <a href="Arduino-IRremote_2LICENSE_8txt_source.html#l00353">LICENSE.txt:353</a></div></div>
<div class="ttc" id="amqttconst_8h_html_aa393db33c1dfb0ce811219ce02e08e61a79a2775d065472ffcb445df30fea63fd"><div class="ttname"><a href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a79a2775d065472ffcb445df30fea63fd">CONN_REFUSED_NOT_AUTHORIZED</a></div><div class="ttdeci">@ CONN_REFUSED_NOT_AUTHORIZED</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00073">mqttconst.h:73</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ae463d24be606b809c652d543d1c11b58a3d79509b61d6f3b7beeafdf2f01ff9ed"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ae463d24be606b809c652d543d1c11b58a3d79509b61d6f3b7beeafdf2f01ff9ed">MQTT_CLIENT_STATUS_CONNECTING</a></div><div class="ttdeci">@ MQTT_CLIENT_STATUS_CONNECTING</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00126">iothubtransport_mqtt_common.c:126</a></div></div>
<div class="ttc" id="aiothub__client__authorization_8c_html_ab152ed6998a4d74434b072c12458dc3f"><div class="ttname"><a href="iothub__client__authorization_8c.html#ab152ed6998a4d74434b072c12458dc3f">IoTHubClient_Auth_Set_x509_Type</a></div><div class="ttdeci">IOTHUB_CREDENTIAL_TYPE IoTHubClient_Auth_Set_x509_Type(IOTHUB_AUTHORIZATION_HANDLE handle, bool enable_x509)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__authorization_8c_source.html#l00196">iothub_client_authorization.c:196</a></div></div>
<div class="ttc" id="alibraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2platform_8h_html"><div class="ttname"><a href="libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2platform_8h.html">platform.h</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_a253f82b1d05114d435979a52c7875813"><div class="ttname"><a href="mqtt__client_8c.html#a253f82b1d05114d435979a52c7875813">mqtt_client_deinit</a></div><div class="ttdeci">void mqtt_client_deinit(MQTT_CLIENT_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l00923">mqtt_client.c:923</a></div></div>
<div class="ttc" id="axio_8c_html_a42cdddeb35bf5a6d45a4a730b1b9e4a5"><div class="ttname"><a href="xio_8c.html#a42cdddeb35bf5a6d45a4a730b1b9e4a5">xio_retrieveoptions</a></div><div class="ttdeci">OPTIONHANDLER_HANDLE xio_retrieveoptions(XIO_HANDLE xio)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8c_source.html#l00256">xio.c:256</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html_aaea729ba9adb6532bf418c0fe54df6dd"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html#aaea729ba9adb6532bf418c0fe54df6dd">MQTT_CLIENT_OPTIONS_TAG::password</a></div><div class="ttdeci">char * password</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00058">mqttconst.h:58</a></div></div>
<div class="ttc" id="aunity__fixture__malloc__overrides_8h_html_acf143577800376dd931c059ecc61ba06"><div class="ttname"><a href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a></div><div class="ttdeci">#define malloc</div><div class="ttdef"><b>Definition:</b> <a href="unity__fixture__malloc__overrides_8h_source.html#l00038">unity_fixture_malloc_overrides.h:37</a></div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_a3e4877f0d8a7f9c150b2f49045cd751c"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a3e4877f0d8a7f9c150b2f49045cd751c">MQTT_DEVICE_TWIN_ITEM_TAG::iothub_type</a></div><div class="ttdeci">IOTHUB_IDENTITY_TYPE iothub_type</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00211">iothubtransport_mqtt_common.c:211</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a35665d241984eff7e3ab14b0188d4ba8"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a35665d241984eff7e3ab14b0188d4ba8">UNSUBSCRIBE_FROM_TOPIC</a></div><div class="ttdeci">#define UNSUBSCRIBE_FROM_TOPIC</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00081">iothubtransport_mqtt_common.c:80</a></div></div>
<div class="ttc" id="atickcounter_8h_html_a9ddfa2ac37b8109d6afb1f6432d651a7"><div class="ttname"><a href="tickcounter_8h.html#a9ddfa2ac37b8109d6afb1f6432d651a7">tickcounter_ms_t</a></div><div class="ttdeci">uint_fast32_t tickcounter_ms_t</div><div class="ttdef"><b>Definition:</b> <a href="tickcounter_8h_source.html#l00015">tickcounter.h:15</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html_a25454feb36c6d1b3cf56ac61dfdb53f6"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html#a25454feb36c6d1b3cf56ac61dfdb53f6">MQTT_CLIENT_OPTIONS_TAG::qualityOfServiceValue</a></div><div class="ttdeci">QOS_VALUE qualityOfServiceValue</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00062">mqttconst.h:62</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a5e876bed0b075e30903a560fa1e18449"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a5e876bed0b075e30903a560fa1e18449">IoTHubTransport_MQTT_Common_Unregister</a></div><div class="ttdeci">void IoTHubTransport_MQTT_Common_Unregister(IOTHUB_DEVICE_HANDLE deviceHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02769">iothubtransport_mqtt_common.c:2769</a></div></div>
<div class="ttc" id="aiothub__transport__ll_8h_html_aa36432c979d5d8bb6adaaa3ec2a74933"><div class="ttname"><a href="iothub__transport__ll_8h.html#aa36432c979d5d8bb6adaaa3ec2a74933">TRANSPORT_LL_HANDLE</a></div><div class="ttdeci">void * TRANSPORT_LL_HANDLE</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00008">iothub_transport_ll.h:8</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a47c0d7b06e69bb49120cfde55283fcc7"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a47c0d7b06e69bb49120cfde55283fcc7">MQTTTRANSPORT_HANDLE_DATA_TAG::connectTick</a></div><div class="ttdeci">tickcounter_ms_t connectTick</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00177">iothubtransport_mqtt_common.c:177</a></div></div>
<div class="ttc" id="ashared__util__options_8h_html"><div class="ttname"><a href="shared__util__options_8h.html">shared_util_options.h</a></div></div>
<div class="ttc" id="aunionIOTHUB__IDENTITY__INFO__TAG_html_a8de54ec066823f63fffeb477b640b981"><div class="ttname"><a href="unionIOTHUB__IDENTITY__INFO__TAG.html#a8de54ec066823f63fffeb477b640b981">IOTHUB_IDENTITY_INFO_TAG::device_twin</a></div><div class="ttdeci">IOTHUB_DEVICE_TWIN * device_twin</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00070">iothub_client_private.h:70</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ab7a8d534901b729208c722be6e7b3b75"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab7a8d534901b729208c722be6e7b3b75">MQTTTRANSPORT_HANDLE_DATA_TAG::authorization_module</a></div><div class="ttdeci">IOTHUB_AUTHORIZATION_HANDLE authorization_module</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00198">iothubtransport_mqtt_common.c:198</a></div></div>
<div class="ttc" id="astructSYSTEM__PROPERTY__INFO__TAG_html_a9a1a3a891a6c8370f6b9b603f45438b7"><div class="ttname"><a href="structSYSTEM__PROPERTY__INFO__TAG.html#a9a1a3a891a6c8370f6b9b603f45438b7">SYSTEM_PROPERTY_INFO_TAG::propLength</a></div><div class="ttdeci">size_t propLength</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00093">iothubtransport_mqtt_common.c:93</a></div></div>
<div class="ttc" id="astructMQTT__MESSAGE__DETAILS__LIST__TAG_html_aeea81301af4eef081f83323e896c6aeb"><div class="ttname"><a href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html#aeea81301af4eef081f83323e896c6aeb">MQTT_MESSAGE_DETAILS_LIST_TAG::iotHubMessageEntry</a></div><div class="ttdeci">IOTHUB_MESSAGE_LIST * iotHubMessageEntry</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00223">iothubtransport_mqtt_common.c:223</a></div></div>
<div class="ttc" id="amqttconst_8h_html_aa393db33c1dfb0ce811219ce02e08e61a64078d6ef772f59c0f74510c377641c3"><div class="ttname"><a href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a64078d6ef772f59c0f74510c377641c3">CONN_REFUSED_UNKNOWN</a></div><div class="ttdeci">@ CONN_REFUSED_UNKNOWN</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00075">mqttconst.h:74</a></div></div>
<div class="ttc" id="astrings_8c_html_ae97f94b5ef464ef7b5fdcf0fb6eb6bf1"><div class="ttname"><a href="strings_8c.html#ae97f94b5ef464ef7b5fdcf0fb6eb6bf1">STRING_concat</a></div><div class="ttdeci">int STRING_concat(STRING_HANDLE handle, const char *s2)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00367">strings.c:367</a></div></div>
<div class="ttc" id="alibraries_2AzureIoT_2src_2az__iot_2umqtt_2inc_2azure__umqtt__c_2mqtt__client_8h_html"><div class="ttname"><a href="libraries_2AzureIoT_2src_2az__iot_2umqtt_2inc_2azure__umqtt__c_2mqtt__client_8h.html">mqtt_client.h</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a2ab3ca33bc3e2806ef0e08b7e1629a1a"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a2ab3ca33bc3e2806ef0e08b7e1629a1a">MQTT_DEVICE_TWIN_ITEM</a></div><div class="ttdeci">struct MQTT_DEVICE_TWIN_ITEM_TAG MQTT_DEVICE_TWIN_ITEM</div></div>
<div class="ttc" id="amqtt__client_8c_html_a9ec68776c1334e5c5d5e93251151d626"><div class="ttname"><a href="mqtt__client_8c.html#a9ec68776c1334e5c5d5e93251151d626">mqtt_client_connect</a></div><div class="ttdeci">int mqtt_client_connect(MQTT_CLIENT_HANDLE handle, XIO_HANDLE xioHandle, MQTT_CLIENT_OPTIONS *mqttOptions)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l00937">mqtt_client.c:937</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html">MQTTTRANSPORT_HANDLE_DATA_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00130">iothubtransport_mqtt_common.c:131</a></div></div>
<div class="ttc" id="astructDLIST__ENTRY__TAG_html"><div class="ttname"><a href="structDLIST__ENTRY__TAG.html">DLIST_ENTRY_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8h_source.html#l00018">doublylinkedlist.h:19</a></div></div>
<div class="ttc" id="aiothub__client__authorization_8c_html_a2516a8e0730fe2f737f7d26b680f5256"><div class="ttname"><a href="iothub__client__authorization_8c.html#a2516a8e0730fe2f737f7d26b680f5256">IoTHubClient_Auth_Get_DeviceKey</a></div><div class="ttdeci">const char * IoTHubClient_Auth_Get_DeviceKey(IOTHUB_AUTHORIZATION_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__authorization_8c_source.html#l00432">iothub_client_authorization.c:432</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_af7f5a8ae38ba9fcc2b0d0c32c6cabcab"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af7f5a8ae38ba9fcc2b0d0c32c6cabcab">MQTTTRANSPORT_HANDLE_DATA_TAG::topic_MqttMessage</a></div><div class="ttdeci">STRING_HANDLE topic_MqttMessage</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00134">iothubtransport_mqtt_common.c:134</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a7a21b708e41e489dcbbaf0a91dfde8ee"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a7a21b708e41e489dcbbaf0a91dfde8ee">MQTTTRANSPORT_HANDLE_DATA_TAG::llClientHandle</a></div><div class="ttdeci">IOTHUB_CLIENT_LL_HANDLE llClientHandle</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00159">iothubtransport_mqtt_common.c:159</a></div></div>
<div class="ttc" id="aiothub__client__retry__control_8h_html_a44ee4bf0af2bfa80f9e2680f4247ebba"><div class="ttname"><a href="iothub__client__retry__control_8h.html#a44ee4bf0af2bfa80f9e2680f4247ebba">RETRY_ACTION</a></div><div class="ttdeci">enum RETRY_ACTION_TAG RETRY_ACTION</div></div>
<div class="ttc" id="astructSUBSCRIBE__ACK__TAG_html_ab2b68fad7dbe2f3cf5b72ede65a10768"><div class="ttname"><a href="structSUBSCRIBE__ACK__TAG.html#ab2b68fad7dbe2f3cf5b72ede65a10768">SUBSCRIBE_ACK_TAG::qosReturn</a></div><div class="ttdeci">QOS_VALUE * qosReturn</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00092">mqttconst.h:92</a></div></div>
<div class="ttc" id="aoptionhandler_8c_html_a4b32e141221e6cdfaa44ac5e0e87711f"><div class="ttname"><a href="optionhandler_8c.html#a4b32e141221e6cdfaa44ac5e0e87711f">OptionHandler_Destroy</a></div><div class="ttdeci">void OptionHandler_Destroy(OPTIONHANDLER_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="optionhandler_8c_source.html#l00257">optionhandler.c:257</a></div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html">MQTT_DEVICE_TWIN_ITEM_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00207">iothubtransport_mqtt_common.c:208</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a19c1223d5f5b9e3cf901ce2d2a657b74"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a19c1223d5f5b9e3cf901ce2d2a657b74">STATUS_CODE_TIMEOUT_VALUE</a></div><div class="ttdeci">#define STATUS_CODE_TIMEOUT_VALUE</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00050">iothubtransport_mqtt_common.c:49</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a9dcca736d0691d77478439ecc05b4526"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9dcca736d0691d77478439ecc05b4526">MQTTTRANSPORT_HANDLE_DATA_TAG::isDestroyCalled</a></div><div class="ttdeci">bool isDestroyCalled</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00171">iothubtransport_mqtt_common.c:171</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a2d2ab9657cc946c76cb9fd383cbc510a"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a2d2ab9657cc946c76cb9fd383cbc510a">SUBSCRIBE_TELEMETRY_TOPIC</a></div><div class="ttdeci">#define SUBSCRIBE_TELEMETRY_TOPIC</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00084">iothubtransport_mqtt_common.c:83</a></div></div>
<div class="ttc" id="amap_8c_html_ac97e499fa2f9b6830679e519185cd260"><div class="ttname"><a href="map_8c.html#ac97e499fa2f9b6830679e519185cd260">Map_GetInternals</a></div><div class="ttdeci">MAP_RESULT Map_GetInternals(MAP_HANDLE handle, const char *const **keys, const char *const **values, size_t *count)</div><div class="ttdef"><b>Definition:</b> <a href="map_8c_source.html#l00559">map.c:559</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_aa5871196da7d7da7b2d2e7f9f4a55731"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aa5871196da7d7da7b2d2e7f9f4a55731">MQTTTRANSPORT_HANDLE_DATA_TAG::device_id</a></div><div class="ttdeci">STRING_HANDLE device_id</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00144">iothubtransport_mqtt_common.c:144</a></div></div>
<div class="ttc" id="astructIOTHUB__DEVICE__CONFIG__TAG_html_a87e34933a1a56a42bcf0e77df365bd76"><div class="ttname"><a href="structIOTHUB__DEVICE__CONFIG__TAG.html#a87e34933a1a56a42bcf0e77df365bd76">IOTHUB_DEVICE_CONFIG_TAG::deviceSasToken</a></div><div class="ttdeci">const char * deviceSasToken</div><div class="ttdoc">The device SAS used to authenticate the device in place of using the device key.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00049">iothub_transport_ll.h:49</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_ab3db6de666d01e3d5730e1d2db592832"><div class="ttname"><a href="iothub__message_8c.html#ab3db6de666d01e3d5730e1d2db592832">IoTHubMessage_GetContentEncodingSystemProperty</a></div><div class="ttdeci">const char * IoTHubMessage_GetContentEncodingSystemProperty(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00655">iothub_message.c:655</a></div></div>
<div class="ttc" id="astring__tokenizer_8c_html_a2032010d1f316263b1d1692bafce9888"><div class="ttname"><a href="string__tokenizer_8c.html#a2032010d1f316263b1d1692bafce9888">STRING_TOKENIZER_create_from_char</a></div><div class="ttdeci">STRING_TOKENIZER_HANDLE STRING_TOKENIZER_create_from_char(const char *input)</div><div class="ttdef"><b>Definition:</b> <a href="string__tokenizer_8c_source.html#l00038">string_tokenizer.c:38</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_ab01841e548f7119ab833be50695de241"><div class="ttname"><a href="iothub__message_8c.html#ab01841e548f7119ab833be50695de241">IoTHubMessage_GetContentTypeSystemProperty</a></div><div class="ttdeci">const char * IoTHubMessage_GetContentTypeSystemProperty(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00597">iothub_message.c:597</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a8f3836e19c295f06c2387c8d9af9cc2c"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a8f3836e19c295f06c2387c8d9af9cc2c">IoTHubTransport_MQTT_Common_Unsubscribe</a></div><div class="ttdeci">void IoTHubTransport_MQTT_Common_Unsubscribe(IOTHUB_DEVICE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02286">iothubtransport_mqtt_common.c:2286</a></div></div>
<div class="ttc" id="axio_8c_html_acf7bf0887a6f4a203740745d27d21bb1"><div class="ttname"><a href="xio_8c.html#acf7bf0887a6f4a203740745d27d21bb1">xio_destroy</a></div><div class="ttdeci">void xio_destroy(XIO_HANDLE xio)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8c_source.html#l00060">xio.c:60</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html_a5ab252353b669743ca47d186da92af48"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html#a5ab252353b669743ca47d186da92af48">MQTT_CLIENT_OPTIONS_TAG::useCleanSession</a></div><div class="ttdeci">bool useCleanSession</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00061">mqttconst.h:61</a></div></div>
<div class="ttc" id="adoublylinkedlist_8c_html_a2a48601508bb4df122026cfe7d90109d"><div class="ttname"><a href="doublylinkedlist_8c.html#a2a48601508bb4df122026cfe7d90109d">DList_RemoveEntryList</a></div><div class="ttdeci">int DList_RemoveEntryList(PDLIST_ENTRY Entry)</div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8c_source.html#l00027">doublylinkedlist.c:27</a></div></div>
<div class="ttc" id="astrings_8c_html_ad091a0c95f3dcf64d9f0c242744b464d"><div class="ttname"><a href="strings_8c.html#ad091a0c95f3dcf64d9f0c242744b464d">STRING_construct</a></div><div class="ttdeci">STRING_HANDLE STRING_construct(const char *psz)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00087">strings.c:87</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a2c60bfa3b3743b25707510364154779e"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a2c60bfa3b3743b25707510364154779e">MQTTTRANSPORT_HANDLE_DATA_TAG::keepAliveValue</a></div><div class="ttdeci">uint16_t keepAliveValue</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00174">iothubtransport_mqtt_common.c:174</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a07488a0c591bfe49d015b8ed68303053"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a07488a0c591bfe49d015b8ed68303053">DEVICE_TWIN_MSG_TYPE_TAG</a></div><div class="ttdeci">DEVICE_TWIN_MSG_TYPE_TAG</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00109">iothubtransport_mqtt_common.c:110</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a017a281f3f8c13979235d06c952bf7d0"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a017a281f3f8c13979235d06c952bf7d0">MQTTTRANSPORT_HANDLE_DATA_TAG::mqttClientStatus</a></div><div class="ttdeci">MQTT_CLIENT_STATUS mqttClientStatus</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00170">iothubtransport_mqtt_common.c:170</a></div></div>
<div class="ttc" id="astdint_8h_html_a0238af00180b6d9278fa1c6aa790fdf4"><div class="ttname"><a href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a></div><div class="ttdeci">__uint32_t uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00045">stdint.h:45</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_ada4fa36e8ab3af2759a6e5703d55dc29"><div class="ttname"><a href="iothub__message_8c.html#ada4fa36e8ab3af2759a6e5703d55dc29">IoTHubMessage_GetMessageId</a></div><div class="ttdeci">const char * IoTHubMessage_GetMessageId(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00542">iothub_message.c:542</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_a3d5f3d8a6da59b259f170de613c61cc0"><div class="ttname"><a href="iothub__message_8c.html#a3d5f3d8a6da59b259f170de613c61cc0">IoTHubMessage_SetMessageId</a></div><div class="ttdeci">IOTHUB_MESSAGE_RESULT IoTHubMessage_SetMessageId(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle, const char *messageId)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00510">iothub_message.c:510</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a6781b97d6acc03e7bf1c9d619f98abad"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a6781b97d6acc03e7bf1c9d619f98abad">DEFAULT_RETRY_TIMEOUT_IN_SECONDS</a></div><div class="ttdeci">#define DEFAULT_RETRY_TIMEOUT_IN_SECONDS</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00053">iothubtransport_mqtt_common.c:52</a></div></div>
<div class="ttc" id="acJSON__Utils_8h_html_a0dff3c76a075649fa412b1c429ffe382"><div class="ttname"><a href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a></div><div class="ttdeci">const char *const const char *const const cJSON *const value</div><div class="ttdef"><b>Definition:</b> <a href="cJSON__Utils_8h_source.html#l00042">cJSON_Utils.h:42</a></div></div>
<div class="ttc" id="adoublylinkedlist_8c_html_a19216dad2b49004f6a1bcbf433f85201"><div class="ttname"><a href="doublylinkedlist_8c.html#a19216dad2b49004f6a1bcbf433f85201">DList_RemoveHeadList</a></div><div class="ttdeci">PDLIST_ENTRY DList_RemoveHeadList(PDLIST_ENTRY ListHead)</div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8c_source.html#l00046">doublylinkedlist.c:46</a></div></div>
<div class="ttc" id="astructoption_html"><div class="ttname"><a href="structoption.html">option</a></div><div class="ttdef"><b>Definition:</b> <a href="components_2arduino-esp32_2tools_2sdk_2include_2newlib_2getopt_8h_source.html#l00105">getopt.h:106</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ac137ee6d73d2610092cda83c5c0c7226"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ac137ee6d73d2610092cda83c5c0c7226">MQTT_CLIENT_STATUS</a></div><div class="ttdeci">enum MQTT_CLIENT_STATUS_TAG MQTT_CLIENT_STATUS</div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a826b9a63aee7138a05a1c8fedf0240c0a6b23a6df07a7072975fb1c55a7c93600"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a6b23a6df07a7072975fb1c55a7c93600">DEVICE_KEY</a></div><div class="ttdeci">@ DEVICE_KEY</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00120">iothubtransport_mqtt_common.c:120</a></div></div>
<div class="ttc" id="atickcounter_8c_html_a58975c98066c833f9a78ec40f8a9da51"><div class="ttname"><a href="tickcounter_8c.html#a58975c98066c833f9a78ec40f8a9da51">tickcounter_create</a></div><div class="ttdeci">TICK_COUNTER_HANDLE tickcounter_create(void)</div><div class="ttdef"><b>Definition:</b> <a href="tickcounter_8c_source.html#l00023">tickcounter.c:23</a></div></div>
<div class="ttc" id="acrt__abstractions_8h_html"><div class="ttname"><a href="crt__abstractions_8h.html">crt_abstractions.h</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a7f290bee42e3871e80bdad7432fb1df9"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a7f290bee42e3871e80bdad7432fb1df9">SUBSCRIBE_NOTIFICATION_STATE_TOPIC</a></div><div class="ttdeci">#define SUBSCRIBE_NOTIFICATION_STATE_TOPIC</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00083">iothubtransport_mqtt_common.c:82</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html">MQTT_CLIENT_OPTIONS_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00052">mqttconst.h:53</a></div></div>
<div class="ttc" id="astructIOTHUB__DEVICE__CONFIG__TAG_html_a86dab4b782bc2e22300e256a126484a2"><div class="ttname"><a href="structIOTHUB__DEVICE__CONFIG__TAG.html#a86dab4b782bc2e22300e256a126484a2">IOTHUB_DEVICE_CONFIG_TAG::deviceId</a></div><div class="ttdeci">const char * deviceId</div><div class="ttdoc">A string that identifies the device.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00043">iothub_transport_ll.h:43</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a340db2681e4ab55c3994f84a0a580911"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a340db2681e4ab55c3994f84a0a580911">IoTHubTransport_MQTT_Common_Register</a></div><div class="ttdeci">IOTHUB_DEVICE_HANDLE IoTHubTransport_MQTT_Common_Register(TRANSPORT_LL_HANDLE handle, const IOTHUB_DEVICE_CONFIG *device, IOTHUB_CLIENT_LL_HANDLE iotHubClientHandle, PDLIST_ENTRY waitingToSend)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02707">iothubtransport_mqtt_common.c:2707</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a60afc0a2e32dc67731e11894f9ba3381"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a60afc0a2e32dc67731e11894f9ba3381">IoTHubTransport_MQTT_Common_Create</a></div><div class="ttdeci">TRANSPORT_LL_HANDLE IoTHubTransport_MQTT_Common_Create(const IOTHUBTRANSPORT_CONFIG *config, MQTT_GET_IO_TRANSPORT get_io_transport)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l01912">iothubtransport_mqtt_common.c:1912</a></div></div>
<div class="ttc" id="agballoc_8h_html"><div class="ttname"><a href="gballoc_8h.html">gballoc.h</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html_a6b559edc71ff3b0e8d9f9840cb36b27c"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html#a6b559edc71ff3b0e8d9f9840cb36b27c">IOTHUB_CLIENT_CONFIG_TAG::iotHubName</a></div><div class="ttdeci">const char * iotHubName</div><div class="ttdoc">The IoT Hub name to which the device is connecting.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00196">iothub_client_ll.h:196</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_a7d9e8d71c27f2f4150d477431aeaaa54"><div class="ttname"><a href="mqtt__client_8c.html#a7d9e8d71c27f2f4150d477431aeaaa54">mqtt_client_init</a></div><div class="ttdeci">MQTT_CLIENT_HANDLE mqtt_client_init(ON_MQTT_MESSAGE_RECV_CALLBACK msgRecv, ON_MQTT_OPERATION_CALLBACK opCallback, void *opCallbackCtx, ON_MQTT_ERROR_CALLBACK onErrorCallBack, void *errorCBCtx)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l00870">mqtt_client.c:870</a></div></div>
<div class="ttc" id="amqttconst_8h_html_aa393db33c1dfb0ce811219ce02e08e61afb522d125f454b5343f746711327949d"><div class="ttname"><a href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61afb522d125f454b5343f746711327949d">CONN_REFUSED_BAD_USERNAME_PASSWORD</a></div><div class="ttdeci">@ CONN_REFUSED_BAD_USERNAME_PASSWORD</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00072">mqttconst.h:72</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a6e01c323589f14aa916d47a9dbf5acbd"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a6e01c323589f14aa916d47a9dbf5acbd">MQTTTRANSPORT_HANDLE_DATA_TAG::topic_GetState</a></div><div class="ttdeci">STRING_HANDLE topic_GetState</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00135">iothubtransport_mqtt_common.c:135</a></div></div>
<div class="ttc" id="amqttconst_8h_html_acebcb96b6f2b1dc376db101b5b763a26"><div class="ttname"><a href="mqttconst_8h.html#acebcb96b6f2b1dc376db101b5b763a26">CONNECT_RETURN_CODE</a></div><div class="ttdeci">enum CONNECT_RETURN_CODE_TAG CONNECT_RETURN_CODE</div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ae47738116e8e6c4a0b93b9a64d6f8a37"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ae47738116e8e6c4a0b93b9a64d6f8a37">IoTHubTransport_MQTT_Common_GetHostname</a></div><div class="ttdeci">STRING_HANDLE IoTHubTransport_MQTT_Common_GetHostname(TRANSPORT_LL_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02780">iothubtransport_mqtt_common.c:2780</a></div></div>
<div class="ttc" id="astructMQTT__CLIENT__OPTIONS__TAG_html_ac5fc4be196b6b3429a9f6d401adcf015"><div class="ttname"><a href="structMQTT__CLIENT__OPTIONS__TAG.html#ac5fc4be196b6b3429a9f6d401adcf015">MQTT_CLIENT_OPTIONS_TAG::username</a></div><div class="ttdeci">char * username</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00057">mqttconst.h:57</a></div></div>
<div class="ttc" id="aiothub__client__retry__control_8h_html_ad23f3b31478edd6be6b7692a332a3bd7ab67743fc9afefaeebb627ae9473724ae"><div class="ttname"><a href="iothub__client__retry__control_8h.html#ad23f3b31478edd6be6b7692a332a3bd7ab67743fc9afefaeebb627ae9473724ae">RETRY_ACTION_RETRY_NOW</a></div><div class="ttdeci">@ RETRY_ACTION_RETRY_NOW</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__retry__control_8h_source.html#l00024">iothub_client_retry_control.h:24</a></div></div>
<div class="ttc" id="amqttconst_8h_html_aa393db33c1dfb0ce811219ce02e08e61ad7ad3f0642483fa35a79b11e2e60f767"><div class="ttname"><a href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61ad7ad3f0642483fa35a79b11e2e60f767">CONN_REFUSED_SERVER_UNAVAIL</a></div><div class="ttdeci">@ CONN_REFUSED_SERVER_UNAVAIL</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00071">mqttconst.h:71</a></div></div>
<div class="ttc" id="astructentry_html"><div class="ttname"><a href="structentry.html">entry</a></div><div class="ttdef"><b>Definition:</b> <a href="search_8h_source.html#l00016">search.h:16</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_a46bb7da64768d0bae997366dd8d022d6"><div class="ttname"><a href="mqtt__client_8c.html#a46bb7da64768d0bae997366dd8d022d6">mqtt_client_set_trace</a></div><div class="ttdeci">void mqtt_client_set_trace(MQTT_CLIENT_HANDLE handle, bool traceOn, bool rawBytesOn)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l01250">mqtt_client.c:1250</a></div></div>
<div class="ttc" id="astructDEVICE__METHOD__INFO__TAG_html_a12942fec616c65819dcd00c94006b20d"><div class="ttname"><a href="structDEVICE__METHOD__INFO__TAG.html#a12942fec616c65819dcd00c94006b20d">DEVICE_METHOD_INFO_TAG::request_id</a></div><div class="ttdeci">STRING_HANDLE request_id</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00231">iothubtransport_mqtt_common.c:231</a></div></div>
<div class="ttc" id="aurlencode_8h_html"><div class="ttname"><a href="urlencode_8h.html">urlencode.h</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a45e0394a54942a331c09a89db95ddded"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a45e0394a54942a331c09a89db95ddded">MQTTTRANSPORT_HANDLE_DATA_TAG::telemetry_waitingForAck</a></div><div class="ttdeci">DLIST_ENTRY telemetry_waitingForAck</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00191">iothubtransport_mqtt_common.c:191</a></div></div>
<div class="ttc" id="astrings_8c_html_a351a84891e778e497c7eafa76bd02cd0"><div class="ttname"><a href="strings_8c.html#a351a84891e778e497c7eafa76bd02cd0">STRING_c_str</a></div><div class="ttdeci">const char * STRING_c_str(STRING_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00667">strings.c:667</a></div></div>
<div class="ttc" id="acomponents_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h_html"><div class="ttname"><a href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html">strings.h</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a35279fbd52274c99a0d972d377c9cc97"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a35279fbd52274c99a0d972d377c9cc97">MQTTTRANSPORT_HANDLE_DATA_TAG::connectFailCount</a></div><div class="ttdeci">size_t connectFailCount</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00176">iothubtransport_mqtt_common.c:176</a></div></div>
<div class="ttc" id="astructIOTHUB__MESSAGE__LIST__TAG_html"><div class="ttname"><a href="structIOTHUB__MESSAGE__LIST__TAG.html">IOTHUB_MESSAGE_LIST_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00047">iothub_client_private.h:48</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a483c15ac99b09da35b40ad0c7455f3e0"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a483c15ac99b09da35b40ad0c7455f3e0">MQTTTRANSPORT_HANDLE_DATA_TAG::http_proxy_port</a></div><div class="ttdeci">int http_proxy_port</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00201">iothubtransport_mqtt_common.c:201</a></div></div>
<div class="ttc" id="astructMQTT__TRANSPORT__PROXY__OPTIONS__TAG_html_a3545f76f314f3bf2d06bcd66c866e4fd"><div class="ttname"><a href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a3545f76f314f3bf2d06bcd66c866e4fd">MQTT_TRANSPORT_PROXY_OPTIONS_TAG::username</a></div><div class="ttdeci">const char * username</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8h_source.html#l00019">iothubtransport_mqtt_common.h:19</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html">IOTHUB_CLIENT_CONFIG_TAG</a></div><div class="ttdoc">This struct captures IoTHub client configuration.</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00176">iothub_client_ll.h:177</a></div></div>
<div class="ttc" id="astructCONSTBUFFER__TAG_html"><div class="ttname"><a href="structCONSTBUFFER__TAG.html">CONSTBUFFER_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="constbuffer_8h_source.html#l00023">constbuffer.h:24</a></div></div>
<div class="ttc" id="astructSUBSCRIBE__PAYLOAD__TAG_html_a528534ecd9c6c7d6ed5736c810519a88"><div class="ttname"><a href="structSUBSCRIBE__PAYLOAD__TAG.html#a528534ecd9c6c7d6ed5736c810519a88">SUBSCRIBE_PAYLOAD_TAG::qosReturn</a></div><div class="ttdeci">QOS_VALUE qosReturn</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00086">mqttconst.h:86</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ad7809e79d2e9e3ef3f471393511ea161"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ad7809e79d2e9e3ef3f471393511ea161">MQTTTRANSPORT_HANDLE_DATA_TAG::devicesPath</a></div><div class="ttdeci">STRING_HANDLE devicesPath</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00145">iothubtransport_mqtt_common.c:145</a></div></div>
<div class="ttc" id="axlogging_8h_html_aec0857f05ae0368bb1cb6efdc63cd420"><div class="ttname"><a href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a></div><div class="ttdeci">#define LogError(FORMAT,...)</div><div class="ttdef"><b>Definition:</b> <a href="xlogging_8h_source.html#l00164">xlogging.h:163</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_ab35559cad3fe52707903b31e1a7ab837"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#ab35559cad3fe52707903b31e1a7ab837">MQTTTRANSPORT_HANDLE_DATA_TAG::http_proxy_hostname</a></div><div class="ttdeci">char * http_proxy_hostname</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00200">iothubtransport_mqtt_common.c:200</a></div></div>
<div class="ttc" id="aunionIOTHUB__IDENTITY__INFO__TAG_html"><div class="ttname"><a href="unionIOTHUB__IDENTITY__INFO__TAG.html">IOTHUB_IDENTITY_INFO_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00068">iothub_client_private.h:69</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_aebe4a395f23a2e353ed6c17770a5cec6"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#aebe4a395f23a2e353ed6c17770a5cec6">SAS_REFRESH_MULTIPLIER</a></div><div class="ttdeci">#define SAS_REFRESH_MULTIPLIER</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00040">iothubtransport_mqtt_common.c:39</a></div></div>
<div class="ttc" id="adoublylinkedlist_8c_html_a682ace80db3a8d5af3ba733320f31303"><div class="ttname"><a href="doublylinkedlist_8c.html#a682ace80db3a8d5af3ba733320f31303">DList_InitializeListHead</a></div><div class="ttdeci">void DList_InitializeListHead(PDLIST_ENTRY ListHead)</div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8c_source.html#l00007">doublylinkedlist.c:7</a></div></div>
<div class="ttc" id="astructstate_html"><div class="ttname"><a href="structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="tinyexpr_8c_source.html#l00064">tinyexpr.c:64</a></div></div>
<div class="ttc" id="axio_8c_html_ab842aa9de72d9359ac059be7428c59d5"><div class="ttname"><a href="xio_8c.html#ab842aa9de72d9359ac059be7428c59d5">xio_setoption</a></div><div class="ttdeci">int xio_setoption(XIO_HANDLE xio, const char *optionName, const void *value)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8c_source.html#l00169">xio.c:169</a></div></div>
<div class="ttc" id="amqttconst_8h_html_aa393db33c1dfb0ce811219ce02e08e61a0f5ba76cc3adf64c3f79f71d1cfe226e"><div class="ttname"><a href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61a0f5ba76cc3adf64c3f79f71d1cfe226e">CONN_REFUSED_UNACCEPTABLE_VERSION</a></div><div class="ttdeci">@ CONN_REFUSED_UNACCEPTABLE_VERSION</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00069">mqttconst.h:69</a></div></div>
<div class="ttc" id="astructIOTHUB__DEVICE__TWIN__TAG_html"><div class="ttname"><a href="structIOTHUB__DEVICE__TWIN__TAG.html">IOTHUB_DEVICE_TWIN_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00056">iothub_client_private.h:57</a></div></div>
<div class="ttc" id="axlogging_8h_html"><div class="ttname"><a href="xlogging_8h.html">xlogging.h</a></div></div>
<div class="ttc" id="astrings_8c_html_ac700e7a0a099bc7ac42abba74b9fd874"><div class="ttname"><a href="strings_8c.html#ac700e7a0a099bc7ac42abba74b9fd874">STRING_clone</a></div><div class="ttdeci">STRING_HANDLE STRING_clone(STRING_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00052">strings.c:52</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_abd67ff5af5ba27a444381a59b9db32c1"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#abd67ff5af5ba27a444381a59b9db32c1">MQTTTRANSPORT_HANDLE_DATA_TAG::saved_tls_options</a></div><div class="ttdeci">OPTIONHANDLER_HANDLE saved_tls_options</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00181">iothubtransport_mqtt_common.c:181</a></div></div>
<div class="ttc" id="astructIOTHUB__AUTHORIZATION__DATA__TAG_html"><div class="ttname"><a href="structIOTHUB__AUTHORIZATION__DATA__TAG.html">IOTHUB_AUTHORIZATION_DATA_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__authorization_8c_source.html#l00024">iothub_client_authorization.c:25</a></div></div>
<div class="ttc" id="astructSUBSCRIBE__ACK__TAG_html_aeb753dc68343430d63c4a332ab4e13a3"><div class="ttname"><a href="structSUBSCRIBE__ACK__TAG.html#aeb753dc68343430d63c4a332ab4e13a3">SUBSCRIBE_ACK_TAG::qosCount</a></div><div class="ttdeci">size_t qosCount</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00093">mqttconst.h:93</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a28f1b4f0886bfaf9a00796612117879e"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a28f1b4f0886bfaf9a00796612117879e">SUBSCRIBE_GET_REPORTED_STATE_TOPIC</a></div><div class="ttdeci">#define SUBSCRIBE_GET_REPORTED_STATE_TOPIC</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00082">iothubtransport_mqtt_common.c:81</a></div></div>
<div class="ttc" id="adoublylinkedlist_8c_html_aaab37bb1e203dc4dc3d259cdea440a92"><div class="ttname"><a href="doublylinkedlist_8c.html#aaab37bb1e203dc4dc3d259cdea440a92">DList_IsListEmpty</a></div><div class="ttdeci">int DList_IsListEmpty(const PDLIST_ENTRY ListHead)</div><div class="ttdef"><b>Definition:</b> <a href="doublylinkedlist_8c_source.html#l00017">doublylinkedlist.c:17</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_a98bf6bb3417212c2d8d79bcb068d0dc3"><div class="ttname"><a href="mqtt__client_8c.html#a98bf6bb3417212c2d8d79bcb068d0dc3">mqtt_client_unsubscribe</a></div><div class="ttdeci">int mqtt_client_unsubscribe(MQTT_CLIENT_HANDLE handle, uint16_t packetId, const char **unsubscribeList, size_t count)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l01097">mqtt_client.c:1097</a></div></div>
<div class="ttc" id="astructPUBLISH__ACK__TAG_html"><div class="ttname"><a href="structPUBLISH__ACK__TAG.html">PUBLISH_ACK_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00101">mqttconst.h:102</a></div></div>
<div class="ttc" id="astructAPP__PAYLOAD__TAG_html_a3bd2c590b04276f02341d3f1c03de5b6"><div class="ttname"><a href="structAPP__PAYLOAD__TAG.html#a3bd2c590b04276f02341d3f1c03de5b6">APP_PAYLOAD_TAG::message</a></div><div class="ttdeci">uint8_t * message</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00048">mqttconst.h:48</a></div></div>
<div class="ttc" id="aiothub__client__authorization_8c_html_a89cee2cc0727764f01e0835902cf8021"><div class="ttname"><a href="iothub__client__authorization_8c.html#a89cee2cc0727764f01e0835902cf8021">IoTHubClient_Auth_Is_SasToken_Valid</a></div><div class="ttdeci">SAS_TOKEN_STATUS IoTHubClient_Auth_Is_SasToken_Valid(IOTHUB_AUTHORIZATION_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__authorization_8c_source.html#l00449">iothub_client_authorization.c:449</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a826b9a63aee7138a05a1c8fedf0240c0a2567f06e779a42cde83533b1171617c3"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a2567f06e779a42cde83533b1171617c3">CREDENTIAL_NOT_BUILD</a></div><div class="ttdeci">@ CREDENTIAL_NOT_BUILD</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00117">iothubtransport_mqtt_common.c:117</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a9443e6b2d6efba9987b27600e9a41681"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a9443e6b2d6efba9987b27600e9a41681">MQTTTRANSPORT_HANDLE_DATA_TAG::http_proxy_username</a></div><div class="ttdeci">char * http_proxy_username</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00202">iothubtransport_mqtt_common.c:202</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_af03e0416fa3e66f3353ef4f1f1a8d08a"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#af03e0416fa3e66f3353ef4f1f1a8d08a">MQTTTRANSPORT_HANDLE_DATA_TAG::isProductInfoSet</a></div><div class="ttdeci">bool isProductInfoSet</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00204">iothubtransport_mqtt_common.c:204</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a60a7b7fa1d57870506d7c8198f2bf055"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a60a7b7fa1d57870506d7c8198f2bf055">IoTHubTransport_MQTT_Common_Destroy</a></div><div class="ttdeci">void IoTHubTransport_MQTT_Common_Destroy(TRANSPORT_LL_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l01990">iothubtransport_mqtt_common.c:1990</a></div></div>
<div class="ttc" id="amqtt__client_8c_html_ad25607626f5b458479b1b036bd5ece09"><div class="ttname"><a href="mqtt__client_8c.html#ad25607626f5b458479b1b036bd5ece09">mqtt_client_publish</a></div><div class="ttdeci">int mqtt_client_publish(MQTT_CLIENT_HANDLE handle, MQTT_MESSAGE_HANDLE msgHandle)</div><div class="ttdef"><b>Definition:</b> <a href="mqtt__client_8c_source.html#l00985">mqtt_client.c:985</a></div></div>
<div class="ttc" id="astructMQTT__TRANSPORT__PROXY__OPTIONS__TAG_html"><div class="ttname"><a href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html">MQTT_TRANSPORT_PROXY_OPTIONS_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8h_source.html#l00015">iothubtransport_mqtt_common.h:16</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_a5280afeeba67d2f6e6d4cde3e1b719bf"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#a5280afeeba67d2f6e6d4cde3e1b719bf">MQTTTRANSPORT_HANDLE_DATA_TAG::waitingToSend</a></div><div class="ttdeci">PDLIST_ENTRY waitingToSend</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00184">iothubtransport_mqtt_common.c:184</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a9850d77fc0d21328a61d514c66659f7f"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a9850d77fc0d21328a61d514c66659f7f">MQTT_TRANSPORT_CREDENTIAL_TYPE</a></div><div class="ttdeci">enum MQTT_TRANSPORT_CREDENTIAL_TYPE_TAG MQTT_TRANSPORT_CREDENTIAL_TYPE</div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_ad4bba49218323e0a70c72a6a6178457c"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#ad4bba49218323e0a70c72a6a6178457c">SYSTEM_PROPERTY_INFO</a></div><div class="ttdeci">struct SYSTEM_PROPERTY_INFO_TAG SYSTEM_PROPERTY_INFO</div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_acdf844cb29af3cc97a6d23aa60a0bc88"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#acdf844cb29af3cc97a6d23aa60a0bc88">MQTTTRANSPORT_HANDLE_DATA_TAG::topic_DeviceMethods</a></div><div class="ttdeci">STRING_HANDLE topic_DeviceMethods</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00138">iothubtransport_mqtt_common.c:138</a></div></div>
<div class="ttc" id="astructIOTHUBTRANSPORT__CONFIG__TAG_html_abd716d885797e2963c500c2315554ff7"><div class="ttname"><a href="structIOTHUBTRANSPORT__CONFIG__TAG.html#abd716d885797e2963c500c2315554ff7">IOTHUBTRANSPORT_CONFIG_TAG::waitingToSend</a></div><div class="ttdeci">PDLIST_ENTRY waitingToSend</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00232">iothub_client_ll.h:232</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a826b9a63aee7138a05a1c8fedf0240c0a8694381c253255173e2c9d72cba04144"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0a8694381c253255173e2c9d72cba04144">SAS_TOKEN_FROM_USER</a></div><div class="ttdeci">@ SAS_TOKEN_FROM_USER</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00119">iothubtransport_mqtt_common.c:119</a></div></div>
<div class="ttc" id="aiothub__client__retry__control_8h_html_ad23f3b31478edd6be6b7692a332a3bd7a1e97263c554fc2dcf72b36ff15b84d45"><div class="ttname"><a href="iothub__client__retry__control_8h.html#ad23f3b31478edd6be6b7692a332a3bd7a1e97263c554fc2dcf72b36ff15b84d45">RETRY_ACTION_RETRY_LATER</a></div><div class="ttdeci">@ RETRY_ACTION_RETRY_LATER</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__retry__control_8h_source.html#l00025">iothub_client_retry_control.h:25</a></div></div>
<div class="ttc" id="aoptionhandler_8c_html_afeea10981f7e63a37cb6af40c0a1bff4"><div class="ttname"><a href="optionhandler_8c.html#afeea10981f7e63a37cb6af40c0a1bff4">OptionHandler_FeedOptions</a></div><div class="ttdeci">OPTIONHANDLER_RESULT OptionHandler_FeedOptions(OPTIONHANDLER_HANDLE handle, void *destinationHandle)</div><div class="ttdef"><b>Definition:</b> <a href="optionhandler_8c_source.html#l00216">optionhandler.c:216</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_adc89704e51e8456f1322146438879d61"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#adc89704e51e8456f1322146438879d61">DEVICE_METHOD_INFO</a></div><div class="ttdeci">struct DEVICE_METHOD_INFO_TAG DEVICE_METHOD_INFO</div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_aa36f2858f563663b71d1d01d6136328a"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#aa36f2858f563663b71d1d01d6136328a">SAS_TOKEN_DEFAULT_LIFETIME</a></div><div class="ttdeci">#define SAS_TOKEN_DEFAULT_LIFETIME</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00039">iothubtransport_mqtt_common.c:38</a></div></div>
<div class="ttc" id="acJSON_8h_html_a03c83e0884e2e3a1783db79f2d67101f"><div class="ttname"><a href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a></div><div class="ttdeci">char const int length</div><div class="ttdef"><b>Definition:</b> <a href="cJSON_8h_source.html#l00161">cJSON.h:161</a></div></div>
<div class="ttc" id="astructSUBSCRIBE__PAYLOAD__TAG_html_a2d77b40f1e95f10bb0045fa167f127aa"><div class="ttname"><a href="structSUBSCRIBE__PAYLOAD__TAG.html#a2d77b40f1e95f10bb0045fa167f127aa">SUBSCRIBE_PAYLOAD_TAG::subscribeTopic</a></div><div class="ttdeci">const char * subscribeTopic</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00085">mqttconst.h:85</a></div></div>
<div class="ttc" id="astructMQTT__DEVICE__TWIN__ITEM__TAG_html_a33ad9a8ed280336798bfc025954bf0d9"><div class="ttname"><a href="structMQTT__DEVICE__TWIN__ITEM__TAG.html#a33ad9a8ed280336798bfc025954bf0d9">MQTT_DEVICE_TWIN_ITEM_TAG::packet_id</a></div><div class="ttdeci">uint16_t packet_id</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00212">iothubtransport_mqtt_common.c:212</a></div></div>
<div class="ttc" id="astructMQTTTRANSPORT__HANDLE__DATA__TAG_html_aef4660717140daad1326e7441be8b84d"><div class="ttname"><a href="structMQTTTRANSPORT__HANDLE__DATA__TAG.html#aef4660717140daad1326e7441be8b84d">MQTTTRANSPORT_HANDLE_DATA_TAG::mqttClient</a></div><div class="ttdeci">MQTT_CLIENT_HANDLE mqttClient</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00162">iothubtransport_mqtt_common.c:162</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a6459574e19405348bb38dcbfa874613d"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a6459574e19405348bb38dcbfa874613d">IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin</a></div><div class="ttdeci">int IoTHubTransport_MQTT_Common_Subscribe_DeviceTwin(IOTHUB_DEVICE_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02039">iothubtransport_mqtt_common.c:2039</a></div></div>
<div class="ttc" id="astructMQTT__MESSAGE__DETAILS__LIST__TAG_html"><div class="ttname"><a href="structMQTT__MESSAGE__DETAILS__LIST__TAG.html">MQTT_MESSAGE_DETAILS_LIST_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00219">iothubtransport_mqtt_common.c:220</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_afac0461ed8c3d522bbf2a4cfa9f3f957"><div class="ttname"><a href="iothub__message_8c.html#afac0461ed8c3d522bbf2a4cfa9f3f957">IoTHubMessage_GetByteArray</a></div><div class="ttdeci">IOTHUB_MESSAGE_RESULT IoTHubMessage_GetByteArray(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle, const unsigned char **buffer, size_t *size)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00365">iothub_message.c:365</a></div></div>
<div class="ttc" id="acomponents_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h_html_ab3f670a1274ad8b1a721599e19166c6c"><div class="ttname"><a href="components_2arduino-esp32_2libraries_2AzureIoT_2src_2az__iot_2c-utility_2inc_2azure__c__shared__utility_2strings_8h.html#ab3f670a1274ad8b1a721599e19166c6c">STRING_construct_sprintf</a></div><div class="ttdeci">STRING_HANDLE STRING_construct_sprintf(const char *format,...)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00125">strings.c:125</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html_a64f5ccfc18ce46337a09dfa0ac60b8dd"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html#a64f5ccfc18ce46337a09dfa0ac60b8dd">IOTHUB_CLIENT_CONFIG_TAG::protocolGatewayHostName</a></div><div class="ttdeci">const char * protocolGatewayHostName</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00201">iothub_client_ll.h:201</a></div></div>
<div class="ttc" id="astructMQTT__TRANSPORT__PROXY__OPTIONS__TAG_html_a89564f5229de7990a44d2c1a600b218b"><div class="ttname"><a href="structMQTT__TRANSPORT__PROXY__OPTIONS__TAG.html#a89564f5229de7990a44d2c1a600b218b">MQTT_TRANSPORT_PROXY_OPTIONS_TAG::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8h_source.html#l00018">iothubtransport_mqtt_common.h:18</a></div></div>
<div class="ttc" id="astructHTTP__PROXY__OPTIONS__TAG_html_a25110c13d4cfe369dbcaf8ee15f6d687"><div class="ttname"><a href="structHTTP__PROXY__OPTIONS__TAG.html#a25110c13d4cfe369dbcaf8ee15f6d687">HTTP_PROXY_OPTIONS_TAG::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="shared__util__options_8h_source.html#l00015">shared_util_options.h:15</a></div></div>
<div class="ttc" id="aagenttime_8c_html_ae215665d6ce179d18157b06033082b60"><div class="ttname"><a href="agenttime_8c.html#ae215665d6ce179d18157b06033082b60">get_time</a></div><div class="ttdeci">time_t get_time(time_t *p)</div><div class="ttdef"><b>Definition:</b> <a href="agenttime_8c_source.html#l00009">agenttime.c:9</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a8db9bc2e3db478df58b8f27db5d677e3"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a8db9bc2e3db478df58b8f27db5d677e3">IoTHubTransport_MQTT_Common_SetRetryPolicy</a></div><div class="ttdeci">int IoTHubTransport_MQTT_Common_SetRetryPolicy(TRANSPORT_LL_HANDLE handle, IOTHUB_CLIENT_RETRY_POLICY retryPolicy, size_t retryTimeoutLimitInSeconds)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00264">iothubtransport_mqtt_common.c:264</a></div></div>
<div class="ttc" id="astrings_8c_html_aa4a3f5638a574f7dfad01419df072e2a"><div class="ttname"><a href="strings_8c.html#aa4a3f5638a574f7dfad01419df072e2a">STRING_concat_with_STRING</a></div><div class="ttdeci">int STRING_concat_with_STRING(STRING_HANDLE s1, STRING_HANDLE s2)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00400">strings.c:400</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_afcc4a3e4e8ac287b0a9a3850c5a72248"><div class="ttname"><a href="iothub__message_8c.html#afcc4a3e4e8ac287b0a9a3850c5a72248">IoTHubMessage_SetCorrelationId</a></div><div class="ttdeci">IOTHUB_MESSAGE_RESULT IoTHubMessage_SetCorrelationId(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle, const char *correlationId)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00477">iothub_message.c:477</a></div></div>
<div class="ttc" id="astructXIO__INSTANCE__TAG_html"><div class="ttname"><a href="structXIO__INSTANCE__TAG.html">XIO_INSTANCE_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="xio_8c_source.html#l00013">xio.c:14</a></div></div>
<div class="ttc" id="astructOPTIONHANDLER__HANDLE__DATA__TAG_html"><div class="ttname"><a href="structOPTIONHANDLER__HANDLE__DATA__TAG.html">OPTIONHANDLER_HANDLE_DATA_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="optionhandler_8c_source.html#l00016">optionhandler.c:17</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a22f0af96e6836836e4c087ddd7972342"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a22f0af96e6836836e4c087ddd7972342">IoTHubTransport_MQTT_Common_SendMessageDisposition</a></div><div class="ttdeci">IOTHUB_CLIENT_RESULT IoTHubTransport_MQTT_Common_SendMessageDisposition(MESSAGE_CALLBACK_INFO *message_data, IOTHUBMESSAGE_DISPOSITION_RESULT disposition)</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l02797">iothubtransport_mqtt_common.c:2797</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_af5961a16ad97a128434cbdde78a91b4c"><div class="ttname"><a href="iothub__message_8c.html#af5961a16ad97a128434cbdde78a91b4c">IoTHubMessage_SetContentTypeSystemProperty</a></div><div class="ttdeci">IOTHUB_MESSAGE_RESULT IoTHubMessage_SetContentTypeSystemProperty(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle, const char *contentType)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00560">iothub_message.c:560</a></div></div>
<div class="ttc" id="ainttypes_8h_html"><div class="ttname"><a href="inttypes_8h.html">inttypes.h</a></div></div>
<div class="ttc" id="astdlib__noniso_8h_html_a825c37450147a643edbcb1a435518307"><div class="ttname"><a href="stdlib__noniso_8h.html#a825c37450147a643edbcb1a435518307">atol</a></div><div class="ttdeci">long atol(const char *s)</div></div>
<div class="ttc" id="astructCONNECT__ACK__TAG_html"><div class="ttname"><a href="structCONNECT__ACK__TAG.html">CONNECT_ACK_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00077">mqttconst.h:78</a></div></div>
<div class="ttc" id="aiothub__message_8c_html_aaf63b9aecdde6f8c90d9fbd0755d0c41"><div class="ttname"><a href="iothub__message_8c.html#aaf63b9aecdde6f8c90d9fbd0755d0c41">IoTHubMessage_GetString</a></div><div class="ttdeci">const char * IoTHubMessage_GetString(IOTHUB_MESSAGE_HANDLE iotHubMessageHandle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__message_8c_source.html#l00399">iothub_message.c:399</a></div></div>
<div class="ttc" id="aiothub__client__ll_8c_html_a9788e5c85357e7f37f5c1c945c80695c"><div class="ttname"><a href="iothub__client__ll_8c.html#a9788e5c85357e7f37f5c1c945c80695c">IoTHubClient_LL_ConnectionStatusCallBack</a></div><div class="ttdeci">void IoTHubClient_LL_ConnectionStatusCallBack(IOTHUB_CLIENT_LL_HANDLE handle, IOTHUB_CLIENT_CONNECTION_STATUS status, IOTHUB_CLIENT_CONNECTION_STATUS_REASON reason)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8c_source.html#l01528">iothub_client_ll.c:1528</a></div></div>
<div class="ttc" id="amqttconst_8h_html_aa393db33c1dfb0ce811219ce02e08e61ad1e8baf8f019f73c4a13f2f087d96806"><div class="ttname"><a href="mqttconst_8h.html#aa393db33c1dfb0ce811219ce02e08e61ad1e8baf8f019f73c4a13f2f087d96806">CONNECTION_ACCEPTED</a></div><div class="ttdeci">@ CONNECTION_ACCEPTED</div><div class="ttdef"><b>Definition:</b> <a href="mqttconst_8h_source.html#l00068">mqttconst.h:68</a></div></div>
<div class="ttc" id="aiothub__client__private_8h_html_af017a165145ff71c161d40d7ce6a92c8"><div class="ttname"><a href="iothub__client__private_8h.html#af017a165145ff71c161d40d7ce6a92c8">CLIENT_DEVICE_TYPE_PREFIX</a></div><div class="ttdeci">#define CLIENT_DEVICE_TYPE_PREFIX</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__private_8h_source.html#l00029">iothub_client_private.h:28</a></div></div>
<div class="ttc" id="amap_8c_html_a3c232f8741686b794a1a767117012497"><div class="ttname"><a href="map_8c.html#a3c232f8741686b794a1a767117012497">Map_AddOrUpdate</a></div><div class="ttdeci">MAP_RESULT Map_AddOrUpdate(MAP_HANDLE handle, const char *key, const char *value)</div><div class="ttdef"><b>Definition:</b> <a href="map_8c_source.html#l00377">map.c:377</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a826b9a63aee7138a05a1c8fedf0240c0"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a826b9a63aee7138a05a1c8fedf0240c0">MQTT_TRANSPORT_CREDENTIAL_TYPE_TAG</a></div><div class="ttdeci">MQTT_TRANSPORT_CREDENTIAL_TYPE_TAG</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00115">iothubtransport_mqtt_common.c:116</a></div></div>
<div class="ttc" id="astrings_8c_html_ad5dac28de3fdf01777ac937fa876ac3c"><div class="ttname"><a href="strings_8c.html#ad5dac28de3fdf01777ac937fa876ac3c">STRING_length</a></div><div class="ttdeci">size_t STRING_length(STRING_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="strings_8c_source.html#l00683">strings.c:683</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html_ad030712a97d1d08abb7d38841417fc2d"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html#ad030712a97d1d08abb7d38841417fc2d">IOTHUB_CLIENT_CONFIG_TAG::deviceKey</a></div><div class="ttdeci">const char * deviceKey</div><div class="ttdoc">The device key used to authenticate the device. If neither deviceSasToken nor deviceKey is present th...</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00189">iothub_client_ll.h:189</a></div></div>
<div class="ttc" id="astructMESSAGE__CALLBACK__INFO__TAG_html_a236b601a4e8c04102c63c85317fde8de"><div class="ttname"><a href="structMESSAGE__CALLBACK__INFO__TAG.html#a236b601a4e8c04102c63c85317fde8de">MESSAGE_CALLBACK_INFO_TAG::messageHandle</a></div><div class="ttdeci">IOTHUB_MESSAGE_HANDLE messageHandle</div><div class="ttdef"><b>Definition:</b> <a href="iothub__transport__ll_8h_source.html#l00028">iothub_transport_ll.h:28</a></div></div>
<div class="ttc" id="astructIOTHUB__CLIENT__CONFIG__TAG_html_a54b2c744ca9f3dbe94d71753ea36d1dc"><div class="ttname"><a href="structIOTHUB__CLIENT__CONFIG__TAG.html#a54b2c744ca9f3dbe94d71753ea36d1dc">IOTHUB_CLIENT_CONFIG_TAG::deviceSasToken</a></div><div class="ttdeci">const char * deviceSasToken</div><div class="ttdoc">The device SAS Token used to authenticate the device in place of device key. If neither deviceSasToke...</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__ll_8h_source.html#l00193">iothub_client_ll.h:193</a></div></div>
<div class="ttc" id="aiothubtransport__mqtt__common_8c_html_a33c77b72749b1d9d1ab8edf93f28ee8b"><div class="ttname"><a href="iothubtransport__mqtt__common_8c.html#a33c77b72749b1d9d1ab8edf93f28ee8b">RESEND_TIMEOUT_VALUE_MIN</a></div><div class="ttdeci">#define RESEND_TIMEOUT_VALUE_MIN</div><div class="ttdef"><b>Definition:</b> <a href="iothubtransport__mqtt__common_8c_source.html#l00045">iothubtransport_mqtt_common.c:44</a></div></div>
<div class="ttc" id="aiothub__client__authorization_8c_html_a6a815c201b2a287aa37600f4ab5acc99"><div class="ttname"><a href="iothub__client__authorization_8c.html#a6a815c201b2a287aa37600f4ab5acc99">IoTHubClient_Auth_Get_Credential_Type</a></div><div class="ttdeci">IOTHUB_CREDENTIAL_TYPE IoTHubClient_Auth_Get_Credential_Type(IOTHUB_AUTHORIZATION_HANDLE handle)</div><div class="ttdef"><b>Definition:</b> <a href="iothub__client__authorization_8c_source.html#l00276">iothub_client_authorization.c:276</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
