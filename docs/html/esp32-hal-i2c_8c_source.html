<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>watch 2: components/arduino-esp32/cores/esp32/esp32-hal-i2c.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">watch 2
   </div>
   <div id="projectbrief">Firmwareforwatch2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_5eb99044ce905dee52e93bf33cea5db4.html">arduino-esp32</a></li><li class="navelem"><a class="el" href="dir_795c59de7e4ed2c11ede9e206275cb26.html">cores</a></li><li class="navelem"><a class="el" href="dir_7161b714644b5ca54deb1cb6e5e155ba.html">esp32</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">esp32-hal-i2c.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="esp32-hal-i2c_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright 2015-2016 Espressif Systems (Shanghai) PTE LTD</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// you may not use this file except in compliance with the License.</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// You may obtain a copy of the License at</span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160; </div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">//     http://www.apache.org/licenses/LICENSE-2.0</span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// Unless required by applicable law or agreed to in writing, software</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// See the License for the specific language governing permissions and</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// limitations under the License.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160; </div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="esp32-hal-i2c_8h.html">esp32-hal-i2c.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="esp32-hal_8h.html">esp32-hal.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html">freertos/FreeRTOS.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="task_8h.html">freertos/task.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="semphr_8h.html">freertos/semphr.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="event__groups_8h.html">freertos/event_groups.h</a>&quot;</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="ets__sys_8h.html">rom/ets_sys.h</a>&quot;</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="periph__ctrl_8h.html">driver/periph_ctrl.h</a>&quot;</span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="i2c__reg_8h.html">soc/i2c_reg.h</a>&quot;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="i2c__struct_8h.html">soc/i2c_struct.h</a>&quot;</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="dport__reg_8h.html">soc/dport_reg.h</a>&quot;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="esp__attr_8h.html">esp_attr.h</a>&quot;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="esp32-hal-cpu_8h.html">esp32-hal-cpu.h</a>&quot;</span> <span class="comment">// cpu clock change support 31DEC2018</span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">//#define I2C_DEV(i)   (volatile i2c_dev_t *)((i)?DR_REG_I2C1_EXT_BASE:DR_REG_I2C_EXT_BASE)</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">//#define I2C_DEV(i)   ((i2c_dev_t *)(REG_I2C_BASE(i)))</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#define I2C_SCL_IDX(p)  ((p==0)?I2CEXT0_SCL_OUT_IDX:((p==1)?I2CEXT1_SCL_OUT_IDX:0))</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a18a17a12fec3313dae2ed463e5f70680">   31</a></span>&#160;<span class="preprocessor">#define I2C_SDA_IDX(p) ((p==0)?I2CEXT0_SDA_OUT_IDX:((p==1)?I2CEXT1_SDA_OUT_IDX:0))</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a9f980d89641c71517c62c090ad0d202c">   32</a></span>&#160; </div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="preprocessor">#define DR_REG_I2C_EXT_BASE_FIXED               0x60013000</span></div>
<div class="line"><a name="l00034"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a8d0946fe3292be63c7241dbd23a35068">   34</a></span>&#160;<span class="preprocessor">#define DR_REG_I2C1_EXT_BASE_FIXED              0x60027000</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a5bc92d9eaa2740f4e94965fa36172f96">   35</a></span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">/* Stickbreaker ISR mode debug support</span></div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;<span class="comment">ENABLE_I2C_DEBUG_BUFFER</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;<span class="comment">  Enable debug interrupt history buffer, fifoTx history buffer.</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;<span class="comment">  Setting this define will result in 2570 bytes of RAM being used whenever CORE_DEBUG_LEVEL</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">  is higher than WARNING. Unless you are debugging a problem in the I2C subsystem,</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">  I would recommend you leave it commented out.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">  */</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160; </div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;<span class="comment">//#define ENABLE_I2C_DEBUG_BUFFER</span></div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO) &amp;&amp; (defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="preprocessor">#define INTBUFFMAX 64</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="preprocessor">#define FIFOMAX 512</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="keyword">static</span> <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> intBuff[INTBUFFMAX][3][2];</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;<span class="keyword">static</span> <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> intPos[2]= {0,0};</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="keyword">static</span> <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> fifoBuffer[FIFOMAX];</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="keyword">static</span> <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> fifoPos = 0;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160; </div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">// start from tools/sdk/include/soc/soc/i2c_struct.h</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160; </div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html">   58</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;    <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#af042bc4a4fd25792ccff95207fa184e4">   60</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#af042bc4a4fd25792ccff95207fa184e4">byte_num</a>:      8;              <span class="comment">/*Byte_num represent the number of data need to be send or data need to be received.*/</span></div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#a4330934ad271c97b698fc31109b4a2c7">   61</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#a4330934ad271c97b698fc31109b4a2c7">ack_en</a>:        1;              <span class="comment">/*ack_check_en  ack_exp and ack value are used to control  the ack bit.*/</span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#ae47320542d6ab1632ab44d6b3c6f87de">   62</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#ae47320542d6ab1632ab44d6b3c6f87de">ack_exp</a>:       1;              <span class="comment">/*ack_check_en  ack_exp and ack value are used to control  the ack bit.*/</span></div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#a59c59c9daa06c3a823be23ccb93eaefb">   63</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#a59c59c9daa06c3a823be23ccb93eaefb">ack_val</a>:       1;              <span class="comment">/*ack_check_en  ack_exp and ack value are used to control  the ack bit.*/</span></div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#ae20d743b705cce71f404d99d857c8293">   64</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#ae20d743b705cce71f404d99d857c8293">op_code</a>:       3;              <span class="comment">/*op_code is the command  0：RSTART   1：WRITE  2：READ  3：STOP . 4:END.*/</span></div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#aa05cfd4f2e3acf66c733aacae7d00104">   65</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#aa05cfd4f2e3acf66c733aacae7d00104">reserved14</a>:   17;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#afeddb86bea8da6f0c22e4cf4294f8b50">   66</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#afeddb86bea8da6f0c22e4cf4294f8b50">done</a>:  1;                      <span class="comment">/*When command0 is done in I2C Master mode  this bit changes to high level.*/</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;    };</div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="unionI2C__COMMAND__t.html#a084e61d008dcc189b23a8b7f53b8f67a">   68</a></span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__COMMAND__t.html#a084e61d008dcc189b23a8b7f53b8f67a">val</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;} <a class="code" href="unionI2C__COMMAND__t.html">I2C_COMMAND_t</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160; </div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html">   71</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;    <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#ae725a2314a49f5273a1c7f957b0fe8e6">   73</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#ae725a2314a49f5273a1c7f957b0fe8e6">rx_fifo_full_thrhd</a>: 5;</div>
<div class="line"><a name="l00074"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#ae72ce6e606d48072099b3f878829f7c1">   74</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#ae72ce6e606d48072099b3f878829f7c1">tx_fifo_empty_thrhd</a>:5;         <span class="comment">//Config tx_fifo empty threhd value when using apb fifo access * /</span></div>
<div class="line"><a name="l00075"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#a3dbb707d1ba9233784a82c004ca41841">   75</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#a3dbb707d1ba9233784a82c004ca41841">nonfifo_en</a>:         1;         <span class="comment">//Set this bit to enble apb nonfifo access. * /</span></div>
<div class="line"><a name="l00076"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#aeec9aef89194d9e4cd0ec68ab07fa205">   76</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#aeec9aef89194d9e4cd0ec68ab07fa205">fifo_addr_cfg_en</a>:   1;         <span class="comment">//When this bit is set to 1 then the byte after address represent the offset address of I2C Slave&#39;s ram. * /</span></div>
<div class="line"><a name="l00077"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#ab9700d95fe090c521d39ccc62cec2bf0">   77</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#ab9700d95fe090c521d39ccc62cec2bf0">rx_fifo_rst</a>:        1;         <span class="comment">//Set this bit to reset rx fifo when using apb fifo access. * /</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="comment">// chuck while this bit is 1, the RX fifo is held in REST, Toggle it * /</span></div>
<div class="line"><a name="l00079"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#afb71c50ad66a58c8cce3f9be94a1aad4">   79</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#afb71c50ad66a58c8cce3f9be94a1aad4">tx_fifo_rst</a>:        1;         <span class="comment">//Set this bit to reset tx fifo when using apb fifo access. * /</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        <span class="comment">// chuck while this bit is 1, the TX fifo is held in REST, Toggle it * /</span></div>
<div class="line"><a name="l00081"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#ac4a9ae18d9bc02ba7489036f91caf814">   81</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#ac4a9ae18d9bc02ba7489036f91caf814">nonfifo_rx_thres</a>:   6;         <span class="comment">//when I2C receives more than nonfifo_rx_thres data  it will produce rx_send_full_int_raw interrupt and update the current offset address of the receiving data.* /</span></div>
<div class="line"><a name="l00082"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#a68e930ea3b13e9725cb0629458fa9319">   82</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#a68e930ea3b13e9725cb0629458fa9319">nonfifo_tx_thres</a>:   6;         <span class="comment">//when I2C sends more than nonfifo_tx_thres data  it will produce tx_send_empty_int_raw interrupt and update the current offset address of the sending data. * /</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#aa9ffe90a346383175e4193c7835d5a66">   83</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#aa9ffe90a346383175e4193c7835d5a66">reserved26</a>:         6;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;    };</div>
<div class="line"><a name="l00085"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">   85</a></span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">val</a>;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;} <a class="code" href="unionI2C__FIFO__CONF__t.html">I2C_FIFO_CONF_t</a>;</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160; </div>
<div class="line"><a name="l00088"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__ST__t.html">   88</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;        <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__ST__t.html#aa11846ed25c423ace94e910d39353c23">   90</a></span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__ST__t.html#aa11846ed25c423ace94e910d39353c23">rx_fifo_start_addr</a>: 5;         <span class="comment">/*This is the offset address of the last receiving data as described in nonfifo_rx_thres_register.*/</span></div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__ST__t.html#a489962ec376ed2b731ddce9211573038">   91</a></span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__ST__t.html#a489962ec376ed2b731ddce9211573038">rx_fifo_end_addr</a>:   5;         <span class="comment">/*This is the offset address of the first receiving data as described in nonfifo_rx_thres_register.*/</span></div>
<div class="line"><a name="l00092"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__ST__t.html#a32556e203f837a0f7899cd0d605fd086">   92</a></span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__ST__t.html#a32556e203f837a0f7899cd0d605fd086">tx_fifo_start_addr</a>: 5;         <span class="comment">/*This is the offset address of the first  sending data as described in nonfifo_tx_thres register.*/</span></div>
<div class="line"><a name="l00093"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__ST__t.html#a1c7cdd83c4e07b943c6d6b0b4de96754">   93</a></span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__ST__t.html#a1c7cdd83c4e07b943c6d6b0b4de96754">tx_fifo_end_addr</a>:   5;         <span class="comment">/*This is the offset address of the last  sending data as described in nonfifo_tx_thres register.*/</span></div>
<div class="line"><a name="l00094"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__ST__t.html#aeaf0751adaf723adc7be60f6ac4c5994">   94</a></span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__ST__t.html#aeaf0751adaf723adc7be60f6ac4c5994">reserved20</a>:        12;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;        };</div>
<div class="line"><a name="l00096"></a><span class="lineno"><a class="line" href="unionI2C__FIFO__ST__t.html#a400d33bc4389be046228f6efdb0b35be">   96</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__FIFO__ST__t.html#a400d33bc4389be046228f6efdb0b35be">val</a>;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;    } <a class="code" href="unionI2C__FIFO__ST__t.html">I2C_FIFO_ST_t</a>;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">// end from tools/sdk/include/soc/soc/i2c_struct.h</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160; </div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">// sync between dispatch(i2cProcQueue) and worker(i2c_isr_handler_default)</span></div>
<div class="line"><a name="l00102"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187">  102</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;    <span class="comment">//I2C_NONE=0,</span></div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187ac00c1b7bda0b29f0b6ff7172bc5c4239">  104</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187ac00c1b7bda0b29f0b6ff7172bc5c4239">I2C_STARTUP</a>=1,</div>
<div class="line"><a name="l00105"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a68addd56c2d6a3c3c8c047966a77f77f">  105</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a68addd56c2d6a3c3c8c047966a77f77f">I2C_RUNNING</a>,</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad">I2C_DONE</a></div>
<div class="line"><a name="l00107"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad">  107</a></span>&#160;} <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187">I2C_STAGE_t</a>;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160; </div>
<div class="line"><a name="l00109"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341f">  109</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line"><a name="l00110"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">  110</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>=0,</div>
<div class="line"><a name="l00111"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341faf4ca5227cff9f13557a1bbe51ad02724">  111</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341faf4ca5227cff9f13557a1bbe51ad02724">I2C_MASTER</a>,</div>
<div class="line"><a name="l00112"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fae8fe4f82e66f4463eade639f1eaca544">  112</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fae8fe4f82e66f4463eade639f1eaca544">I2C_SLAVE</a>,</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa9c4888058a03d2c9cf7c84fe15dbd4f4">I2C_MASTERSLAVE</a></div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa9c4888058a03d2c9cf7c84fe15dbd4f4">  114</a></span>&#160;} <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341f">I2C_MODE_t</a>;</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160; </div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">// internal Error condition</span></div>
<div class="line"><a name="l00117"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3">  117</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;    <span class="comment">//  I2C_NONE=0,</span></div>
<div class="line"><a name="l00119"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3aeceba296bdda2b90e8835c431fe7a72a">  119</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3aeceba296bdda2b90e8835c431fe7a72a">I2C_OK</a>=1,</div>
<div class="line"><a name="l00120"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a2e4932a1868432bff23103fac0127fdc">  120</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a2e4932a1868432bff23103fac0127fdc">I2C_ERROR</a>,</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3adf30cba98e655e4327b882990103cd03">  121</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3adf30cba98e655e4327b882990103cd03">I2C_ADDR_NAK</a>,</div>
<div class="line"><a name="l00122"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3ae6a8bc51a7b7474f8c2b3c2163e5bd49">  122</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3ae6a8bc51a7b7474f8c2b3c2163e5bd49">I2C_DATA_NAK</a>,</div>
<div class="line"><a name="l00123"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a9e1aeef18f20ebbd58caa3082ded5ef6">  123</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a9e1aeef18f20ebbd58caa3082ded5ef6">I2C_ARBITRATION</a>,</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a1056d6a4b037e383132309c2898a2fc8">I2C_TIMEOUT</a></div>
<div class="line"><a name="l00125"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a1056d6a4b037e383132309c2898a2fc8">  125</a></span>&#160;} <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3">I2C_ERROR_t</a>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160; </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;<span class="comment">// i2c_event bits for EVENTGROUP bits</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;<span class="comment">// needed to minimize change events, FreeRTOS Daemon overload, so ISR will only set values</span></div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment">// on Exit.  Dispatcher will set bits for each dq before/after ISR completion</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="preprocessor">#define EVENT_ERROR_NAK (BIT(0))</span></div>
<div class="line"><a name="l00131"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a73249ae7b0e5d931b975b84998875f6a">  131</a></span>&#160;<span class="preprocessor">#define EVENT_ERROR     (BIT(1))</span></div>
<div class="line"><a name="l00132"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a386cca3372545d35239c7c9deeb704f3">  132</a></span>&#160;<span class="preprocessor">#define EVENT_ERROR_BUS_BUSY  (BIT(2))</span></div>
<div class="line"><a name="l00133"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a9554ab32654736a43a1527a1aab100c2">  133</a></span>&#160;<span class="preprocessor">#define EVENT_RUNNING   (BIT(3))</span></div>
<div class="line"><a name="l00134"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#aab1b25f2f2cd4550d73279f646b8011c">  134</a></span>&#160;<span class="preprocessor">#define EVENT_DONE      (BIT(4))</span></div>
<div class="line"><a name="l00135"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">  135</a></span>&#160;<span class="preprocessor">#define EVENT_IN_END    (BIT(5))</span></div>
<div class="line"><a name="l00136"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a1f1a46ff782041e3ac03235d9230e332">  136</a></span>&#160;<span class="preprocessor">#define EVENT_ERROR_PREV  (BIT(6))</span></div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a84f8a4430731e9fb4f3ca13298695ad1">  137</a></span>&#160;<span class="preprocessor">#define EVENT_ERROR_TIMEOUT   (BIT(7))</span></div>
<div class="line"><a name="l00138"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a4b20ffd4cf1946602c6fdca18f2f6b93">  138</a></span>&#160;<span class="preprocessor">#define EVENT_ERROR_ARBITRATION (BIT(8))</span></div>
<div class="line"><a name="l00139"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a4519c498410bb0d2052812c5faa35a30">  139</a></span>&#160;<span class="preprocessor">#define EVENT_ERROR_DATA_NAK  (BIT(9))</span></div>
<div class="line"><a name="l00140"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#af3691dd07d3d90e44b5968f26857ca00">  140</a></span>&#160;<span class="preprocessor">#define EVENT_MASK 0x3F</span></div>
<div class="line"><a name="l00141"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a2886d56a52bad68e04e56f4361e9e92f">  141</a></span>&#160; </div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;<span class="comment">// control record for each dq entry</span></div>
<div class="line"><a name="l00143"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html">  143</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;    <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00145"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">  145</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>: 16; <span class="comment">// I2C address, if 10bit must have 0x7800 mask applied, else 8bit</span></div>
<div class="line"><a name="l00146"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">  146</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>:         1; <span class="comment">// transaction direction 0 write, 1 read</span></div>
<div class="line"><a name="l00147"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a39d7190db2ae442c3db2ee3dd04acc38">  147</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a39d7190db2ae442c3db2ee3dd04acc38">stop</a>:         1; <span class="comment">// sendStop 0 no, 1 yes</span></div>
<div class="line"><a name="l00148"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">  148</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">startCmdSent</a>: 1; <span class="comment">// START cmd has been added to command[]</span></div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">  149</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">addrCmdSent</a>:  1; <span class="comment">// addr WRITE cmd has been added to command[]</span></div>
<div class="line"><a name="l00150"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a3a549294b3be6cdbb87af2ad13d13d9f">  150</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a3a549294b3be6cdbb87af2ad13d13d9f">dataCmdSent</a>:  1; <span class="comment">// all necessary DATA(READ/WRITE) cmds added to command[]</span></div>
<div class="line"><a name="l00151"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">  151</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">stopCmdSent</a>:  1; <span class="comment">// completed all necessary commands</span></div>
<div class="line"><a name="l00152"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">  152</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a>:      2; <span class="comment">// number of addr bytes need to send address</span></div>
<div class="line"><a name="l00153"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">  153</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>:     2; <span class="comment">// number of addr bytes added to FIFO</span></div>
<div class="line"><a name="l00154"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a3f3963d6b40b87bce9e4df022135748d">  154</a></span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>  <a class="code" href="unionI2C__DATA__CTRL__t.html#a3f3963d6b40b87bce9e4df022135748d">reserved_31</a>:  6;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    };</div>
<div class="line"><a name="l00156"></a><span class="lineno"><a class="line" href="unionI2C__DATA__CTRL__t.html#a745b00de27a02a8e53c9c3c9c864cf49">  156</a></span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="unionI2C__DATA__CTRL__t.html#a745b00de27a02a8e53c9c3c9c864cf49">val</a>;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;} <a class="code" href="unionI2C__DATA__CTRL__t.html">I2C_DATA_CTRL_t</a>;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160; </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;<span class="comment">// individual dq element</span></div>
<div class="line"><a name="l00160"></a><span class="lineno"><a class="line" href="structI2C__DATA__QUEUE__t.html">  160</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00161"></a><span class="lineno"><a class="line" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">  161</a></span>&#160;    <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> *<a class="code" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">data</a>;           <span class="comment">// data pointer for read/write buffer</span></div>
<div class="line"><a name="l00162"></a><span class="lineno"><a class="line" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">  162</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a>;         <span class="comment">// size of data buffer</span></div>
<div class="line"><a name="l00163"></a><span class="lineno"><a class="line" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">  163</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>;       <span class="comment">// current position for next char in buffer (&lt;length)</span></div>
<div class="line"><a name="l00164"></a><span class="lineno"><a class="line" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">  164</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a>; <span class="comment">// used to control number of I2C_COMMAND_t blocks added to queue</span></div>
<div class="line"><a name="l00165"></a><span class="lineno"><a class="line" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">  165</a></span>&#160;    <a class="code" href="unionI2C__DATA__CTRL__t.html">I2C_DATA_CTRL_t</a> <a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>;</div>
<div class="line"><a name="l00166"></a><span class="lineno"><a class="line" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">  166</a></span>&#160;    <a class="code" href="event__groups_8h.html#a5119294106541c4eca46e8742fdb4e85">EventGroupHandle_t</a> <a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a>;  <span class="comment">// optional user supplied for Async feedback EventBits</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;} <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160; </div>
<div class="line"><a name="l00169"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html">  169</a></span>&#160;<span class="keyword">struct </span><a class="code" href="structi2c__struct__t.html">i2c_struct_t</a> {</div>
<div class="line"><a name="l00170"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">  170</a></span>&#160;    <a class="code" href="structi2c__dev__t.html">i2c_dev_t</a> * <a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;<span class="preprocessor">#if !CONFIG_DISABLE_HAL_LOCKS</span></div>
<div class="line"><a name="l00172"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a0a090b1ed46ca4ffbedb63add98433ad">  172</a></span>&#160;    <a class="code" href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html#a520d8cf032327581ece00e5bd8e03a75">xSemaphoreHandle</a> <a class="code" href="structi2c__struct__t.html#a0a090b1ed46ca4ffbedb63add98433ad">lock</a>;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00174"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">  174</a></span>&#160;    <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> <a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>;</div>
<div class="line"><a name="l00175"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">  175</a></span>&#160;    <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> <a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a>;</div>
<div class="line"><a name="l00176"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">  176</a></span>&#160;    <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> <a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a>;</div>
<div class="line"><a name="l00177"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a7db81cc506d04e9c8830aa9d7735ff24">  177</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341f">I2C_MODE_t</a> <a class="code" href="structi2c__struct__t.html#a7db81cc506d04e9c8830aa9d7735ff24">mode</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">  178</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187">I2C_STAGE_t</a> <a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">  179</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3">I2C_ERROR_t</a> <a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">  180</a></span>&#160;    <a class="code" href="event__groups_8h.html#a5119294106541c4eca46e8742fdb4e85">EventGroupHandle_t</a> <a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>; <span class="comment">// a way to monitor ISR process</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    <span class="comment">// maybe use it to trigger callback for OnRequest()</span></div>
<div class="line"><a name="l00182"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">  182</a></span>&#160;    <a class="code" href="esp__intr__alloc_8h.html#ab011a236fc3c9318f38ae4cdb9a26105">intr_handle_t</a> <a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>;       </div>
<div class="line"><a name="l00183"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">  183</a></span>&#160;    <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> * <a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">  184</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>; <span class="comment">// number of dq entries in queue.</span></div>
<div class="line"><a name="l00185"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">  185</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>; <span class="comment">// current queue that still has or needs data (out/in)</span></div>
<div class="line"><a name="l00186"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">  186</a></span>&#160;    <a class="code" href="stdint_8h.html#a3542c6a0490e65fc4fc407273126e64f">int16_t</a>  <a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a>;  <span class="comment">// byte pos where error happened, -1 devId, 0..(length-1) data</span></div>
<div class="line"><a name="l00187"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">  187</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a>; <span class="comment">// errorByteCnt is in this queue,(for error locus)</span></div>
<div class="line"><a name="l00188"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#aca9f378e0051c0f049ca7ddd60ad4cbd">  188</a></span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="structi2c__struct__t.html#aca9f378e0051c0f049ca7ddd60ad4cbd">exitCode</a>;</div>
<div class="line"><a name="l00189"></a><span class="lineno"><a class="line" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">  189</a></span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a>;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;};</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160; </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;<span class="keyword">enum</span> {</div>
<div class="line"><a name="l00193"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7ae966547086e83500d1873692d12db5ba">  193</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7ae966547086e83500d1873692d12db5ba">I2C_CMD_RSTART</a>,</div>
<div class="line"><a name="l00194"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a3a71d4224bff65119353ea514674f4e4">  194</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a3a71d4224bff65119353ea514674f4e4">I2C_CMD_WRITE</a>,</div>
<div class="line"><a name="l00195"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a30b3f51f7ecc88b81838c3d97b2c1ef3">  195</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a30b3f51f7ecc88b81838c3d97b2c1ef3">I2C_CMD_READ</a>,</div>
<div class="line"><a name="l00196"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a48ed4cfaff55487476d8165c9e35d1e1">  196</a></span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a48ed4cfaff55487476d8165c9e35d1e1">I2C_CMD_STOP</a>,</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4fd6937efbe394af6170a399a906b9c0">I2C_CMD_END</a></div>
<div class="line"><a name="l00198"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4fd6937efbe394af6170a399a906b9c0">  198</a></span>&#160;};</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="preprocessor">#if CONFIG_DISABLE_HAL_LOCKS</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="preprocessor">#define I2C_MUTEX_LOCK()</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="preprocessor">#define I2C_MUTEX_UNLOCK()</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160; </div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="keyword">static</span> <a class="code" href="structi2c__struct__t.html">i2c_t</a> _i2c_bus_array[2] = {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;    {(<span class="keyword">volatile</span> <a class="code" href="structi2c__dev__t.html">i2c_dev_t</a> *)(<a class="code" href="esp32-hal-i2c_8c.html#a8d0946fe3292be63c7241dbd23a35068">DR_REG_I2C_EXT_BASE_FIXED</a>), 0, -1, -1,<a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,0,0,0,0,0},</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    {(<span class="keyword">volatile</span> <a class="code" href="structi2c__dev__t.html">i2c_dev_t</a> *)(<a class="code" href="esp32-hal-i2c_8c.html#a5bc92d9eaa2740f4e94965fa36172f96">DR_REG_I2C1_EXT_BASE_FIXED</a>), 1, -1, -1,<a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,0,0,0,0,0}</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;};</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="preprocessor">#define I2C_MUTEX_LOCK()    do {} while (xSemaphoreTakeRecursive(i2c-&gt;lock, portMAX_DELAY) != pdPASS)</span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a30d636c7aade7e875101380f58b90746">  210</a></span>&#160;<span class="preprocessor">#define I2C_MUTEX_UNLOCK()  xSemaphoreGiveRecursive(i2c-&gt;lock)</span></div>
<div class="line"><a name="l00211"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">  211</a></span>&#160; </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;<span class="keyword">static</span> <a class="code" href="structi2c__struct__t.html">i2c_t</a> _i2c_bus_array[2] = {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;    {(<span class="keyword">volatile</span> <a class="code" href="structi2c__dev__t.html">i2c_dev_t</a> *)(<a class="code" href="esp32-hal-i2c_8c.html#a8d0946fe3292be63c7241dbd23a35068">DR_REG_I2C_EXT_BASE_FIXED</a>), <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, -1, -1, <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,0,0,0,0,0,0},</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;    {(<span class="keyword">volatile</span> <a class="code" href="structi2c__dev__t.html">i2c_dev_t</a> *)(<a class="code" href="esp32-hal-i2c_8c.html#a5bc92d9eaa2740f4e94965fa36172f96">DR_REG_I2C1_EXT_BASE_FIXED</a>), <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 1, -1, -1,<a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a>,<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,0,0,0,0,0,0}</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;};</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160; </div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;<span class="comment"> * index     - command index (0 to 15)</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;<span class="comment"> * op_code   - is the command</span></div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;<span class="comment"> * byte_num  - This register is to store the amounts of data that is read and written. byte_num in RSTART, STOP, END is null.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;<span class="comment"> * ack_val   - Each data byte is terminated by an ACK bit used to set the bit level.</span></div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;<span class="comment"> * ack_exp   - This bit is to set an expected ACK value for the transmitter.</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment"> * ack_check - This bit is to decide whether the transmitter checks ACK bit. 1 means yes and 0 means no.</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment"> * */</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160; </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160; </div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">/* Stickbreaker ISR mode debug support</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> i2cDumpCmdQueue(<a class="code" href="structi2c__struct__t.html">i2c_t</a> *i2c)</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;{</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_ERROR)&amp;&amp;(defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;    <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> * <span class="keyword">const</span> cmdName[] ={<span class="stringliteral">&quot;RSTART&quot;</span>,<span class="stringliteral">&quot;WRITE&quot;</span>,<span class="stringliteral">&quot;READ&quot;</span>,<span class="stringliteral">&quot;STOP&quot;</span>,<span class="stringliteral">&quot;END&quot;</span>};</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;    <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=0;</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;    <span class="keywordflow">while</span>(<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;16) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;        <a class="code" href="unionI2C__COMMAND__t.html">I2C_COMMAND_t</a> c;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        c.<a class="code" href="unionI2C__COMMAND__t.html#a084e61d008dcc189b23a8b7f53b8f67a">val</a>=i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">command</a>[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;[%2d]\t%c\t%s\tval[%d]\texp[%d]\ten[%d]\tbytes[%d]&quot;</span>,<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>,(c.<a class="code" href="unionI2C__COMMAND__t.html#afeddb86bea8da6f0c22e4cf4294f8b50">done</a>?<span class="charliteral">&#39;Y&#39;</span>:<span class="charliteral">&#39;N&#39;</span>),</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;              cmdName[c.<a class="code" href="unionI2C__COMMAND__t.html#ae20d743b705cce71f404d99d857c8293">op_code</a>],</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;              c.<a class="code" href="unionI2C__COMMAND__t.html#a59c59c9daa06c3a823be23ccb93eaefb">ack_val</a>,</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;              c.<a class="code" href="unionI2C__COMMAND__t.html#ae47320542d6ab1632ab44d6b3c6f87de">ack_exp</a>,</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;              c.<a class="code" href="unionI2C__COMMAND__t.html#a4330934ad271c97b698fc31109b4a2c7">ack_en</a>,</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;              c.<a class="code" href="unionI2C__COMMAND__t.html#af042bc4a4fd25792ccff95207fa184e4">byte_num</a>);</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;        <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;}</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160; </div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;<span class="comment">/* Stickbreaker ISR mode debug support</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO)</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> i2cDumpDqData(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;{</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;<span class="preprocessor">#if defined (ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>=0;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;    <span class="keywordtype">char</span> buff[140];</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;    <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> *tdq;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;    <span class="keywordtype">int</span> digits=0,lenDigits=0;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;    <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a> = i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;    <span class="keywordflow">while</span>(<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>&gt;0) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        digits++;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a> /= 10;</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;    }</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;    <span class="keywordflow">while</span>(a&lt;i2c-&gt;queueCount) { <span class="comment">// find maximum number of len decimal digits for formatting</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;        <span class="keywordflow">if</span> (i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a> &gt; lenDigits ) lenDigits = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a>;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;        <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>++;</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;    }</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;    <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>=0;</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;    <span class="keywordflow">while</span>(lenDigits&gt;0){</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;      <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>++;</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;      lenDigits /= 10;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;    }</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;    lenDigits = <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;    <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a> = 0;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;    <span class="keywordflow">while</span>(a&lt;i2c-&gt;queueCount) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;        tdq=&amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>];</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;        <span class="keywordtype">char</span> buf1[10],buf2[10];</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        sprintf(buf1,<span class="stringliteral">&quot;%0*d&quot;</span>,lenDigits,tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a>);</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;        sprintf(buf2,<span class="stringliteral">&quot;%0*d&quot;</span>,lenDigits,tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;[%0*d] %sbit %x %c %s buf@=%p, len=%s, pos=%s, ctrl=%d%d%d%d%d&quot;</span>,digits,<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>,</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;        (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&gt;0x100)?<span class="stringliteral">&quot;10&quot;</span>:<span class="stringliteral">&quot;7&quot;</span>,</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;        (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&gt;0x100)?(((tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&amp;0x600)&gt;&gt;1)|(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&amp;0xff)):(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&gt;&gt;1),</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;        (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>)?<span class="charliteral">&#39;R&#39;</span>:<span class="charliteral">&#39;W&#39;</span>,</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a39d7190db2ae442c3db2ee3dd04acc38">stop</a>)?<span class="stringliteral">&quot;STOP&quot;</span>:<span class="stringliteral">&quot;&quot;</span>,</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;        tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">data</a>,</div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;        buf1,buf2,</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">startCmdSent</a>,tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">addrCmdSent</a>,tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a3a549294b3be6cdbb87af2ad13d13d9f">dataCmdSent</a>,(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a39d7190db2ae442c3db2ee3dd04acc38">stop</a>)?tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">stopCmdSent</a>:0,tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;        );</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;        <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="namespaceasio.html#a8dcdb41a4adfd6fe5322b5dd666d9f29">offset</a> = 0;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;        <span class="keywordflow">while</span>(offset&lt;tdq-&gt;<a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>) {</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            memset(buff,<span class="charliteral">&#39; &#39;</span>,140);</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            buff[139]=<span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 0,j;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            j=sprintf(buff,<span class="stringliteral">&quot;0x%04x: &quot;</span>,<a class="code" href="namespaceasio.html#a8dcdb41a4adfd6fe5322b5dd666d9f29">offset</a>);</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">while</span>((<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;32)&amp;&amp;(offset &lt; tdq-&gt;<a class="code" href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a>)) {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                <span class="keywordtype">char</span> ch = tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">data</a>[<a class="code" href="namespaceasio.html#a8dcdb41a4adfd6fe5322b5dd666d9f29">offset</a>];</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                sprintf((<span class="keywordtype">char</span>*)&amp;buff[(<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>*3)+41],<span class="stringliteral">&quot;%02x &quot;</span>,ch);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="keywordflow">if</span>((ch&lt;32)||(ch&gt;126)) {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    ch=<span class="charliteral">&#39;.&#39;</span>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                j+=sprintf((<span class="keywordtype">char</span>*)&amp;buff[j],<span class="stringliteral">&quot;%c&quot;</span>,ch);</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;                buff[j]=<span class="charliteral">&#39; &#39;</span>;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;                <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;                <a class="code" href="namespaceasio.html#a8dcdb41a4adfd6fe5322b5dd666d9f29">offset</a>++;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;            }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;%s&quot;</span>,buff);</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        }</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;        <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>++;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;    }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;Debug Buffer not Enabled&quot;</span>);</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;}</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="preprocessor">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> i2cDumpI2c(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;{</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;i2c=%p&quot;</span>,i2c);</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;dev=%p date=%p&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acf59f484dd868cb0d92cf2650f89ffa5">date</a>);</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;<span class="preprocessor">#if !CONFIG_DISABLE_HAL_LOCKS</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;lock=%p&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0a090b1ed46ca4ffbedb63add98433ad">lock</a>);</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;num=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>);</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;mode=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a7db81cc506d04e9c8830aa9d7735ff24">mode</a>);</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;stage=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a>);</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;error=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a>);</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;event=%p bits=%x&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>,(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>)?<a class="code" href="event__groups_8h.html#a0ae86f092fb07ccb475ae938f9a12584">xEventGroupGetBits</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>):0);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;intr_handle=%p&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>);</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;dq=%p&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;queueCount=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>);</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;queuePos=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>);</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;errorByteCnt=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a>);</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;errorQueue=%d&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a>);</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;debugFlags=0x%08X&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a>);</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>) {</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;        i2cDumpDqData(i2c);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;    }</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;}</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160; </div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO)  </span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> i2cDumpInts(<a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> num)</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;{</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="preprocessor">#if defined (ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;%u row\tcount\tINTR\tTX\tRX\tTick &quot;</span>,num);</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>=1; <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>&lt;=INTBUFFMAX; <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>++) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;        <a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>=(<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>+intPos[num])%INTBUFFMAX;</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        <span class="keywordflow">if</span>(intBuff[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>][0][num]!=0) {</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;[%02d]\t0x%04x\t0x%04x\t0x%04x\t0x%04x\t0x%08x&quot;</span>,<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>,((intBuff[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>][0][num]&gt;&gt;16)&amp;0xFFFF),(intBuff[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>][0][num]&amp;0xFFFF),((intBuff[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>][1][num]&gt;&gt;16)&amp;0xFFFF),(intBuff[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>][1][num]&amp;0xFFFF),intBuff[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>][2][num]);</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;        }</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;    }</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="preprocessor">#else</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;Debug Buffer not Enabled&quot;</span>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;}</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160; </div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO)&amp;&amp;(defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> i2cDumpStatus(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c){</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;    <span class="keyword">typedef</span> <span class="keyword">union </span>{</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;        <span class="keyword">struct </span>{</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> ack_rec:             1;        <span class="comment">/*This register stores the value of ACK bit.*/</span></div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> slave_rw:            1;        <span class="comment">/*when in slave mode  1：master read slave  0: master write slave.*/</span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> time_out:            1;        <span class="comment">/*when I2C takes more than time_out_reg clocks to receive a data then this register changes to high level.*/</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> arb_lost:            1;        <span class="comment">/*when I2C lost control of SDA line  this register changes to high level.*/</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> bus_busy:            1;        <span class="comment">/*1:I2C bus is busy transferring data. 0:I2C bus is in idle state.*/</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> slave_addressed:     1;        <span class="comment">/*when configured as i2c slave  and the address send by master is equal to slave&#39;s address  then this bit will be high level.*/</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> byte_trans:          1;        <span class="comment">/*This register changes to high level when one byte is transferred.*/</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="SdInfo_8h.html#a88028b6a6993ea4c35717196f8e16a9e">reserved7</a>:           1;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> rx_fifo_cnt:         6;        <span class="comment">/*This register represent the amount of data need to send.*/</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> reserved14:          4;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> tx_fifo_cnt:         6;        <span class="comment">/*This register stores the amount of received data  in ram.*/</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> scl_main_state_last: 3;        <span class="comment">/*This register stores the value of state machine for i2c module.  3&#39;h0: SCL_MAIN_IDLE  3&#39;h1: SCL_ADDRESS_SHIFT 3&#39;h2: SCL_ACK_ADDRESS  3&#39;h3: SCL_RX_DATA  3&#39;h4 SCL_TX_DATA  3&#39;h5:SCL_SEND_ACK 3&#39;h6:SCL_WAIT_ACK*/</span></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> reserved27:          1;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> scl_state_last:      3;        <span class="comment">/*This register stores the value of state machine to produce SCL. 3&#39;h0: SCL_IDLE  3&#39;h1:SCL_START   3&#39;h2:SCL_LOW_EDGE  3&#39;h3: SCL_LOW   3&#39;h4:SCL_HIGH_EDGE   3&#39;h5:SCL_HIGH  3&#39;h6:SCL_STOP*/</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> reserved31:          1;</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;        };</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> val;</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;    } status_reg;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;     </div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;    status_reg sr;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;    sr.val= i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;    </div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;ack(%d) sl_rw(%d) to(%d) arb(%d) busy(%d) sl(%d) trans(%d) rx(%d) tx(%d) sclMain(%d) scl(%d)&quot;</span>,sr.ack_rec,sr.slave_rw,sr.time_out,sr.arb_lost,sr.bus_busy,sr.slave_addressed,sr.byte_trans, sr.rx_fifo_cnt, sr.tx_fifo_cnt,sr.scl_main_state_last, sr.scl_state_last);</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;}</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160; </div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO)&amp;&amp;(defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> i2cDumpFifo(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c){</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;<span class="keywordtype">char</span> <a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>[64];</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;<a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> k = 0;</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = fifoPos+1;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;  <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> %=FIFOMAX;</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="keywordflow">while</span>((fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]==0)&amp;&amp;(<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>!=fifoPos)){</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;  <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;  <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> %=FIFOMAX;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;}</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="keywordflow">if</span>(<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> != fifoPos){<span class="comment">// actual data</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;    <span class="keywordflow">do</span>{</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;      <span class="keywordflow">if</span>(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &amp; 0x8000){ <span class="comment">// address byte</span></div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        <span class="keywordflow">if</span>(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &amp; 0x100) { <span class="comment">// read</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;          <span class="keywordflow">if</span>(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &amp; 0x1) { <span class="comment">// valid read dev id</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            k+= sprintf(&amp;<a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>[k],<span class="stringliteral">&quot;READ  0x%02X&quot;</span>,(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]&amp;0xff)&gt;&gt;1);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;          } <span class="keywordflow">else</span> { <span class="comment">// invalid read dev id</span></div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            k+= sprintf(&amp;<a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>[k],<span class="stringliteral">&quot;Bad READ  0x%02X&quot;</span>,(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]&amp;0xff));</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;          }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// write</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;          <span class="keywordflow">if</span>(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &amp; 0x1) { <span class="comment">// bad write dev id</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            k+= sprintf(&amp;<a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>[k],<span class="stringliteral">&quot;bad WRITE 0x%02X&quot;</span>,(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]&amp;0xff));</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;          } <span class="keywordflow">else</span> { <span class="comment">// good Write</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            k+= sprintf(&amp;<a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>[k],<span class="stringliteral">&quot;WRITE 0x%02X&quot;</span>,(fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]&amp;0xff)&gt;&gt;1);</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;          }</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;        }</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;      } <span class="keywordflow">else</span> k += sprintf(&amp;<a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>[k],<span class="stringliteral">&quot;% 4X &quot;</span>,fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>]);</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160; </div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;      <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++;</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;      <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> %= FIFOMAX;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;      <span class="keywordtype">bool</span> outBuffer=<span class="keyword">false</span>;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;      <span class="keywordflow">if</span>( fifoBuffer[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>] &amp; 0x8000){</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;        outBuffer=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;        k=0;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;      }</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;      <span class="keywordflow">if</span>((outBuffer)||(k&gt;50)||(<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>==fifoPos)) <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;%s&quot;</span>,<a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>);</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;      outBuffer = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;      <span class="keywordflow">if</span>(k&gt;50) {</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;        k=sprintf(<a class="code" href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">buf</a>,<span class="stringliteral">&quot;-&gt; &quot;</span>);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;      }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;    }<span class="keywordflow">while</span>( <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>!= fifoPos);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;}</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;}</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160; </div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> i2cTriggerDumps(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> trigger, <span class="keyword">const</span> <span class="keywordtype">char</span> locus[]){</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO)&amp;&amp;(defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;    <span class="keywordflow">if</span>( trigger ){</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;      <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;%s&quot;</span>,locus);      </div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;      <span class="keywordflow">if</span>(trigger &amp; 1) i2cDumpI2c(i2c);</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;      <span class="keywordflow">if</span>(trigger &amp; 2) i2cDumpInts(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;      <span class="keywordflow">if</span>(trigger &amp; 4) i2cDumpCmdQueue(i2c);</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;      <span class="keywordflow">if</span>(trigger &amp; 8) i2cDumpStatus(i2c);</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;      <span class="keywordflow">if</span>(trigger &amp; 16) i2cDumpFifo(i2c);</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;    }</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;<span class="preprocessor">#endif    </span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;}</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160; <span class="comment">// end of debug support routines</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160; </div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;<span class="comment">/* Start of CPU Clock change Support</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160; </div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> i2cApbChangeCallback(<span class="keywordtype">void</span> * arg, <a class="code" href="esp32-hal-cpu_8h.html#a030cbe7d208b1f9b7c85765ccc5b4fff">apb_change_ev_t</a> ev_type, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> old_apb, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> new_apb){</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;    <a class="code" href="structi2c__struct__t.html">i2c_t</a>* i2c = (<a class="code" href="structi2c__struct__t.html">i2c_t</a>*) arg; <span class="comment">// recover data</span></div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {  <span class="comment">// point to peripheral control block does not exits</span></div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;    }</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> oldFreq=0;</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;    <span class="keywordflow">switch</span>(ev_type){</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-cpu_8h.html#a030cbe7d208b1f9b7c85765ccc5b4fffa5337858216a3483bafd454613bf1ce6d">APB_BEFORE_CHANGE</a> : </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;            <span class="keywordflow">if</span>(new_apb &lt; 3000000) {<span class="comment">// too slow</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;apb speed %d too slow&quot;</span>,new_apb);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;            }</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <a class="code" href="esp32-hal-i2c_8c.html#a30d636c7aade7e875101380f58b90746">I2C_MUTEX_LOCK</a>(); <span class="comment">// lock will spin until current transaction is completed</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-cpu_8h.html#a030cbe7d208b1f9b7c85765ccc5b4fffa2d5ad22a8033570065a302bfba76bc49">APB_AFTER_CHANGE</a> :</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            oldFreq = (i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a6875850c3caab3615fc5b7027985fa13">scl_low_period</a>.<a class="code" href="structi2c__dev__t.html#a66e438dcb5bc99cc0219c14a4d17f495">period</a>+i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#aa25f4fafaa9bd8c03bf4f1040664dd2f">scl_high_period</a>.<a class="code" href="structi2c__dev__t.html#a66e438dcb5bc99cc0219c14a4d17f495">period</a>); <span class="comment">//read old apbCycles </span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">if</span>(oldFreq&gt;0) { <span class="comment">// was configured with value</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                oldFreq = old_apb / oldFreq;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                <a class="code" href="esp32-hal-i2c_8c.html#a0223736866298198d98aebadd9ca47b3">i2cSetFrequency</a>(i2c,oldFreq);</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;            <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;        <a class="code" href="namespaceimageconverter.html#a43b15cf6044906a354902441c7f02f5c">default</a> : </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;unk ev %u&quot;</span>,ev_type);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    }</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;}</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;<span class="comment">/* End of CPU Clock change Support</span></div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;<span class="comment">*/</span> </div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> i2cSetCmd(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> <a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> op_code, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> byte_num, <span class="keywordtype">bool</span> ack_val, <span class="keywordtype">bool</span> ack_exp, <span class="keywordtype">bool</span> ack_check)</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;{</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;    <a class="code" href="unionI2C__COMMAND__t.html">I2C_COMMAND_t</a> <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;    <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>.val=0;</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>.ack_en = ack_check;</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>.ack_exp = ack_exp;</div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>.ack_val = ack_val;</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;    <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>.byte_num = byte_num;</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;    <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>.op_code = op_code;</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">command</a>[<a class="code" href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a>].<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = <a class="code" href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a>.val;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;}</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160; </div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160; </div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> fillCmdQueue(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <span class="keywordtype">bool</span> INTS)</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;{</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;    <span class="comment">/* this function is called on initial i2cProcQueue() or when a I2C_END_DETECT_INT occurs</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> cmdIdx = 0;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> qp = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>; <span class="comment">// all queues before queuePos have been completely processed,</span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;      <span class="comment">// so look start by checking the &#39;current queue&#39; so see if it needs commands added to</span></div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;      <span class="comment">// hardware peripheral command list. walk through each queue entry until all queues have been</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;      <span class="comment">// checked</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;    <span class="keywordtype">bool</span> done;</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;    <span class="keywordtype">bool</span> needMoreCmds = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;    <span class="keywordtype">bool</span> ena_rx=<span class="keyword">false</span>; <span class="comment">// if we add a read op, better enable Rx_Fifo IRQ</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;    <span class="keywordtype">bool</span> ena_tx=<span class="keyword">false</span>; <span class="comment">// if we add a Write op, better enable TX_Fifo IRQ</span></div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160; </div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;    <span class="keywordflow">while</span>(!needMoreCmds&amp;&amp;(qp &lt; i2c-&gt;queueCount)) { <span class="comment">// check if more possible cmds</span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[qp].<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">stopCmdSent</a>) {<span class="comment">// marks that all required cmds[] have been added to peripheral </span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;            qp++;</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;            needMoreCmds=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;        }</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;    }</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;    <span class="comment">//log_e(&quot;needMoreCmds=%d&quot;,needMoreCmds);</span></div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;    done=(!needMoreCmds)||(cmdIdx&gt;14);</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160; </div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">while</span>(!done) { <span class="comment">// fill the command[] until either 0..14 filled or out of cmds and last cmd is STOP</span></div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;        <span class="comment">//CMD START</span></div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> *tdq=&amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[qp]; <span class="comment">// simpler coding</span></div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160; </div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;        <span class="keywordflow">if</span>((!tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">startCmdSent</a>) &amp;&amp; (cmdIdx &lt; 14)) { <span class="comment">// has this dq element&#39;s START command been added?</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;            <span class="comment">// (cmdIdx&lt;14)  because a START op cannot directly precede an END op, else a time out cascade occurs</span></div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            i2cSetCmd(i2c, cmdIdx++, <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7ae966547086e83500d1873692d12db5ba">I2C_CMD_RSTART</a>, 0, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">startCmdSent</a>=1;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160; </div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;        <span class="comment">//CMD WRITE ADDRESS</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;        <span class="keywordflow">if</span>((!done)&amp;&amp;(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">startCmdSent</a>)) { <span class="comment">// have to leave room for continue(END), and START must have been sent!</span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            <span class="keywordflow">if</span>(!tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">addrCmdSent</a>) {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                i2cSetCmd(i2c, cmdIdx++, <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a3a71d4224bff65119353ea514674f4e4">I2C_CMD_WRITE</a>, tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a>, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>); <span class="comment">//load address in cmdlist, validate (low) ack</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">addrCmdSent</a>=1;</div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                done =(cmdIdx&gt;14);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;                ena_tx=<span class="keyword">true</span>; <span class="comment">// tx Data necessary</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            }</div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;        }</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160; </div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;        <span class="comment">/* Can I have another Sir?</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;<span class="comment">        ALL CMD queues must be terminated with either END or STOP.</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;<span class="comment">        If END is used, when refilling the cmd[] next time, no entries from END to [15] can be used.</span></div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;<span class="comment">        AND the cmd[] must be filled starting at [0] with commands. Either fill all 15 [0]..[14] and leave the</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;<span class="comment">        END in [15] or include a STOP in one of the positions [0]..[14].  Any entries after a STOP are IGNORED by the StateMachine.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;<span class="comment">        The END operation does not complete until ctr-&gt;trans_start=1 has been issued.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;<span class="comment">        So, only refill from [0]..[14], leave [15] for a continuation(END) if necessary.</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;<span class="comment">        As a corollary, once END exists in [15], you do not need to overwrite it for the</span></div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;<span class="comment">        next continuation. It is never modified. But, I update it every time because it might</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;<span class="comment">        actually be the first time!</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;<span class="comment"></span> </div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;<span class="comment">        23NOV17  START cannot proceed END.  if START is in[14], END cannot be in [15].</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;<span class="comment">        So, if END is moved to [14], [14] and [15] can no longer be used for anything other than END.</span></div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;<span class="comment">        If a START is found in [14] then a prior READ or WRITE must be expanded so that there is no START element in [14].</span></div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;<span class="comment">         */</span></div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160; </div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;         <span class="keywordflow">if</span>((!done)&amp;&amp;(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">addrCmdSent</a>)) { <span class="comment">//room in command[] for at least One data (read/Write) cmd</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;            <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> blkSize=0; <span class="comment">// max is 255</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;            <span class="keywordflow">while</span>(( tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a> &gt; tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a> )&amp;&amp;(!done )) { <span class="comment">// more bytes needed and room in cmd queue, leave room for END</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;                blkSize = (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a> &gt; 255)?255:(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a> - tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>); <span class="comment">// Last read cmd needs different ACK setting, so leave 1 byte remainder on reads</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;                tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a> -= blkSize; </div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;                <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>==1) { <span class="comment">//read mode</span></div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;                    i2cSetCmd(i2c, (cmdIdx)++, <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a30b3f51f7ecc88b81838c3d97b2c1ef3">I2C_CMD_READ</a>, blkSize,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>); <span class="comment">// read    cmd, this can&#39;t be the last read.</span></div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;                    ena_rx=<span class="keyword">true</span>; <span class="comment">// need to enable rxFifo IRQ</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;                } <span class="keywordflow">else</span> { <span class="comment">// write</span></div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;                    i2cSetCmd(i2c, cmdIdx++, <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a3a71d4224bff65119353ea514674f4e4">I2C_CMD_WRITE</a>, blkSize, <span class="keyword">false</span>, <span class="keyword">false</span>, <span class="keyword">true</span>); <span class="comment">// check for Nak</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;                    ena_tx=<span class="keyword">true</span>; <span class="comment">// need to enable txFifo IRQ</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;                }</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;                done = cmdIdx&gt;14; <span class="comment">//have to leave room for END</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            }</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160; </div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;            <span class="keywordflow">if</span>(!done) { <span class="comment">// buffer is not filled completely</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;                <span class="keywordflow">if</span>((tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>==1)&amp;&amp;(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a>==1)) { <span class="comment">//special last read byte NAK</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;                    i2cSetCmd(i2c, (cmdIdx)++, <a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a30b3f51f7ecc88b81838c3d97b2c1ef3">I2C_CMD_READ</a>, 1,<span class="keyword">true</span>,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;                    <span class="comment">// send NAK to mark end of read</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;                    tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a>=0;</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;                    done = cmdIdx &gt; 14;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;                    ena_rx=<span class="keyword">true</span>;</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;                }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            }</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160; </div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a3a549294b3be6cdbb87af2ad13d13d9f">dataCmdSent</a>=(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a>==0); <span class="comment">// enough command[] to send all data</span></div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160; </div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            <span class="keywordflow">if</span>((!done)&amp;&amp;(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a3a549294b3be6cdbb87af2ad13d13d9f">dataCmdSent</a>)) { <span class="comment">// possibly add stop</span></div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <span class="keywordflow">if</span>(!tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">stopCmdSent</a>){</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                    <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a39d7190db2ae442c3db2ee3dd04acc38">stop</a>) { <span class="comment">//send a stop</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                        i2cSetCmd(i2c, (cmdIdx)++,<a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a48ed4cfaff55487476d8165c9e35d1e1">I2C_CMD_STOP</a>,0,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                        done = cmdIdx &gt; 14;</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;                    }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;                    tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">stopCmdSent</a> = 1;</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;                }</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            }</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;        }</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160; </div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;        <span class="keywordflow">if</span>((cmdIdx==14)&amp;&amp;(!tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">startCmdSent</a>)) {</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="comment">// START would have preceded END, causes SM TIMEOUT</span></div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;            <span class="comment">// need to stretch out a prior WRITE or READ to two Command[] elements</span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;            done = <span class="keyword">false</span>; <span class="comment">// reuse it</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;            <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> = 13; <span class="comment">// start working back until a READ/WRITE has &gt;1 numBytes</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;            cmdIdx =15;</div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;            <span class="keywordflow">while</span>(!done) {</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;                i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">command</a>[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>+1].<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">command</a>[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>; <span class="comment">// push it down</span></div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;                <span class="keywordflow">if</span> (((i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">command</a>[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="structi2c__dev__t.html#a6faf139d6d56420a0ecfe82b874730d9">op_code</a> == 1)||(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">command</a>[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="structi2c__dev__t.html#a6faf139d6d56420a0ecfe82b874730d9">op_code</a>==2))) {</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;                    <span class="comment">/* add a dummy read/write cmd[] with num_bytes set to zero,just a place holder in the cmd[]list</span></div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;<span class="comment">                     */</span></div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;                    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">command</a>[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>].<a class="code" href="structi2c__dev__t.html#a4fe9f1267d59f0178614b9c05bd6cec4">byte_num</a> = 0;</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;                    done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160; </div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;                    <span class="keywordflow">if</span>(<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a> &gt; 0) {</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;                        <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>--;</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;                    } <span class="keywordflow">else</span> { <span class="comment">// unable to stretch, fatal</span></div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;                        <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;invalid CMD[] layout Stretch Failed&quot;</span>);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;                        i2cDumpCmdQueue(i2c);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;                        done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;                    }</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;                }</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            }</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160; </div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;        }</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160; </div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160; </div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        <span class="keywordflow">if</span>(cmdIdx==15) { <span class="comment">//need continuation, even if STOP is in 14, it will not matter</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            <span class="comment">// cmd buffer is almost full, Add END as a continuation feature</span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;            i2cSetCmd(i2c, (cmdIdx)++,<a class="code" href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4fd6937efbe394af6170a399a906b9c0">I2C_CMD_END</a>, 0,<span class="keyword">false</span>,<span class="keyword">false</span>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a4fc7f1f13dbbcf5de5a60d57533dfc4e">end_detect</a>=1; </div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;            i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a4fc7f1f13dbbcf5de5a60d57533dfc4e">end_detect</a>=1; </div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;            done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;        }</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        <span class="keywordflow">if</span>(!done) {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">stopCmdSent</a>) { <span class="comment">// this queue element has been completely added to command[] buffer</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;                qp++;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;                <span class="keywordflow">if</span>(qp &lt; i2c-&gt;queueCount) {</div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;                    tdq = &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[qp];</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;                    done = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;                }</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            }</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;        }</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160; </div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    }<span class="comment">// while(!done)</span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="keywordflow">if</span>(INTS) { <span class="comment">// don&#39;t want to prematurely enable fifo ints until ISR is ready to handle them.</span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;        <span class="keywordflow">if</span>(ena_rx) {</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;            i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a676a425504ba43c012aa06d552e5173e">rx_fifo_full</a> = 1;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;        }</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;        <span class="keywordflow">if</span>(ena_tx) {</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a4893967cb15ac4f6c7aab7bf2f941e73">tx_fifo_empty</a> = 1;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;        }</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    }</div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;}</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160; </div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> fillTxFifo(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;{</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">/*</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;<span class="comment">    12/01/2017 The Fifo&#39;s are independent, 32 bytes of tx and 32 bytes of Rx.</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;<span class="comment">    overlap is not an issue, just keep them full/empty the status_reg.xx_fifo_cnt</span></div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;<span class="comment">    tells the truth. And the INT&#39;s fire correctly</span></div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>=i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>; <span class="comment">// currently executing dq,</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;    <span class="keywordtype">bool</span> full=!(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a2362625ecf1798724a92bccd8a417898">tx_fifo_cnt</a>&lt;31);</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;    <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> cnt;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;    <span class="keywordtype">bool</span> rxQueueEncountered = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;    <span class="keywordflow">while</span>((a &lt; i2c-&gt;queueCount) &amp;&amp; !full) {</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;        <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> *tdq = &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>];</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;        cnt=0;</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;        <span class="comment">// add to address to fifo ctrl.addr already has R/W bit positioned correctly</span></div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a> &lt; tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a>) { <span class="comment">// need to send address bytes</span></div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;            <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a>==2) { <span class="comment">//10bit</span></div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>==0) { <span class="comment">//10bit highbyte needs sent</span></div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                    <span class="keywordflow">if</span>(!full) { <span class="comment">// room in fifo</span></div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;                        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">fifo_data</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = ((tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&gt;&gt;8)&amp;0xFF);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;                        cnt++;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;                        tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>=1; <span class="comment">//10bit highbyte sent</span></div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;                    }</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;                }</div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;                full=!(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a2362625ecf1798724a92bccd8a417898">tx_fifo_cnt</a>&lt;31);</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160; </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;                <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>==1) { <span class="comment">//10bit Lowbyte needs sent</span></div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;                    <span class="keywordflow">if</span>(!full) { <span class="comment">// room in fifo</span></div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;                        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">fifo_data</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&amp;0xFF;</div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;                        cnt++;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;                        tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>=2; <span class="comment">//10bit lowbyte sent</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;                    }</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                }</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            } <span class="keywordflow">else</span> { <span class="comment">// 7bit}</span></div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;                <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>==0) { <span class="comment">// 7bit Lowbyte needs sent</span></div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;                    <span class="keywordflow">if</span>(!full) { <span class="comment">// room in fifo</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;                        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">fifo_data</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&amp;0xFF;</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;                        cnt++;</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;                        tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>=1; <span class="comment">// 7bit lowbyte sent</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO) &amp;&amp; (defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;                        <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a> = 0x8000 | tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a> | (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>&lt;&lt;8);</div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;                        fifoBuffer[fifoPos++] = <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                        fifoPos %= FIFOMAX;</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;                    }</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;                }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            }</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;        }</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="comment">// add write data to fifo</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;        <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>==0) { <span class="comment">// write</span></div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a> == tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a>) { <span class="comment">//address has been sent, is Write Mode!</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;                <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> moveCnt = 32 - i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a2362625ecf1798724a92bccd8a417898">tx_fifo_cnt</a>; <span class="comment">// how much room in txFifo?</span></div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                <span class="keywordflow">while</span>(( moveCnt&gt;0)&amp;&amp;(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a> &lt; tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a>)) {</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO) &amp;&amp; (defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;                    fifoBuffer[fifoPos++] =  tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">data</a>[tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>];</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;                    fifoPos %= FIFOMAX;</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;                    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">fifo_data</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">data</a>[tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>++];</div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;                    cnt++;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;                    moveCnt--;</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160; </div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;                }</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// read Queue Encountered, can&#39;t update QueuePos past this point, emptyRxfifo will do it</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">if</span>( ! rxQueueEncountered ) {</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;              rxQueueEncountered = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;              <span class="keywordflow">if</span>(<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a> &gt; i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>){</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;                i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a> = <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>; </div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;              }</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;           }              </div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;        }</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO) &amp;&amp; (defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160; </div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <span class="comment">// update debug buffer tx counts</span></div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;        cnt += intBuff[intPos[i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][1][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]&gt;&gt;16;</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        intBuff[intPos[i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][1][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = (intBuff[intPos[i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][1][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]&amp;0xFFFF)|(cnt&lt;&lt;16);</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160; </div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        full=!(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a2362625ecf1798724a92bccd8a417898">tx_fifo_cnt</a>&lt;31);</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;        <span class="keywordflow">if</span>(!full) {</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>++;    <span class="comment">// check next buffer for address tx, or write data</span></div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;        }</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;    }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160; </div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a> &gt;= i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a> ) { <span class="comment">// disable TX IRQ, all tx Data has been queued</span></div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a4893967cb15ac4f6c7aab7bf2f941e73">tx_fifo_empty</a>= 0;</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;    }</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160; </div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a4893967cb15ac4f6c7aab7bf2f941e73">tx_fifo_empty</a>=1;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;}</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160; </div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160; </div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> emptyRxFifo(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;{</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="namespaceudp__server.html#a5012db13ff4b8ca2bf4f7cd6ce97ddfc">d</a>, cnt=0, moveCnt;</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;    </div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;    moveCnt = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#ade74ecedca580ff9e930b64666d880e5">rx_fifo_cnt</a>;<span class="comment">//no need to check the reg until this many are read</span></div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160; </div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;    <span class="keywordflow">while</span>((moveCnt &gt; 0)&amp;&amp;(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a> &lt; i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>)){ <span class="comment">// data to move    </span></div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160; </div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;        <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> *tdq =&amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>]; <span class="comment">//short cut</span></div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160; </div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;        <span class="keywordflow">while</span>((tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a> &gt;= tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a>)&amp;&amp;( i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a> &lt; i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>)){ <span class="comment">// find were to store</span></div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>++;</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            tdq = &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>];</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;        }</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;      </div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;        <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a> &gt;= i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>){ <span class="comment">// bad stuff, rx data but no place to put it!</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;no Storage location for %d&quot;</span>,moveCnt);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;        <span class="comment">// discard</span></div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="keywordflow">while</span>(moveCnt&gt;0){</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                <a class="code" href="namespaceudp__server.html#a5012db13ff4b8ca2bf4f7cd6ce97ddfc">d</a> = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">fifo_data</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                moveCnt--;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                cnt++;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            }</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;        }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        </div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;        <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a> == 1){ <span class="comment">// read command</span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;            <span class="keywordflow">if</span>(moveCnt &gt; (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a> - tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>)) { <span class="comment">//make sure they go in this dq</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;        <span class="comment">// part of these reads go into the next dq</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;                moveCnt = (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a> - tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>);</div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;            }</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;        } <span class="keywordflow">else</span> {<span class="comment">// error</span></div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;RxEmpty(%d) call on TxBuffer? dq=%d&quot;</span>,moveCnt,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>);</div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;        <span class="comment">// discard</span></div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="keywordflow">while</span>(moveCnt&gt;0){</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                <a class="code" href="namespaceudp__server.html#a5012db13ff4b8ca2bf4f7cd6ce97ddfc">d</a> = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">fifo_data</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                moveCnt--;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                cnt++;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;            }</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;        }</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160; </div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;        <span class="keywordflow">while</span>(moveCnt &gt; 0) { <span class="comment">// store data</span></div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;            <a class="code" href="namespaceudp__server.html#a5012db13ff4b8ca2bf4f7cd6ce97ddfc">d</a> = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">fifo_data</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            moveCnt--;</div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            cnt++;</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">data</a>[tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>++] = (<a class="code" href="namespaceudp__server.html#a5012db13ff4b8ca2bf4f7cd6ce97ddfc">d</a>&amp;0xFF);</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;        }</div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160; </div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;        moveCnt = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#ade74ecedca580ff9e930b64666d880e5">rx_fifo_cnt</a>; <span class="comment">//any more out there?</span></div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;    }</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;    </div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO)&amp;&amp; (defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;        <span class="comment">// update Debug rxCount</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;        cnt += (intBuff[intPos[i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][1][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>])&amp;0xffFF;</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;        intBuff[intPos[i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][1][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = (intBuff[intPos[i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][1][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]&amp;0xFFFF0000)|cnt;</div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;}</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160; </div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> i2cIsrExit(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c,<span class="keyword">const</span> <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> eventCode,<span class="keywordtype">bool</span> Fatal)</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;{</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160; </div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;    <span class="keywordflow">switch</span>(eventCode) {</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>:</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a> = <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3aeceba296bdda2b90e8835c431fe7a72a">I2C_OK</a>;</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#a73249ae7b0e5d931b975b84998875f6a">EVENT_ERROR_NAK</a> :</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a> =<a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3adf30cba98e655e4327b882990103cd03">I2C_ADDR_NAK</a>;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#af3691dd07d3d90e44b5968f26857ca00">EVENT_ERROR_DATA_NAK</a> :</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a> =<a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3ae6a8bc51a7b7474f8c2b3c2163e5bd49">I2C_DATA_NAK</a>;</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#a4b20ffd4cf1946602c6fdca18f2f6b93">EVENT_ERROR_TIMEOUT</a> :</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a> = <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a1056d6a4b037e383132309c2898a2fc8">I2C_TIMEOUT</a>;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#a4519c498410bb0d2052812c5faa35a30">EVENT_ERROR_ARBITRATION</a>:</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a> = <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a9e1aeef18f20ebbd58caa3082ded5ef6">I2C_ARBITRATION</a>;</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;    <a class="code" href="namespaceimageconverter.html#a43b15cf6044906a354902441c7f02f5c">default</a> :</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a> = <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a2e4932a1868432bff23103fac0127fdc">I2C_ERROR</a>;</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    }</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> exitCode = <a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a> | eventCode |(Fatal?<a class="code" href="esp32-hal-i2c_8c.html#a386cca3372545d35239c7c9deeb704f3">EVENT_ERROR</a>:0);</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;    <span class="keywordflow">if</span>((i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a> &lt; i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>) &amp;&amp; (i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a> == 1)) {</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        emptyRxFifo(i2c);    <span class="comment">// grab last few characters</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;    }</div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0; <span class="comment">// shut down interrupts</span></div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0x1FFF;</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a> = <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad">I2C_DONE</a>;</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#aca9f378e0051c0f049ca7ddd60ad4cbd">exitCode</a> = exitCode; <span class="comment">//true eventcode</span></div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160; </div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;    <a class="code" href="portmacro_8h.html#a1ebe82d24d764ae4e352f7c3a9f92c01">portBASE_TYPE</a> HPTaskAwoken = <a class="code" href="projdefs_8h.html#aa56260e937e7e203026707e5ba944273">pdFALSE</a>,xResult;</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;    <span class="comment">// try to notify Dispatch we are done,</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;    <span class="comment">// else the 50ms time out will recover the APP, just a little slower</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;    HPTaskAwoken = <a class="code" href="projdefs_8h.html#aa56260e937e7e203026707e5ba944273">pdFALSE</a>;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;    xResult = <a class="code" href="event__groups_8h.html#a62b68278abac6358369ae8e390988a02">xEventGroupSetBitsFromISR</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>, exitCode, &amp;HPTaskAwoken);</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    <span class="keywordflow">if</span>(xResult == <a class="code" href="projdefs_8h.html#a07848d3078849bd32353c69d30a479b3">pdPASS</a>) {</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;        <span class="keywordflow">if</span>(HPTaskAwoken==<a class="code" href="projdefs_8h.html#af268cf937960eb029256bd9c4d949fbe">pdTRUE</a>) {</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <a class="code" href="portmacro_8h.html#ab35c804254f390845581c29fe6bcb65a">portYIELD_FROM_ISR</a>();</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;            <span class="comment">//      log_e(&quot;Yield to Higher&quot;);</span></div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;        }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;    }</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160; </div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;}</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160; </div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> i2c_update_error_byte_cnt(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;{</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;<span class="comment">/* i2c_update_error_byte_cnt 07/18/2018</span></div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;<span class="comment">  Only called after an error has occurred, so, most of the time this function is never used.</span></div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;<span class="comment">  This function obliterates the need to interrupt monitor each byte transferred, at high bitrates</span></div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;<span class="comment">  the byte interrupts were overwhelming the OS.  Spurious Interrupts were being generated.</span></div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;<span class="comment">  it updates errorByteCnt, errorQueue. </span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>=0; <span class="comment">// start at top of DQ, count how many bytes added to tx fifo, and received from rx_fifo.</span></div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    <a class="code" href="stdint_8h.html#a3542c6a0490e65fc4fc407273126e64f">int16_t</a> bc = 0;</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> *tdq;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> = 0; </div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;    <span class="keywordflow">while</span>( a &lt; i2c-&gt;queueCount){ <span class="comment">// add up all bytes loaded into fifo&#39;s</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;        tdq = &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>];</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> += tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> += tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>; </div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;        <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>++;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    }</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;  <span class="comment">// now errorByteCnt contains total bytes moved into and out of FIFO&#39;s</span></div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;  <span class="comment">// but, there may still be bytes waiting in Fifo&#39;s</span></div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> -= i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a2362625ecf1798724a92bccd8a417898">tx_fifo_cnt</a>; <span class="comment">// waiting to go out;</span></div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> += i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#ade74ecedca580ff9e930b64666d880e5">rx_fifo_cnt</a>; <span class="comment">// already received</span></div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;<span class="comment">// now walk thru DQ again, find which byte is &#39;current&#39;</span></div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    bc = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a>;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a> = 0;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;    <span class="keywordflow">while</span>( i2c-&gt;<a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a> &lt; i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a> ){</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;        tdq = &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[i2c-&gt;<a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a>];</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;        <span class="keywordflow">if</span>(bc&gt;0){ <span class="comment">// not found yet</span></div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;            <span class="keywordflow">if</span>( tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a> &gt;= bc){ <span class="comment">// in address</span></div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                bc = -1; <span class="comment">// in address</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                bc -= tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">addrSent</a>;</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;                <span class="keywordflow">if</span>( tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a> &gt; bc) { <span class="comment">// data nak</span></div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                    <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;                } <span class="keywordflow">else</span> { <span class="comment">// count down</span></div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                    bc -= tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a>;</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                }</div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;            }</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;        </div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a>++;</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;    }  </div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;  </div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> = bc;</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160; }</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160; </div>
<div class="line"><a name="l00895"></a><span class="lineno">  895</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> <a class="code" href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a> i2c_isr_handler_default(<span class="keywordtype">void</span>* arg)</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;{</div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;    <a class="code" href="structi2c__struct__t.html">i2c_t</a>* p_i2c = (<a class="code" href="structi2c__struct__t.html">i2c_t</a>*) arg; <span class="comment">// recover data</span></div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> activeInt = p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a62d02036f90458d22533b20f37603b8b">int_status</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>&amp;0x7FF;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160; </div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;    <span class="keywordflow">if</span>(p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a>==<a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad">I2C_DONE</a>) { <span class="comment">//get Out, can&#39;t service, not configured</span></div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;        p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0;</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;        p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0x1FFF;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;<span class="preprocessor">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_VERBOSE</span></div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a> = p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#aa1293a7cc273d50371a46fc1363d0e20">int_raw</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a71c957bc93270caaa91f41f6989c317b">log_w</a>(<span class="stringliteral">&quot;eject raw=%p, int=%p&quot;</span>,<a class="code" href="cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a>,activeInt);</div>
<div class="line"><a name="l00906"></a><span class="lineno">  906</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;        <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;    }</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;    <span class="keywordflow">while</span> (activeInt != 0) { <span class="comment">// Ordering of &#39;if(activeInt)&#39; statements is important, don&#39;t change</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160; </div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;<span class="preprocessor">    #if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO) &amp;&amp; (defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;        <span class="keywordflow">if</span>(activeInt==(intBuff[intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][0][p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]&amp;0x1fff)) {</div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            intBuff[intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][0][p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = (((intBuff[intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][0][p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]&gt;&gt;16)+1)&lt;&lt;16)|activeInt;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]++;</div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] %= INTBUFFMAX;</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;            intBuff[intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][0][p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = (1&lt;&lt;16) | activeInt;</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;            intBuff[intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][1][p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = 0;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;        }</div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160; </div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;        intBuff[intPos[p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>]][2][p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = <a class="code" href="task_8h.html#a092be3fd5752625303c307620be523ff">xTaskGetTickCountFromISR</a>(); <span class="comment">// when IRQ fired</span></div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160; </div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160; </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a50043108723eacb497b8763d807fc355">I2C_TRANS_START_INT_ST_M</a>) {</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="keywordflow">if</span>(p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a>==<a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187ac00c1b7bda0b29f0b6ff7172bc5c4239">I2C_STARTUP</a>) {</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;                p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a>=<a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a68addd56c2d6a3c3c8c047966a77f77f">I2C_RUNNING</a>;</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;            }</div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160; </div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;            activeInt &amp;=~<a class="code" href="i2c__reg_8h.html#a50043108723eacb497b8763d807fc355">I2C_TRANS_START_INT_ST_M</a>;</div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#ab3ad529c882de397811576e35506ab48">trans_start</a> = 1; <span class="comment">// already enabled? why Again?</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#ab3ad529c882de397811576e35506ab48">trans_start</a> = 1; <span class="comment">// so that will trigger after next &#39;END&#39;</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;        }</div>
<div class="line"><a name="l00934"></a><span class="lineno">  934</span>&#160; </div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a9eb825b493b3fa6ef6fc0ecc33995298">I2C_TXFIFO_EMPTY_INT_ST</a>) {<span class="comment">//should this be before Trans_start?</span></div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            fillTxFifo(p_i2c); <span class="comment">//fillTxFifo will enable/disable/clear interrupt</span></div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            activeInt&amp;=~<a class="code" href="i2c__reg_8h.html#a9eb825b493b3fa6ef6fc0ecc33995298">I2C_TXFIFO_EMPTY_INT_ST</a>;</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;        }</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160; </div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;        <span class="keywordflow">if</span>(activeInt &amp; <a class="code" href="i2c__reg_8h.html#af189e14a82ce53935c15340906746186">I2C_RXFIFO_FULL_INT_ST</a>) {</div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;            emptyRxFifo(p_i2c);</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a676a425504ba43c012aa06d552e5173e">rx_fifo_full</a>=1;</div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a676a425504ba43c012aa06d552e5173e">rx_fifo_full</a>=1; <span class="comment">//why?</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160; </div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;            activeInt &amp;=~<a class="code" href="i2c__reg_8h.html#af189e14a82ce53935c15340906746186">I2C_RXFIFO_FULL_INT_ST</a>;</div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;        }</div>
<div class="line"><a name="l00947"></a><span class="lineno">  947</span>&#160; </div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a850e57ef5a7be95eadb35a0f5ac7aef4">I2C_ACK_ERR_INT_ST_M</a>) {<span class="comment">//fatal error, abort i2c service</span></div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="keywordflow">if</span> (p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a7db81cc506d04e9c8830aa9d7735ff24">mode</a> == <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341faf4ca5227cff9f13557a1bbe51ad02724">I2C_MASTER</a>) {</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;                i2c_update_error_byte_cnt(p_i2c); <span class="comment">// calc which byte caused ack Error, check if address or data</span></div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;                <span class="keywordflow">if</span>(p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> &lt; 0 ) { <span class="comment">// address</span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;                    i2cIsrExit(p_i2c,<a class="code" href="esp32-hal-i2c_8c.html#a73249ae7b0e5d931b975b84998875f6a">EVENT_ERROR_NAK</a>,<span class="keyword">true</span>);</div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;                    i2cIsrExit(p_i2c,<a class="code" href="esp32-hal-i2c_8c.html#af3691dd07d3d90e44b5968f26857ca00">EVENT_ERROR_DATA_NAK</a>,<span class="keyword">true</span>); <span class="comment">//data</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;                }</div>
<div class="line"><a name="l00956"></a><span class="lineno">  956</span>&#160;            }</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;            <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;        }</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160; </div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a58bd3719f0a40ccf05995cb30655301a">I2C_TIME_OUT_INT_ST_M</a>) {</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;            <span class="comment">// let Gross timeout occur, Slave may release SCL before the configured timeout expires</span></div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;            <span class="comment">// the Statemachine only has a 13.1ms max timout, some Devices &gt;500ms</span></div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a2b07d645f43661e8c7ea81044f985799">time_out</a> =1;</div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;            activeInt &amp;=~<a class="code" href="i2c__reg_8h.html#aab489ad80eacb8d9258098e45fff9737">I2C_TIME_OUT_INT_ST</a>;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;          <span class="comment">// since a timeout occurred, capture the rxFifo data </span></div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;            emptyRxFifo(p_i2c);</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a676a425504ba43c012aa06d552e5173e">rx_fifo_full</a>=1;</div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a676a425504ba43c012aa06d552e5173e">rx_fifo_full</a>=1; <span class="comment">//why?</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160; </div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;        }</div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160; </div>
<div class="line"><a name="l00972"></a><span class="lineno">  972</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a0023da2dab9290b30b958f7bd1558b8d">I2C_TRANS_COMPLETE_INT_ST_M</a>) {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a59aa59915fabb1e3cdeb9e84d0d3c3f9">trans_complete</a> = 1;</div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;            i2cIsrExit(p_i2c,<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>,<span class="keyword">false</span>);</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            <span class="keywordflow">return</span>; <span class="comment">// no more work to do</span></div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;            <span class="comment">/*</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;<span class="comment">            // how does slave mode act?</span></div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;<span class="comment">            if (p_i2c-&gt;mode == I2C_SLAVE) { // STOP detected</span></div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;<span class="comment">            // empty fifo</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;<span class="comment">            // dispatch callback</span></div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;        }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160; </div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a888266c919400c4a6961473fcac5648a">I2C_ARBITRATION_LOST_INT_ST_M</a>) { <span class="comment">//fatal</span></div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            i2cIsrExit(p_i2c,<a class="code" href="esp32-hal-i2c_8c.html#a4519c498410bb0d2052812c5faa35a30">EVENT_ERROR_ARBITRATION</a>,<span class="keyword">true</span>);</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;            <span class="keywordflow">return</span>; <span class="comment">// no more work to do</span></div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;        }</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160; </div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a8067e27dbe842a0cd0cf12607766c70f">I2C_SLAVE_TRAN_COMP_INT_ST_M</a>) {</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#adc5a92d3c925aebd6263beb2d0168011">slave_tran_comp</a> = 1;</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;            <span class="comment">// need to complete this !</span></div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;        }</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160; </div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;        <span class="keywordflow">if</span> (activeInt &amp; <a class="code" href="i2c__reg_8h.html#a40c86feff31fd56a6297f3c6655f163e">I2C_END_DETECT_INT_ST_M</a>) {</div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a4fc7f1f13dbbcf5de5a60d57533dfc4e">end_detect</a> = 0;</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a4fc7f1f13dbbcf5de5a60d57533dfc4e">end_detect</a> = 1;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#ab3ad529c882de397811576e35506ab48">trans_start</a>=0;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;            fillCmdQueue(p_i2c,<span class="keyword">true</span>); <span class="comment">// enable interrupts</span></div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#ab3ad529c882de397811576e35506ab48">trans_start</a>=1; <span class="comment">// go for it</span></div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;            activeInt&amp;=~<a class="code" href="i2c__reg_8h.html#a40c86feff31fd56a6297f3c6655f163e">I2C_END_DETECT_INT_ST_M</a>;</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;        }</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160; </div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;        <span class="keywordflow">if</span>(activeInt) { <span class="comment">// clear unhandled if possible?  What about Disabling interrupt?</span></div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = activeInt;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;unknown int=%x&quot;</span>,activeInt);</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;            <span class="comment">// disable unhandled IRQ,</span></div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = p_i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> &amp; (~activeInt);</div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;        }</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160; </div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;<span class="comment">//        activeInt = p_i2c-&gt;dev-&gt;int_status.val; // start all over if another interrupt happened</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;<span class="comment">// 01AUG2018 if another interrupt happened, the OS will schedule another interrupt</span></div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;<span class="comment">// this is the source of spurious interrupts</span></div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;    }</div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;}</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160; </div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;<span class="comment">/* Stickbreaker added for ISR 11/2017</span></div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;<span class="comment">functional with Silicon date=0x16042000</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;<span class="keyword">static</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> i2cAddQueue(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c,<a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> mode, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> i2cDeviceAddr, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> *dataPtr, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> dataLen,<span class="keywordtype">bool</span> sendStop, <span class="keywordtype">bool</span> dataOnly, <a class="code" href="event__groups_8h.html#a5119294106541c4eca46e8742fdb4e85">EventGroupHandle_t</a> <a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>)</div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;{</div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;    <span class="comment">// need to grab a MUTEX for exclusive Queue,</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;    <span class="comment">// what about if ISR is running?</span></div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160; </div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;    <span class="keywordflow">if</span>(i2c==<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;    }</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160; </div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;    <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> dqx;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">data</a> = dataPtr;</div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a> = dataLen;</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a> = 0;</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">cmdBytesNeeded</a> = dataLen;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a745b00de27a02a8e53c9c3c9c864cf49">val</a> = 0;</div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;    <span class="keywordflow">if</span>( dataOnly) {</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;     <span class="comment">/* special case to add a queue data only element.</span></div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;<span class="comment">        START and devAddr will not be sent, this dq element can have a STOP.</span></div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;<span class="comment">        allows multiple buffers to be used for one transaction.</span></div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;<span class="comment">        sequence: normal transaction(sendStop==false), [dataonly(sendStop==false)],dataOnly(sendStop==true)</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;<span class="comment">       *** Currently only works with WRITE, final byte NAK an READ will cause a fail between dq buffer elements.  (in progress 30JUL2018)</span></div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;<span class="comment">        */</span></div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;        dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">startCmdSent</a> = 1; <span class="comment">// mark as already sent</span></div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;        dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">addrCmdSent</a> = 1;</div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;        dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a> = ((i2cDeviceAddr&amp;0xFC00)==0x7800)?2:1; <span class="comment">// 10bit or 7bit address</span></div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;    }</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a> = i2cDeviceAddr;</div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a> = mode;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a39d7190db2ae442c3db2ee3dd04acc38">stop</a>= sendStop;</div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;    dqx.<a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a> = <a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>;</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160; </div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;    <span class="keywordflow">if</span>(<a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>) { <span class="comment">// an eventGroup exist, so, initialize it</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;        <a class="code" href="event__groups_8h.html#a0fb72cfdd4f0d5f86d955fc3af448f2a">xEventGroupClearBits</a>(<a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>, <a class="code" href="esp32-hal-i2c_8c.html#a2886d56a52bad68e04e56f4361e9e92f">EVENT_MASK</a>); <span class="comment">// all of them</span></div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;    }</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160; </div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>!=<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { <span class="comment">// expand</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;        <span class="comment">//log_i(&quot;expand&quot;);</span></div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;        <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>* tq =(<a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#a1b739878adcdb46fb5d209af7ce79628">realloc</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>,<span class="keyword">sizeof</span>(<a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>)*(i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a> +1));</div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;        <span class="keywordflow">if</span>(tq!=<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) { <span class="comment">// ok</span></div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;            i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a> = tq;</div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;            memmove(&amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>++],&amp;dqx,<span class="keyword">sizeof</span>(<a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>));</div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// bad stuff, unable to allocate more memory!</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;realloc Failure&quot;</span>);</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83afe56692036d33b6bed4851e3a97795ab">I2C_ERROR_MEMORY</a>;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;        }</div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// first Time</span></div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;        <span class="comment">//log_i(&quot;new&quot;);</span></div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>=0;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a> =(<a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>));</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;        <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>!=<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;            memmove(&amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>++],&amp;dqx,<span class="keyword">sizeof</span>(<a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a>));</div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;malloc failure&quot;</span>);</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83afe56692036d33b6bed4851e3a97795ab">I2C_ERROR_MEMORY</a>;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;        }</div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;    }</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;}</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160; </div>
<div class="line"><a name="l01079"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a1734a997ffcba9d958bc00b00f58aca6"> 1079</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a2b8f0b1e7cd584246ab629f1d3d80d0a">i2cAddQueueWrite</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> i2cDeviceAddr, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> *dataPtr, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> dataLen,<span class="keywordtype">bool</span> sendStop,<a class="code" href="event__groups_8h.html#a5119294106541c4eca46e8742fdb4e85">EventGroupHandle_t</a> <a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>)</div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;{</div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;    <span class="keywordflow">return</span> i2cAddQueue(i2c,0,i2cDeviceAddr,dataPtr,dataLen,sendStop,<span class="keyword">false</span>,<a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>);</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;}</div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160; </div>
<div class="line"><a name="l01084"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a1b1145b2282170a6afe69cf30f842613"> 1084</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a5b4ef6852cf5a778800d8b9dda16b613">i2cAddQueueRead</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> i2cDeviceAddr, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> *dataPtr, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> dataLen,<span class="keywordtype">bool</span> sendStop,<a class="code" href="event__groups_8h.html#a5119294106541c4eca46e8742fdb4e85">EventGroupHandle_t</a> <a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>)</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;{</div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;    <span class="comment">//10bit read is kind of weird, first you do a 0byte Write with 10bit</span></div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;    <span class="comment">//  address, then a ReSTART then a 7bit Read using the the upper 7bit +</span></div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;    <span class="comment">// readBit.</span></div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160; </div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;    <span class="comment">// this might cause an internal register pointer problem with 10bit</span></div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;    <span class="comment">// devices, But, Don&#39;t have any to test against.</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;    <span class="comment">// this is the Industry Standard specification.</span></div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160; </div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;    <span class="keywordflow">if</span>((i2cDeviceAddr &amp;0xFC00)==0x7800) { <span class="comment">// ten bit read</span></div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;        <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> err = i2cAddQueue(i2c,0,i2cDeviceAddr,<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>,0,<span class="keyword">false</span>,<span class="keyword">false</span>,<a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>);</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;        <span class="keywordflow">if</span>(err==<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>) {</div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;            <span class="keywordflow">return</span> i2cAddQueue(i2c,1,(i2cDeviceAddr&gt;&gt;8),dataPtr,dataLen,sendStop,<span class="keyword">false</span>,<a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>);</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;            <span class="keywordflow">return</span> err;</div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;        }</div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;    }</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;    <span class="keywordflow">return</span> i2cAddQueue(i2c,1,i2cDeviceAddr,dataPtr,dataLen,sendStop,<span class="keyword">false</span>,<a class="code" href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">event</a>);</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;}</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160; </div>
<div class="line"><a name="l01105"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a0285897a5bcf3a47c6302f3dc9da64c9"> 1105</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a0285897a5bcf3a47c6302f3dc9da64c9">i2cProcQueue</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> *readCount, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> timeOutMillis)</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;{</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;    <span class="comment">/* do the hard stuff here</span></div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;<span class="comment">    install ISR if necessary</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;<span class="comment">    setup EventGroup</span></div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;<span class="comment">    handle bus busy?</span></div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;    <span class="comment">//log_e(&quot;procQueue i2c=%p&quot;,&amp;i2c);</span></div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;    <span class="keywordflow">if</span>(readCount){ <span class="comment">//total reads accomplished in all queue elements</span></div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;        *readCount = 0;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;    }</div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;    }</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a> &amp; 0xff000000) i2cTriggerDumps(i2c,(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a>&gt;&gt;24),<span class="stringliteral">&quot;before ProcQueue&quot;</span>);</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;    <span class="keywordflow">if</span> (i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a1694d0cee228028a9de11753f289444e">bus_busy</a>) { <span class="comment">// return error, let TwoWire() handle resetting the hardware.</span></div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;        <span class="comment">/* if multi master then this if should be changed to this 03/12/2018</span></div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;<span class="comment">        if(multiMaster){// try to let the bus clear by its self</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;<span class="comment">            uint32_t timeOutTick = millis();</span></div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;<span class="comment">            while((i2c-&gt;dev-&gt;status_reg.bus_busy)&amp;&amp;(millis()-timeOutTick&lt;timeOutMillis())){</span></div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;<span class="comment">              delay(2); // allow task switch</span></div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;<span class="comment">            }</span></div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;<span class="comment">        }</span></div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;<span class="comment">        if(i2c-&gt;dev-&gt;status_reg.bus_busy){ // still busy, so die</span></div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;<span class="comment">             */</span></div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a>(<span class="stringliteral">&quot;Bus busy, reinit&quot;</span>);</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a845fdb6c4d2815606f3c1755bb0e3aac">I2C_ERROR_BUSY</a>;</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;    }</div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160; </div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a30d636c7aade7e875101380f58b90746">I2C_MUTEX_LOCK</a>();</div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;    <span class="comment">/* what about co-existence with SLAVE mode?</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">    Should I check if a slaveMode xfer is in progress and hang</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"> 1137</span>&#160;<span class="comment">    until it completes?</span></div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;<span class="comment">    if i2c-&gt;stage == I2C_RUNNING or I2C_SLAVE_ACTIVE</span></div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;<span class="comment">     */</span></div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a> = <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad">I2C_DONE</a>; <span class="comment">// until ready</span></div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160; </div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;<span class="preprocessor">#if (ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO) &amp;&amp; (defined ENABLE_I2C_DEBUG_BUFFER)</span></div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;    <span class="keywordflow">for</span>(<a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>=0; <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>&lt;INTBUFFMAX; <a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>++) {</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;        intBuff[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>][0][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = 0;</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;        intBuff[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>][1][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = 0;</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;        intBuff[<a class="code" href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a>][2][i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = 0;</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;    }</div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;    intPos[i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>] = 0;</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;    fifoPos = 0;</div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;    memset(fifoBuffer,0,FIFOMAX);</div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;    <span class="comment">// EventGroup is used to signal transmission completion from ISR</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;    <span class="comment">// not always reliable. Sometimes, the FreeRTOS scheduler is maxed out and refuses request</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"> 1154</span>&#160;    <span class="comment">// if that happens, this call hangs until the timeout period expires, then it continues.</span></div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;    <span class="keywordflow">if</span>(!i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>) {</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a> = xEventGroupCreate();</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>) {</div>
<div class="line"><a name="l01159"></a><span class="lineno"> 1159</span>&#160;        <a class="code" href="event__groups_8h.html#a0fb72cfdd4f0d5f86d955fc3af448f2a">xEventGroupClearBits</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>, 0xFF);</div>
<div class="line"><a name="l01160"></a><span class="lineno"> 1160</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// failed to create EventGroup</span></div>
<div class="line"><a name="l01161"></a><span class="lineno"> 1161</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;eventCreate failed=%p&quot;</span>,i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>);</div>
<div class="line"><a name="l01162"></a><span class="lineno"> 1162</span>&#160;        <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l01163"></a><span class="lineno"> 1163</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83afe56692036d33b6bed4851e3a97795ab">I2C_ERROR_MEMORY</a>;</div>
<div class="line"><a name="l01164"></a><span class="lineno"> 1164</span>&#160;    }</div>
<div class="line"><a name="l01165"></a><span class="lineno"> 1165</span>&#160; </div>
<div class="line"><a name="l01166"></a><span class="lineno"> 1166</span>&#160;    <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01167"></a><span class="lineno"> 1167</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a7db81cc506d04e9c8830aa9d7735ff24">mode</a> = <a class="code" href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341faf4ca5227cff9f13557a1bbe51ad02724">I2C_MASTER</a>;</div>
<div class="line"><a name="l01168"></a><span class="lineno"> 1168</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#ab3ad529c882de397811576e35506ab48">trans_start</a>=0; <span class="comment">// Pause Machine</span></div>
<div class="line"><a name="l01169"></a><span class="lineno"> 1169</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a60e35fd5bf77573b8d0ab8d8ae741e34">timeout</a>.<a class="code" href="structi2c__dev__t.html#a464cdec653f66f9ba7b8bf10ec14b35b">tout</a> = 0xFFFFF; <span class="comment">// max 13ms</span></div>
<div class="line"><a name="l01170"></a><span class="lineno"> 1170</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0x1FFF; <span class="comment">// kill them All!</span></div>
<div class="line"><a name="l01171"></a><span class="lineno"> 1171</span>&#160;    </div>
<div class="line"><a name="l01172"></a><span class="lineno"> 1172</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#a3edbfd55ed118c1297db594e20dbe9a1">ms_mode</a> = 1; <span class="comment">// master!</span></div>
<div class="line"><a name="l01173"></a><span class="lineno"> 1173</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>=0;</div>
<div class="line"><a name="l01174"></a><span class="lineno"> 1174</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a>=0;</div>
<div class="line"><a name="l01175"></a><span class="lineno"> 1175</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a> = 0;</div>
<div class="line"><a name="l01176"></a><span class="lineno"> 1176</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> totalBytes=0; <span class="comment">// total number of bytes to be Moved!</span></div>
<div class="line"><a name="l01177"></a><span class="lineno"> 1177</span>&#160;    <span class="comment">// convert address field to required I2C format</span></div>
<div class="line"><a name="l01178"></a><span class="lineno"> 1178</span>&#160;    <span class="keywordflow">while</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a> &lt; i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>) { <span class="comment">// need to push these address modes upstream, to AddQueue</span></div>
<div class="line"><a name="l01179"></a><span class="lineno"> 1179</span>&#160;        <a class="code" href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a> *tdq = &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>++];</div>
<div class="line"><a name="l01180"></a><span class="lineno"> 1180</span>&#160;        <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> taddr=0;</div>
<div class="line"><a name="l01181"></a><span class="lineno"> 1181</span>&#160;        <span class="keywordflow">if</span>(tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a> ==2) { <span class="comment">// 10bit address</span></div>
<div class="line"><a name="l01182"></a><span class="lineno"> 1182</span>&#160;            taddr =((tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a> &gt;&gt; 7) &amp; 0xFE)</div>
<div class="line"><a name="l01183"></a><span class="lineno"> 1183</span>&#160;                   |tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>;</div>
<div class="line"><a name="l01184"></a><span class="lineno"> 1184</span>&#160;            taddr = (taddr &lt;&lt;8) | (tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&amp;0xFF);</div>
<div class="line"><a name="l01185"></a><span class="lineno"> 1185</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// 7bit address</span></div>
<div class="line"><a name="l01186"></a><span class="lineno"> 1186</span>&#160;            taddr =  ((tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a>&lt;&lt;1)&amp;0xFE)</div>
<div class="line"><a name="l01187"></a><span class="lineno"> 1187</span>&#160;                     |tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>;</div>
<div class="line"><a name="l01188"></a><span class="lineno"> 1188</span>&#160;        }</div>
<div class="line"><a name="l01189"></a><span class="lineno"> 1189</span>&#160;        tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">addr</a> = taddr; <span class="comment">// all fixed with R/W bit</span></div>
<div class="line"><a name="l01190"></a><span class="lineno"> 1190</span>&#160;        totalBytes += tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">length</a> + tdq-&gt;<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">addrReq</a>; <span class="comment">// total number of byte to be moved!</span></div>
<div class="line"><a name="l01191"></a><span class="lineno"> 1191</span>&#160;    }</div>
<div class="line"><a name="l01192"></a><span class="lineno"> 1192</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>=0;</div>
<div class="line"><a name="l01193"></a><span class="lineno"> 1193</span>&#160; </div>
<div class="line"><a name="l01194"></a><span class="lineno"> 1194</span>&#160;    fillCmdQueue(i2c,<span class="keyword">false</span>); <span class="comment">// don&#39;t enable Tx/RX irq&#39;s</span></div>
<div class="line"><a name="l01195"></a><span class="lineno"> 1195</span>&#160;    <span class="comment">// start adding command[], END irq will keep it full</span></div>
<div class="line"><a name="l01196"></a><span class="lineno"> 1196</span>&#160;    <span class="comment">//Data Fifo will be filled after trans_start is issued</span></div>
<div class="line"><a name="l01197"></a><span class="lineno"> 1197</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#aca9f378e0051c0f049ca7ddd60ad4cbd">exitCode</a>=0;</div>
<div class="line"><a name="l01198"></a><span class="lineno"> 1198</span>&#160; </div>
<div class="line"><a name="l01199"></a><span class="lineno"> 1199</span>&#160;    <a class="code" href="unionI2C__FIFO__CONF__t.html">I2C_FIFO_CONF_t</a> f;</div>
<div class="line"><a name="l01200"></a><span class="lineno"> 1200</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">val</a> = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89c28654ad7d9c55847e3ac544d61929">fifo_conf</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l01201"></a><span class="lineno"> 1201</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#ab9700d95fe090c521d39ccc62cec2bf0">rx_fifo_rst</a> = 1; <span class="comment">// fifo in reset</span></div>
<div class="line"><a name="l01202"></a><span class="lineno"> 1202</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#afb71c50ad66a58c8cce3f9be94a1aad4">tx_fifo_rst</a> = 1; <span class="comment">// fifo in reset</span></div>
<div class="line"><a name="l01203"></a><span class="lineno"> 1203</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#a3dbb707d1ba9233784a82c004ca41841">nonfifo_en</a> = 0; <span class="comment">// use fifo mode</span></div>
<div class="line"><a name="l01204"></a><span class="lineno"> 1204</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#a68e930ea3b13e9725cb0629458fa9319">nonfifo_tx_thres</a> = 31;</div>
<div class="line"><a name="l01205"></a><span class="lineno"> 1205</span>&#160;    <span class="comment">// need to adjust threshold based on I2C clock rate, at 100k, 30 usually works,</span></div>
<div class="line"><a name="l01206"></a><span class="lineno"> 1206</span>&#160;    <span class="comment">// sometimes the emptyRx() actually moves 31 bytes</span></div>
<div class="line"><a name="l01207"></a><span class="lineno"> 1207</span>&#160;    <span class="comment">// it hasn&#39;t overflowed yet, I cannot tell if the new byte is added while</span></div>
<div class="line"><a name="l01208"></a><span class="lineno"> 1208</span>&#160;    <span class="comment">// emptyRX() is executing or before?</span></div>
<div class="line"><a name="l01209"></a><span class="lineno"> 1209</span>&#160;  <span class="comment">// let i2cSetFrequency() set thrhds  </span></div>
<div class="line"><a name="l01210"></a><span class="lineno"> 1210</span>&#160;  <span class="comment">//   f.rx_fifo_full_thrhd = 30; // 30 bytes before INT is issued</span></div>
<div class="line"><a name="l01211"></a><span class="lineno"> 1211</span>&#160;  <span class="comment">//  f.tx_fifo_empty_thrhd = 0;</span></div>
<div class="line"><a name="l01212"></a><span class="lineno"> 1212</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#aeec9aef89194d9e4cd0ec68ab07fa205">fifo_addr_cfg_en</a> = 0; <span class="comment">// no directed access</span></div>
<div class="line"><a name="l01213"></a><span class="lineno"> 1213</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89c28654ad7d9c55847e3ac544d61929">fifo_conf</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = f.<a class="code" href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">val</a>; <span class="comment">// post them all</span></div>
<div class="line"><a name="l01214"></a><span class="lineno"> 1214</span>&#160; </div>
<div class="line"><a name="l01215"></a><span class="lineno"> 1215</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#ab9700d95fe090c521d39ccc62cec2bf0">rx_fifo_rst</a> = 0; <span class="comment">// release fifo</span></div>
<div class="line"><a name="l01216"></a><span class="lineno"> 1216</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#afb71c50ad66a58c8cce3f9be94a1aad4">tx_fifo_rst</a> = 0;</div>
<div class="line"><a name="l01217"></a><span class="lineno"> 1217</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89c28654ad7d9c55847e3ac544d61929">fifo_conf</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = f.<a class="code" href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">val</a>; <span class="comment">// post them all</span></div>
<div class="line"><a name="l01218"></a><span class="lineno"> 1218</span>&#160; </div>
<div class="line"><a name="l01219"></a><span class="lineno"> 1219</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a> = <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187ac00c1b7bda0b29f0b6ff7172bc5c4239">I2C_STARTUP</a>; <span class="comment">// everything configured, now start the I2C StateMachine, and</span></div>
<div class="line"><a name="l01220"></a><span class="lineno"> 1220</span>&#160;    <span class="comment">// As soon as interrupts are enabled, the ISR will start handling them.</span></div>
<div class="line"><a name="l01221"></a><span class="lineno"> 1221</span>&#160;    <span class="comment">// it should receive a TXFIFO_EMPTY immediately, even before it</span></div>
<div class="line"><a name="l01222"></a><span class="lineno"> 1222</span>&#160;    <span class="comment">// receives the TRANS_START</span></div>
<div class="line"><a name="l01223"></a><span class="lineno"> 1223</span>&#160; </div>
<div class="line"><a name="l01224"></a><span class="lineno"> 1224</span>&#160;    </div>
<div class="line"><a name="l01225"></a><span class="lineno"> 1225</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> interruptsEnabled =</div>
<div class="line"><a name="l01226"></a><span class="lineno"> 1226</span>&#160;        <a class="code" href="i2c__reg_8h.html#a01d3757a37489f27e7bc21b6d7b94e65">I2C_ACK_ERR_INT_ENA</a> | <span class="comment">// (BIT(10))  Causes Fatal Error Exit</span></div>
<div class="line"><a name="l01227"></a><span class="lineno"> 1227</span>&#160;        <a class="code" href="i2c__reg_8h.html#af6fcafa997203a3a0b597826f2cf7f0e">I2C_TRANS_START_INT_ENA</a> | <span class="comment">// (BIT(9))  Triggered by trans_start=1, initial,END</span></div>
<div class="line"><a name="l01228"></a><span class="lineno"> 1228</span>&#160;        <a class="code" href="i2c__reg_8h.html#a6bee57099c576e9d24180fc06236d8d4">I2C_TIME_OUT_INT_ENA</a>  | <span class="comment">//(BIT(8))  Trigger by SLAVE SCL stretching, NOT an ERROR</span></div>
<div class="line"><a name="l01229"></a><span class="lineno"> 1229</span>&#160;        <a class="code" href="i2c__reg_8h.html#a9ff855baf1376e63d4e9cec27f28b62b">I2C_TRANS_COMPLETE_INT_ENA</a> | <span class="comment">// (BIT(7))  triggered by STOP, successful exit</span></div>
<div class="line"><a name="l01230"></a><span class="lineno"> 1230</span>&#160;        <a class="code" href="i2c__reg_8h.html#a2e2624c8eb2b28797f651a1f88653ae7">I2C_ARBITRATION_LOST_INT_ENA</a> | <span class="comment">// (BIT(5))  cause fatal error exit</span></div>
<div class="line"><a name="l01231"></a><span class="lineno"> 1231</span>&#160;        <a class="code" href="i2c__reg_8h.html#a730540e6ee43d14d9cd60b7db10a87a3">I2C_SLAVE_TRAN_COMP_INT_ENA</a>  | <span class="comment">// (BIT(4))  unhandled</span></div>
<div class="line"><a name="l01232"></a><span class="lineno"> 1232</span>&#160;        <a class="code" href="i2c__reg_8h.html#a999453461409e71e43e30d829ab8ac54">I2C_END_DETECT_INT_ENA</a>  | <span class="comment">// (BIT(3))   refills cmd[] list</span></div>
<div class="line"><a name="l01233"></a><span class="lineno"> 1233</span>&#160;        <a class="code" href="i2c__reg_8h.html#a8f7e3266a6af57a9c2a96c17c2d9343c">I2C_RXFIFO_OVF_INT_ENA</a>  | <span class="comment">//(BIT(2))  unhandled</span></div>
<div class="line"><a name="l01234"></a><span class="lineno"> 1234</span>&#160;        <a class="code" href="i2c__reg_8h.html#a1a0cbfd2b9fa1dbadad974fc7fdb019e">I2C_TXFIFO_EMPTY_INT_ENA</a> | <span class="comment">// (BIT(1))    triggers fillTxFifo()</span></div>
<div class="line"><a name="l01235"></a><span class="lineno"> 1235</span>&#160;        <a class="code" href="i2c__reg_8h.html#af132d6cb4090b6f2902bbac45317048f">I2C_RXFIFO_FULL_INT_ENA</a>;  <span class="comment">// (BIT(0))     trigger emptyRxFifo()</span></div>
<div class="line"><a name="l01236"></a><span class="lineno"> 1236</span>&#160;  </div>
<div class="line"><a name="l01237"></a><span class="lineno"> 1237</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = interruptsEnabled;</div>
<div class="line"><a name="l01238"></a><span class="lineno"> 1238</span>&#160; </div>
<div class="line"><a name="l01239"></a><span class="lineno"> 1239</span>&#160;    <span class="keywordflow">if</span>(!i2c-&gt;<a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>) { <span class="comment">// create ISR for either peripheral</span></div>
<div class="line"><a name="l01240"></a><span class="lineno"> 1240</span>&#160;        <span class="comment">// log_i(&quot;create ISR %d&quot;,i2c-&gt;num);</span></div>
<div class="line"><a name="l01241"></a><span class="lineno"> 1241</span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> ret = 0;</div>
<div class="line"><a name="l01242"></a><span class="lineno"> 1242</span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a> = <a class="code" href="group__Intr__Alloc.html#ga3fb8d6fa8b5e33b3503e86917bc8367b">ESP_INTR_FLAG_IRAM</a> |  <span class="comment">//&lt; ISR can be called if cache is disabled</span></div>
<div class="line"><a name="l01243"></a><span class="lineno"> 1243</span>&#160;          <a class="code" href="group__Intr__Alloc.html#ga9b0bc1a2b5cc22b499e041742ae1b17b">ESP_INTR_FLAG_LOWMED</a> |   <span class="comment">//&lt; Low and medium prio interrupts. These can be handled in C.</span></div>
<div class="line"><a name="l01244"></a><span class="lineno"> 1244</span>&#160;          <a class="code" href="group__Intr__Alloc.html#gafc7bfcea2e621d81336ea6dd23310363">ESP_INTR_FLAG_SHARED</a>; <span class="comment">//&lt; Reduce resource requirements, Share interrupts</span></div>
<div class="line"><a name="l01245"></a><span class="lineno"> 1245</span>&#160;      </div>
<div class="line"><a name="l01246"></a><span class="lineno"> 1246</span>&#160;        <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>) {</div>
<div class="line"><a name="l01247"></a><span class="lineno"> 1247</span>&#160;            ret = <a class="code" href="esp__intr__alloc_8h.html#ab8535ce94aafbeaefed76f5dfa6cfc94">esp_intr_alloc_intrstatus</a>(<a class="code" href="soc_8h.html#a0c36237cc6b5140fd0cf1e449d177809">ETS_I2C_EXT1_INTR_SOURCE</a>, <a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>, (<a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>)&amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a62d02036f90458d22533b20f37603b8b">int_status</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>, interruptsEnabled, &amp;i2c_isr_handler_default,i2c, &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>);</div>
<div class="line"><a name="l01248"></a><span class="lineno"> 1248</span>&#160;        } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01249"></a><span class="lineno"> 1249</span>&#160;            ret = <a class="code" href="esp__intr__alloc_8h.html#ab8535ce94aafbeaefed76f5dfa6cfc94">esp_intr_alloc_intrstatus</a>(<a class="code" href="soc_8h.html#a7d9e1c6df766f10c2905df77f970e2c6">ETS_I2C_EXT0_INTR_SOURCE</a>, <a class="code" href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a>, (<a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a>)&amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a62d02036f90458d22533b20f37603b8b">int_status</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>, interruptsEnabled, &amp;i2c_isr_handler_default,i2c, &amp;i2c-&gt;<a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>);</div>
<div class="line"><a name="l01250"></a><span class="lineno"> 1250</span>&#160;        }</div>
<div class="line"><a name="l01251"></a><span class="lineno"> 1251</span>&#160; </div>
<div class="line"><a name="l01252"></a><span class="lineno"> 1252</span>&#160;        <span class="keywordflow">if</span>(ret!=<a class="code" href="esp__err_8h.html#abdbffa06442bc1fe3d65dbb8d17656d1">ESP_OK</a>) {</div>
<div class="line"><a name="l01253"></a><span class="lineno"> 1253</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;install interrupt handler Failed=%d&quot;</span>,ret);</div>
<div class="line"><a name="l01254"></a><span class="lineno"> 1254</span>&#160;            <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l01255"></a><span class="lineno"> 1255</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83afe56692036d33b6bed4851e3a97795ab">I2C_ERROR_MEMORY</a>;</div>
<div class="line"><a name="l01256"></a><span class="lineno"> 1256</span>&#160;        }</div>
<div class="line"><a name="l01257"></a><span class="lineno"> 1257</span>&#160;        <span class="keywordflow">if</span>( !<a class="code" href="esp32-hal-cpu_8c.html#ad7389b1cd9f6a2d4326b50e04f533e17">addApbChangeCallback</a>( i2c, i2cApbChangeCallback)) {</div>
<div class="line"><a name="l01258"></a><span class="lineno"> 1258</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;install apb Callback failed&quot;</span>);</div>
<div class="line"><a name="l01259"></a><span class="lineno"> 1259</span>&#160;            <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l01260"></a><span class="lineno"> 1260</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01261"></a><span class="lineno"> 1261</span>&#160;        }</div>
<div class="line"><a name="l01262"></a><span class="lineno"> 1262</span>&#160; </div>
<div class="line"><a name="l01263"></a><span class="lineno"> 1263</span>&#160;    }</div>
<div class="line"><a name="l01264"></a><span class="lineno"> 1264</span>&#160;    <span class="comment">//hang until it completes.</span></div>
<div class="line"><a name="l01265"></a><span class="lineno"> 1265</span>&#160; </div>
<div class="line"><a name="l01266"></a><span class="lineno"> 1266</span>&#160;    <span class="comment">// how many ticks should it take to transfer totalBytes through the I2C hardware,</span></div>
<div class="line"><a name="l01267"></a><span class="lineno"> 1267</span>&#160;    <span class="comment">// add user supplied timeOutMillis to Calculated Value</span></div>
<div class="line"><a name="l01268"></a><span class="lineno"> 1268</span>&#160; </div>
<div class="line"><a name="l01269"></a><span class="lineno"> 1269</span>&#160;    <a class="code" href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html#a324d7087026e1e9dfe6b7567d5bf63c8">portTickType</a> ticksTimeOut = ((totalBytes*10*1000)/(<a class="code" href="esp32-hal-i2c_8c.html#a76839c845b68b6104dd8f77b5c08d478">i2cGetFrequency</a>(i2c))+timeOutMillis)/<a class="code" href="portmacro_8h.html#a554d9322ce7f698a86a22b21234bd8cd">portTICK_PERIOD_MS</a>;</div>
<div class="line"><a name="l01270"></a><span class="lineno"> 1270</span>&#160; </div>
<div class="line"><a name="l01271"></a><span class="lineno"> 1271</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#ab3ad529c882de397811576e35506ab48">trans_start</a>=1; <span class="comment">// go for it</span></div>
<div class="line"><a name="l01272"></a><span class="lineno"> 1272</span>&#160; </div>
<div class="line"><a name="l01273"></a><span class="lineno"> 1273</span>&#160;<span class="preprocessor">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_DEBUG</span></div>
<div class="line"><a name="l01274"></a><span class="lineno"> 1274</span>&#160;    <a class="code" href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html#a324d7087026e1e9dfe6b7567d5bf63c8">portTickType</a> tBefore=<a class="code" href="task_8h.html#a753ecfe23e7386066ecccad5d16422f7">xTaskGetTickCount</a>();</div>
<div class="line"><a name="l01275"></a><span class="lineno"> 1275</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01276"></a><span class="lineno"> 1276</span>&#160;    </div>
<div class="line"><a name="l01277"></a><span class="lineno"> 1277</span>&#160;    <span class="comment">// wait for ISR to complete the transfer, or until timeOut in case of bus fault, hardware problem</span></div>
<div class="line"><a name="l01278"></a><span class="lineno"> 1278</span>&#160;    </div>
<div class="line"><a name="l01279"></a><span class="lineno"> 1279</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> eBits = <a class="code" href="event__groups_8h.html#aab9d5b405bc57b7624dcabe9a9a503db">xEventGroupWaitBits</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>,<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>,<a class="code" href="projdefs_8h.html#aa56260e937e7e203026707e5ba944273">pdFALSE</a>,<a class="code" href="projdefs_8h.html#af268cf937960eb029256bd9c4d949fbe">pdTRUE</a>,ticksTimeOut);</div>
<div class="line"><a name="l01280"></a><span class="lineno"> 1280</span>&#160; </div>
<div class="line"><a name="l01281"></a><span class="lineno"> 1281</span>&#160;<span class="preprocessor">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_DEBUG</span></div>
<div class="line"><a name="l01282"></a><span class="lineno"> 1282</span>&#160;    <a class="code" href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html#a324d7087026e1e9dfe6b7567d5bf63c8">portTickType</a> tAfter=<a class="code" href="task_8h.html#a753ecfe23e7386066ecccad5d16422f7">xTaskGetTickCount</a>();</div>
<div class="line"><a name="l01283"></a><span class="lineno"> 1283</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01284"></a><span class="lineno"> 1284</span>&#160; </div>
<div class="line"><a name="l01285"></a><span class="lineno"> 1285</span>&#160; </div>
<div class="line"><a name="l01286"></a><span class="lineno"> 1286</span>&#160;    <span class="comment">// if xEventGroupSetBitsFromISR() failed, the ISR could have succeeded but never been</span></div>
<div class="line"><a name="l01287"></a><span class="lineno"> 1287</span>&#160;    <span class="comment">// able to mark the success</span></div>
<div class="line"><a name="l01288"></a><span class="lineno"> 1288</span>&#160; </div>
<div class="line"><a name="l01289"></a><span class="lineno"> 1289</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#aca9f378e0051c0f049ca7ddd60ad4cbd">exitCode</a>!=eBits) { <span class="comment">// try to recover from O/S failure</span></div>
<div class="line"><a name="l01290"></a><span class="lineno"> 1290</span>&#160;        <span class="comment">//  log_e(&quot;EventGroup Failed:%p!=%p&quot;,eBits,i2c-&gt;exitCode);</span></div>
<div class="line"><a name="l01291"></a><span class="lineno"> 1291</span>&#160;        eBits=i2c-&gt;<a class="code" href="structi2c__struct__t.html#aca9f378e0051c0f049ca7ddd60ad4cbd">exitCode</a>;</div>
<div class="line"><a name="l01292"></a><span class="lineno"> 1292</span>&#160;    }</div>
<div class="line"><a name="l01293"></a><span class="lineno"> 1293</span>&#160;    <span class="keywordflow">if</span>((eBits&amp;<a class="code" href="esp32-hal-i2c_8c.html#a386cca3372545d35239c7c9deeb704f3">EVENT_ERROR</a>)||(!(eBits &amp; <a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>))){ <span class="comment">// need accurate errorByteCnt for debug</span></div>
<div class="line"><a name="l01294"></a><span class="lineno"> 1294</span>&#160;      i2c_update_error_byte_cnt(i2c);</div>
<div class="line"><a name="l01295"></a><span class="lineno"> 1295</span>&#160;    }</div>
<div class="line"><a name="l01296"></a><span class="lineno"> 1296</span>&#160; </div>
<div class="line"><a name="l01297"></a><span class="lineno"> 1297</span>&#160;    <span class="keywordflow">if</span>(!(eBits==<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>)&amp;&amp;(eBits&amp;~(<a class="code" href="esp32-hal-i2c_8c.html#a73249ae7b0e5d931b975b84998875f6a">EVENT_ERROR_NAK</a>|<a class="code" href="esp32-hal-i2c_8c.html#af3691dd07d3d90e44b5968f26857ca00">EVENT_ERROR_DATA_NAK</a>|<a class="code" href="esp32-hal-i2c_8c.html#a386cca3372545d35239c7c9deeb704f3">EVENT_ERROR</a>|<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>))) { <span class="comment">// not only Done, therefore error, exclude ADDR NAK, DATA_NAK</span></div>
<div class="line"><a name="l01298"></a><span class="lineno"> 1298</span>&#160;<span class="preprocessor">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_INFO</span></div>
<div class="line"><a name="l01299"></a><span class="lineno"> 1299</span>&#160;        i2cDumpI2c(i2c);</div>
<div class="line"><a name="l01300"></a><span class="lineno"> 1300</span>&#160;        i2cDumpInts(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>);</div>
<div class="line"><a name="l01301"></a><span class="lineno"> 1301</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01302"></a><span class="lineno"> 1302</span>&#160;    }</div>
<div class="line"><a name="l01303"></a><span class="lineno"> 1303</span>&#160; </div>
<div class="line"><a name="l01304"></a><span class="lineno"> 1304</span>&#160;    <span class="keywordflow">if</span>(eBits&amp;<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>) { <span class="comment">// no gross timeout</span></div>
<div class="line"><a name="l01305"></a><span class="lineno"> 1305</span>&#160;        <span class="keywordflow">switch</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a>) {</div>
<div class="line"><a name="l01306"></a><span class="lineno"> 1306</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3aeceba296bdda2b90e8835c431fe7a72a">I2C_OK</a> :</div>
<div class="line"><a name="l01307"></a><span class="lineno"> 1307</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01308"></a><span class="lineno"> 1308</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01309"></a><span class="lineno"> 1309</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a2e4932a1868432bff23103fac0127fdc">I2C_ERROR</a> :</div>
<div class="line"><a name="l01310"></a><span class="lineno"> 1310</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01311"></a><span class="lineno"> 1311</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01312"></a><span class="lineno"> 1312</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3adf30cba98e655e4327b882990103cd03">I2C_ADDR_NAK</a>:</div>
<div class="line"><a name="l01313"></a><span class="lineno"> 1313</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a6b7ba78b8ad1e491de04b31ab0ffbb8e">I2C_ERROR_ACK</a>;</div>
<div class="line"><a name="l01314"></a><span class="lineno"> 1314</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01315"></a><span class="lineno"> 1315</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3ae6a8bc51a7b7474f8c2b3c2163e5bd49">I2C_DATA_NAK</a>:</div>
<div class="line"><a name="l01316"></a><span class="lineno"> 1316</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a6b7ba78b8ad1e491de04b31ab0ffbb8e">I2C_ERROR_ACK</a>;</div>
<div class="line"><a name="l01317"></a><span class="lineno"> 1317</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01318"></a><span class="lineno"> 1318</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a9e1aeef18f20ebbd58caa3082ded5ef6">I2C_ARBITRATION</a>:</div>
<div class="line"><a name="l01319"></a><span class="lineno"> 1319</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83af2a92feb58cfefb6fbda0e5d0c2aadf2">I2C_ERROR_BUS</a>;</div>
<div class="line"><a name="l01320"></a><span class="lineno"> 1320</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01321"></a><span class="lineno"> 1321</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a1056d6a4b037e383132309c2898a2fc8">I2C_TIMEOUT</a>:</div>
<div class="line"><a name="l01322"></a><span class="lineno"> 1322</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a7a8a638a6deda6c6943409e9e4cae099">I2C_ERROR_TIMEOUT</a>;</div>
<div class="line"><a name="l01323"></a><span class="lineno"> 1323</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01324"></a><span class="lineno"> 1324</span>&#160;        <a class="code" href="namespaceimageconverter.html#a43b15cf6044906a354902441c7f02f5c">default</a> :</div>
<div class="line"><a name="l01325"></a><span class="lineno"> 1325</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01326"></a><span class="lineno"> 1326</span>&#160;        }</div>
<div class="line"><a name="l01327"></a><span class="lineno"> 1327</span>&#160;    } <span class="keywordflow">else</span> { <span class="comment">// GROSS timeout, shutdown ISR , report Timeout</span></div>
<div class="line"><a name="l01328"></a><span class="lineno"> 1328</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">stage</a> = <a class="code" href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad">I2C_DONE</a>;</div>
<div class="line"><a name="l01329"></a><span class="lineno"> 1329</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">int_ena</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> =0;</div>
<div class="line"><a name="l01330"></a><span class="lineno"> 1330</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">int_clr</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0x1FFF;</div>
<div class="line"><a name="l01331"></a><span class="lineno"> 1331</span>&#160;        i2c_update_error_byte_cnt(i2c);</div>
<div class="line"><a name="l01332"></a><span class="lineno"> 1332</span>&#160;        <span class="keywordflow">if</span>((i2c-&gt;<a class="code" href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">errorByteCnt</a> == 0)&amp;&amp;(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">errorQueue</a>==0)) { <span class="comment">// Bus Busy no bytes Moved</span></div>
<div class="line"><a name="l01333"></a><span class="lineno"> 1333</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a845fdb6c4d2815606f3c1755bb0e3aac">I2C_ERROR_BUSY</a>;</div>
<div class="line"><a name="l01334"></a><span class="lineno"> 1334</span>&#160;            eBits = eBits | <a class="code" href="esp32-hal-i2c_8c.html#a9554ab32654736a43a1527a1aab100c2">EVENT_ERROR_BUS_BUSY</a>|<a class="code" href="esp32-hal-i2c_8c.html#a386cca3372545d35239c7c9deeb704f3">EVENT_ERROR</a>|<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>;</div>
<div class="line"><a name="l01335"></a><span class="lineno"> 1335</span>&#160;<span class="preprocessor">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_DEBUG</span></div>
<div class="line"><a name="l01336"></a><span class="lineno"> 1336</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a1de06c4fd79189513953309af5b5593a">log_d</a>(<span class="stringliteral">&quot; Busy Timeout start=0x%x, end=0x%x, =%d, max=%d error=%d&quot;</span>,tBefore,tAfter,(tAfter-tBefore),ticksTimeOut,i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a>);</div>
<div class="line"><a name="l01337"></a><span class="lineno"> 1337</span>&#160;            i2cDumpI2c(i2c);</div>
<div class="line"><a name="l01338"></a><span class="lineno"> 1338</span>&#160;            i2cDumpInts(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>);</div>
<div class="line"><a name="l01339"></a><span class="lineno"> 1339</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01340"></a><span class="lineno"> 1340</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// just a timeout, some data made it out or in.</span></div>
<div class="line"><a name="l01341"></a><span class="lineno"> 1341</span>&#160;            <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a> = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a7a8a638a6deda6c6943409e9e4cae099">I2C_ERROR_TIMEOUT</a>;</div>
<div class="line"><a name="l01342"></a><span class="lineno"> 1342</span>&#160;            eBits = eBits | <a class="code" href="esp32-hal-i2c_8c.html#a4b20ffd4cf1946602c6fdca18f2f6b93">EVENT_ERROR_TIMEOUT</a>|<a class="code" href="esp32-hal-i2c_8c.html#a386cca3372545d35239c7c9deeb704f3">EVENT_ERROR</a>|<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>;</div>
<div class="line"><a name="l01343"></a><span class="lineno"> 1343</span>&#160; </div>
<div class="line"><a name="l01344"></a><span class="lineno"> 1344</span>&#160;<span class="preprocessor">#if ARDUHAL_LOG_LEVEL &gt;= ARDUHAL_LOG_LEVEL_DEBUG</span></div>
<div class="line"><a name="l01345"></a><span class="lineno"> 1345</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a1de06c4fd79189513953309af5b5593a">log_d</a>(<span class="stringliteral">&quot; Gross Timeout Dead start=0x%x, end=0x%x, =%d, max=%d error=%d&quot;</span>,tBefore,tAfter,(tAfter-tBefore),ticksTimeOut,i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">error</a>);</div>
<div class="line"><a name="l01346"></a><span class="lineno"> 1346</span>&#160;            i2cDumpI2c(i2c);</div>
<div class="line"><a name="l01347"></a><span class="lineno"> 1347</span>&#160;            i2cDumpInts(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>);</div>
<div class="line"><a name="l01348"></a><span class="lineno"> 1348</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01349"></a><span class="lineno"> 1349</span>&#160;        }</div>
<div class="line"><a name="l01350"></a><span class="lineno"> 1350</span>&#160;    }</div>
<div class="line"><a name="l01351"></a><span class="lineno"> 1351</span>&#160; </div>
<div class="line"><a name="l01352"></a><span class="lineno"> 1352</span>&#160;    <span class="comment">/* offloading all EventGroups to dispatch, EventGroups in ISR is not always successful</span></div>
<div class="line"><a name="l01353"></a><span class="lineno"> 1353</span>&#160;<span class="comment">     11/20/2017</span></div>
<div class="line"><a name="l01354"></a><span class="lineno"> 1354</span>&#160;<span class="comment">       if error, need to trigger all succeeding dataQueue events with the EVENT_ERROR_PREV</span></div>
<div class="line"><a name="l01355"></a><span class="lineno"> 1355</span>&#160;<span class="comment">     07/22/2018</span></div>
<div class="line"><a name="l01356"></a><span class="lineno"> 1356</span>&#160;<span class="comment">       Need to use the queueEvent value to identify transaction blocks, if an error occurs,</span></div>
<div class="line"><a name="l01357"></a><span class="lineno"> 1357</span>&#160;<span class="comment">       all subsequent queue items with the same queueEvent value will receive the EVENT_ERROR_PREV.</span></div>
<div class="line"><a name="l01358"></a><span class="lineno"> 1358</span>&#160;<span class="comment">       But, ProcQue should re-queue queue items that have a different queueEvent value(different transaction)</span></div>
<div class="line"><a name="l01359"></a><span class="lineno"> 1359</span>&#160;<span class="comment">       This change will support multi-thread i2c usage.  Use the queueEvent as the transaction event</span></div>
<div class="line"><a name="l01360"></a><span class="lineno"> 1360</span>&#160;<span class="comment">       identifier.</span></div>
<div class="line"><a name="l01361"></a><span class="lineno"> 1361</span>&#160;<span class="comment">    */</span></div>
<div class="line"><a name="l01362"></a><span class="lineno"> 1362</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a> = 0;</div>
<div class="line"><a name="l01363"></a><span class="lineno"> 1363</span>&#160; </div>
<div class="line"><a name="l01364"></a><span class="lineno"> 1364</span>&#160;    <span class="keywordflow">while</span>(b &lt; i2c-&gt;queueCount) {</div>
<div class="line"><a name="l01365"></a><span class="lineno"> 1365</span>&#160;        <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">ctrl</a>.<a class="code" href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">mode</a>==1 &amp;&amp; readCount) {</div>
<div class="line"><a name="l01366"></a><span class="lineno"> 1366</span>&#160;            *readCount += i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">position</a>; <span class="comment">// number of data bytes received</span></div>
<div class="line"><a name="l01367"></a><span class="lineno"> 1367</span>&#160;        }</div>
<div class="line"><a name="l01368"></a><span class="lineno"> 1368</span>&#160;        <span class="keywordflow">if</span>(b &lt; i2c-&gt;queuePos) { <span class="comment">// before any error</span></div>
<div class="line"><a name="l01369"></a><span class="lineno"> 1369</span>&#160;            <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a>) { <span class="comment">// this data queue element has an EventGroup</span></div>
<div class="line"><a name="l01370"></a><span class="lineno"> 1370</span>&#160;                <a class="code" href="event__groups_8h.html#a02d7b3bb55f7e11d9c47116266c5fb2e">xEventGroupSetBits</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a>,<a class="code" href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a>);</div>
<div class="line"><a name="l01371"></a><span class="lineno"> 1371</span>&#160;            }</div>
<div class="line"><a name="l01372"></a><span class="lineno"> 1372</span>&#160;        } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a> == i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>) { <span class="comment">// last processed queue</span></div>
<div class="line"><a name="l01373"></a><span class="lineno"> 1373</span>&#160;            <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a>) { <span class="comment">// this data queue element has an EventGroup</span></div>
<div class="line"><a name="l01374"></a><span class="lineno"> 1374</span>&#160;                <a class="code" href="event__groups_8h.html#a02d7b3bb55f7e11d9c47116266c5fb2e">xEventGroupSetBits</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a>,eBits);</div>
<div class="line"><a name="l01375"></a><span class="lineno"> 1375</span>&#160;            }</div>
<div class="line"><a name="l01376"></a><span class="lineno"> 1376</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// never processed queues</span></div>
<div class="line"><a name="l01377"></a><span class="lineno"> 1377</span>&#160;            <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a>) { <span class="comment">// this data queue element has an EventGroup</span></div>
<div class="line"><a name="l01378"></a><span class="lineno"> 1378</span>&#160;                <a class="code" href="event__groups_8h.html#a02d7b3bb55f7e11d9c47116266c5fb2e">xEventGroupSetBits</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>[<a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>].<a class="code" href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">queueEvent</a>,eBits|<a class="code" href="esp32-hal-i2c_8c.html#a84f8a4430731e9fb4f3ca13298695ad1">EVENT_ERROR_PREV</a>);</div>
<div class="line"><a name="l01379"></a><span class="lineno"> 1379</span>&#160;            }</div>
<div class="line"><a name="l01380"></a><span class="lineno"> 1380</span>&#160;        }</div>
<div class="line"><a name="l01381"></a><span class="lineno"> 1381</span>&#160;        <a class="code" href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">b</a>++;</div>
<div class="line"><a name="l01382"></a><span class="lineno"> 1382</span>&#160;    }</div>
<div class="line"><a name="l01383"></a><span class="lineno"> 1383</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a> &amp; 0x00ff0000) i2cTriggerDumps(i2c,(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a>&gt;&gt;16),<span class="stringliteral">&quot;after ProcQueue&quot;</span>);</div>
<div class="line"><a name="l01384"></a><span class="lineno"> 1384</span>&#160; </div>
<div class="line"><a name="l01385"></a><span class="lineno"> 1385</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l01386"></a><span class="lineno"> 1386</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a>;</div>
<div class="line"><a name="l01387"></a><span class="lineno"> 1387</span>&#160;}</div>
<div class="line"><a name="l01388"></a><span class="lineno"> 1388</span>&#160; </div>
<div class="line"><a name="l01389"></a><span class="lineno"> 1389</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> i2cReleaseISR(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l01390"></a><span class="lineno"> 1390</span>&#160;{</div>
<div class="line"><a name="l01391"></a><span class="lineno"> 1391</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>) {</div>
<div class="line"><a name="l01392"></a><span class="lineno"> 1392</span>&#160;        <a class="code" href="esp__intr__alloc_8h.html#a72b74e3a15147c3ca43e77875f71e908">esp_intr_free</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>);</div>
<div class="line"><a name="l01393"></a><span class="lineno"> 1393</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">intr_handle</a>=<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01394"></a><span class="lineno"> 1394</span>&#160;        <span class="keywordflow">if</span> (!<a class="code" href="esp32-hal-cpu_8c.html#ae85f8f9000f48e8e31f28a6088c27879">removeApbChangeCallback</a>( i2c, i2cApbChangeCallback)) {</div>
<div class="line"><a name="l01395"></a><span class="lineno"> 1395</span>&#160;            <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;unable to release apbCallback&quot;</span>);</div>
<div class="line"><a name="l01396"></a><span class="lineno"> 1396</span>&#160;        }</div>
<div class="line"><a name="l01397"></a><span class="lineno"> 1397</span>&#160;    }</div>
<div class="line"><a name="l01398"></a><span class="lineno"> 1398</span>&#160;}</div>
<div class="line"><a name="l01399"></a><span class="lineno"> 1399</span>&#160; </div>
<div class="line"><a name="l01400"></a><span class="lineno"> 1400</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> i2cCheckLineState(<a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> sda, <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> scl){</div>
<div class="line"><a name="l01401"></a><span class="lineno"> 1401</span>&#160;     <span class="keywordflow">if</span>(sda &lt; 0 || scl &lt; 0){</div>
<div class="line"><a name="l01402"></a><span class="lineno"> 1402</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>;<span class="comment">//return false since there is nothing to do</span></div>
<div class="line"><a name="l01403"></a><span class="lineno"> 1403</span>&#160;    }</div>
<div class="line"><a name="l01404"></a><span class="lineno"> 1404</span>&#160;    <span class="comment">// if the bus is not &#39;clear&#39; try the cycling SCL until SDA goes High or 9 cycles</span></div>
<div class="line"><a name="l01405"></a><span class="lineno"> 1405</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a>(sda, <a class="code" href="esp32-hal-gpio_8h.html#a5bb885982ff66a2e0a0a45a8ee9c35e2">HIGH</a>);</div>
<div class="line"><a name="l01406"></a><span class="lineno"> 1406</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#a5bb885982ff66a2e0a0a45a8ee9c35e2">HIGH</a>);</div>
<div class="line"><a name="l01407"></a><span class="lineno"> 1407</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a6732634a108a709990b0a9ea9c573ca5">pinMode</a>(sda, <a class="code" href="esp32-hal-gpio_8h.html#aa65f05495aa2b9e5d89a7e79886a596e">PULLUP</a>|<a class="code" href="esp32-hal-gpio_8h.html#a298c4c61c2505f61e111ba1b4252c81f">OPEN_DRAIN</a>|<a class="code" href="esp32-hal-gpio_8h.html#a1bb283bd7893b9855e2f23013891fc82">INPUT</a>);</div>
<div class="line"><a name="l01408"></a><span class="lineno"> 1408</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a6732634a108a709990b0a9ea9c573ca5">pinMode</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#aa65f05495aa2b9e5d89a7e79886a596e">PULLUP</a>|<a class="code" href="esp32-hal-gpio_8h.html#a298c4c61c2505f61e111ba1b4252c81f">OPEN_DRAIN</a>|<a class="code" href="esp32-hal-gpio_8h.html#a61a3c9a18380aafb6e430e79bf596557">OUTPUT</a>);</div>
<div class="line"><a name="l01409"></a><span class="lineno"> 1409</span>&#160; </div>
<div class="line"><a name="l01410"></a><span class="lineno"> 1410</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(sda) || !<a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(scl)) { <span class="comment">// bus in busy state</span></div>
<div class="line"><a name="l01411"></a><span class="lineno"> 1411</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a71c957bc93270caaa91f41f6989c317b">log_w</a>(<span class="stringliteral">&quot;invalid state sda(%d)=%d, scl(%d)=%d&quot;</span>, sda, <a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(sda), scl, <a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(scl));</div>
<div class="line"><a name="l01412"></a><span class="lineno"> 1412</span>&#160;        <a class="code" href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#a5bb885982ff66a2e0a0a45a8ee9c35e2">HIGH</a>);</div>
<div class="line"><a name="l01413"></a><span class="lineno"> 1413</span>&#160;        <span class="keywordflow">for</span>(<a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>=0; <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>&lt;9; <a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>++) {</div>
<div class="line"><a name="l01414"></a><span class="lineno"> 1414</span>&#160;            <a class="code" href="esp32-hal-misc_8c.html#ae3503e70fc65f10a5e08f8c5815e8599">delayMicroseconds</a>(5);</div>
<div class="line"><a name="l01415"></a><span class="lineno"> 1415</span>&#160;            <a class="code" href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#ab811d8c6ff3a505312d3276590444289">LOW</a>);</div>
<div class="line"><a name="l01416"></a><span class="lineno"> 1416</span>&#160;            <a class="code" href="esp32-hal-misc_8c.html#ae3503e70fc65f10a5e08f8c5815e8599">delayMicroseconds</a>(5);</div>
<div class="line"><a name="l01417"></a><span class="lineno"> 1417</span>&#160;            <a class="code" href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#a5bb885982ff66a2e0a0a45a8ee9c35e2">HIGH</a>);</div>
<div class="line"><a name="l01418"></a><span class="lineno"> 1418</span>&#160;            <span class="keywordflow">if</span>(<a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(sda)){ <span class="comment">// bus recovered</span></div>
<div class="line"><a name="l01419"></a><span class="lineno"> 1419</span>&#160;                <a class="code" href="esp32-hal-log_8h.html#a1de06c4fd79189513953309af5b5593a">log_d</a>(<span class="stringliteral">&quot;Recovered after %d Cycles&quot;</span>,<a class="code" href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a>+1);</div>
<div class="line"><a name="l01420"></a><span class="lineno"> 1420</span>&#160;                <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l01421"></a><span class="lineno"> 1421</span>&#160;            }</div>
<div class="line"><a name="l01422"></a><span class="lineno"> 1422</span>&#160;        }</div>
<div class="line"><a name="l01423"></a><span class="lineno"> 1423</span>&#160;    }</div>
<div class="line"><a name="l01424"></a><span class="lineno"> 1424</span>&#160; </div>
<div class="line"><a name="l01425"></a><span class="lineno"> 1425</span>&#160;    <span class="keywordflow">if</span>(!<a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(sda) || !<a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(scl)) { <span class="comment">// bus in busy state</span></div>
<div class="line"><a name="l01426"></a><span class="lineno"> 1426</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a>(<span class="stringliteral">&quot;Bus Invalid State, TwoWire() Can&#39;t init sda=%d, scl=%d&quot;</span>,<a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(sda),<a class="code" href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a>(scl));</div>
<div class="line"><a name="l01427"></a><span class="lineno"> 1427</span>&#160;        <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">// bus is busy</span></div>
<div class="line"><a name="l01428"></a><span class="lineno"> 1428</span>&#160;    }</div>
<div class="line"><a name="l01429"></a><span class="lineno"> 1429</span>&#160;    <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l01430"></a><span class="lineno"> 1430</span>&#160;}</div>
<div class="line"><a name="l01431"></a><span class="lineno"> 1431</span>&#160; </div>
<div class="line"><a name="l01432"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a2933fdd203d61a8bbadde6013da3fd00"> 1432</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a2933fdd203d61a8bbadde6013da3fd00">i2cAttachSCL</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> scl)</div>
<div class="line"><a name="l01433"></a><span class="lineno"> 1433</span>&#160;{</div>
<div class="line"><a name="l01434"></a><span class="lineno"> 1434</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01435"></a><span class="lineno"> 1435</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01436"></a><span class="lineno"> 1436</span>&#160;    }</div>
<div class="line"><a name="l01437"></a><span class="lineno"> 1437</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#a5bb885982ff66a2e0a0a45a8ee9c35e2">HIGH</a>);</div>
<div class="line"><a name="l01438"></a><span class="lineno"> 1438</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a6732634a108a709990b0a9ea9c573ca5">pinMode</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#a298c4c61c2505f61e111ba1b4252c81f">OPEN_DRAIN</a> | <a class="code" href="esp32-hal-gpio_8h.html#aa65f05495aa2b9e5d89a7e79886a596e">PULLUP</a> | <a class="code" href="esp32-hal-gpio_8h.html#a1bb283bd7893b9855e2f23013891fc82">INPUT</a> | <a class="code" href="esp32-hal-gpio_8h.html#a61a3c9a18380aafb6e430e79bf596557">OUTPUT</a>);</div>
<div class="line"><a name="l01439"></a><span class="lineno"> 1439</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#a4911e993064543ddd612bc48c7bbe3f8">pinMatrixOutAttach</a>(scl, <a class="code" href="esp32-hal-i2c_8c.html#a18a17a12fec3313dae2ed463e5f70680">I2C_SCL_IDX</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>), <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01440"></a><span class="lineno"> 1440</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#ac991dba10f936abd7becd51ff2d73f7b">pinMatrixInAttach</a>(scl, <a class="code" href="esp32-hal-i2c_8c.html#a18a17a12fec3313dae2ed463e5f70680">I2C_SCL_IDX</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>), <span class="keyword">false</span>);</div>
<div class="line"><a name="l01441"></a><span class="lineno"> 1441</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01442"></a><span class="lineno"> 1442</span>&#160;}</div>
<div class="line"><a name="l01443"></a><span class="lineno"> 1443</span>&#160; </div>
<div class="line"><a name="l01444"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a6b0447b9745ab4aa9b58d8e428fe01ff"> 1444</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a6b0447b9745ab4aa9b58d8e428fe01ff">i2cDetachSCL</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> scl)</div>
<div class="line"><a name="l01445"></a><span class="lineno"> 1445</span>&#160;{</div>
<div class="line"><a name="l01446"></a><span class="lineno"> 1446</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01447"></a><span class="lineno"> 1447</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01448"></a><span class="lineno"> 1448</span>&#160;    }</div>
<div class="line"><a name="l01449"></a><span class="lineno"> 1449</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#a405c3b937758dd44931c5452f4397ff1">pinMatrixOutDetach</a>(scl, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01450"></a><span class="lineno"> 1450</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#a2a3f15df9222f9488139614fad88c907">pinMatrixInDetach</a>(<a class="code" href="esp32-hal-i2c_8c.html#a18a17a12fec3313dae2ed463e5f70680">I2C_SCL_IDX</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>), <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01451"></a><span class="lineno"> 1451</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a6732634a108a709990b0a9ea9c573ca5">pinMode</a>(scl, <a class="code" href="esp32-hal-gpio_8h.html#a1bb283bd7893b9855e2f23013891fc82">INPUT</a> | <a class="code" href="esp32-hal-gpio_8h.html#aa65f05495aa2b9e5d89a7e79886a596e">PULLUP</a>);</div>
<div class="line"><a name="l01452"></a><span class="lineno"> 1452</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01453"></a><span class="lineno"> 1453</span>&#160;}</div>
<div class="line"><a name="l01454"></a><span class="lineno"> 1454</span>&#160; </div>
<div class="line"><a name="l01455"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a7e6703ba9b50f8d8f119240b4e2cb2ae"> 1455</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a7e6703ba9b50f8d8f119240b4e2cb2ae">i2cAttachSDA</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> sda)</div>
<div class="line"><a name="l01456"></a><span class="lineno"> 1456</span>&#160;{</div>
<div class="line"><a name="l01457"></a><span class="lineno"> 1457</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01458"></a><span class="lineno"> 1458</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01459"></a><span class="lineno"> 1459</span>&#160;    }</div>
<div class="line"><a name="l01460"></a><span class="lineno"> 1460</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a>(sda, <a class="code" href="esp32-hal-gpio_8h.html#a5bb885982ff66a2e0a0a45a8ee9c35e2">HIGH</a>);</div>
<div class="line"><a name="l01461"></a><span class="lineno"> 1461</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a6732634a108a709990b0a9ea9c573ca5">pinMode</a>(sda, <a class="code" href="esp32-hal-gpio_8h.html#a298c4c61c2505f61e111ba1b4252c81f">OPEN_DRAIN</a> | <a class="code" href="esp32-hal-gpio_8h.html#aa65f05495aa2b9e5d89a7e79886a596e">PULLUP</a> | <a class="code" href="esp32-hal-gpio_8h.html#a1bb283bd7893b9855e2f23013891fc82">INPUT</a> | <a class="code" href="esp32-hal-gpio_8h.html#a61a3c9a18380aafb6e430e79bf596557">OUTPUT</a> );</div>
<div class="line"><a name="l01462"></a><span class="lineno"> 1462</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#a4911e993064543ddd612bc48c7bbe3f8">pinMatrixOutAttach</a>(sda, <a class="code" href="esp32-hal-i2c_8c.html#a9f980d89641c71517c62c090ad0d202c">I2C_SDA_IDX</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>), <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01463"></a><span class="lineno"> 1463</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#ac991dba10f936abd7becd51ff2d73f7b">pinMatrixInAttach</a>(sda, <a class="code" href="esp32-hal-i2c_8c.html#a9f980d89641c71517c62c090ad0d202c">I2C_SDA_IDX</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>), <span class="keyword">false</span>);</div>
<div class="line"><a name="l01464"></a><span class="lineno"> 1464</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01465"></a><span class="lineno"> 1465</span>&#160;}</div>
<div class="line"><a name="l01466"></a><span class="lineno"> 1466</span>&#160; </div>
<div class="line"><a name="l01467"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a5c49ce1d54cb39f209e1226c4c113f3a"> 1467</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a5c49ce1d54cb39f209e1226c4c113f3a">i2cDetachSDA</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> sda)</div>
<div class="line"><a name="l01468"></a><span class="lineno"> 1468</span>&#160;{</div>
<div class="line"><a name="l01469"></a><span class="lineno"> 1469</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01470"></a><span class="lineno"> 1470</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01471"></a><span class="lineno"> 1471</span>&#160;    }</div>
<div class="line"><a name="l01472"></a><span class="lineno"> 1472</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#a405c3b937758dd44931c5452f4397ff1">pinMatrixOutDetach</a>(sda, <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01473"></a><span class="lineno"> 1473</span>&#160;    <a class="code" href="esp32-hal-matrix_8c.html#a2a3f15df9222f9488139614fad88c907">pinMatrixInDetach</a>(<a class="code" href="esp32-hal-i2c_8c.html#a9f980d89641c71517c62c090ad0d202c">I2C_SDA_IDX</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>), <span class="keyword">false</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l01474"></a><span class="lineno"> 1474</span>&#160;    <a class="code" href="esp32-hal-gpio_8c.html#a6732634a108a709990b0a9ea9c573ca5">pinMode</a>(sda, <a class="code" href="esp32-hal-gpio_8h.html#a1bb283bd7893b9855e2f23013891fc82">INPUT</a> | <a class="code" href="esp32-hal-gpio_8h.html#aa65f05495aa2b9e5d89a7e79886a596e">PULLUP</a>);</div>
<div class="line"><a name="l01475"></a><span class="lineno"> 1475</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01476"></a><span class="lineno"> 1476</span>&#160;}</div>
<div class="line"><a name="l01477"></a><span class="lineno"> 1477</span>&#160; </div>
<div class="line"><a name="l01478"></a><span class="lineno"> 1478</span>&#160;<span class="comment">/*</span></div>
<div class="line"><a name="l01479"></a><span class="lineno"> 1479</span>&#160;<span class="comment"> * PUBLIC API</span></div>
<div class="line"><a name="l01480"></a><span class="lineno"> 1480</span>&#160;<span class="comment"> * */</span></div>
<div class="line"><a name="l01481"></a><span class="lineno"> 1481</span>&#160;<span class="comment">// 24Nov17 only supports Master Mode</span></div>
<div class="line"><a name="l01482"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a3480cfc1b9f20aabb0ee4885fcac9ea6"> 1482</a></span>&#160;<a class="code" href="structi2c__struct__t.html">i2c_t</a> * <a class="code" href="esp32-hal-i2c_8c.html#a2050f38e68846046646743bce6f488b7">i2cInit</a>(<a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a> i2c_num, <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> sda, <a class="code" href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a> scl, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> frequency) {</div>
<div class="line"><a name="l01483"></a><span class="lineno"> 1483</span>&#160;<span class="preprocessor">#ifdef ENABLE_I2C_DEBUG_BUFFER</span></div>
<div class="line"><a name="l01484"></a><span class="lineno"> 1484</span>&#160;  <a class="code" href="esp32-hal-log_8h.html#a925f3f2d10368d16506845d280b1b7a1">log_v</a>(<span class="stringliteral">&quot;num=%d sda=%d scl=%d freq=%d&quot;</span>,i2c_num, sda, scl, frequency);</div>
<div class="line"><a name="l01485"></a><span class="lineno"> 1485</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01486"></a><span class="lineno"> 1486</span>&#160;    <span class="keywordflow">if</span>(i2c_num &gt; 1) {</div>
<div class="line"><a name="l01487"></a><span class="lineno"> 1487</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01488"></a><span class="lineno"> 1488</span>&#160;    }</div>
<div class="line"><a name="l01489"></a><span class="lineno"> 1489</span>&#160; </div>
<div class="line"><a name="l01490"></a><span class="lineno"> 1490</span>&#160;    <a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c = &amp;_i2c_bus_array[i2c_num];</div>
<div class="line"><a name="l01491"></a><span class="lineno"> 1491</span>&#160; </div>
<div class="line"><a name="l01492"></a><span class="lineno"> 1492</span>&#160;    <span class="comment">// pins should be detached, else glitch</span></div>
<div class="line"><a name="l01493"></a><span class="lineno"> 1493</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a> &gt;= 0){</div>
<div class="line"><a name="l01494"></a><span class="lineno"> 1494</span>&#160;        <a class="code" href="esp32-hal-i2c_8c.html#a5c49ce1d54cb39f209e1226c4c113f3a">i2cDetachSDA</a>(i2c, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a>);</div>
<div class="line"><a name="l01495"></a><span class="lineno"> 1495</span>&#160;    }</div>
<div class="line"><a name="l01496"></a><span class="lineno"> 1496</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a> &gt;= 0){</div>
<div class="line"><a name="l01497"></a><span class="lineno"> 1497</span>&#160;        <a class="code" href="esp32-hal-i2c_8c.html#a6b0447b9745ab4aa9b58d8e428fe01ff">i2cDetachSCL</a>(i2c, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a>);</div>
<div class="line"><a name="l01498"></a><span class="lineno"> 1498</span>&#160;    }</div>
<div class="line"><a name="l01499"></a><span class="lineno"> 1499</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a> = sda;</div>
<div class="line"><a name="l01500"></a><span class="lineno"> 1500</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a> = scl;</div>
<div class="line"><a name="l01501"></a><span class="lineno"> 1501</span>&#160; </div>
<div class="line"><a name="l01502"></a><span class="lineno"> 1502</span>&#160;<span class="preprocessor">#if !CONFIG_DISABLE_HAL_LOCKS</span></div>
<div class="line"><a name="l01503"></a><span class="lineno"> 1503</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0a090b1ed46ca4ffbedb63add98433ad">lock</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01504"></a><span class="lineno"> 1504</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0a090b1ed46ca4ffbedb63add98433ad">lock</a> = xSemaphoreCreateRecursiveMutex();</div>
<div class="line"><a name="l01505"></a><span class="lineno"> 1505</span>&#160;        <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0a090b1ed46ca4ffbedb63add98433ad">lock</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01506"></a><span class="lineno"> 1506</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01507"></a><span class="lineno"> 1507</span>&#160;        }</div>
<div class="line"><a name="l01508"></a><span class="lineno"> 1508</span>&#160;    }</div>
<div class="line"><a name="l01509"></a><span class="lineno"> 1509</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01510"></a><span class="lineno"> 1510</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a30d636c7aade7e875101380f58b90746">I2C_MUTEX_LOCK</a>();</div>
<div class="line"><a name="l01511"></a><span class="lineno"> 1511</span>&#160; </div>
<div class="line"><a name="l01512"></a><span class="lineno"> 1512</span>&#160;    i2cReleaseISR(i2c); <span class="comment">// ISR exists, release it before disabling hardware</span></div>
<div class="line"><a name="l01513"></a><span class="lineno"> 1513</span>&#160; </div>
<div class="line"><a name="l01514"></a><span class="lineno"> 1514</span>&#160;    <span class="keywordflow">if</span>(frequency == 0) {<span class="comment">// don&#39;t change existing frequency</span></div>
<div class="line"><a name="l01515"></a><span class="lineno"> 1515</span>&#160;        frequency = <a class="code" href="esp32-hal-i2c_8c.html#a76839c845b68b6104dd8f77b5c08d478">i2cGetFrequency</a>(i2c);</div>
<div class="line"><a name="l01516"></a><span class="lineno"> 1516</span>&#160;        <span class="keywordflow">if</span>(frequency == 0) {</div>
<div class="line"><a name="l01517"></a><span class="lineno"> 1517</span>&#160;            frequency = 100000L;    <span class="comment">// default to 100khz</span></div>
<div class="line"><a name="l01518"></a><span class="lineno"> 1518</span>&#160;        }</div>
<div class="line"><a name="l01519"></a><span class="lineno"> 1519</span>&#160;    }</div>
<div class="line"><a name="l01520"></a><span class="lineno"> 1520</span>&#160; </div>
<div class="line"><a name="l01521"></a><span class="lineno"> 1521</span>&#160;    <span class="keywordflow">if</span>(i2c_num == 0) {</div>
<div class="line"><a name="l01522"></a><span class="lineno"> 1522</span>&#160;        <a class="code" href="dport__access_8h.html#a30f4d8bd206a36385b711ed14dd05b34">DPORT_SET_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a5defc386124973590397a2d78d2f50bc">DPORT_PERIP_RST_EN_REG</a>,<a class="code" href="dport__reg_8h.html#a9fc62e8ef1289b8ba8ecb726c4f57f51">DPORT_I2C_EXT0_RST</a>); <span class="comment">//reset hardware</span></div>
<div class="line"><a name="l01523"></a><span class="lineno"> 1523</span>&#160;        <a class="code" href="dport__access_8h.html#a30f4d8bd206a36385b711ed14dd05b34">DPORT_SET_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a49880909661c594efee90557f9d01f2d">DPORT_PERIP_CLK_EN_REG</a>,<a class="code" href="dport__reg_8h.html#a7c08e72d7839c1015c7410518f7b20fe">DPORT_I2C_EXT0_CLK_EN</a>);</div>
<div class="line"><a name="l01524"></a><span class="lineno"> 1524</span>&#160;        <a class="code" href="dport__access_8h.html#ae41996597ae6153962375a83c1100f1f">DPORT_CLEAR_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a5defc386124973590397a2d78d2f50bc">DPORT_PERIP_RST_EN_REG</a>,<a class="code" href="dport__reg_8h.html#a9fc62e8ef1289b8ba8ecb726c4f57f51">DPORT_I2C_EXT0_RST</a>);<span class="comment">//  release reset</span></div>
<div class="line"><a name="l01525"></a><span class="lineno"> 1525</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01526"></a><span class="lineno"> 1526</span>&#160;        <a class="code" href="dport__access_8h.html#a30f4d8bd206a36385b711ed14dd05b34">DPORT_SET_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a5defc386124973590397a2d78d2f50bc">DPORT_PERIP_RST_EN_REG</a>,<a class="code" href="dport__reg_8h.html#abb59ee0bc123a690e523f067615ecd26">DPORT_I2C_EXT1_RST</a>); <span class="comment">//reset Hardware</span></div>
<div class="line"><a name="l01527"></a><span class="lineno"> 1527</span>&#160;        <a class="code" href="dport__access_8h.html#a30f4d8bd206a36385b711ed14dd05b34">DPORT_SET_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a49880909661c594efee90557f9d01f2d">DPORT_PERIP_CLK_EN_REG</a>,<a class="code" href="dport__reg_8h.html#ae6228dab1982f1264b0ae5f88e8464e7">DPORT_I2C_EXT1_CLK_EN</a>);</div>
<div class="line"><a name="l01528"></a><span class="lineno"> 1528</span>&#160;        <a class="code" href="dport__access_8h.html#ae41996597ae6153962375a83c1100f1f">DPORT_CLEAR_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a5defc386124973590397a2d78d2f50bc">DPORT_PERIP_RST_EN_REG</a>,<a class="code" href="dport__reg_8h.html#abb59ee0bc123a690e523f067615ecd26">DPORT_I2C_EXT1_RST</a>);</div>
<div class="line"><a name="l01529"></a><span class="lineno"> 1529</span>&#160;    }</div>
<div class="line"><a name="l01530"></a><span class="lineno"> 1530</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0;</div>
<div class="line"><a name="l01531"></a><span class="lineno"> 1531</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#a3edbfd55ed118c1297db594e20dbe9a1">ms_mode</a> = 1;</div>
<div class="line"><a name="l01532"></a><span class="lineno"> 1532</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#a5719ed2103fef6d7d3cd2ea23be331ac">sda_force_out</a> = 1 ;</div>
<div class="line"><a name="l01533"></a><span class="lineno"> 1533</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#a99d8a9c5377e2c44895c7fb824562f72">scl_force_out</a> = 1 ;</div>
<div class="line"><a name="l01534"></a><span class="lineno"> 1534</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">ctr</a>.<a class="code" href="structi2c__dev__t.html#ae78831cacb1c081ab41417c0721aadf8">clk_en</a> = 1;</div>
<div class="line"><a name="l01535"></a><span class="lineno"> 1535</span>&#160; </div>
<div class="line"><a name="l01536"></a><span class="lineno"> 1536</span>&#160;    <span class="comment">//the max clock number of receiving  a data</span></div>
<div class="line"><a name="l01537"></a><span class="lineno"> 1537</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a60e35fd5bf77573b8d0ab8d8ae741e34">timeout</a>.<a class="code" href="structi2c__dev__t.html#a464cdec653f66f9ba7b8bf10ec14b35b">tout</a> = 400000;<span class="comment">//clocks max=1048575</span></div>
<div class="line"><a name="l01538"></a><span class="lineno"> 1538</span>&#160;    <span class="comment">//disable apb nonfifo access</span></div>
<div class="line"><a name="l01539"></a><span class="lineno"> 1539</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89c28654ad7d9c55847e3ac544d61929">fifo_conf</a>.<a class="code" href="structi2c__dev__t.html#aa839acb7b689c79ce9dfd27343d088a9">nonfifo_en</a> = 0;</div>
<div class="line"><a name="l01540"></a><span class="lineno"> 1540</span>&#160; </div>
<div class="line"><a name="l01541"></a><span class="lineno"> 1541</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#aa9c300c2f5b7d7a1a82b1995ad442ceb">slave_addr</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = 0;</div>
<div class="line"><a name="l01542"></a><span class="lineno"> 1542</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l01543"></a><span class="lineno"> 1543</span>&#160; </div>
<div class="line"><a name="l01544"></a><span class="lineno"> 1544</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a0223736866298198d98aebadd9ca47b3">i2cSetFrequency</a>(i2c, frequency);    <span class="comment">// reconfigure</span></div>
<div class="line"><a name="l01545"></a><span class="lineno"> 1545</span>&#160; </div>
<div class="line"><a name="l01546"></a><span class="lineno"> 1546</span>&#160;    <span class="keywordflow">if</span>(!i2cCheckLineState(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a>, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a>)){</div>
<div class="line"><a name="l01547"></a><span class="lineno"> 1547</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01548"></a><span class="lineno"> 1548</span>&#160;    }</div>
<div class="line"><a name="l01549"></a><span class="lineno"> 1549</span>&#160; </div>
<div class="line"><a name="l01550"></a><span class="lineno"> 1550</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a> &gt;= 0){</div>
<div class="line"><a name="l01551"></a><span class="lineno"> 1551</span>&#160;        <a class="code" href="esp32-hal-i2c_8c.html#a7e6703ba9b50f8d8f119240b4e2cb2ae">i2cAttachSDA</a>(i2c, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a>);</div>
<div class="line"><a name="l01552"></a><span class="lineno"> 1552</span>&#160;    }</div>
<div class="line"><a name="l01553"></a><span class="lineno"> 1553</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a> &gt;= 0){</div>
<div class="line"><a name="l01554"></a><span class="lineno"> 1554</span>&#160;        <a class="code" href="esp32-hal-i2c_8c.html#a2933fdd203d61a8bbadde6013da3fd00">i2cAttachSCL</a>(i2c, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a>);</div>
<div class="line"><a name="l01555"></a><span class="lineno"> 1555</span>&#160;    }</div>
<div class="line"><a name="l01556"></a><span class="lineno"> 1556</span>&#160;    <span class="keywordflow">return</span> i2c;</div>
<div class="line"><a name="l01557"></a><span class="lineno"> 1557</span>&#160;}</div>
<div class="line"><a name="l01558"></a><span class="lineno"> 1558</span>&#160; </div>
<div class="line"><a name="l01559"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#af848359f1f618cf9a627d483a5da95c8"> 1559</a></span>&#160;<span class="keywordtype">void</span> <a class="code" href="esp32-hal-i2c_8c.html#af848359f1f618cf9a627d483a5da95c8">i2cRelease</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> *i2c)  <span class="comment">// release all resources, power down peripheral</span></div>
<div class="line"><a name="l01560"></a><span class="lineno"> 1560</span>&#160;{</div>
<div class="line"><a name="l01561"></a><span class="lineno"> 1561</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a30d636c7aade7e875101380f58b90746">I2C_MUTEX_LOCK</a>();</div>
<div class="line"><a name="l01562"></a><span class="lineno"> 1562</span>&#160; </div>
<div class="line"><a name="l01563"></a><span class="lineno"> 1563</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a> &gt;= 0){</div>
<div class="line"><a name="l01564"></a><span class="lineno"> 1564</span>&#160;        <a class="code" href="esp32-hal-i2c_8c.html#a5c49ce1d54cb39f209e1226c4c113f3a">i2cDetachSDA</a>(i2c, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a>);</div>
<div class="line"><a name="l01565"></a><span class="lineno"> 1565</span>&#160;    }</div>
<div class="line"><a name="l01566"></a><span class="lineno"> 1566</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a> &gt;= 0){</div>
<div class="line"><a name="l01567"></a><span class="lineno"> 1567</span>&#160;        <a class="code" href="esp32-hal-i2c_8c.html#a6b0447b9745ab4aa9b58d8e428fe01ff">i2cDetachSCL</a>(i2c, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a>);</div>
<div class="line"><a name="l01568"></a><span class="lineno"> 1568</span>&#160;    }</div>
<div class="line"><a name="l01569"></a><span class="lineno"> 1569</span>&#160; </div>
<div class="line"><a name="l01570"></a><span class="lineno"> 1570</span>&#160;    i2cReleaseISR(i2c);</div>
<div class="line"><a name="l01571"></a><span class="lineno"> 1571</span>&#160; </div>
<div class="line"><a name="l01572"></a><span class="lineno"> 1572</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>) {</div>
<div class="line"><a name="l01573"></a><span class="lineno"> 1573</span>&#160;        <a class="code" href="event__groups_8h.html#a6939faca89fc4ba52fa8288527042464">vEventGroupDelete</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a>);</div>
<div class="line"><a name="l01574"></a><span class="lineno"> 1574</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_event</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01575"></a><span class="lineno"> 1575</span>&#160;    }</div>
<div class="line"><a name="l01576"></a><span class="lineno"> 1576</span>&#160; </div>
<div class="line"><a name="l01577"></a><span class="lineno"> 1577</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#ab270d52c26de7f5ce13ec1538b0b94fd">i2cFlush</a>(i2c);</div>
<div class="line"><a name="l01578"></a><span class="lineno"> 1578</span>&#160; </div>
<div class="line"><a name="l01579"></a><span class="lineno"> 1579</span>&#160;    <span class="comment">// reset the I2C hardware and shut off the clock, power it down.</span></div>
<div class="line"><a name="l01580"></a><span class="lineno"> 1580</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a> == 0) {</div>
<div class="line"><a name="l01581"></a><span class="lineno"> 1581</span>&#160;        <a class="code" href="dport__access_8h.html#a30f4d8bd206a36385b711ed14dd05b34">DPORT_SET_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a5defc386124973590397a2d78d2f50bc">DPORT_PERIP_RST_EN_REG</a>,<a class="code" href="dport__reg_8h.html#a9fc62e8ef1289b8ba8ecb726c4f57f51">DPORT_I2C_EXT0_RST</a>); <span class="comment">//reset hardware</span></div>
<div class="line"><a name="l01582"></a><span class="lineno"> 1582</span>&#160;        <a class="code" href="dport__access_8h.html#ae41996597ae6153962375a83c1100f1f">DPORT_CLEAR_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a49880909661c594efee90557f9d01f2d">DPORT_PERIP_CLK_EN_REG</a>,<a class="code" href="dport__reg_8h.html#a7c08e72d7839c1015c7410518f7b20fe">DPORT_I2C_EXT0_CLK_EN</a>); <span class="comment">// shutdown hardware</span></div>
<div class="line"><a name="l01583"></a><span class="lineno"> 1583</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01584"></a><span class="lineno"> 1584</span>&#160;        <a class="code" href="dport__access_8h.html#a30f4d8bd206a36385b711ed14dd05b34">DPORT_SET_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a5defc386124973590397a2d78d2f50bc">DPORT_PERIP_RST_EN_REG</a>,<a class="code" href="dport__reg_8h.html#abb59ee0bc123a690e523f067615ecd26">DPORT_I2C_EXT1_RST</a>); <span class="comment">//reset Hardware</span></div>
<div class="line"><a name="l01585"></a><span class="lineno"> 1585</span>&#160;        <a class="code" href="dport__access_8h.html#ae41996597ae6153962375a83c1100f1f">DPORT_CLEAR_PERI_REG_MASK</a>(<a class="code" href="dport__reg_8h.html#a49880909661c594efee90557f9d01f2d">DPORT_PERIP_CLK_EN_REG</a>,<a class="code" href="dport__reg_8h.html#ae6228dab1982f1264b0ae5f88e8464e7">DPORT_I2C_EXT1_CLK_EN</a>); <span class="comment">// shutdown Hardware</span></div>
<div class="line"><a name="l01586"></a><span class="lineno"> 1586</span>&#160;    }</div>
<div class="line"><a name="l01587"></a><span class="lineno"> 1587</span>&#160; </div>
<div class="line"><a name="l01588"></a><span class="lineno"> 1588</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l01589"></a><span class="lineno"> 1589</span>&#160;}</div>
<div class="line"><a name="l01590"></a><span class="lineno"> 1590</span>&#160; </div>
<div class="line"><a name="l01591"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#ab270d52c26de7f5ce13ec1538b0b94fd"> 1591</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#ab270d52c26de7f5ce13ec1538b0b94fd">i2cFlush</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l01592"></a><span class="lineno"> 1592</span>&#160;{</div>
<div class="line"><a name="l01593"></a><span class="lineno"> 1593</span>&#160;    <span class="keywordflow">if</span>(i2c==<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01594"></a><span class="lineno"> 1594</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01595"></a><span class="lineno"> 1595</span>&#160;    }</div>
<div class="line"><a name="l01596"></a><span class="lineno"> 1596</span>&#160;    i2cTriggerDumps(i2c,i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a> &amp; 0xff, <span class="stringliteral">&quot;FLUSH&quot;</span>);</div>
<div class="line"><a name="l01597"></a><span class="lineno"> 1597</span>&#160; </div>
<div class="line"><a name="l01598"></a><span class="lineno"> 1598</span>&#160;    <span class="comment">// need to grab a MUTEX for exclusive Queue,</span></div>
<div class="line"><a name="l01599"></a><span class="lineno"> 1599</span>&#160;    <span class="comment">// what out if ISR is running?</span></div>
<div class="line"><a name="l01600"></a><span class="lineno"> 1600</span>&#160;    <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> rc=<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01601"></a><span class="lineno"> 1601</span>&#160;    <span class="keywordflow">if</span>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>!=<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01602"></a><span class="lineno"> 1602</span>&#160;        <span class="comment">//  log_i(&quot;free&quot;);</span></div>
<div class="line"><a name="l01603"></a><span class="lineno"> 1603</span>&#160;        <span class="comment">// what about EventHandle?</span></div>
<div class="line"><a name="l01604"></a><span class="lineno"> 1604</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a>);</div>
<div class="line"><a name="l01605"></a><span class="lineno"> 1605</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">dq</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l01606"></a><span class="lineno"> 1606</span>&#160;    }</div>
<div class="line"><a name="l01607"></a><span class="lineno"> 1607</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">queueCount</a>=0;</div>
<div class="line"><a name="l01608"></a><span class="lineno"> 1608</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">queuePos</a>=0;</div>
<div class="line"><a name="l01609"></a><span class="lineno"> 1609</span>&#160;    <span class="comment">// release Mutex</span></div>
<div class="line"><a name="l01610"></a><span class="lineno"> 1610</span>&#160;    <span class="keywordflow">return</span> rc;</div>
<div class="line"><a name="l01611"></a><span class="lineno"> 1611</span>&#160;}</div>
<div class="line"><a name="l01612"></a><span class="lineno"> 1612</span>&#160; </div>
<div class="line"><a name="l01613"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a5e5763762569a0ffbc045480c5fda8c4"> 1613</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a5e5763762569a0ffbc045480c5fda8c4">i2cWrite</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="tag__strings_8h.html#ade5a18d52133ef21f211020ceb464c07">address</a>, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a>* buff, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>, <span class="keywordtype">bool</span> sendStop, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> timeOutMillis){</div>
<div class="line"><a name="l01614"></a><span class="lineno"> 1614</span>&#160;    <span class="keywordflow">if</span>((i2c==<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)||((<a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>&gt;0)&amp;&amp;(buff==<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>))) { <span class="comment">// need to have location to store requested data</span></div>
<div class="line"><a name="l01615"></a><span class="lineno"> 1615</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01616"></a><span class="lineno"> 1616</span>&#160;    }</div>
<div class="line"><a name="l01617"></a><span class="lineno"> 1617</span>&#160;    <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> last_error = <a class="code" href="esp32-hal-i2c_8c.html#a2b8f0b1e7cd584246ab629f1d3d80d0a">i2cAddQueueWrite</a>(i2c, <a class="code" href="tag__strings_8h.html#ade5a18d52133ef21f211020ceb464c07">address</a>, buff, <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>, sendStop, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01618"></a><span class="lineno"> 1618</span>&#160; </div>
<div class="line"><a name="l01619"></a><span class="lineno"> 1619</span>&#160;    <span class="keywordflow">if</span>(last_error == <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>) { <span class="comment">//queued</span></div>
<div class="line"><a name="l01620"></a><span class="lineno"> 1620</span>&#160;        <span class="keywordflow">if</span>(sendStop) { <span class="comment">//now actually process the queued commands, including READs</span></div>
<div class="line"><a name="l01621"></a><span class="lineno"> 1621</span>&#160;            last_error = <a class="code" href="esp32-hal-i2c_8c.html#a0285897a5bcf3a47c6302f3dc9da64c9">i2cProcQueue</a>(i2c, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, timeOutMillis);</div>
<div class="line"><a name="l01622"></a><span class="lineno"> 1622</span>&#160;            <span class="keywordflow">if</span>(last_error == <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a845fdb6c4d2815606f3c1755bb0e3aac">I2C_ERROR_BUSY</a>) { <span class="comment">// try to clear the bus</span></div>
<div class="line"><a name="l01623"></a><span class="lineno"> 1623</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="esp32-hal-i2c_8c.html#a2050f38e68846046646743bce6f488b7">i2cInit</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a>, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a>, 0)) {</div>
<div class="line"><a name="l01624"></a><span class="lineno"> 1624</span>&#160;                    last_error = <a class="code" href="esp32-hal-i2c_8c.html#a0285897a5bcf3a47c6302f3dc9da64c9">i2cProcQueue</a>(i2c, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, timeOutMillis);</div>
<div class="line"><a name="l01625"></a><span class="lineno"> 1625</span>&#160;                }</div>
<div class="line"><a name="l01626"></a><span class="lineno"> 1626</span>&#160;            }</div>
<div class="line"><a name="l01627"></a><span class="lineno"> 1627</span>&#160;            <a class="code" href="esp32-hal-i2c_8c.html#ab270d52c26de7f5ce13ec1538b0b94fd">i2cFlush</a>(i2c);</div>
<div class="line"><a name="l01628"></a><span class="lineno"> 1628</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// stop not received, so wait for I2C stop,</span></div>
<div class="line"><a name="l01629"></a><span class="lineno"> 1629</span>&#160;            last_error = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a3ba8243b59b2c4f46ff083cbe7c8f0ad">I2C_ERROR_CONTINUE</a>;</div>
<div class="line"><a name="l01630"></a><span class="lineno"> 1630</span>&#160;        }</div>
<div class="line"><a name="l01631"></a><span class="lineno"> 1631</span>&#160;    }</div>
<div class="line"><a name="l01632"></a><span class="lineno"> 1632</span>&#160;    <span class="keywordflow">return</span> last_error;</div>
<div class="line"><a name="l01633"></a><span class="lineno"> 1633</span>&#160;}</div>
<div class="line"><a name="l01634"></a><span class="lineno"> 1634</span>&#160; </div>
<div class="line"><a name="l01635"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a6583e0fe8187c302efcea1ae8448d885"> 1635</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a6583e0fe8187c302efcea1ae8448d885">i2cRead</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="tag__strings_8h.html#ade5a18d52133ef21f211020ceb464c07">address</a>, <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a>* buff, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>, <span class="keywordtype">bool</span> sendStop, <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> timeOutMillis, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> *readCount){</div>
<div class="line"><a name="l01636"></a><span class="lineno"> 1636</span>&#160;    <span class="keywordflow">if</span>((<a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a> == 0)||(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)||(buff==<a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)){ <span class="comment">// hardware will hang if no data requested on READ</span></div>
<div class="line"><a name="l01637"></a><span class="lineno"> 1637</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01638"></a><span class="lineno"> 1638</span>&#160;    }</div>
<div class="line"><a name="l01639"></a><span class="lineno"> 1639</span>&#160;    <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> last_error=<a class="code" href="esp32-hal-i2c_8c.html#a5b4ef6852cf5a778800d8b9dda16b613">i2cAddQueueRead</a>(i2c, <a class="code" href="tag__strings_8h.html#ade5a18d52133ef21f211020ceb464c07">address</a>, buff, <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>, sendStop, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l01640"></a><span class="lineno"> 1640</span>&#160; </div>
<div class="line"><a name="l01641"></a><span class="lineno"> 1641</span>&#160;    <span class="keywordflow">if</span>(last_error == <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>) { <span class="comment">//queued</span></div>
<div class="line"><a name="l01642"></a><span class="lineno"> 1642</span>&#160;        <span class="keywordflow">if</span>(sendStop) { <span class="comment">//now actually process the queued commands, including READs</span></div>
<div class="line"><a name="l01643"></a><span class="lineno"> 1643</span>&#160;            last_error = <a class="code" href="esp32-hal-i2c_8c.html#a0285897a5bcf3a47c6302f3dc9da64c9">i2cProcQueue</a>(i2c, readCount, timeOutMillis);</div>
<div class="line"><a name="l01644"></a><span class="lineno"> 1644</span>&#160;            <span class="keywordflow">if</span>(last_error == <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a845fdb6c4d2815606f3c1755bb0e3aac">I2C_ERROR_BUSY</a>) { <span class="comment">// try to clear the bus</span></div>
<div class="line"><a name="l01645"></a><span class="lineno"> 1645</span>&#160;                <span class="keywordflow">if</span>(<a class="code" href="esp32-hal-i2c_8c.html#a2050f38e68846046646743bce6f488b7">i2cInit</a>(i2c-&gt;<a class="code" href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">num</a>, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">sda</a>, i2c-&gt;<a class="code" href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">scl</a>, 0)) {</div>
<div class="line"><a name="l01646"></a><span class="lineno"> 1646</span>&#160;                    last_error = <a class="code" href="esp32-hal-i2c_8c.html#a0285897a5bcf3a47c6302f3dc9da64c9">i2cProcQueue</a>(i2c, readCount, timeOutMillis);</div>
<div class="line"><a name="l01647"></a><span class="lineno"> 1647</span>&#160;                }</div>
<div class="line"><a name="l01648"></a><span class="lineno"> 1648</span>&#160;            }</div>
<div class="line"><a name="l01649"></a><span class="lineno"> 1649</span>&#160;            <a class="code" href="esp32-hal-i2c_8c.html#ab270d52c26de7f5ce13ec1538b0b94fd">i2cFlush</a>(i2c);</div>
<div class="line"><a name="l01650"></a><span class="lineno"> 1650</span>&#160;        } <span class="keywordflow">else</span> { <span class="comment">// stop not received, so wait for I2C stop,</span></div>
<div class="line"><a name="l01651"></a><span class="lineno"> 1651</span>&#160;            last_error = <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a3ba8243b59b2c4f46ff083cbe7c8f0ad">I2C_ERROR_CONTINUE</a>;</div>
<div class="line"><a name="l01652"></a><span class="lineno"> 1652</span>&#160;        }</div>
<div class="line"><a name="l01653"></a><span class="lineno"> 1653</span>&#160;    }</div>
<div class="line"><a name="l01654"></a><span class="lineno"> 1654</span>&#160;    <span class="keywordflow">return</span> last_error;</div>
<div class="line"><a name="l01655"></a><span class="lineno"> 1655</span>&#160;}</div>
<div class="line"><a name="l01656"></a><span class="lineno"> 1656</span>&#160; </div>
<div class="line"><a name="l01657"></a><span class="lineno"> 1657</span>&#160;<span class="preprocessor">#define MIN_I2C_CLKS 100              // minimum ratio between cpu and i2c Bus clocks</span></div>
<div class="line"><a name="l01658"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#a22b7fbf8ccfe29971f573cb28f6787dd"> 1658</a></span>&#160;<span class="preprocessor">#define INTERRUPT_CYCLE_OVERHEAD 16000 // number of cpu clocks necessary to respond to interrupt</span></div>
<div class="line"><a name="l01659"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8c.html#ab47a5a461b785c6be025c7e7ec770393"> 1659</a></span>&#160;<a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a0223736866298198d98aebadd9ca47b3">i2cSetFrequency</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> clk_speed)</div>
<div class="line"><a name="l01660"></a><span class="lineno"> 1660</span>&#160;{</div>
<div class="line"><a name="l01661"></a><span class="lineno"> 1661</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01662"></a><span class="lineno"> 1662</span>&#160;        <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a>;</div>
<div class="line"><a name="l01663"></a><span class="lineno"> 1663</span>&#160;    }</div>
<div class="line"><a name="l01664"></a><span class="lineno"> 1664</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> apb = <a class="code" href="esp32-hal-cpu_8c.html#a52637cdc19ab4d49d5f63cc63e6bc832">getApbFrequency</a>(); </div>
<div class="line"><a name="l01665"></a><span class="lineno"> 1665</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> period = (apb/clk_speed) / 2;</div>
<div class="line"><a name="l01666"></a><span class="lineno"> 1666</span>&#160; </div>
<div class="line"><a name="l01667"></a><span class="lineno"> 1667</span>&#160;    <span class="keywordflow">if</span>((apb/8192 &gt; clk_speed)||(apb/<a class="code" href="esp32-hal-i2c_8c.html#a22b7fbf8ccfe29971f573cb28f6787dd">MIN_I2C_CLKS</a> &lt; clk_speed)){ <span class="comment">//out of bounds</span></div>
<div class="line"><a name="l01668"></a><span class="lineno"> 1668</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a1de06c4fd79189513953309af5b5593a">log_d</a>(<span class="stringliteral">&quot;i2c freq(%d) out of bounds.vs APB Clock(%d), min=%d, max=%d&quot;</span>,clk_speed,apb,(apb/8192),(apb/<a class="code" href="esp32-hal-i2c_8c.html#a22b7fbf8ccfe29971f573cb28f6787dd">MIN_I2C_CLKS</a>));</div>
<div class="line"><a name="l01669"></a><span class="lineno"> 1669</span>&#160;    }</div>
<div class="line"><a name="l01670"></a><span class="lineno"> 1670</span>&#160;    <span class="keywordflow">if</span>(period &lt; (<a class="code" href="esp32-hal-i2c_8c.html#a22b7fbf8ccfe29971f573cb28f6787dd">MIN_I2C_CLKS</a>/2) ){</div>
<div class="line"><a name="l01671"></a><span class="lineno"> 1671</span>&#160;        period = (<a class="code" href="esp32-hal-i2c_8c.html#a22b7fbf8ccfe29971f573cb28f6787dd">MIN_I2C_CLKS</a>/2);</div>
<div class="line"><a name="l01672"></a><span class="lineno"> 1672</span>&#160;        clk_speed = apb/(period*2);</div>
<div class="line"><a name="l01673"></a><span class="lineno"> 1673</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a1de06c4fd79189513953309af5b5593a">log_d</a>(<span class="stringliteral">&quot;APB Freq too slow, Reducing i2c Freq to %d Hz&quot;</span>,clk_speed);</div>
<div class="line"><a name="l01674"></a><span class="lineno"> 1674</span>&#160;    } <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( period&gt; 4095) {</div>
<div class="line"><a name="l01675"></a><span class="lineno"> 1675</span>&#160;        period = 4095;</div>
<div class="line"><a name="l01676"></a><span class="lineno"> 1676</span>&#160;        clk_speed = apb/(period*2);</div>
<div class="line"><a name="l01677"></a><span class="lineno"> 1677</span>&#160;        <a class="code" href="esp32-hal-log_8h.html#a1de06c4fd79189513953309af5b5593a">log_d</a>(<span class="stringliteral">&quot;APB Freq too fast, Increasing i2c Freq to %d Hz&quot;</span>,clk_speed);</div>
<div class="line"><a name="l01678"></a><span class="lineno"> 1678</span>&#160;    }</div>
<div class="line"><a name="l01679"></a><span class="lineno"> 1679</span>&#160;<span class="preprocessor">#ifdef ENABLE_I2C_DEBUG_BUFFER</span></div>
<div class="line"><a name="l01680"></a><span class="lineno"> 1680</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a925f3f2d10368d16506845d280b1b7a1">log_v</a>(<span class="stringliteral">&quot;freq=%dHz&quot;</span>,clk_speed);</div>
<div class="line"><a name="l01681"></a><span class="lineno"> 1681</span>&#160;<span class="preprocessor">#endif      </span></div>
<div class="line"><a name="l01682"></a><span class="lineno"> 1682</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> halfPeriod = period/2;</div>
<div class="line"><a name="l01683"></a><span class="lineno"> 1683</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> quarterPeriod = period/4;</div>
<div class="line"><a name="l01684"></a><span class="lineno"> 1684</span>&#160; </div>
<div class="line"><a name="l01685"></a><span class="lineno"> 1685</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a30d636c7aade7e875101380f58b90746">I2C_MUTEX_LOCK</a>();</div>
<div class="line"><a name="l01686"></a><span class="lineno"> 1686</span>&#160; </div>
<div class="line"><a name="l01687"></a><span class="lineno"> 1687</span>&#160;    <a class="code" href="unionI2C__FIFO__CONF__t.html">I2C_FIFO_CONF_t</a> f;</div>
<div class="line"><a name="l01688"></a><span class="lineno"> 1688</span>&#160; </div>
<div class="line"><a name="l01689"></a><span class="lineno"> 1689</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">val</a>    = i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89c28654ad7d9c55847e3ac544d61929">fifo_conf</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l01690"></a><span class="lineno"> 1690</span>&#160;<span class="comment">/*  Adjust Fifo thresholds based on differential between cpu frequency and bus clock.</span></div>
<div class="line"><a name="l01691"></a><span class="lineno"> 1691</span>&#160;<span class="comment">    The fifo_delta is calculated such that at least INTERRUPT_CYCLE_OVERHEAD cpu clocks are</span></div>
<div class="line"><a name="l01692"></a><span class="lineno"> 1692</span>&#160;<span class="comment">    available when a Fifo interrupt is triggered.  This allows enough room in the Fifo so that</span></div>
<div class="line"><a name="l01693"></a><span class="lineno"> 1693</span>&#160;<span class="comment">    interrupt latency does not cause a Fifo overflow/underflow event.</span></div>
<div class="line"><a name="l01694"></a><span class="lineno"> 1694</span>&#160;<span class="comment">*/</span></div>
<div class="line"><a name="l01695"></a><span class="lineno"> 1695</span>&#160;<span class="preprocessor">#ifdef ENABLE_I2C_DEBUG_BUFFER</span></div>
<div class="line"><a name="l01696"></a><span class="lineno"> 1696</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a925f3f2d10368d16506845d280b1b7a1">log_v</a>(<span class="stringliteral">&quot;cpu Freq=%dMhz, i2c Freq=%dHz&quot;</span>,<a class="code" href="esp32-hal-cpu_8c.html#a2d2f074cfffbd2063aa0c10f1d73a51e">getCpuFrequencyMhz</a>(),clk_speed);</div>
<div class="line"><a name="l01697"></a><span class="lineno"> 1697</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01698"></a><span class="lineno"> 1698</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> fifo_delta = (<a class="code" href="esp32-hal-i2c_8c.html#ab47a5a461b785c6be025c7e7ec770393">INTERRUPT_CYCLE_OVERHEAD</a>/((<a class="code" href="esp32-hal-cpu_8c.html#a2d2f074cfffbd2063aa0c10f1d73a51e">getCpuFrequencyMhz</a>()*1000000 / clk_speed)*10))+1; </div>
<div class="line"><a name="l01699"></a><span class="lineno"> 1699</span>&#160;    <span class="keywordflow">if</span> (fifo_delta &gt; 24) fifo_delta=24;   </div>
<div class="line"><a name="l01700"></a><span class="lineno"> 1700</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#ae725a2314a49f5273a1c7f957b0fe8e6">rx_fifo_full_thrhd</a> = 32 - fifo_delta;</div>
<div class="line"><a name="l01701"></a><span class="lineno"> 1701</span>&#160;    f.<a class="code" href="unionI2C__FIFO__CONF__t.html#ae72ce6e606d48072099b3f878829f7c1">tx_fifo_empty_thrhd</a> = fifo_delta;</div>
<div class="line"><a name="l01702"></a><span class="lineno"> 1702</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a89c28654ad7d9c55847e3ac544d61929">fifo_conf</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a> = f.<a class="code" href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">val</a>; <span class="comment">// set thresholds</span></div>
<div class="line"><a name="l01703"></a><span class="lineno"> 1703</span>&#160;<span class="preprocessor">#ifdef ENABLE_I2C_DEBUG_BUFFER</span></div>
<div class="line"><a name="l01704"></a><span class="lineno"> 1704</span>&#160;    <a class="code" href="esp32-hal-log_8h.html#a925f3f2d10368d16506845d280b1b7a1">log_v</a>(<span class="stringliteral">&quot;Fifo delta=%d&quot;</span>,fifo_delta);</div>
<div class="line"><a name="l01705"></a><span class="lineno"> 1705</span>&#160;<span class="preprocessor">#endif</span></div>
<div class="line"><a name="l01706"></a><span class="lineno"> 1706</span>&#160;    <span class="comment">//the clock num during SCL is low level</span></div>
<div class="line"><a name="l01707"></a><span class="lineno"> 1707</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a6875850c3caab3615fc5b7027985fa13">scl_low_period</a>.<a class="code" href="structi2c__dev__t.html#a66e438dcb5bc99cc0219c14a4d17f495">period</a> = period;</div>
<div class="line"><a name="l01708"></a><span class="lineno"> 1708</span>&#160;    <span class="comment">//the clock num during SCL is high level</span></div>
<div class="line"><a name="l01709"></a><span class="lineno"> 1709</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#aa25f4fafaa9bd8c03bf4f1040664dd2f">scl_high_period</a>.<a class="code" href="structi2c__dev__t.html#a66e438dcb5bc99cc0219c14a4d17f495">period</a> = period;</div>
<div class="line"><a name="l01710"></a><span class="lineno"> 1710</span>&#160; </div>
<div class="line"><a name="l01711"></a><span class="lineno"> 1711</span>&#160;    <span class="comment">//the clock num between the negedge of SDA and negedge of SCL for start mark</span></div>
<div class="line"><a name="l01712"></a><span class="lineno"> 1712</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a8959e5d32460a95d899f01d2e9d06947">scl_start_hold</a>.<a class="code" href="structi2c__dev__t.html#ac7f19e940414eb0358e8c778f26c0bc5">time</a> = halfPeriod;</div>
<div class="line"><a name="l01713"></a><span class="lineno"> 1713</span>&#160;    <span class="comment">//the clock num between the posedge of SCL and the negedge of SDA for restart mark</span></div>
<div class="line"><a name="l01714"></a><span class="lineno"> 1714</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#ad9016fd5918434230dd718d9c5092a52">scl_rstart_setup</a>.<a class="code" href="structi2c__dev__t.html#ac7f19e940414eb0358e8c778f26c0bc5">time</a> = halfPeriod;</div>
<div class="line"><a name="l01715"></a><span class="lineno"> 1715</span>&#160; </div>
<div class="line"><a name="l01716"></a><span class="lineno"> 1716</span>&#160;    <span class="comment">//the clock num after the STOP bit&#39;s posedge</span></div>
<div class="line"><a name="l01717"></a><span class="lineno"> 1717</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a16123ff2c11ba84622e3ced02c0582b0">scl_stop_hold</a>.<a class="code" href="structi2c__dev__t.html#ac7f19e940414eb0358e8c778f26c0bc5">time</a> = halfPeriod;</div>
<div class="line"><a name="l01718"></a><span class="lineno"> 1718</span>&#160;    <span class="comment">//the clock num between the posedge of SCL and the posedge of SDA</span></div>
<div class="line"><a name="l01719"></a><span class="lineno"> 1719</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#ac83d5e7a21cc3802dfee5f3ca3675132">scl_stop_setup</a>.<a class="code" href="structi2c__dev__t.html#ac7f19e940414eb0358e8c778f26c0bc5">time</a> = halfPeriod;</div>
<div class="line"><a name="l01720"></a><span class="lineno"> 1720</span>&#160; </div>
<div class="line"><a name="l01721"></a><span class="lineno"> 1721</span>&#160;    <span class="comment">//the clock num I2C used to hold the data after the negedge of SCL.</span></div>
<div class="line"><a name="l01722"></a><span class="lineno"> 1722</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a3140366faff678ff124a9150eb0daf7f">sda_hold</a>.<a class="code" href="structi2c__dev__t.html#ac7f19e940414eb0358e8c778f26c0bc5">time</a> = quarterPeriod;</div>
<div class="line"><a name="l01723"></a><span class="lineno"> 1723</span>&#160;    <span class="comment">//the clock num I2C used to sample data on SDA after the posedge of SCL</span></div>
<div class="line"><a name="l01724"></a><span class="lineno"> 1724</span>&#160;    i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#af16bd0c672658c4aaaf3dbdf7983f09a">sda_sample</a>.<a class="code" href="structi2c__dev__t.html#ac7f19e940414eb0358e8c778f26c0bc5">time</a> = quarterPeriod;</div>
<div class="line"><a name="l01725"></a><span class="lineno"> 1725</span>&#160;    <a class="code" href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a>();</div>
<div class="line"><a name="l01726"></a><span class="lineno"> 1726</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a>;</div>
<div class="line"><a name="l01727"></a><span class="lineno"> 1727</span>&#160;}</div>
<div class="line"><a name="l01728"></a><span class="lineno"> 1728</span>&#160; </div>
<div class="line"><a name="l01729"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a76839c845b68b6104dd8f77b5c08d478"> 1729</a></span>&#160;<a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a76839c845b68b6104dd8f77b5c08d478">i2cGetFrequency</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c)</div>
<div class="line"><a name="l01730"></a><span class="lineno"> 1730</span>&#160;{</div>
<div class="line"><a name="l01731"></a><span class="lineno"> 1731</span>&#160;    <span class="keywordflow">if</span>(i2c == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01732"></a><span class="lineno"> 1732</span>&#160;        <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01733"></a><span class="lineno"> 1733</span>&#160;    }</div>
<div class="line"><a name="l01734"></a><span class="lineno"> 1734</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> result = 0;</div>
<div class="line"><a name="l01735"></a><span class="lineno"> 1735</span>&#160;    <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> old_count = (i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a6875850c3caab3615fc5b7027985fa13">scl_low_period</a>.<a class="code" href="structi2c__dev__t.html#a66e438dcb5bc99cc0219c14a4d17f495">period</a>+i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#aa25f4fafaa9bd8c03bf4f1040664dd2f">scl_high_period</a>.<a class="code" href="structi2c__dev__t.html#a66e438dcb5bc99cc0219c14a4d17f495">period</a>);</div>
<div class="line"><a name="l01736"></a><span class="lineno"> 1736</span>&#160;    <span class="keywordflow">if</span>(old_count&gt;0) {</div>
<div class="line"><a name="l01737"></a><span class="lineno"> 1737</span>&#160;        result = <a class="code" href="esp32-hal-cpu_8c.html#a52637cdc19ab4d49d5f63cc63e6bc832">getApbFrequency</a>() / old_count;</div>
<div class="line"><a name="l01738"></a><span class="lineno"> 1738</span>&#160;    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l01739"></a><span class="lineno"> 1739</span>&#160;        result = 0;</div>
<div class="line"><a name="l01740"></a><span class="lineno"> 1740</span>&#160;    }</div>
<div class="line"><a name="l01741"></a><span class="lineno"> 1741</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l01742"></a><span class="lineno"> 1742</span>&#160;}</div>
<div class="line"><a name="l01743"></a><span class="lineno"> 1743</span>&#160; </div>
<div class="line"><a name="l01744"></a><span class="lineno"> 1744</span>&#160; </div>
<div class="line"><a name="l01745"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#ad681ee1345bbfeac978592e16d10b79a"> 1745</a></span>&#160;<a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a1abf3bfb3124c9d7ecef1fb8ef962182">i2cDebug</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> setBits, <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> resetBits){</div>
<div class="line"><a name="l01746"></a><span class="lineno"> 1746</span>&#160;    <span class="keywordflow">if</span>(i2c != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {</div>
<div class="line"><a name="l01747"></a><span class="lineno"> 1747</span>&#160;        i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a> = ((i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a> | setBits) &amp; ~resetBits);</div>
<div class="line"><a name="l01748"></a><span class="lineno"> 1748</span>&#160;        <span class="keywordflow">return</span> i2c-&gt;<a class="code" href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">debugFlags</a>;</div>
<div class="line"><a name="l01749"></a><span class="lineno"> 1749</span>&#160;    }</div>
<div class="line"><a name="l01750"></a><span class="lineno"> 1750</span>&#160;    <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01751"></a><span class="lineno"> 1751</span>&#160;    </div>
<div class="line"><a name="l01752"></a><span class="lineno"> 1752</span>&#160; }</div>
<div class="line"><a name="l01753"></a><span class="lineno"> 1753</span>&#160; </div>
<div class="line"><a name="l01754"></a><span class="lineno"><a class="line" href="esp32-hal-i2c_8h.html#a0e90b59a14dce6407857b1e476de3667"> 1754</a></span>&#160;<a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> <a class="code" href="esp32-hal-i2c_8c.html#a0e90b59a14dce6407857b1e476de3667">i2cGetStatus</a>(<a class="code" href="structi2c__struct__t.html">i2c_t</a> * i2c){</div>
<div class="line"><a name="l01755"></a><span class="lineno"> 1755</span>&#160;    <span class="keywordflow">if</span>(i2c != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>){</div>
<div class="line"><a name="l01756"></a><span class="lineno"> 1756</span>&#160;        <span class="keywordflow">return</span> i2c-&gt;<a class="code" href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">dev</a>-&gt;<a class="code" href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">status_reg</a>.<a class="code" href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">val</a>;</div>
<div class="line"><a name="l01757"></a><span class="lineno"> 1757</span>&#160;    }</div>
<div class="line"><a name="l01758"></a><span class="lineno"> 1758</span>&#160;    <span class="keywordflow">else</span> <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l01759"></a><span class="lineno"> 1759</span>&#160;}</div>
<div class="line"><a name="l01760"></a><span class="lineno"> 1760</span>&#160; </div>
<div class="line"><a name="l01761"></a><span class="lineno"> 1761</span>&#160; </div>
<div class="line"><a name="l01762"></a><span class="lineno"> 1762</span>&#160;<span class="comment">/* todo</span></div>
<div class="line"><a name="l01763"></a><span class="lineno"> 1763</span>&#160;<span class="comment">  22JUL18</span></div>
<div class="line"><a name="l01764"></a><span class="lineno"> 1764</span>&#160;<span class="comment">    need to add multi-thread capability, use dq.queueEvent as the group marker. When multiple threads</span></div>
<div class="line"><a name="l01765"></a><span class="lineno"> 1765</span>&#160;<span class="comment">    transactions are present in the same queue, and an error occurs, abort all succeeding unserviced transactions</span></div>
<div class="line"><a name="l01766"></a><span class="lineno"> 1766</span>&#160;<span class="comment">    with the same dq.queueEvent value.  Succeeding unserviced transactions with different dq.queueEvent values</span></div>
<div class="line"><a name="l01767"></a><span class="lineno"> 1767</span>&#160;<span class="comment">    can be re-queued and processed independently. </span></div>
<div class="line"><a name="l01768"></a><span class="lineno"> 1768</span>&#160;<span class="comment">  30JUL18 complete data only queue elements, this will allow transfers to use multiple data blocks, </span></div>
<div class="line"><a name="l01769"></a><span class="lineno"> 1769</span>&#160;<span class="comment"> */</span></div>
<div class="line"><a name="l01770"></a><span class="lineno"> 1770</span>&#160; </div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="ai2c__reg_8h_html_a6bee57099c576e9d24180fc06236d8d4"><div class="ttname"><a href="i2c__reg_8h.html#a6bee57099c576e9d24180fc06236d8d4">I2C_TIME_OUT_INT_ENA</a></div><div class="ttdeci">#define I2C_TIME_OUT_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00473">i2c_reg.h:472</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_af848359f1f618cf9a627d483a5da95c8"><div class="ttname"><a href="esp32-hal-i2c_8c.html#af848359f1f618cf9a627d483a5da95c8">i2cRelease</a></div><div class="ttdeci">void i2cRelease(i2c_t *i2c)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01559">esp32-hal-i2c.c:1559</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a61af85395270abc2c57cdec5fa81af81">I2C_ERROR_OK</a></div><div class="ttdeci">@ I2C_ERROR_OK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00030">esp32-hal-i2c.h:30</a></div></div>
<div class="ttc" id="anamespaceasio_1_1detail_html_a83969c12552b8b4db0c39a9efd1e0e25"><div class="ttname"><a href="namespaceasio_1_1detail.html#a83969c12552b8b4db0c39a9efd1e0e25">asio::detail::event</a></div><div class="ttdeci">null_event event</div><div class="ttdef"><b>Definition:</b> <a href="event_8hpp_source.html#l00036">event.hpp:36</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_af942127f6c441cbdd5ccc58217e8570b"><div class="ttname"><a href="structi2c__dev__t.html#af942127f6c441cbdd5ccc58217e8570b">i2c_dev_t::command</a></div><div class="ttdeci">union i2c_dev_t::@423 command[16]</div></div>
<div class="ttc" id="ai2c__reg_8h_html_a40c86feff31fd56a6297f3c6655f163e"><div class="ttname"><a href="i2c__reg_8h.html#a40c86feff31fd56a6297f3c6655f163e">I2C_END_DETECT_INT_ST_M</a></div><div class="ttdeci">#define I2C_END_DETECT_INT_ST_M</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00584">i2c_reg.h:583</a></div></div>
<div class="ttc" id="ai2c__struct_8h_html"><div class="ttname"><a href="i2c__struct_8h.html">i2c_struct.h</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_af132d6cb4090b6f2902bbac45317048f"><div class="ttname"><a href="i2c__reg_8h.html#af132d6cb4090b6f2902bbac45317048f">I2C_RXFIFO_FULL_INT_ENA</a></div><div class="ttdeci">#define I2C_RXFIFO_FULL_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00521">i2c_reg.h:520</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a7db81cc506d04e9c8830aa9d7735ff24"><div class="ttname"><a href="structi2c__struct__t.html#a7db81cc506d04e9c8830aa9d7735ff24">i2c_struct_t::mode</a></div><div class="ttdeci">I2C_MODE_t mode</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00177">esp32-hal-i2c.c:177</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a89ac7db28179097a96e651e17a9c35a9"><div class="ttname"><a href="structi2c__dev__t.html#a89ac7db28179097a96e651e17a9c35a9">i2c_dev_t::ctr</a></div><div class="ttdeci">union i2c_dev_t::@403 ctr</div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_a4330934ad271c97b698fc31109b4a2c7"><div class="ttname"><a href="unionI2C__COMMAND__t.html#a4330934ad271c97b698fc31109b4a2c7">I2C_COMMAND_t::ack_en</a></div><div class="ttdeci">uint32_t ack_en</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00061">esp32-hal-i2c.c:61</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a46bdfbcb68572cde999861c2251aeb65"><div class="ttname"><a href="structi2c__dev__t.html#a46bdfbcb68572cde999861c2251aeb65">i2c_dev_t::fifo_data</a></div><div class="ttdeci">union i2c_dev_t::@409 fifo_data</div></div>
<div class="ttc" id="adport__reg_8h_html_a5defc386124973590397a2d78d2f50bc"><div class="ttname"><a href="dport__reg_8h.html#a5defc386124973590397a2d78d2f50bc">DPORT_PERIP_RST_EN_REG</a></div><div class="ttdeci">#define DPORT_PERIP_RST_EN_REG</div><div class="ttdef"><b>Definition:</b> <a href="dport__reg_8h_source.html#l00985">dport_reg.h:984</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html">I2C_FIFO_CONF_t</a></div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00071">esp32-hal-i2c.c:71</a></div></div>
<div class="ttc" id="aesp__intr__alloc_8h_html_ab011a236fc3c9318f38ae4cdb9a26105"><div class="ttname"><a href="esp__intr__alloc_8h.html#ab011a236fc3c9318f38ae4cdb9a26105">intr_handle_t</a></div><div class="ttdeci">intr_handle_data_t * intr_handle_t</div><div class="ttdef"><b>Definition:</b> <a href="esp__intr__alloc_8h_source.html#l00087">esp_intr_alloc.h:87</a></div></div>
<div class="ttc" id="astdint_8h_html_a06ffba8acf5d133104191f183e67ac8c"><div class="ttname"><a href="stdint_8h.html#a06ffba8acf5d133104191f183e67ac8c">int8_t</a></div><div class="ttdeci">__int8_t int8_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00020">stdint.h:20</a></div></div>
<div class="ttc" id="aesp32-hal-matrix_8c_html_a2a3f15df9222f9488139614fad88c907"><div class="ttname"><a href="esp32-hal-matrix_8c.html#a2a3f15df9222f9488139614fad88c907">pinMatrixInDetach</a></div><div class="ttdeci">void IRAM_ATTR pinMatrixInDetach(uint8_t signal, bool high, bool inverted)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-matrix_8c_source.html#l00038">esp32-hal-matrix.c:38</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a48ed4cfaff55487476d8165c9e35d1e1"><div class="ttname"><a href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a48ed4cfaff55487476d8165c9e35d1e1">I2C_CMD_STOP</a></div><div class="ttdeci">@ I2C_CMD_STOP</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00196">esp32-hal-i2c.c:196</a></div></div>
<div class="ttc" id="atask_8h_html"><div class="ttname"><a href="task_8h.html">task.h</a></div></div>
<div class="ttc" id="aesp32-hal-log_8h_html_a925f3f2d10368d16506845d280b1b7a1"><div class="ttname"><a href="esp32-hal-log_8h.html#a925f3f2d10368d16506845d280b1b7a1">log_v</a></div><div class="ttdeci">#define log_v(format,...)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-log_8h_source.html#l00085">esp32-hal-log.h:84</a></div></div>
<div class="ttc" id="astdint_8h_html_a281b4b5562236420969a830503b0ba19"><div class="ttname"><a href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a></div><div class="ttdeci">__uint16_t uint16_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00033">stdint.h:33</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a2e2624c8eb2b28797f651a1f88653ae7"><div class="ttname"><a href="i2c__reg_8h.html#a2e2624c8eb2b28797f651a1f88653ae7">I2C_ARBITRATION_LOST_INT_ENA</a></div><div class="ttdeci">#define I2C_ARBITRATION_LOST_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00491">i2c_reg.h:490</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a5bc92d9eaa2740f4e94965fa36172f96"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a5bc92d9eaa2740f4e94965fa36172f96">DR_REG_I2C1_EXT_BASE_FIXED</a></div><div class="ttdeci">#define DR_REG_I2C1_EXT_BASE_FIXED</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00035">esp32-hal-i2c.c:34</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a4fc7f1f13dbbcf5de5a60d57533dfc4e"><div class="ttname"><a href="structi2c__dev__t.html#a4fc7f1f13dbbcf5de5a60d57533dfc4e">i2c_dev_t::end_detect</a></div><div class="ttdeci">uint32_t end_detect</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00117">i2c_struct.h:117</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__ST__t_html_aeaf0751adaf723adc7be60f6ac4c5994"><div class="ttname"><a href="unionI2C__FIFO__ST__t.html#aeaf0751adaf723adc7be60f6ac4c5994">I2C_FIFO_ST_t::reserved20</a></div><div class="ttdeci">uint32_t reserved20</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00094">esp32-hal-i2c.c:94</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a4100839fdd3ae102156a79f41ec36187"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187">I2C_STAGE_t</a></div><div class="ttdeci">I2C_STAGE_t</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00102">esp32-hal-i2c.c:102</a></div></div>
<div class="ttc" id="aevent__groups_8h_html"><div class="ttname"><a href="event__groups_8h.html">event_groups.h</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a6b0447b9745ab4aa9b58d8e428fe01ff"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a6b0447b9745ab4aa9b58d8e428fe01ff">i2cDetachSCL</a></div><div class="ttdeci">i2c_err_t i2cDetachSCL(i2c_t *i2c, int8_t scl)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01444">esp32-hal-i2c.c:1444</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_ade7e0553ee987a9446cd674ec38c341faf4ca5227cff9f13557a1bbe51ad02724"><div class="ttname"><a href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341faf4ca5227cff9f13557a1bbe51ad02724">I2C_MASTER</a></div><div class="ttdeci">@ I2C_MASTER</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00111">esp32-hal-i2c.c:111</a></div></div>
<div class="ttc" id="ahttp__parser_8h_html_ab6b306ef981f5e21bb41ea2c2dbe8cd9"><div class="ttname"><a href="http__parser_8h.html#ab6b306ef981f5e21bb41ea2c2dbe8cd9">flags</a></div><div class="ttdeci">flags</div><div class="ttdef"><b>Definition:</b> <a href="http__parser_8h_source.html#l00148">http_parser.h:149</a></div></div>
<div class="ttc" id="aportmacro_8h_html_ab35c804254f390845581c29fe6bcb65a"><div class="ttname"><a href="portmacro_8h.html#ab35c804254f390845581c29fe6bcb65a">portYIELD_FROM_ISR</a></div><div class="ttdeci">#define portYIELD_FROM_ISR()</div><div class="ttdef"><b>Definition:</b> <a href="portmacro_8h_source.html#l00388">portmacro.h:387</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_afbfb00ea741d217c953b504dcb65cdb3ae6a8bc51a7b7474f8c2b3c2163e5bd49"><div class="ttname"><a href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3ae6a8bc51a7b7474f8c2b3c2163e5bd49">I2C_DATA_NAK</a></div><div class="ttdeci">@ I2C_DATA_NAK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00122">esp32-hal-i2c.c:122</a></div></div>
<div class="ttc" id="aesp__attr_8h_html_a8b5a7da03d5e9fbb2ca81ddc85025012"><div class="ttname"><a href="esp__attr_8h.html#a8b5a7da03d5e9fbb2ca81ddc85025012">IRAM_ATTR</a></div><div class="ttdeci">#define IRAM_ATTR</div><div class="ttdef"><b>Definition:</b> <a href="esp__attr_8h_source.html#l00027">esp_attr.h:26</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a1abf3bfb3124c9d7ecef1fb8ef962182"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a1abf3bfb3124c9d7ecef1fb8ef962182">i2cDebug</a></div><div class="ttdeci">uint32_t i2cDebug(i2c_t *i2c, uint32_t setBits, uint32_t resetBits)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01745">esp32-hal-i2c.c:1745</a></div></div>
<div class="ttc" id="atools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h_html_a324d7087026e1e9dfe6b7567d5bf63c8"><div class="ttname"><a href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html#a324d7087026e1e9dfe6b7567d5bf63c8">portTickType</a></div><div class="ttdeci">#define portTickType</div><div class="ttdef"><b>Definition:</b> <a href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h_source.html#l00819">FreeRTOS.h:818</a></div></div>
<div class="ttc" id="adport__access_8h_html_ae41996597ae6153962375a83c1100f1f"><div class="ttname"><a href="dport__access_8h.html#ae41996597ae6153962375a83c1100f1f">DPORT_CLEAR_PERI_REG_MASK</a></div><div class="ttdeci">#define DPORT_CLEAR_PERI_REG_MASK(reg, mask)</div><div class="ttdef"><b>Definition:</b> <a href="dport__access_8h_source.html#l00181">dport_access.h:180</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a0ed4bdd99c6db8b98e376c9d2414b38a"><div class="ttname"><a href="structi2c__struct__t.html#a0ed4bdd99c6db8b98e376c9d2414b38a">i2c_struct_t::dq</a></div><div class="ttdeci">I2C_DATA_QUEUE_t * dq</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00183">esp32-hal-i2c.c:183</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a676a425504ba43c012aa06d552e5173e"><div class="ttname"><a href="structi2c__dev__t.html#a676a425504ba43c012aa06d552e5173e">i2c_dev_t::rx_fifo_full</a></div><div class="ttdeci">uint32_t rx_fifo_full</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00114">i2c_struct.h:114</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a8959e5d32460a95d899f01d2e9d06947"><div class="ttname"><a href="structi2c__dev__t.html#a8959e5d32460a95d899f01d2e9d06947">i2c_dev_t::scl_start_hold</a></div><div class="ttdeci">union i2c_dev_t::@417 scl_start_hold</div></div>
<div class="ttc" id="astructi2c__dev__t_html_a16123ff2c11ba84622e3ced02c0582b0"><div class="ttname"><a href="structi2c__dev__t.html#a16123ff2c11ba84622e3ced02c0582b0">i2c_dev_t::scl_stop_hold</a></div><div class="ttdeci">union i2c_dev_t::@419 scl_stop_hold</div></div>
<div class="ttc" id="astructi2c__dev__t_html_a99d8a9c5377e2c44895c7fb824562f72"><div class="ttname"><a href="structi2c__dev__t.html#a99d8a9c5377e2c44895c7fb824562f72">i2c_dev_t::scl_force_out</a></div><div class="ttdeci">uint32_t scl_force_out</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00034">i2c_struct.h:34</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a728cfb17097f6b840d3e9c2c13723f10"><div class="ttname"><a href="structi2c__struct__t.html#a728cfb17097f6b840d3e9c2c13723f10">i2c_struct_t::dev</a></div><div class="ttdeci">i2c_dev_t * dev</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00170">esp32-hal-i2c.c:170</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a999fb9bca782f99ff4612e8421072bad">I2C_DONE</a></div><div class="ttdeci">@ I2C_DONE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00107">esp32-hal-i2c.c:106</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a9eb825b493b3fa6ef6fc0ecc33995298"><div class="ttname"><a href="i2c__reg_8h.html#a9eb825b493b3fa6ef6fc0ecc33995298">I2C_TXFIFO_EMPTY_INT_ST</a></div><div class="ttdeci">#define I2C_TXFIFO_EMPTY_INT_ST</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00595">i2c_reg.h:594</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_ab9700d95fe090c521d39ccc62cec2bf0"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#ab9700d95fe090c521d39ccc62cec2bf0">I2C_FIFO_CONF_t::rx_fifo_rst</a></div><div class="ttdeci">uint32_t rx_fifo_rst</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00077">esp32-hal-i2c.c:77</a></div></div>
<div class="ttc" id="aesp32-hal-matrix_8c_html_ac991dba10f936abd7becd51ff2d73f7b"><div class="ttname"><a href="esp32-hal-matrix_8c.html#ac991dba10f936abd7becd51ff2d73f7b">pinMatrixInAttach</a></div><div class="ttdeci">void IRAM_ATTR pinMatrixInAttach(uint8_t pin, uint8_t signal, bool inverted)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-matrix_8c_source.html#l00033">esp32-hal-matrix.c:33</a></div></div>
<div class="ttc" id="aevent__groups_8h_html_a62b68278abac6358369ae8e390988a02"><div class="ttname"><a href="event__groups_8h.html#a62b68278abac6358369ae8e390988a02">xEventGroupSetBitsFromISR</a></div><div class="ttdeci">#define xEventGroupSetBitsFromISR(xEventGroup, uxBitsToSet, pxHigherPriorityTaskWoken)</div><div class="ttdef"><b>Definition:</b> <a href="event__groups_8h_source.html#l00555">event_groups.h:554</a></div></div>
<div class="ttc" id="aesp32-hal-misc_8c_html_ae3503e70fc65f10a5e08f8c5815e8599"><div class="ttname"><a href="esp32-hal-misc_8c.html#ae3503e70fc65f10a5e08f8c5815e8599">delayMicroseconds</a></div><div class="ttdeci">void IRAM_ATTR delayMicroseconds(uint32_t us)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-misc_8c_source.html#l00149">esp32-hal-misc.c:149</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a5041ab55bce58a6f5a9e3b6b296b3f07"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a5041ab55bce58a6f5a9e3b6b296b3f07">I2C_DATA_CTRL_t::startCmdSent</a></div><div class="ttdeci">uint32_t startCmdSent</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00148">esp32-hal-i2c.c:148</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_ae47320542d6ab1632ab44d6b3c6f87de"><div class="ttname"><a href="unionI2C__COMMAND__t.html#ae47320542d6ab1632ab44d6b3c6f87de">I2C_COMMAND_t::ack_exp</a></div><div class="ttdeci">uint32_t ack_exp</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00062">esp32-hal-i2c.c:62</a></div></div>
<div class="ttc" id="astructI2C__DATA__QUEUE__t_html_a48073cf254a90a928cc5aacdaa9d0a48"><div class="ttname"><a href="structI2C__DATA__QUEUE__t.html#a48073cf254a90a928cc5aacdaa9d0a48">I2C_DATA_QUEUE_t::data</a></div><div class="ttdeci">uint8_t * data</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00161">esp32-hal-i2c.c:161</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html"><div class="ttname"><a href="i2c__reg_8h.html">i2c_reg.h</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_acb3e61f8e61bc725670539115498d5cd"><div class="ttname"><a href="esp32-hal-i2c_8c.html#acb3e61f8e61bc725670539115498d5cd">EVENT_DONE</a></div><div class="ttdeci">#define EVENT_DONE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00135">esp32-hal-i2c.c:134</a></div></div>
<div class="ttc" id="asoc_8h_html_a0c36237cc6b5140fd0cf1e449d177809"><div class="ttname"><a href="soc_8h.html#a0c36237cc6b5140fd0cf1e449d177809">ETS_I2C_EXT1_INTR_SOURCE</a></div><div class="ttdeci">#define ETS_I2C_EXT1_INTR_SOURCE</div><div class="ttdef"><b>Definition:</b> <a href="soc_8h_source.html#l00378">soc.h:377</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a9ff855baf1376e63d4e9cec27f28b62b"><div class="ttname"><a href="i2c__reg_8h.html#a9ff855baf1376e63d4e9cec27f28b62b">I2C_TRANS_COMPLETE_INT_ENA</a></div><div class="ttdeci">#define I2C_TRANS_COMPLETE_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00479">i2c_reg.h:478</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a4fe9f1267d59f0178614b9c05bd6cec4"><div class="ttname"><a href="structi2c__dev__t.html#a4fe9f1267d59f0178614b9c05bd6cec4">i2c_dev_t::byte_num</a></div><div class="ttdeci">uint32_t byte_num</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00256">i2c_struct.h:256</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_afbfb00ea741d217c953b504dcb65cdb3a2e4932a1868432bff23103fac0127fdc"><div class="ttname"><a href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a2e4932a1868432bff23103fac0127fdc">I2C_ERROR</a></div><div class="ttdeci">@ I2C_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00120">esp32-hal-i2c.c:120</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a25efb929e18c744f82a36325eb14e69a"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a25efb929e18c744f82a36325eb14e69a">I2C_MUTEX_UNLOCK</a></div><div class="ttdeci">#define I2C_MUTEX_UNLOCK()</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00211">esp32-hal-i2c.c:210</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_af9e543008ddc11a5379cb6694fb8c3e2"><div class="ttname"><a href="structi2c__struct__t.html#af9e543008ddc11a5379cb6694fb8c3e2">i2c_struct_t::stage</a></div><div class="ttdeci">I2C_STAGE_t stage</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00178">esp32-hal-i2c.c:178</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_ad9016fd5918434230dd718d9c5092a52"><div class="ttname"><a href="structi2c__dev__t.html#ad9016fd5918434230dd718d9c5092a52">i2c_dev_t::scl_rstart_setup</a></div><div class="ttdeci">union i2c_dev_t::@418 scl_rstart_setup</div></div>
<div class="ttc" id="aunionI2C__FIFO__ST__t_html_a32556e203f837a0f7899cd0d605fd086"><div class="ttname"><a href="unionI2C__FIFO__ST__t.html#a32556e203f837a0f7899cd0d605fd086">I2C_FIFO_ST_t::tx_fifo_start_addr</a></div><div class="ttdeci">uint32_t tx_fifo_start_addr</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00092">esp32-hal-i2c.c:92</a></div></div>
<div class="ttc" id="aesp32-hal-log_8h_html_a1de06c4fd79189513953309af5b5593a"><div class="ttname"><a href="esp32-hal-log_8h.html#a1de06c4fd79189513953309af5b5593a">log_d</a></div><div class="ttdeci">#define log_d(format,...)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-log_8h_source.html#l00093">esp32-hal-log.h:92</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a2b07d645f43661e8c7ea81044f985799"><div class="ttname"><a href="structi2c__dev__t.html#a2b07d645f43661e8c7ea81044f985799">i2c_dev_t::time_out</a></div><div class="ttdeci">uint32_t time_out</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00050">i2c_struct.h:50</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8c_html_ad7389b1cd9f6a2d4326b50e04f533e17"><div class="ttname"><a href="esp32-hal-cpu_8c.html#ad7389b1cd9f6a2d4326b50e04f533e17">addApbChangeCallback</a></div><div class="ttdeci">bool addApbChangeCallback(void *arg, apb_change_cb_t cb)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-cpu_8c_source.html#l00074">esp32-hal-cpu.c:74</a></div></div>
<div class="ttc" id="adport__reg_8h_html_a9fc62e8ef1289b8ba8ecb726c4f57f51"><div class="ttname"><a href="dport__reg_8h.html#a9fc62e8ef1289b8ba8ecb726c4f57f51">DPORT_I2C_EXT0_RST</a></div><div class="ttdeci">#define DPORT_I2C_EXT0_RST</div><div class="ttdef"><b>Definition:</b> <a href="dport__reg_8h_source.html#l01012">dport_reg.h:1011</a></div></div>
<div class="ttc" id="aRPSL_8txt_html_ae227cfd33a5880ffce840d383c2fbff3"><div class="ttname"><a href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a></div><div class="ttdeci">Conditions &amp;Restrictions Subject to the terms and conditions of this Licensor hereby grants effective on the date You accept this a royalty free</div><div class="ttdef"><b>Definition:</b> <a href="RPSL_8txt_source.html#l00105">RPSL.txt:105</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a850e57ef5a7be95eadb35a0f5ac7aef4"><div class="ttname"><a href="i2c__reg_8h.html#a850e57ef5a7be95eadb35a0f5ac7aef4">I2C_ACK_ERR_INT_ST_M</a></div><div class="ttdeci">#define I2C_ACK_ERR_INT_ST_M</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00542">i2c_reg.h:541</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a2795f548027cd180e161b1d65608b906"><div class="ttname"><a href="structi2c__struct__t.html#a2795f548027cd180e161b1d65608b906">i2c_struct_t::i2c_event</a></div><div class="ttdeci">EventGroupHandle_t i2c_event</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00180">esp32-hal-i2c.c:180</a></div></div>
<div class="ttc" id="adport__access_8h_html_a30f4d8bd206a36385b711ed14dd05b34"><div class="ttname"><a href="dport__access_8h.html#a30f4d8bd206a36385b711ed14dd05b34">DPORT_SET_PERI_REG_MASK</a></div><div class="ttdeci">#define DPORT_SET_PERI_REG_MASK(reg, mask)</div><div class="ttdef"><b>Definition:</b> <a href="dport__access_8h_source.html#l00184">dport_access.h:183</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a84f8a4430731e9fb4f3ca13298695ad1"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a84f8a4430731e9fb4f3ca13298695ad1">EVENT_ERROR_PREV</a></div><div class="ttdeci">#define EVENT_ERROR_PREV</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00137">esp32-hal-i2c.c:136</a></div></div>
<div class="ttc" id="atools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h_html"><div class="ttname"><a href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html">FreeRTOS.h</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_ae20d743b705cce71f404d99d857c8293"><div class="ttname"><a href="unionI2C__COMMAND__t.html#ae20d743b705cce71f404d99d857c8293">I2C_COMMAND_t::op_code</a></div><div class="ttdeci">uint32_t op_code</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00064">esp32-hal-i2c.c:64</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a9999cfb99dfd2078a47720ae19c5d79d"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a9999cfb99dfd2078a47720ae19c5d79d">I2C_DATA_CTRL_t::addrReq</a></div><div class="ttdeci">uint32_t addrReq</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00152">esp32-hal-i2c.c:152</a></div></div>
<div class="ttc" id="aArduino-IRremote_2LICENSE_8txt_html_a9642942062a0c88c684a2bb3289aa738"><div class="ttname"><a href="Arduino-IRremote_2LICENSE_8txt.html#a9642942062a0c88c684a2bb3289aa738">reason</a></div><div class="ttdeci">if the work is an executable linked with the with the complete machine readable work that uses the as object code and or source so that the user can modify the Library and then relink to produce a modified executable containing the modified rather than copying library functions into the if the user installs as long as the modified version is interface compatible with the version that the work was made with c Accompany the work with a written valid for at least three to give the same user the materials specified in for a charge no more than the cost of performing this distribution d If distribution of the work is made by offering access to copy from a designated offer equivalent access to copy the above specified materials from the same place e Verify that the user has already received a copy of these materials or that you have already sent this user a copy For an the required form of the work that uses the Library must include any data and utility programs needed for reproducing the executable from it as a special the materials to be distributed need not include anything that is normally and so on of the operating system on which the executable unless that component itself accompanies the executable It may happen that this requirement contradicts the license restrictions of other proprietary libraries that do not normally accompany the operating system Such a contradiction means you cannot use both them and the Library together in an executable that you distribute You may place library facilities that are a work based on the Library side by side in a single library together with other library facilities not covered by this and distribute such a combined provided that the separate distribution of the work based on the Library and of the other library facilities is otherwise and provided that you do these two uncombined with any other library facilities This must be distributed under the terms of the Sections above b Give prominent notice with the combined library of the fact that part of it is a work based on the and explaining where to find the accompanying uncombined form of the same work You may not link or distribute the Library except as expressly provided under this License Any attempt otherwise to link or distribute the Library is and will automatically terminate your rights under this License parties who have received or from you under this License will not have their licenses terminated so long as such parties remain in full compliance You are not required to accept this since you have not signed it nothing else grants you permission to modify or distribute the Library or its derivative works These actions are prohibited by law if you do not accept this License by modifying or distributing the you indicate your acceptance of this License to do and all its terms and conditions for distributing or modifying the Library or works based on it Each time you redistribute the the recipient automatically receives a license from the original licensor to link with or modify the Library subject to these terms and conditions You may not impose any further restrictions on the recipients exercise of the rights granted herein You are not responsible for enforcing compliance by third parties with this License as a consequence of a court judgment or allegation of patent infringement or for any other reason(not limited to patent issues)</div></div>
<div class="ttc" id="astructi2c__dev__t_html_acf59f484dd868cb0d92cf2650f89ffa5"><div class="ttname"><a href="structi2c__dev__t.html#acf59f484dd868cb0d92cf2650f89ffa5">i2c_dev_t::date</a></div><div class="ttdeci">uint32_t date</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00290">i2c_struct.h:290</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8h_html_a030cbe7d208b1f9b7c85765ccc5b4fff"><div class="ttname"><a href="esp32-hal-cpu_8h.html#a030cbe7d208b1f9b7c85765ccc5b4fff">apb_change_ev_t</a></div><div class="ttdeci">apb_change_ev_t</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-cpu_8h_source.html#l00026">esp32-hal-cpu.h:26</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a215c438d2ec5e0a58bfc36989e0368bc"><div class="ttname"><a href="structi2c__dev__t.html#a215c438d2ec5e0a58bfc36989e0368bc">i2c_dev_t::int_clr</a></div><div class="ttdeci">union i2c_dev_t::@411 int_clr</div></div>
<div class="ttc" id="astructi2c__dev__t_html_a3edbfd55ed118c1297db594e20dbe9a1"><div class="ttname"><a href="structi2c__dev__t.html#a3edbfd55ed118c1297db594e20dbe9a1">i2c_dev_t::ms_mode</a></div><div class="ttdeci">uint32_t ms_mode</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00037">i2c_struct.h:37</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_af189e14a82ce53935c15340906746186"><div class="ttname"><a href="i2c__reg_8h.html#af189e14a82ce53935c15340906746186">I2C_RXFIFO_FULL_INT_ST</a></div><div class="ttdeci">#define I2C_RXFIFO_FULL_INT_ST</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00601">i2c_reg.h:600</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83af2a92feb58cfefb6fbda0e5d0c2aadf2"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83af2a92feb58cfefb6fbda0e5d0c2aadf2">I2C_ERROR_BUS</a></div><div class="ttdeci">@ I2C_ERROR_BUS</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00034">esp32-hal-i2c.h:34</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8h_html_ab811d8c6ff3a505312d3276590444289"><div class="ttname"><a href="esp32-hal-gpio_8h.html#ab811d8c6ff3a505312d3276590444289">LOW</a></div><div class="ttdeci">#define LOW</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-gpio_8h_source.html#l00030">esp32-hal-gpio.h:29</a></div></div>
<div class="ttc" id="acJSON_8h_html_a750b5d744c39a06bfb13e6eb010e35d0"><div class="ttname"><a href="cJSON_8h.html#a750b5d744c39a06bfb13e6eb010e35d0">index</a></div><div class="ttdeci">int index</div><div class="ttdef"><b>Definition:</b> <a href="cJSON_8h_source.html#l00168">cJSON.h:168</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a5cd2a28acff6be374a16bbf81b64c953"><div class="ttname"><a href="structi2c__struct__t.html#a5cd2a28acff6be374a16bbf81b64c953">i2c_struct_t::scl</a></div><div class="ttdeci">int8_t scl</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00176">esp32-hal-i2c.c:176</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a9f980d89641c71517c62c090ad0d202c"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a9f980d89641c71517c62c090ad0d202c">I2C_SDA_IDX</a></div><div class="ttdeci">#define I2C_SDA_IDX(p)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00032">esp32-hal-i2c.c:31</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__ST__t_html_a400d33bc4389be046228f6efdb0b35be"><div class="ttname"><a href="unionI2C__FIFO__ST__t.html#a400d33bc4389be046228f6efdb0b35be">I2C_FIFO_ST_t::val</a></div><div class="ttdeci">uint32_t val</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00096">esp32-hal-i2c.c:96</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a30b3f51f7ecc88b81838c3d97b2c1ef3"><div class="ttname"><a href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a30b3f51f7ecc88b81838c3d97b2c1ef3">I2C_CMD_READ</a></div><div class="ttdeci">@ I2C_CMD_READ</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00195">esp32-hal-i2c.c:195</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a60e35fd5bf77573b8d0ab8d8ae741e34"><div class="ttname"><a href="structi2c__dev__t.html#a60e35fd5bf77573b8d0ab8d8ae741e34">i2c_dev_t::timeout</a></div><div class="ttdeci">union i2c_dev_t::@405 timeout</div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_a68e930ea3b13e9725cb0629458fa9319"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#a68e930ea3b13e9725cb0629458fa9319">I2C_FIFO_CONF_t::nonfifo_tx_thres</a></div><div class="ttdeci">uint32_t nonfifo_tx_thres</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00082">esp32-hal-i2c.c:82</a></div></div>
<div class="ttc" id="aesp32-hal-matrix_8c_html_a4911e993064543ddd612bc48c7bbe3f8"><div class="ttname"><a href="esp32-hal-matrix_8c.html#a4911e993064543ddd612bc48c7bbe3f8">pinMatrixOutAttach</a></div><div class="ttdeci">void IRAM_ATTR pinMatrixOutAttach(uint8_t pin, uint8_t function, bool invertOut, bool invertEnable)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-matrix_8c_source.html#l00023">esp32-hal-matrix.c:23</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8c_html_a6732634a108a709990b0a9ea9c573ca5"><div class="ttname"><a href="esp32-hal-gpio_8c.html#a6732634a108a709990b0a9ea9c573ca5">pinMode</a></div><div class="ttdeci">void pinMode(uint8_t pin, uint8_t mode) __attribute__((weak</div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_ae725a2314a49f5273a1c7f957b0fe8e6"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#ae725a2314a49f5273a1c7f957b0fe8e6">I2C_FIFO_CONF_t::rx_fifo_full_thrhd</a></div><div class="ttdeci">uint32_t rx_fifo_full_thrhd</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00073">esp32-hal-i2c.c:73</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_a3dbb707d1ba9233784a82c004ca41841"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#a3dbb707d1ba9233784a82c004ca41841">I2C_FIFO_CONF_t::nonfifo_en</a></div><div class="ttdeci">uint32_t nonfifo_en</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00075">esp32-hal-i2c.c:75</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83a845fdb6c4d2815606f3c1755bb0e3aac"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a845fdb6c4d2815606f3c1755bb0e3aac">I2C_ERROR_BUSY</a></div><div class="ttdeci">@ I2C_ERROR_BUSY</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00035">esp32-hal-i2c.h:35</a></div></div>
<div class="ttc" id="aesp__intr__alloc_8h_html_ab8535ce94aafbeaefed76f5dfa6cfc94"><div class="ttname"><a href="esp__intr__alloc_8h.html#ab8535ce94aafbeaefed76f5dfa6cfc94">esp_intr_alloc_intrstatus</a></div><div class="ttdeci">esp_err_t esp_intr_alloc_intrstatus(int source, int flags, uint32_t intrstatusreg, uint32_t intrstatusmask, intr_handler_t handler, void *arg, intr_handle_t *ret_handle)</div><div class="ttdoc">Allocate an interrupt with the given parameters.</div></div>
<div class="ttc" id="aesp__err_8h_html_abdbffa06442bc1fe3d65dbb8d17656d1"><div class="ttname"><a href="esp__err_8h.html#abdbffa06442bc1fe3d65dbb8d17656d1">ESP_OK</a></div><div class="ttdeci">#define ESP_OK</div><div class="ttdef"><b>Definition:</b> <a href="esp__err_8h_source.html#l00028">esp_err.h:27</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a1694d0cee228028a9de11753f289444e"><div class="ttname"><a href="structi2c__dev__t.html#a1694d0cee228028a9de11753f289444e">i2c_dev_t::bus_busy</a></div><div class="ttdeci">uint32_t bus_busy</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00052">i2c_struct.h:52</a></div></div>
<div class="ttc" id="aevent__groups_8h_html_a5119294106541c4eca46e8742fdb4e85"><div class="ttname"><a href="event__groups_8h.html#a5119294106541c4eca46e8742fdb4e85">EventGroupHandle_t</a></div><div class="ttdeci">void * EventGroupHandle_t</div><div class="ttdef"><b>Definition:</b> <a href="event__groups_8h_source.html#l00120">event_groups.h:120</a></div></div>
<div class="ttc" id="aprojdefs_8h_html_a07848d3078849bd32353c69d30a479b3"><div class="ttname"><a href="projdefs_8h.html#a07848d3078849bd32353c69d30a479b3">pdPASS</a></div><div class="ttdeci">#define pdPASS</div><div class="ttdef"><b>Definition:</b> <a href="projdefs_8h_source.html#l00086">projdefs.h:85</a></div></div>
<div class="ttc" id="anamespaceasio_html_a945a5c18fa77a9e2eba420f8f44b2a4f"><div class="ttname"><a href="namespaceasio.html#a945a5c18fa77a9e2eba420f8f44b2a4f">asio::b</a></div><div class="ttdeci">basic_streambuf&lt; Allocator &gt; &amp; b</div><div class="ttdef"><b>Definition:</b> <a href="impl_2read_8hpp_source.html#l00689">read.hpp:689</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8c_html_a53ec409c9e9b28b53af22d693fdeb134"><div class="ttname"><a href="esp32-hal-gpio_8c.html#a53ec409c9e9b28b53af22d693fdeb134">digitalWrite</a></div><div class="ttdeci">void digitalWrite(uint8_t pin, uint8_t val) __attribute__((weak</div></div>
<div class="ttc" id="astructi2c__dev__t_html"><div class="ttname"><a href="structi2c__dev__t.html">i2c_dev_t</a></div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00023">i2c_struct.h:23</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1"><div class="ttname"><a href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa07195cf050725bad8693dfc2749d3ed1">I2C_NONE</a></div><div class="ttdeci">@ I2C_NONE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00110">esp32-hal-i2c.c:110</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_aa839acb7b689c79ce9dfd27343d088a9"><div class="ttname"><a href="structi2c__dev__t.html#aa839acb7b689c79ce9dfd27343d088a9">i2c_dev_t::nonfifo_en</a></div><div class="ttdeci">uint32_t nonfifo_en</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00095">i2c_struct.h:95</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a4519c498410bb0d2052812c5faa35a30"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a4519c498410bb0d2052812c5faa35a30">EVENT_ERROR_ARBITRATION</a></div><div class="ttdeci">#define EVENT_ERROR_ARBITRATION</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00139">esp32-hal-i2c.c:138</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a0023da2dab9290b30b958f7bd1558b8d"><div class="ttname"><a href="i2c__reg_8h.html#a0023da2dab9290b30b958f7bd1558b8d">I2C_TRANS_COMPLETE_INT_ST_M</a></div><div class="ttdeci">#define I2C_TRANS_COMPLETE_INT_ST_M</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00560">i2c_reg.h:559</a></div></div>
<div class="ttc" id="adport__reg_8h_html_abb59ee0bc123a690e523f067615ecd26"><div class="ttname"><a href="dport__reg_8h.html#abb59ee0bc123a690e523f067615ecd26">DPORT_I2C_EXT1_RST</a></div><div class="ttdeci">#define DPORT_I2C_EXT1_RST</div><div class="ttdef"><b>Definition:</b> <a href="dport__reg_8h_source.html#l01000">dport_reg.h:999</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_afbfb00ea741d217c953b504dcb65cdb3aeceba296bdda2b90e8835c431fe7a72a"><div class="ttname"><a href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3aeceba296bdda2b90e8835c431fe7a72a">I2C_OK</a></div><div class="ttdeci">@ I2C_OK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00119">esp32-hal-i2c.c:119</a></div></div>
<div class="ttc" id="atools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h_html_a520d8cf032327581ece00e5bd8e03a75"><div class="ttname"><a href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h.html#a520d8cf032327581ece00e5bd8e03a75">xSemaphoreHandle</a></div><div class="ttdeci">#define xSemaphoreHandle</div><div class="ttdef"><b>Definition:</b> <a href="tools_2sdk_2include_2freertos_2freertos_2FreeRTOS_8h_source.html#l00822">FreeRTOS.h:821</a></div></div>
<div class="ttc" id="acJSON_8h_html_a788db922597cf2fb6389e278f822e59f"><div class="ttname"><a href="cJSON_8h.html#a788db922597cf2fb6389e278f822e59f">raw</a></div><div class="ttdeci">const char *const const char *const raw</div><div class="ttdef"><b>Definition:</b> <a href="cJSON_8h_source.html#l00264">cJSON.h:264</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8c_html_a0768039efa1af1371b2365dfa44167af"><div class="ttname"><a href="esp32-hal-gpio_8c.html#a0768039efa1af1371b2365dfa44167af">digitalRead</a></div><div class="ttdeci">int digitalRead(uint8_t pin) __attribute__((weak</div></div>
<div class="ttc" id="astructi2c__dev__t_html_ae78831cacb1c081ab41417c0721aadf8"><div class="ttname"><a href="structi2c__dev__t.html#ae78831cacb1c081ab41417c0721aadf8">i2c_dev_t::clk_en</a></div><div class="ttdeci">uint32_t clk_en</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00041">i2c_struct.h:41</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a7e6703ba9b50f8d8f119240b4e2cb2ae"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a7e6703ba9b50f8d8f119240b4e2cb2ae">i2cAttachSDA</a></div><div class="ttdeci">i2c_err_t i2cAttachSDA(i2c_t *i2c, int8_t sda)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01455">esp32-hal-i2c.c:1455</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a4100839fdd3ae102156a79f41ec36187ac00c1b7bda0b29f0b6ff7172bc5c4239"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187ac00c1b7bda0b29f0b6ff7172bc5c4239">I2C_STARTUP</a></div><div class="ttdeci">@ I2C_STARTUP</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00104">esp32-hal-i2c.c:104</a></div></div>
<div class="ttc" id="aSdInfo_8h_html_a88028b6a6993ea4c35717196f8e16a9e"><div class="ttname"><a href="SdInfo_8h.html#a88028b6a6993ea4c35717196f8e16a9e">reserved7</a></div><div class="ttdeci">unsigned char reserved7</div><div class="ttdef"><b>Definition:</b> <a href="SdInfo_8h_source.html#l00065">SdInfo.h:65</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_adc5a92d3c925aebd6263beb2d0168011"><div class="ttname"><a href="structi2c__dev__t.html#adc5a92d3c925aebd6263beb2d0168011">i2c_dev_t::slave_tran_comp</a></div><div class="ttdeci">uint32_t slave_tran_comp</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00118">i2c_struct.h:118</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8h_html_a030cbe7d208b1f9b7c85765ccc5b4fffa5337858216a3483bafd454613bf1ce6d"><div class="ttname"><a href="esp32-hal-cpu_8h.html#a030cbe7d208b1f9b7c85765ccc5b4fffa5337858216a3483bafd454613bf1ce6d">APB_BEFORE_CHANGE</a></div><div class="ttdeci">@ APB_BEFORE_CHANGE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-cpu_8h_source.html#l00026">esp32-hal-cpu.h:26</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_afbfb00ea741d217c953b504dcb65cdb3a1056d6a4b037e383132309c2898a2fc8"><div class="ttname"><a href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a1056d6a4b037e383132309c2898a2fc8">I2C_TIMEOUT</a></div><div class="ttdeci">@ I2C_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00125">esp32-hal-i2c.c:124</a></div></div>
<div class="ttc" id="abootloader-cfgcmd_8txt_html_adfc5ba7e22f5e4a6221c12a70503bef3"><div class="ttname"><a href="bootloader-cfgcmd_8txt.html#adfc5ba7e22f5e4a6221c12a70503bef3">cmd</a></div><div class="ttdeci">cmd</div><div class="ttdef"><b>Definition:</b> <a href="bootloader-cfgcmd_8txt_source.html#l00001">bootloader-cfgcmd.txt:1</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_adf764cbdea00d65edcd07bb9953ad2b7ae966547086e83500d1873692d12db5ba"><div class="ttname"><a href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7ae966547086e83500d1873692d12db5ba">I2C_CMD_RSTART</a></div><div class="ttdeci">@ I2C_CMD_RSTART</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00193">esp32-hal-i2c.c:193</a></div></div>
<div class="ttc" id="aevent__groups_8h_html_aab9d5b405bc57b7624dcabe9a9a503db"><div class="ttname"><a href="event__groups_8h.html#aab9d5b405bc57b7624dcabe9a9a503db">xEventGroupWaitBits</a></div><div class="ttdeci">EventBits_t xEventGroupWaitBits(EventGroupHandle_t xEventGroup, const EventBits_t uxBitsToWaitFor, const BaseType_t xClearOnExit, const BaseType_t xWaitForAllBits, TickType_t xTicksToWait) PRIVILEGED_FUNCTION</div></div>
<div class="ttc" id="astructi2c__dev__t_html_a6875850c3caab3615fc5b7027985fa13"><div class="ttname"><a href="structi2c__dev__t.html#a6875850c3caab3615fc5b7027985fa13">i2c_dev_t::scl_low_period</a></div><div class="ttdeci">union i2c_dev_t::@402 scl_low_period</div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a76839c845b68b6104dd8f77b5c08d478"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a76839c845b68b6104dd8f77b5c08d478">i2cGetFrequency</a></div><div class="ttdeci">uint32_t i2cGetFrequency(i2c_t *i2c)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01729">esp32-hal-i2c.c:1729</a></div></div>
<div class="ttc" id="astructI2C__DATA__QUEUE__t_html_a995a2dd4e757cb746c8464578fe80b4d"><div class="ttname"><a href="structI2C__DATA__QUEUE__t.html#a995a2dd4e757cb746c8464578fe80b4d">I2C_DATA_QUEUE_t::length</a></div><div class="ttdeci">uint16_t length</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00162">esp32-hal-i2c.c:162</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a66e438dcb5bc99cc0219c14a4d17f495"><div class="ttname"><a href="structi2c__dev__t.html#a66e438dcb5bc99cc0219c14a4d17f495">i2c_dev_t::period</a></div><div class="ttdeci">uint32_t period</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00026">i2c_struct.h:26</a></div></div>
<div class="ttc" id="aprojdefs_8h_html_aa56260e937e7e203026707e5ba944273"><div class="ttname"><a href="projdefs_8h.html#aa56260e937e7e203026707e5ba944273">pdFALSE</a></div><div class="ttdeci">#define pdFALSE</div><div class="ttdef"><b>Definition:</b> <a href="projdefs_8h_source.html#l00083">projdefs.h:82</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8h_html_a61a3c9a18380aafb6e430e79bf596557"><div class="ttname"><a href="esp32-hal-gpio_8h.html#a61a3c9a18380aafb6e430e79bf596557">OUTPUT</a></div><div class="ttdeci">#define OUTPUT</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-gpio_8h_source.html#l00035">esp32-hal-gpio.h:34</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a9376aed1178614a3aa2089fd45828ba9"><div class="ttname"><a href="structi2c__struct__t.html#a9376aed1178614a3aa2089fd45828ba9">i2c_struct_t::queuePos</a></div><div class="ttdeci">uint16_t queuePos</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00185">esp32-hal-i2c.c:185</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a1913ffb49d97ecbb92cde75222866462"><div class="ttname"><a href="structi2c__struct__t.html#a1913ffb49d97ecbb92cde75222866462">i2c_struct_t::intr_handle</a></div><div class="ttdeci">intr_handle_t intr_handle</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00182">esp32-hal-i2c.c:182</a></div></div>
<div class="ttc" id="aesp32-hal_8h_html"><div class="ttname"><a href="esp32-hal_8h.html">esp32-hal.h</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_ac4a9ae18d9bc02ba7489036f91caf814"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#ac4a9ae18d9bc02ba7489036f91caf814">I2C_FIFO_CONF_t::nonfifo_rx_thres</a></div><div class="ttdeci">uint32_t nonfifo_rx_thres</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00081">esp32-hal-i2c.c:81</a></div></div>
<div class="ttc" id="agroup__Intr__Alloc_html_gafc7bfcea2e621d81336ea6dd23310363"><div class="ttname"><a href="group__Intr__Alloc.html#gafc7bfcea2e621d81336ea6dd23310363">ESP_INTR_FLAG_SHARED</a></div><div class="ttdeci">#define ESP_INTR_FLAG_SHARED</div><div class="ttdoc">Interrupt can be shared between ISRs.</div><div class="ttdef"><b>Definition:</b> <a href="esp__intr__alloc_8h_source.html#l00048">esp_intr_alloc.h:47</a></div></div>
<div class="ttc" id="anamespaceimageconverter_html_a43b15cf6044906a354902441c7f02f5c"><div class="ttname"><a href="namespaceimageconverter.html#a43b15cf6044906a354902441c7f02f5c">imageconverter.default</a></div><div class="ttdeci">default</div><div class="ttdef"><b>Definition:</b> <a href="imageconverter_8py_source.html#l00007">imageconverter.py:7</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8c_html_a2d2f074cfffbd2063aa0c10f1d73a51e"><div class="ttname"><a href="esp32-hal-cpu_8c.html#a2d2f074cfffbd2063aa0c10f1d73a51e">getCpuFrequencyMhz</a></div><div class="ttdeci">uint32_t getCpuFrequencyMhz()</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-cpu_8c_source.html#l00216">esp32-hal-cpu.c:216</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a18a17a12fec3313dae2ed463e5f70680"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a18a17a12fec3313dae2ed463e5f70680">I2C_SCL_IDX</a></div><div class="ttdeci">#define I2C_SCL_IDX(p)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00031">esp32-hal-i2c.c:30</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a2050f38e68846046646743bce6f488b7"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a2050f38e68846046646743bce6f488b7">i2cInit</a></div><div class="ttdeci">i2c_t * i2cInit(uint8_t i2c_num, int8_t sda, int8_t scl, uint32_t frequency)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01482">esp32-hal-i2c.c:1482</a></div></div>
<div class="ttc" id="azconf_8lex_8c_html_acb559820d9ca11295b4500f179ef6392"><div class="ttname"><a href="zconf_8lex_8c.html#acb559820d9ca11295b4500f179ef6392">i</a></div><div class="ttdeci">int i</div><div class="ttdef"><b>Definition:</b> <a href="zconf_8lex_8c_source.html#l01348">zconf.lex.c:1348</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_aa1293a7cc273d50371a46fc1363d0e20"><div class="ttname"><a href="structi2c__dev__t.html#aa1293a7cc273d50371a46fc1363d0e20">i2c_dev_t::int_raw</a></div><div class="ttdeci">union i2c_dev_t::@410 int_raw</div></div>
<div class="ttc" id="astructi2c__struct__t_html_aca9f378e0051c0f049ca7ddd60ad4cbd"><div class="ttname"><a href="structi2c__struct__t.html#aca9f378e0051c0f049ca7ddd60ad4cbd">i2c_struct_t::exitCode</a></div><div class="ttdeci">uint32_t exitCode</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00188">esp32-hal-i2c.c:188</a></div></div>
<div class="ttc" id="adef_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="def_8h_source.html#l00071">def.h:70</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_aa05cfd4f2e3acf66c733aacae7d00104"><div class="ttname"><a href="unionI2C__COMMAND__t.html#aa05cfd4f2e3acf66c733aacae7d00104">I2C_COMMAND_t::reserved14</a></div><div class="ttdeci">uint32_t reserved14</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00065">esp32-hal-i2c.c:65</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83a7a8a638a6deda6c6943409e9e4cae099"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a7a8a638a6deda6c6943409e9e4cae099">I2C_ERROR_TIMEOUT</a></div><div class="ttdeci">@ I2C_ERROR_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00033">esp32-hal-i2c.h:33</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_af042bc4a4fd25792ccff95207fa184e4"><div class="ttname"><a href="unionI2C__COMMAND__t.html#af042bc4a4fd25792ccff95207fa184e4">I2C_COMMAND_t::byte_num</a></div><div class="ttdeci">uint32_t byte_num</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00060">esp32-hal-i2c.c:60</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8h_html_a030cbe7d208b1f9b7c85765ccc5b4fffa2d5ad22a8033570065a302bfba76bc49"><div class="ttname"><a href="esp32-hal-cpu_8h.html#a030cbe7d208b1f9b7c85765ccc5b4fffa2d5ad22a8033570065a302bfba76bc49">APB_AFTER_CHANGE</a></div><div class="ttdeci">@ APB_AFTER_CHANGE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-cpu_8h_source.html#l00026">esp32-hal-cpu.h:26</a></div></div>
<div class="ttc" id="aesp__attr_8h_html"><div class="ttname"><a href="esp__attr_8h.html">esp_attr.h</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a5ee537b5bbcbcea4afc765376a96cd35"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a5ee537b5bbcbcea4afc765376a96cd35">I2C_DATA_CTRL_t::mode</a></div><div class="ttdeci">uint32_t mode</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00146">esp32-hal-i2c.c:146</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8h_html_a1bb283bd7893b9855e2f23013891fc82"><div class="ttname"><a href="esp32-hal-gpio_8h.html#a1bb283bd7893b9855e2f23013891fc82">INPUT</a></div><div class="ttdeci">#define INPUT</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-gpio_8h_source.html#l00034">esp32-hal-gpio.h:33</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a4b20ffd4cf1946602c6fdca18f2f6b93"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a4b20ffd4cf1946602c6fdca18f2f6b93">EVENT_ERROR_TIMEOUT</a></div><div class="ttdeci">#define EVENT_ERROR_TIMEOUT</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00138">esp32-hal-i2c.c:137</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_ac83d5e7a21cc3802dfee5f3ca3675132"><div class="ttname"><a href="structi2c__dev__t.html#ac83d5e7a21cc3802dfee5f3ca3675132">i2c_dev_t::scl_stop_setup</a></div><div class="ttdeci">union i2c_dev_t::@420 scl_stop_setup</div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a3f3963d6b40b87bce9e4df022135748d"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a3f3963d6b40b87bce9e4df022135748d">I2C_DATA_CTRL_t::reserved_31</a></div><div class="ttdeci">uint32_t reserved_31</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00154">esp32-hal-i2c.c:154</a></div></div>
<div class="ttc" id="anamespaceudp__server_html_a5012db13ff4b8ca2bf4f7cd6ce97ddfc"><div class="ttname"><a href="namespaceudp__server.html#a5012db13ff4b8ca2bf4f7cd6ce97ddfc">udp_server.d</a></div><div class="ttdeci">d</div><div class="ttdef"><b>Definition:</b> <a href="udp__server_8py_source.html#l00022">udp_server.py:22</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a5c49ce1d54cb39f209e1226c4c113f3a"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a5c49ce1d54cb39f209e1226c4c113f3a">i2cDetachSDA</a></div><div class="ttdeci">i2c_err_t i2cDetachSDA(i2c_t *i2c, int8_t sda)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01467">esp32-hal-i2c.c:1467</a></div></div>
<div class="ttc" id="aunity__fixture__malloc__overrides_8h_html_acf143577800376dd931c059ecc61ba06"><div class="ttname"><a href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a></div><div class="ttdeci">#define malloc</div><div class="ttdef"><b>Definition:</b> <a href="unity__fixture__malloc__overrides_8h_source.html#l00038">unity_fixture_malloc_overrides.h:37</a></div></div>
<div class="ttc" id="aportmacro_8h_html_a1ebe82d24d764ae4e352f7c3a9f92c01"><div class="ttname"><a href="portmacro_8h.html#a1ebe82d24d764ae4e352f7c3a9f92c01">portBASE_TYPE</a></div><div class="ttdeci">#define portBASE_TYPE</div><div class="ttdef"><b>Definition:</b> <a href="portmacro_8h_source.html#l00109">portmacro.h:108</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a6faf139d6d56420a0ecfe82b874730d9"><div class="ttname"><a href="structi2c__dev__t.html#a6faf139d6d56420a0ecfe82b874730d9">i2c_dev_t::op_code</a></div><div class="ttdeci">uint32_t op_code</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00260">i2c_struct.h:260</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a89c28654ad7d9c55847e3ac544d61929"><div class="ttname"><a href="structi2c__dev__t.html#a89c28654ad7d9c55847e3ac544d61929">i2c_dev_t::fifo_conf</a></div><div class="ttdeci">union i2c_dev_t::@408 fifo_conf</div></div>
<div class="ttc" id="ai2c__reg_8h_html_a888266c919400c4a6961473fcac5648a"><div class="ttname"><a href="i2c__reg_8h.html#a888266c919400c4a6961473fcac5648a">I2C_ARBITRATION_LOST_INT_ST_M</a></div><div class="ttdeci">#define I2C_ARBITRATION_LOST_INT_ST_M</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00572">i2c_reg.h:571</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a5b4ef6852cf5a778800d8b9dda16b613"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a5b4ef6852cf5a778800d8b9dda16b613">i2cAddQueueRead</a></div><div class="ttdeci">i2c_err_t i2cAddQueueRead(i2c_t *i2c, uint16_t i2cDeviceAddr, uint8_t *dataPtr, uint16_t dataLen, bool sendStop, EventGroupHandle_t event)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01084">esp32-hal-i2c.c:1084</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a464cdec653f66f9ba7b8bf10ec14b35b"><div class="ttname"><a href="structi2c__dev__t.html#a464cdec653f66f9ba7b8bf10ec14b35b">i2c_dev_t::tout</a></div><div class="ttdeci">uint32_t tout</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00068">i2c_struct.h:68</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a3140366faff678ff124a9150eb0daf7f"><div class="ttname"><a href="structi2c__dev__t.html#a3140366faff678ff124a9150eb0daf7f">i2c_dev_t::sda_hold</a></div><div class="ttdeci">union i2c_dev_t::@414 sda_hold</div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_ab270d52c26de7f5ce13ec1538b0b94fd"><div class="ttname"><a href="esp32-hal-i2c_8c.html#ab270d52c26de7f5ce13ec1538b0b94fd">i2cFlush</a></div><div class="ttdeci">i2c_err_t i2cFlush(i2c_t *i2c)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01591">esp32-hal-i2c.c:1591</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a8f7e3266a6af57a9c2a96c17c2d9343c"><div class="ttname"><a href="i2c__reg_8h.html#a8f7e3266a6af57a9c2a96c17c2d9343c">I2C_RXFIFO_OVF_INT_ENA</a></div><div class="ttdeci">#define I2C_RXFIFO_OVF_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00509">i2c_reg.h:508</a></div></div>
<div class="ttc" id="astructI2C__DATA__QUEUE__t_html_a1b2a301d33d4cc2d3719fa2d87f8852a"><div class="ttname"><a href="structI2C__DATA__QUEUE__t.html#a1b2a301d33d4cc2d3719fa2d87f8852a">I2C_DATA_QUEUE_t::ctrl</a></div><div class="ttdeci">I2C_DATA_CTRL_t ctrl</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00165">esp32-hal-i2c.c:165</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a2400684bfa76cfd04b2f53a246140adc"><div class="ttname"><a href="structi2c__dev__t.html#a2400684bfa76cfd04b2f53a246140adc">i2c_dev_t::val</a></div><div class="ttdeci">uint32_t val</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00029">i2c_struct.h:29</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html"><div class="ttname"><a href="unionI2C__COMMAND__t.html">I2C_COMMAND_t</a></div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00058">esp32-hal-i2c.c:58</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a0285897a5bcf3a47c6302f3dc9da64c9"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a0285897a5bcf3a47c6302f3dc9da64c9">i2cProcQueue</a></div><div class="ttdeci">i2c_err_t i2cProcQueue(i2c_t *i2c, uint32_t *readCount, uint16_t timeOutMillis)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01105">esp32-hal-i2c.c:1105</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a85db11d885efe3d382f532030328e226"><div class="ttname"><a href="structi2c__struct__t.html#a85db11d885efe3d382f532030328e226">i2c_struct_t::errorByteCnt</a></div><div class="ttdeci">int16_t errorByteCnt</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00186">esp32-hal-i2c.c:186</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a97c6a1779796a64b9a58cb08516186a9"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a97c6a1779796a64b9a58cb08516186a9">I2C_DATA_CTRL_t::stopCmdSent</a></div><div class="ttdeci">uint32_t stopCmdSent</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00151">esp32-hal-i2c.c:151</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a97031e14170d179056665524f3100c7e"><div class="ttname"><a href="structi2c__dev__t.html#a97031e14170d179056665524f3100c7e">i2c_dev_t::status_reg</a></div><div class="ttdeci">union i2c_dev_t::@404 status_reg</div></div>
<div class="ttc" id="astdint_8h_html_a3542c6a0490e65fc4fc407273126e64f"><div class="ttname"><a href="stdint_8h.html#a3542c6a0490e65fc4fc407273126e64f">int16_t</a></div><div class="ttdeci">__int16_t int16_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00032">stdint.h:32</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__ST__t_html_a1c7cdd83c4e07b943c6d6b0b4de96754"><div class="ttname"><a href="unionI2C__FIFO__ST__t.html#a1c7cdd83c4e07b943c6d6b0b4de96754">I2C_FIFO_ST_t::tx_fifo_end_addr</a></div><div class="ttdeci">uint32_t tx_fifo_end_addr</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00093">esp32-hal-i2c.c:93</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__ST__t_html_aa11846ed25c423ace94e910d39353c23"><div class="ttname"><a href="unionI2C__FIFO__ST__t.html#aa11846ed25c423ace94e910d39353c23">I2C_FIFO_ST_t::rx_fifo_start_addr</a></div><div class="ttdeci">uint32_t rx_fifo_start_addr</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00090">esp32-hal-i2c.c:90</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a730540e6ee43d14d9cd60b7db10a87a3"><div class="ttname"><a href="i2c__reg_8h.html#a730540e6ee43d14d9cd60b7db10a87a3">I2C_SLAVE_TRAN_COMP_INT_ENA</a></div><div class="ttdeci">#define I2C_SLAVE_TRAN_COMP_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00497">i2c_reg.h:496</a></div></div>
<div class="ttc" id="aportmacro_8h_html_a554d9322ce7f698a86a22b21234bd8cd"><div class="ttname"><a href="portmacro_8h.html#a554d9322ce7f698a86a22b21234bd8cd">portTICK_PERIOD_MS</a></div><div class="ttdeci">#define portTICK_PERIOD_MS</div><div class="ttdef"><b>Definition:</b> <a href="portmacro_8h_source.html#l00367">portmacro.h:366</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a0223736866298198d98aebadd9ca47b3"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a0223736866298198d98aebadd9ca47b3">i2cSetFrequency</a></div><div class="ttdeci">i2c_err_t i2cSetFrequency(i2c_t *i2c, uint32_t clk_speed)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01659">esp32-hal-i2c.c:1659</a></div></div>
<div class="ttc" id="adport__reg_8h_html_ae6228dab1982f1264b0ae5f88e8464e7"><div class="ttname"><a href="dport__reg_8h.html#ae6228dab1982f1264b0ae5f88e8464e7">DPORT_I2C_EXT1_CLK_EN</a></div><div class="ttdeci">#define DPORT_I2C_EXT1_CLK_EN</div><div class="ttdef"><b>Definition:</b> <a href="dport__reg_8h_source.html#l00963">dport_reg.h:962</a></div></div>
<div class="ttc" id="atag__strings_8h_html_ade5a18d52133ef21f211020ceb464c07"><div class="ttname"><a href="tag__strings_8h.html#ade5a18d52133ef21f211020ceb464c07">address</a></div><div class="ttdeci">address</div><div class="ttdef"><b>Definition:</b> <a href="tag__strings_8h_source.html#l00028">tag_strings.h:28</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_a82257ca3e64acf5d151e320b089b002b"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#a82257ca3e64acf5d151e320b089b002b">I2C_FIFO_CONF_t::val</a></div><div class="ttdeci">uint32_t val</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00085">esp32-hal-i2c.c:85</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8c_html_a52637cdc19ab4d49d5f63cc63e6bc832"><div class="ttname"><a href="esp32-hal-cpu_8c.html#a52637cdc19ab4d49d5f63cc63e6bc832">getApbFrequency</a></div><div class="ttdeci">uint32_t getApbFrequency()</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-cpu_8c_source.html#l00226">esp32-hal-cpu.c:226</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a2933fdd203d61a8bbadde6013da3fd00"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a2933fdd203d61a8bbadde6013da3fd00">i2cAttachSCL</a></div><div class="ttdeci">i2c_err_t i2cAttachSCL(i2c_t *i2c, int8_t scl)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01432">esp32-hal-i2c.c:1432</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_af8605f8e6097beb13aab5fd0c020e414"><div class="ttname"><a href="structi2c__struct__t.html#af8605f8e6097beb13aab5fd0c020e414">i2c_struct_t::num</a></div><div class="ttdeci">uint8_t num</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00174">esp32-hal-i2c.c:174</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a59aa59915fabb1e3cdeb9e84d0d3c3f9"><div class="ttname"><a href="structi2c__dev__t.html#a59aa59915fabb1e3cdeb9e84d0d3c3f9">i2c_dev_t::trans_complete</a></div><div class="ttdeci">uint32_t trans_complete</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00121">i2c_struct.h:121</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_aa25f4fafaa9bd8c03bf4f1040664dd2f"><div class="ttname"><a href="structi2c__dev__t.html#aa25f4fafaa9bd8c03bf4f1040664dd2f">i2c_dev_t::scl_high_period</a></div><div class="ttdeci">union i2c_dev_t::@416 scl_high_period</div></div>
<div class="ttc" id="astructI2C__DATA__QUEUE__t_html_a178da8e8b811e1605fb60625b2ea108d"><div class="ttname"><a href="structI2C__DATA__QUEUE__t.html#a178da8e8b811e1605fb60625b2ea108d">I2C_DATA_QUEUE_t::position</a></div><div class="ttdeci">uint16_t position</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00163">esp32-hal-i2c.c:163</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a386cca3372545d35239c7c9deeb704f3"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a386cca3372545d35239c7c9deeb704f3">EVENT_ERROR</a></div><div class="ttdeci">#define EVENT_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00132">esp32-hal-i2c.c:131</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a22b7fbf8ccfe29971f573cb28f6787dd"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a22b7fbf8ccfe29971f573cb28f6787dd">MIN_I2C_CLKS</a></div><div class="ttdeci">#define MIN_I2C_CLKS</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01658">esp32-hal-i2c.c:1657</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_af3691dd07d3d90e44b5968f26857ca00"><div class="ttname"><a href="esp32-hal-i2c_8c.html#af3691dd07d3d90e44b5968f26857ca00">EVENT_ERROR_DATA_NAK</a></div><div class="ttdeci">#define EVENT_ERROR_DATA_NAK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00140">esp32-hal-i2c.c:139</a></div></div>
<div class="ttc" id="aets__sys_8h_html"><div class="ttname"><a href="ets__sys_8h.html">ets_sys.h</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a39d7190db2ae442c3db2ee3dd04acc38"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a39d7190db2ae442c3db2ee3dd04acc38">I2C_DATA_CTRL_t::stop</a></div><div class="ttdeci">uint32_t stop</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00147">esp32-hal-i2c.c:147</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8h_html"><div class="ttname"><a href="esp32-hal-cpu_8h.html">esp32-hal-cpu.h</a></div></div>
<div class="ttc" id="agroup__Intr__Alloc_html_ga3fb8d6fa8b5e33b3503e86917bc8367b"><div class="ttname"><a href="group__Intr__Alloc.html#ga3fb8d6fa8b5e33b3503e86917bc8367b">ESP_INTR_FLAG_IRAM</a></div><div class="ttdeci">#define ESP_INTR_FLAG_IRAM</div><div class="ttdoc">ISR can be called if cache is disabled.</div><div class="ttdef"><b>Definition:</b> <a href="esp__intr__alloc_8h_source.html#l00050">esp_intr_alloc.h:49</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_aa9c300c2f5b7d7a1a82b1995ad442ceb"><div class="ttname"><a href="structi2c__dev__t.html#aa9c300c2f5b7d7a1a82b1995ad442ceb">i2c_dev_t::slave_addr</a></div><div class="ttdeci">union i2c_dev_t::@406 slave_addr</div></div>
<div class="ttc" id="astdint_8h_html_a0238af00180b6d9278fa1c6aa790fdf4"><div class="ttname"><a href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a></div><div class="ttdeci">__uint32_t uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00045">stdint.h:45</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a2362625ecf1798724a92bccd8a417898"><div class="ttname"><a href="structi2c__dev__t.html#a2362625ecf1798724a92bccd8a417898">i2c_dev_t::tx_fifo_cnt</a></div><div class="ttdeci">uint32_t tx_fifo_cnt</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00058">i2c_struct.h:58</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83afe56692036d33b6bed4851e3a97795ab"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83afe56692036d33b6bed4851e3a97795ab">I2C_ERROR_MEMORY</a></div><div class="ttdeci">@ I2C_ERROR_MEMORY</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00036">esp32-hal-i2c.h:36</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_ade74ecedca580ff9e930b64666d880e5"><div class="ttname"><a href="structi2c__dev__t.html#ade74ecedca580ff9e930b64666d880e5">i2c_dev_t::rx_fifo_cnt</a></div><div class="ttdeci">uint32_t rx_fifo_cnt</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00056">i2c_struct.h:56</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a9554ab32654736a43a1527a1aab100c2"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a9554ab32654736a43a1527a1aab100c2">EVENT_ERROR_BUS_BUSY</a></div><div class="ttdeci">#define EVENT_ERROR_BUS_BUSY</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00133">esp32-hal-i2c.c:132</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_afbfb00ea741d217c953b504dcb65cdb3a9e1aeef18f20ebbd58caa3082ded5ef6"><div class="ttname"><a href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3a9e1aeef18f20ebbd58caa3082ded5ef6">I2C_ARBITRATION</a></div><div class="ttdeci">@ I2C_ARBITRATION</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00123">esp32-hal-i2c.c:123</a></div></div>
<div class="ttc" id="anamespaceasio_html_a8dcdb41a4adfd6fe5322b5dd666d9f29"><div class="ttname"><a href="namespaceasio.html#a8dcdb41a4adfd6fe5322b5dd666d9f29">asio::offset</a></div><div class="ttdeci">uint64_t offset</div><div class="ttdef"><b>Definition:</b> <a href="impl_2read__at_8hpp_source.html#l00367">read_at.hpp:367</a></div></div>
<div class="ttc" id="astructI2C__DATA__QUEUE__t_html"><div class="ttname"><a href="structI2C__DATA__QUEUE__t.html">I2C_DATA_QUEUE_t</a></div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00160">esp32-hal-i2c.c:160</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_acb4bfdc8a42e74fbe011c0bee4aff231"><div class="ttname"><a href="structi2c__dev__t.html#acb4bfdc8a42e74fbe011c0bee4aff231">i2c_dev_t::int_ena</a></div><div class="ttdeci">union i2c_dev_t::@412 int_ena</div></div>
<div class="ttc" id="aunionI2C__FIFO__ST__t_html"><div class="ttname"><a href="unionI2C__FIFO__ST__t.html">I2C_FIFO_ST_t</a></div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00088">esp32-hal-i2c.c:88</a></div></div>
<div class="ttc" id="aesp32-hal-cpu_8c_html_ae85f8f9000f48e8e31f28a6088c27879"><div class="ttname"><a href="esp32-hal-cpu_8c.html#ae85f8f9000f48e8e31f28a6088c27879">removeApbChangeCallback</a></div><div class="ttdeci">bool removeApbChangeCallback(void *arg, apb_change_cb_t cb)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-cpu_8c_source.html#l00108">esp32-hal-cpu.c:108</a></div></div>
<div class="ttc" id="aevent__groups_8h_html_a02d7b3bb55f7e11d9c47116266c5fb2e"><div class="ttname"><a href="event__groups_8h.html#a02d7b3bb55f7e11d9c47116266c5fb2e">xEventGroupSetBits</a></div><div class="ttdeci">EventBits_t xEventGroupSetBits(EventGroupHandle_t xEventGroup, const EventBits_t uxBitsToSet) PRIVILEGED_FUNCTION</div></div>
<div class="ttc" id="atask_8h_html_a092be3fd5752625303c307620be523ff"><div class="ttname"><a href="task_8h.html#a092be3fd5752625303c307620be523ff">xTaskGetTickCountFromISR</a></div><div class="ttdeci">TickType_t xTaskGetTickCountFromISR(void) PRIVILEGED_FUNCTION</div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_ade7e0553ee987a9446cd674ec38c341f"><div class="ttname"><a href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341f">I2C_MODE_t</a></div><div class="ttdeci">I2C_MODE_t</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00109">esp32-hal-i2c.c:109</a></div></div>
<div class="ttc" id="adport__reg_8h_html_a49880909661c594efee90557f9d01f2d"><div class="ttname"><a href="dport__reg_8h.html#a49880909661c594efee90557f9d01f2d">DPORT_PERIP_CLK_EN_REG</a></div><div class="ttdeci">#define DPORT_PERIP_CLK_EN_REG</div><div class="ttdef"><b>Definition:</b> <a href="dport__reg_8h_source.html#l00947">dport_reg.h:946</a></div></div>
<div class="ttc" id="aevent__groups_8h_html_a0ae86f092fb07ccb475ae938f9a12584"><div class="ttname"><a href="event__groups_8h.html#a0ae86f092fb07ccb475ae938f9a12584">xEventGroupGetBits</a></div><div class="ttdeci">#define xEventGroupGetBits(xEventGroup)</div><div class="ttdef"><b>Definition:</b> <a href="event__groups_8h_source.html#l00686">event_groups.h:685</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83a3ba8243b59b2c4f46ff083cbe7c8f0ad"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a3ba8243b59b2c4f46ff083cbe7c8f0ad">I2C_ERROR_CONTINUE</a></div><div class="ttdeci">@ I2C_ERROR_CONTINUE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00037">esp32-hal-i2c.h:37</a></div></div>
<div class="ttc" id="aesp32-hal-matrix_8c_html_a405c3b937758dd44931c5452f4397ff1"><div class="ttname"><a href="esp32-hal-matrix_8c.html#a405c3b937758dd44931c5452f4397ff1">pinMatrixOutDetach</a></div><div class="ttdeci">void IRAM_ATTR pinMatrixOutDetach(uint8_t pin, bool invertOut, bool invertEnable)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-matrix_8c_source.html#l00028">esp32-hal-matrix.c:28</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a50043108723eacb497b8763d807fc355"><div class="ttname"><a href="i2c__reg_8h.html#a50043108723eacb497b8763d807fc355">I2C_TRANS_START_INT_ST_M</a></div><div class="ttdeci">#define I2C_TRANS_START_INT_ST_M</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00548">i2c_reg.h:547</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a73249ae7b0e5d931b975b84998875f6a"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a73249ae7b0e5d931b975b84998875f6a">EVENT_ERROR_NAK</a></div><div class="ttdeci">#define EVENT_ERROR_NAK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00131">esp32-hal-i2c.c:130</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8h_html_aa65f05495aa2b9e5d89a7e79886a596e"><div class="ttname"><a href="esp32-hal-gpio_8h.html#aa65f05495aa2b9e5d89a7e79886a596e">PULLUP</a></div><div class="ttdeci">#define PULLUP</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-gpio_8h_source.html#l00036">esp32-hal-gpio.h:35</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html"><div class="ttname"><a href="structi2c__struct__t.html">i2c_struct_t</a></div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00169">esp32-hal-i2c.c:169</a></div></div>
<div class="ttc" id="aprojdefs_8h_html_af268cf937960eb029256bd9c4d949fbe"><div class="ttname"><a href="projdefs_8h.html#af268cf937960eb029256bd9c4d949fbe">pdTRUE</a></div><div class="ttdeci">#define pdTRUE</div><div class="ttdef"><b>Definition:</b> <a href="projdefs_8h_source.html#l00084">projdefs.h:83</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a6583e0fe8187c302efcea1ae8448d885"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a6583e0fe8187c302efcea1ae8448d885">i2cRead</a></div><div class="ttdeci">i2c_err_t i2cRead(i2c_t *i2c, uint16_t address, uint8_t *buff, uint16_t size, bool sendStop, uint16_t timeOutMillis, uint32_t *readCount)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01635">esp32-hal-i2c.c:1635</a></div></div>
<div class="ttc" id="atask_8h_html_a753ecfe23e7386066ecccad5d16422f7"><div class="ttname"><a href="task_8h.html#a753ecfe23e7386066ecccad5d16422f7">xTaskGetTickCount</a></div><div class="ttdeci">TickType_t xTaskGetTickCount(void) PRIVILEGED_FUNCTION</div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_aeec9aef89194d9e4cd0ec68ab07fa205"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#aeec9aef89194d9e4cd0ec68ab07fa205">I2C_FIFO_CONF_t::fifo_addr_cfg_en</a></div><div class="ttdeci">uint32_t fifo_addr_cfg_en</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00076">esp32-hal-i2c.c:76</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_afbfb00ea741d217c953b504dcb65cdb3"><div class="ttname"><a href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3">I2C_ERROR_t</a></div><div class="ttdeci">I2C_ERROR_t</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00117">esp32-hal-i2c.c:117</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a75d996aba2f11ea95432b2187998e773"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a75d996aba2f11ea95432b2187998e773">I2C_DATA_CTRL_t::addrSent</a></div><div class="ttdeci">uint32_t addrSent</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00153">esp32-hal-i2c.c:153</a></div></div>
<div class="ttc" id="astructI2C__DATA__QUEUE__t_html_ac6803189d0f2668fa69f378c2ef6fcb4"><div class="ttname"><a href="structI2C__DATA__QUEUE__t.html#ac6803189d0f2668fa69f378c2ef6fcb4">I2C_DATA_QUEUE_t::queueEvent</a></div><div class="ttdeci">EventGroupHandle_t queueEvent</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00166">esp32-hal-i2c.c:166</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_afeddb86bea8da6f0c22e4cf4294f8b50"><div class="ttname"><a href="unionI2C__COMMAND__t.html#afeddb86bea8da6f0c22e4cf4294f8b50">I2C_COMMAND_t::done</a></div><div class="ttdeci">uint32_t done</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00066">esp32-hal-i2c.c:66</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_aa9ffe90a346383175e4193c7835d5a66"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#aa9ffe90a346383175e4193c7835d5a66">I2C_FIFO_CONF_t::reserved26</a></div><div class="ttdeci">uint32_t reserved26</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00083">esp32-hal-i2c.c:83</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a2b8f0b1e7cd584246ab629f1d3d80d0a"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a2b8f0b1e7cd584246ab629f1d3d80d0a">i2cAddQueueWrite</a></div><div class="ttdeci">i2c_err_t i2cAddQueueWrite(i2c_t *i2c, uint16_t i2cDeviceAddr, uint8_t *dataPtr, uint16_t dataLen, bool sendStop, EventGroupHandle_t event)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01079">esp32-hal-i2c.c:1079</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a1a0cbfd2b9fa1dbadad974fc7fdb019e"><div class="ttname"><a href="i2c__reg_8h.html#a1a0cbfd2b9fa1dbadad974fc7fdb019e">I2C_TXFIFO_EMPTY_INT_ENA</a></div><div class="ttdeci">#define I2C_TXFIFO_EMPTY_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00515">i2c_reg.h:514</a></div></div>
<div class="ttc" id="agroup__Intr__Alloc_html_ga9b0bc1a2b5cc22b499e041742ae1b17b"><div class="ttname"><a href="group__Intr__Alloc.html#ga9b0bc1a2b5cc22b499e041742ae1b17b">ESP_INTR_FLAG_LOWMED</a></div><div class="ttdeci">#define ESP_INTR_FLAG_LOWMED</div><div class="ttdoc">Low and medium prio interrupts. These can be handled in C.</div><div class="ttdef"><b>Definition:</b> <a href="esp__intr__alloc_8h_source.html#l00053">esp_intr_alloc.h:52</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a8067e27dbe842a0cd0cf12607766c70f"><div class="ttname"><a href="i2c__reg_8h.html#a8067e27dbe842a0cd0cf12607766c70f">I2C_SLAVE_TRAN_COMP_INT_ST_M</a></div><div class="ttdeci">#define I2C_SLAVE_TRAN_COMP_INT_ST_M</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00578">i2c_reg.h:577</a></div></div>
<div class="ttc" id="aesp__intr__alloc_8h_html_a72b74e3a15147c3ca43e77875f71e908"><div class="ttname"><a href="esp__intr__alloc_8h.html#a72b74e3a15147c3ca43e77875f71e908">esp_intr_free</a></div><div class="ttdeci">esp_err_t esp_intr_free(intr_handle_t handle)</div><div class="ttdoc">Disable and free an interrupt.</div></div>
<div class="ttc" id="astructi2c__dev__t_html_ab3ad529c882de397811576e35506ab48"><div class="ttname"><a href="structi2c__dev__t.html#ab3ad529c882de397811576e35506ab48">i2c_dev_t::trans_start</a></div><div class="ttdeci">uint32_t trans_start</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00038">i2c_struct.h:38</a></div></div>
<div class="ttc" id="astructI2C__DATA__QUEUE__t_html_a0b5b61c036fa68a9135eb6eb54e0659d"><div class="ttname"><a href="structI2C__DATA__QUEUE__t.html#a0b5b61c036fa68a9135eb6eb54e0659d">I2C_DATA_QUEUE_t::cmdBytesNeeded</a></div><div class="ttdeci">uint16_t cmdBytesNeeded</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00164">esp32-hal-i2c.c:164</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83">i2c_err_t</a></div><div class="ttdeci">i2c_err_t</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00029">esp32-hal-i2c.h:29</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83a6b7ba78b8ad1e491de04b31ab0ffbb8e"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a6b7ba78b8ad1e491de04b31ab0ffbb8e">I2C_ERROR_ACK</a></div><div class="ttdeci">@ I2C_ERROR_ACK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00032">esp32-hal-i2c.h:32</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_ac7f19e940414eb0358e8c778f26c0bc5"><div class="ttname"><a href="structi2c__dev__t.html#ac7f19e940414eb0358e8c778f26c0bc5">i2c_dev_t::time</a></div><div class="ttdeci">uint32_t time</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00190">i2c_struct.h:190</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_ade7e0553ee987a9446cd674ec38c341fa9c4888058a03d2c9cf7c84fe15dbd4f4"><div class="ttname"><a href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fa9c4888058a03d2c9cf7c84fe15dbd4f4">I2C_MASTERSLAVE</a></div><div class="ttdeci">@ I2C_MASTERSLAVE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00114">esp32-hal-i2c.c:113</a></div></div>
<div class="ttc" id="aperiph__ctrl_8h_html"><div class="ttname"><a href="periph__ctrl_8h.html">periph_ctrl.h</a></div></div>
<div class="ttc" id="aesp32-hal-log_8h_html_a71c957bc93270caaa91f41f6989c317b"><div class="ttname"><a href="esp32-hal-log_8h.html#a71c957bc93270caaa91f41f6989c317b">log_w</a></div><div class="ttdeci">#define log_w(format,...)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-log_8h_source.html#l00109">esp32-hal-log.h:108</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a4100839fdd3ae102156a79f41ec36187a68addd56c2d6a3c3c8c047966a77f77f"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a4100839fdd3ae102156a79f41ec36187a68addd56c2d6a3c3c8c047966a77f77f">I2C_RUNNING</a></div><div class="ttdeci">@ I2C_RUNNING</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00105">esp32-hal-i2c.c:105</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__ST__t_html_a489962ec376ed2b731ddce9211573038"><div class="ttname"><a href="unionI2C__FIFO__ST__t.html#a489962ec376ed2b731ddce9211573038">I2C_FIFO_ST_t::rx_fifo_end_addr</a></div><div class="ttdeci">uint32_t rx_fifo_end_addr</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00091">esp32-hal-i2c.c:91</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a01d3757a37489f27e7bc21b6d7b94e65"><div class="ttname"><a href="i2c__reg_8h.html#a01d3757a37489f27e7bc21b6d7b94e65">I2C_ACK_ERR_INT_ENA</a></div><div class="ttdeci">#define I2C_ACK_ERR_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00461">i2c_reg.h:460</a></div></div>
<div class="ttc" id="aunity__fixture__malloc__overrides_8h_html_a1b739878adcdb46fb5d209af7ce79628"><div class="ttname"><a href="unity__fixture__malloc__overrides_8h.html#a1b739878adcdb46fb5d209af7ce79628">realloc</a></div><div class="ttdeci">#define realloc</div><div class="ttdef"><b>Definition:</b> <a href="unity__fixture__malloc__overrides_8h_source.html#l00040">unity_fixture_malloc_overrides.h:39</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a0a090b1ed46ca4ffbedb63add98433ad"><div class="ttname"><a href="structi2c__struct__t.html#a0a090b1ed46ca4ffbedb63add98433ad">i2c_struct_t::lock</a></div><div class="ttdeci">xSemaphoreHandle lock</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00172">esp32-hal-i2c.c:172</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a35ae5cca5e065dbf057bbf4d6a134125"><div class="ttname"><a href="structi2c__struct__t.html#a35ae5cca5e065dbf057bbf4d6a134125">i2c_struct_t::errorQueue</a></div><div class="ttdeci">uint16_t errorQueue</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00187">esp32-hal-i2c.c:187</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a8d0946fe3292be63c7241dbd23a35068"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a8d0946fe3292be63c7241dbd23a35068">DR_REG_I2C_EXT_BASE_FIXED</a></div><div class="ttdeci">#define DR_REG_I2C_EXT_BASE_FIXED</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00034">esp32-hal-i2c.c:33</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html"><div class="ttname"><a href="esp32-hal-i2c_8h.html">esp32-hal-i2c.h</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a58bd3719f0a40ccf05995cb30655301a"><div class="ttname"><a href="i2c__reg_8h.html#a58bd3719f0a40ccf05995cb30655301a">I2C_TIME_OUT_INT_ST_M</a></div><div class="ttdeci">#define I2C_TIME_OUT_INT_ST_M</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00554">i2c_reg.h:553</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a0e90b59a14dce6407857b1e476de3667"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a0e90b59a14dce6407857b1e476de3667">i2cGetStatus</a></div><div class="ttdeci">uint32_t i2cGetStatus(i2c_t *i2c)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01754">esp32-hal-i2c.c:1754</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_afbfb00ea741d217c953b504dcb65cdb3adf30cba98e655e4327b882990103cd03"><div class="ttname"><a href="esp32-hal-i2c_8c.html#afbfb00ea741d217c953b504dcb65cdb3adf30cba98e655e4327b882990103cd03">I2C_ADDR_NAK</a></div><div class="ttdeci">@ I2C_ADDR_NAK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00121">esp32-hal-i2c.c:121</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a5719ed2103fef6d7d3cd2ea23be331ac"><div class="ttname"><a href="structi2c__dev__t.html#a5719ed2103fef6d7d3cd2ea23be331ac">i2c_dev_t::sda_force_out</a></div><div class="ttdeci">uint32_t sda_force_out</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00033">i2c_struct.h:33</a></div></div>
<div class="ttc" id="acJSON_8h_html_a03c83e0884e2e3a1783db79f2d67101f"><div class="ttname"><a href="cJSON_8h.html#a03c83e0884e2e3a1783db79f2d67101f">length</a></div><div class="ttdeci">char const int length</div><div class="ttdef"><b>Definition:</b> <a href="cJSON_8h_source.html#l00161">cJSON.h:161</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_a59c59c9daa06c3a823be23ccb93eaefb"><div class="ttname"><a href="unionI2C__COMMAND__t.html#a59c59c9daa06c3a823be23ccb93eaefb">I2C_COMMAND_t::ack_val</a></div><div class="ttdeci">uint32_t ack_val</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00063">esp32-hal-i2c.c:63</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a2886d56a52bad68e04e56f4361e9e92f"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a2886d56a52bad68e04e56f4361e9e92f">EVENT_MASK</a></div><div class="ttdeci">#define EVENT_MASK</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00141">esp32-hal-i2c.c:140</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_ab47a5a461b785c6be025c7e7ec770393"><div class="ttname"><a href="esp32-hal-i2c_8c.html#ab47a5a461b785c6be025c7e7ec770393">INTERRUPT_CYCLE_OVERHEAD</a></div><div class="ttdeci">#define INTERRUPT_CYCLE_OVERHEAD</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01659">esp32-hal-i2c.c:1658</a></div></div>
<div class="ttc" id="acacheasm_8h_html_a296a4dfa224096b538c66a9bab58cb9e"><div class="ttname"><a href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a></div><div class="ttdeci">macro cache_index_all size</div><div class="ttdef"><b>Definition:</b> <a href="cacheasm_8h_source.html#l00158">cacheasm.h:158</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html">I2C_DATA_CTRL_t</a></div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00143">esp32-hal-i2c.c:143</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8h_html_a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b"><div class="ttname"><a href="esp32-hal-i2c_8h.html#a880f2ffbefd0ac3c63f2d8aaaf732b83a8ccbd265500d8ce6e626e12f5fe37a1b">I2C_ERROR_DEV</a></div><div class="ttdeci">@ I2C_ERROR_DEV</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8h_source.html#l00031">esp32-hal-i2c.h:31</a></div></div>
<div class="ttc" id="adport__reg_8h_html_a7c08e72d7839c1015c7410518f7b20fe"><div class="ttname"><a href="dport__reg_8h.html#a7c08e72d7839c1015c7410518f7b20fe">DPORT_I2C_EXT0_CLK_EN</a></div><div class="ttdeci">#define DPORT_I2C_EXT0_CLK_EN</div><div class="ttdef"><b>Definition:</b> <a href="dport__reg_8h_source.html#l00975">dport_reg.h:974</a></div></div>
<div class="ttc" id="aunionI2C__COMMAND__t_html_a084e61d008dcc189b23a8b7f53b8f67a"><div class="ttname"><a href="unionI2C__COMMAND__t.html#a084e61d008dcc189b23a8b7f53b8f67a">I2C_COMMAND_t::val</a></div><div class="ttdeci">uint32_t val</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00068">esp32-hal-i2c.c:68</a></div></div>
<div class="ttc" id="aesp32-hal-log_8h_html_a202330fb3201c41b86ad5a4700e529df"><div class="ttname"><a href="esp32-hal-log_8h.html#a202330fb3201c41b86ad5a4700e529df">log_e</a></div><div class="ttdeci">#define log_e(format,...)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-log_8h_source.html#l00117">esp32-hal-log.h:116</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_a36c3d7224380d129e9be34a0303bdafb"><div class="ttname"><a href="structi2c__struct__t.html#a36c3d7224380d129e9be34a0303bdafb">i2c_struct_t::sda</a></div><div class="ttdeci">int8_t sda</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00175">esp32-hal-i2c.c:175</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a3a549294b3be6cdbb87af2ad13d13d9f"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a3a549294b3be6cdbb87af2ad13d13d9f">I2C_DATA_CTRL_t::dataCmdSent</a></div><div class="ttdeci">uint32_t dataCmdSent</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00150">esp32-hal-i2c.c:150</a></div></div>
<div class="ttc" id="aesp32-hal-log_8h_html_a9a988b39da89387c997c14dbe3ad0921"><div class="ttname"><a href="esp32-hal-log_8h.html#a9a988b39da89387c997c14dbe3ad0921">log_i</a></div><div class="ttdeci">#define log_i(format,...)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-log_8h_source.html#l00101">esp32-hal-log.h:100</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_af16bd0c672658c4aaaf3dbdf7983f09a"><div class="ttname"><a href="structi2c__dev__t.html#af16bd0c672658c4aaaf3dbdf7983f09a">i2c_dev_t::sda_sample</a></div><div class="ttdeci">union i2c_dev_t::@415 sda_sample</div></div>
<div class="ttc" id="astructi2c__struct__t_html_af338a035c004aba7b43a8e9a368029d1"><div class="ttname"><a href="structi2c__struct__t.html#af338a035c004aba7b43a8e9a368029d1">i2c_struct_t::debugFlags</a></div><div class="ttdeci">uint32_t debugFlags</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00189">esp32-hal-i2c.c:189</a></div></div>
<div class="ttc" id="astdint_8h_html_a2aff71146ab4942b2b38860c749c4074"><div class="ttname"><a href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a></div><div class="ttdeci">__uint8_t uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00021">stdint.h:21</a></div></div>
<div class="ttc" id="astructi2c__dev__t_html_a62d02036f90458d22533b20f37603b8b"><div class="ttname"><a href="structi2c__dev__t.html#a62d02036f90458d22533b20f37603b8b">i2c_dev_t::int_status</a></div><div class="ttdeci">union i2c_dev_t::@413 int_status</div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a5e5763762569a0ffbc045480c5fda8c4"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a5e5763762569a0ffbc045480c5fda8c4">i2cWrite</a></div><div class="ttdeci">i2c_err_t i2cWrite(i2c_t *i2c, uint16_t address, uint8_t *buff, uint16_t size, bool sendStop, uint16_t timeOutMillis)</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l01613">esp32-hal-i2c.c:1613</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_afb71c50ad66a58c8cce3f9be94a1aad4"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#afb71c50ad66a58c8cce3f9be94a1aad4">I2C_FIFO_CONF_t::tx_fifo_rst</a></div><div class="ttdeci">uint32_t tx_fifo_rst</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00079">esp32-hal-i2c.c:79</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a463a4dace1b8044815272d132b0a5ac2"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a463a4dace1b8044815272d132b0a5ac2">I2C_DATA_CTRL_t::addrCmdSent</a></div><div class="ttdeci">uint32_t addrCmdSent</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00149">esp32-hal-i2c.c:149</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_ade7e0553ee987a9446cd674ec38c341fae8fe4f82e66f4463eade639f1eaca544"><div class="ttname"><a href="esp32-hal-i2c_8c.html#ade7e0553ee987a9446cd674ec38c341fae8fe4f82e66f4463eade639f1eaca544">I2C_SLAVE</a></div><div class="ttdeci">@ I2C_SLAVE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00112">esp32-hal-i2c.c:112</a></div></div>
<div class="ttc" id="asoc_8h_html_a7d9e1c6df766f10c2905df77f970e2c6"><div class="ttname"><a href="soc_8h.html#a7d9e1c6df766f10c2905df77f970e2c6">ETS_I2C_EXT0_INTR_SOURCE</a></div><div class="ttdeci">#define ETS_I2C_EXT0_INTR_SOURCE</div><div class="ttdef"><b>Definition:</b> <a href="soc_8h_source.html#l00377">soc.h:376</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_a999453461409e71e43e30d829ab8ac54"><div class="ttname"><a href="i2c__reg_8h.html#a999453461409e71e43e30d829ab8ac54">I2C_END_DETECT_INT_ENA</a></div><div class="ttdeci">#define I2C_END_DETECT_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00503">i2c_reg.h:502</a></div></div>
<div class="ttc" id="asemphr_8h_html"><div class="ttname"><a href="semphr_8h.html">semphr.h</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_a30d636c7aade7e875101380f58b90746"><div class="ttname"><a href="esp32-hal-i2c_8c.html#a30d636c7aade7e875101380f58b90746">I2C_MUTEX_LOCK</a></div><div class="ttdeci">#define I2C_MUTEX_LOCK()</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00210">esp32-hal-i2c.c:209</a></div></div>
<div class="ttc" id="aCMakeCache_8txt_html_a4b049a23642b5914fa9fc63dd4442995"><div class="ttname"><a href="CMakeCache_8txt.html#a4b049a23642b5914fa9fc63dd4442995">a</a></div><div class="ttdeci">home alice espressif esp idf components esp32 libhal a</div><div class="ttdef"><b>Definition:</b> <a href="CMakeCache_8txt_source.html#l00299">CMakeCache.txt:299</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a745b00de27a02a8e53c9c3c9c864cf49"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a745b00de27a02a8e53c9c3c9c864cf49">I2C_DATA_CTRL_t::val</a></div><div class="ttdeci">uint32_t val</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00156">esp32-hal-i2c.c:156</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a4fd6937efbe394af6170a399a906b9c0"><div class="ttname"><a href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a4fd6937efbe394af6170a399a906b9c0">I2C_CMD_END</a></div><div class="ttdeci">@ I2C_CMD_END</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00198">esp32-hal-i2c.c:197</a></div></div>
<div class="ttc" id="adport__reg_8h_html"><div class="ttname"><a href="dport__reg_8h.html">dport_reg.h</a></div></div>
<div class="ttc" id="anamespaceasio_1_1detail_1_1descriptor__ops_html_ad10e658a754ff775cdcc3b3decd3c8c9"><div class="ttname"><a href="namespaceasio_1_1detail_1_1descriptor__ops.html#ad10e658a754ff775cdcc3b3decd3c8c9">asio::detail::descriptor_ops::buf</a></div><div class="ttdeci">iovec buf</div><div class="ttdef"><b>Definition:</b> <a href="descriptor__ops_8hpp_source.html#l00074">descriptor_ops.hpp:74</a></div></div>
<div class="ttc" id="aesp32-hal-i2c_8c_html_adf764cbdea00d65edcd07bb9953ad2b7a3a71d4224bff65119353ea514674f4e4"><div class="ttname"><a href="esp32-hal-i2c_8c.html#adf764cbdea00d65edcd07bb9953ad2b7a3a71d4224bff65119353ea514674f4e4">I2C_CMD_WRITE</a></div><div class="ttdeci">@ I2C_CMD_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00194">esp32-hal-i2c.c:194</a></div></div>
<div class="ttc" id="aunionI2C__FIFO__CONF__t_html_ae72ce6e606d48072099b3f878829f7c1"><div class="ttname"><a href="unionI2C__FIFO__CONF__t.html#ae72ce6e606d48072099b3f878829f7c1">I2C_FIFO_CONF_t::tx_fifo_empty_thrhd</a></div><div class="ttdeci">uint32_t tx_fifo_empty_thrhd</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00074">esp32-hal-i2c.c:74</a></div></div>
<div class="ttc" id="aunionI2C__DATA__CTRL__t_html_a4644af4781941de9c30a83401198e8c1"><div class="ttname"><a href="unionI2C__DATA__CTRL__t.html#a4644af4781941de9c30a83401198e8c1">I2C_DATA_CTRL_t::addr</a></div><div class="ttdeci">uint32_t addr</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00145">esp32-hal-i2c.c:145</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_ad596f98d418e5e14145f95fd63f3a130"><div class="ttname"><a href="structi2c__struct__t.html#ad596f98d418e5e14145f95fd63f3a130">i2c_struct_t::error</a></div><div class="ttdeci">I2C_ERROR_t error</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00179">esp32-hal-i2c.c:179</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_af6fcafa997203a3a0b597826f2cf7f0e"><div class="ttname"><a href="i2c__reg_8h.html#af6fcafa997203a3a0b597826f2cf7f0e">I2C_TRANS_START_INT_ENA</a></div><div class="ttdeci">#define I2C_TRANS_START_INT_ENA</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00467">i2c_reg.h:466</a></div></div>
<div class="ttc" id="ai2c__reg_8h_html_aab489ad80eacb8d9258098e45fff9737"><div class="ttname"><a href="i2c__reg_8h.html#aab489ad80eacb8d9258098e45fff9737">I2C_TIME_OUT_INT_ST</a></div><div class="ttdeci">#define I2C_TIME_OUT_INT_ST</div><div class="ttdef"><b>Definition:</b> <a href="i2c__reg_8h_source.html#l00553">i2c_reg.h:552</a></div></div>
<div class="ttc" id="aevent__groups_8h_html_a6939faca89fc4ba52fa8288527042464"><div class="ttname"><a href="event__groups_8h.html#a6939faca89fc4ba52fa8288527042464">vEventGroupDelete</a></div><div class="ttdeci">void vEventGroupDelete(EventGroupHandle_t xEventGroup)</div></div>
<div class="ttc" id="aesp32-hal-gpio_8h_html_a298c4c61c2505f61e111ba1b4252c81f"><div class="ttname"><a href="esp32-hal-gpio_8h.html#a298c4c61c2505f61e111ba1b4252c81f">OPEN_DRAIN</a></div><div class="ttdeci">#define OPEN_DRAIN</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-gpio_8h_source.html#l00040">esp32-hal-gpio.h:39</a></div></div>
<div class="ttc" id="astructi2c__struct__t_html_ad83f24ad2d8d1288c1ea276cacb68911"><div class="ttname"><a href="structi2c__struct__t.html#ad83f24ad2d8d1288c1ea276cacb68911">i2c_struct_t::queueCount</a></div><div class="ttdeci">uint16_t queueCount</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-i2c_8c_source.html#l00184">esp32-hal-i2c.c:184</a></div></div>
<div class="ttc" id="aesp32-hal-gpio_8h_html_a5bb885982ff66a2e0a0a45a8ee9c35e2"><div class="ttname"><a href="esp32-hal-gpio_8h.html#a5bb885982ff66a2e0a0a45a8ee9c35e2">HIGH</a></div><div class="ttdeci">#define HIGH</div><div class="ttdef"><b>Definition:</b> <a href="esp32-hal-gpio_8h_source.html#l00031">esp32-hal-gpio.h:30</a></div></div>
<div class="ttc" id="aevent__groups_8h_html_a0fb72cfdd4f0d5f86d955fc3af448f2a"><div class="ttname"><a href="event__groups_8h.html#a0fb72cfdd4f0d5f86d955fc3af448f2a">xEventGroupClearBits</a></div><div class="ttdeci">EventBits_t xEventGroupClearBits(EventGroupHandle_t xEventGroup, const EventBits_t uxBitsToClear) PRIVILEGED_FUNCTION</div></div>
<div class="ttc" id="astructi2c__dev__t_html_a4893967cb15ac4f6c7aab7bf2f941e73"><div class="ttname"><a href="structi2c__dev__t.html#a4893967cb15ac4f6c7aab7bf2f941e73">i2c_dev_t::tx_fifo_empty</a></div><div class="ttdeci">uint32_t tx_fifo_empty</div><div class="ttdef"><b>Definition:</b> <a href="i2c__struct_8h_source.html#l00115">i2c_struct.h:115</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
