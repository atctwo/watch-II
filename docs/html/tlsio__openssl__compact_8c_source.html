<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.18"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>watch 2: components/arduino-esp32/libraries/AzureIoT/src/az_iot/c-utility/pal/src/tlsio_openssl_compact.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">watch 2
   </div>
   <div id="projectbrief">Firmwareforwatch2</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.18 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_409f97388efe006bc3438b95e9edef48.html">components</a></li><li class="navelem"><a class="el" href="dir_5eb99044ce905dee52e93bf33cea5db4.html">arduino-esp32</a></li><li class="navelem"><a class="el" href="dir_0b98385dcf64e929fcaa5e8c894594ea.html">libraries</a></li><li class="navelem"><a class="el" href="dir_eb555940be421b578cfc4731c861a40a.html">AzureIoT</a></li><li class="navelem"><a class="el" href="dir_540bbe64a9e668446da0d15e64e423e9.html">src</a></li><li class="navelem"><a class="el" href="dir_c4ba8e35b6f312a68ea59c6826b7e111.html">az_iot</a></li><li class="navelem"><a class="el" href="dir_31551b8d33ee157fa445c47622c5655a.html">c-utility</a></li><li class="navelem"><a class="el" href="dir_0a8f20c8ca649b7cd893885d3bc0d2ed.html">pal</a></li><li class="navelem"><a class="el" href="dir_0c59f5df8045a78634fb0ce9c08f16de.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">tlsio_openssl_compact.c</div>  </div>
</div><!--header-->
<div class="contents">
<a href="tlsio__openssl__compact_8c.html">Go to the documentation of this file.</a><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) Microsoft. All rights reserved.</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">// Licensed under the MIT license. See LICENSE file in the project root for full license information.</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160; </div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="preprocessor">#include &lt;stdlib.h&gt;</span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160; </div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="openssl_2openssl_2ssl_8h.html">openssl/ssl.h</a>&quot;</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160; </div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="preprocessor">#include &lt;stdio.h&gt;</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="preprocessor">#include &lt;<a class="code" href="stdint_8h.html">stdint.h</a>&gt;</span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="preprocessor">#include &lt;stdbool.h&gt;</span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="preprocessor">#include &quot;../inc/socket_async.h&quot;</span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="preprocessor">#include &quot;../inc/dns_async.h&quot;</span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="preprocessor">#include &quot;../inc/tlsio_pal.h&quot;</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="gballoc_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/gballoc.h</a>&quot;</span></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="xlogging_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/xlogging.h</a>&quot;</span></div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="agenttime_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/agenttime.h</a>&quot;</span></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="singlylinkedlist_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/singlylinkedlist.h</a>&quot;</span></div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="crt__abstractions_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/crt_abstractions.h</a>&quot;</span></div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="preprocessor">#include &quot;<a class="code" href="tlsio__options_8h.html">az_iot/c-utility/inc/azure_c_shared_utility/tlsio_options.h</a>&quot;</span></div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160; </div>
<div class="line"><a name="l00021"></a><span class="lineno"><a class="line" href="structPENDING__TRANSMISSION.html">   21</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct</span></div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{</div>
<div class="line"><a name="l00023"></a><span class="lineno"><a class="line" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">   23</a></span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* <a class="code" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">bytes</a>;</div>
<div class="line"><a name="l00024"></a><span class="lineno"><a class="line" href="structPENDING__TRANSMISSION.html#ab718424c45bd519566c18e78f3f5c0c1">   24</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structPENDING__TRANSMISSION.html#ab718424c45bd519566c18e78f3f5c0c1">size</a>;</div>
<div class="line"><a name="l00025"></a><span class="lineno"><a class="line" href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">   25</a></span>&#160;    <span class="keywordtype">size_t</span> <a class="code" href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">unsent_size</a>;</div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="structPENDING__TRANSMISSION.html#ad2f51b61f99c4886dc00607e076b50ba">   26</a></span>&#160;    <a class="code" href="xio_8h.html#a9275b2e616c2abadf629ca3d94d7871f">ON_SEND_COMPLETE</a> <a class="code" href="structPENDING__TRANSMISSION.html#ad2f51b61f99c4886dc00607e076b50ba">on_send_complete</a>;</div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="structPENDING__TRANSMISSION.html#a2300ca402b1a57a0be31b4b73d9e503b">   27</a></span>&#160;    <span class="keywordtype">void</span>* <a class="code" href="structPENDING__TRANSMISSION.html#a2300ca402b1a57a0be31b4b73d9e503b">callback_context</a>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;} <a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160; </div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="preprocessor">#define MAX_VALID_PORT 0xffff</span></div>
<div class="line"><a name="l00031"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#a0f6fc05b9e28a1054693052fb103765d">   31</a></span>&#160; </div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">// The TLSIO_RECEIVE_BUFFER_SIZE has very little effect on performance, and is kept small</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">// to minimize memory consumption.</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="preprocessor">#define TLSIO_RECEIVE_BUFFER_SIZE 64</span></div>
<div class="line"><a name="l00035"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#a545a2096a8acb4ba86577a8476836de0">   35</a></span>&#160; </div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160; </div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9">   37</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">enum</span> <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9">TLSIO_STATE_TAG</a></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;{</div>
<div class="line"><a name="l00039"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">   39</a></span>&#160;    <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">TLSIO_STATE_CLOSED</a>,</div>
<div class="line"><a name="l00040"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a88599a6fae5c08edccc76a16ac49b25d">   40</a></span>&#160;    <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a88599a6fae5c08edccc76a16ac49b25d">TLSIO_STATE_OPENING_WAITING_DNS</a>,</div>
<div class="line"><a name="l00041"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a821f2aa54b2d0b60a2a5a370800996cd">   41</a></span>&#160;    <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a821f2aa54b2d0b60a2a5a370800996cd">TLSIO_STATE_OPENING_WAITING_SOCKET</a>,</div>
<div class="line"><a name="l00042"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a56c79a97f9e20830f5239e6d11623ed1">   42</a></span>&#160;    <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a56c79a97f9e20830f5239e6d11623ed1">TLSIO_STATE_OPENING_WAITING_SSL</a>,</div>
<div class="line"><a name="l00043"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">   43</a></span>&#160;    <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a>,</div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25">   44</a></span>&#160;    <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25">TLSIO_STATE_ERROR</a>,</div>
<div class="line"><a name="l00045"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#ae6c495f506c21eda4b7f679bbfaa6085">   45</a></span>&#160;} <a class="code" href="tlsio__openssl__compact_8c.html#ae6c495f506c21eda4b7f679bbfaa6085">TLSIO_STATE</a>;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160; </div>
<div class="line"><a name="l00047"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#ac7314201431db6a0a996e4d8b66301ee">   47</a></span>&#160;<span class="keywordtype">bool</span> <a class="code" href="tlsio__openssl__compact_8c.html#ac7314201431db6a0a996e4d8b66301ee">is_an_opening_state</a>(<a class="code" href="tlsio__openssl__compact_8c.html#ae6c495f506c21eda4b7f679bbfaa6085">TLSIO_STATE</a> <a class="code" href="structstate.html">state</a>)</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;{</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;    <span class="keywordflow">return</span> <a class="code" href="structstate.html">state</a> == <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a88599a6fae5c08edccc76a16ac49b25d">TLSIO_STATE_OPENING_WAITING_DNS</a> ||</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;        <a class="code" href="structstate.html">state</a> == <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a821f2aa54b2d0b60a2a5a370800996cd">TLSIO_STATE_OPENING_WAITING_SOCKET</a> ||</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        <a class="code" href="structstate.html">state</a> == <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a56c79a97f9e20830f5239e6d11623ed1">TLSIO_STATE_OPENING_WAITING_SSL</a>;</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;}</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160; </div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">// This structure definition is mirrored in the unit tests, so if you change</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">// this struct, keep it in sync with the one in tlsio_openssl_compact_ut.c</span></div>
<div class="line"><a name="l00056"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html">   56</a></span>&#160;<span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE_TAG</a></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;{</div>
<div class="line"><a name="l00058"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#ad56bc8aa8fea9cb57baf06f3fca9420b">   58</a></span>&#160;    <a class="code" href="xio_8h.html#a13198b46d201d067f60a82c1bf0e5780">ON_BYTES_RECEIVED</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#ad56bc8aa8fea9cb57baf06f3fca9420b">on_bytes_received</a>;</div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#afbe2863585ed2168cdd472157b05a22c">   59</a></span>&#160;    <a class="code" href="xio_8h.html#a2761e39867e9372423f77921fc5fd26d">ON_IO_ERROR</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#afbe2863585ed2168cdd472157b05a22c">on_io_error</a>;</div>
<div class="line"><a name="l00060"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">   60</a></span>&#160;    <a class="code" href="xio_8h.html#a3acca89b8b5ff3d42b3eaf0b3dbcf7ca">ON_IO_OPEN_COMPLETE</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">on_open_complete</a>;</div>
<div class="line"><a name="l00061"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#af81df084101e36976fcdccad12bb9ca5">   61</a></span>&#160;    <span class="keywordtype">void</span>* <a class="code" href="structTLS__IO__INSTANCE__TAG.html#af81df084101e36976fcdccad12bb9ca5">on_bytes_received_context</a>;</div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#a0a3d2e0a57edaf63aae1c954a1f004cc">   62</a></span>&#160;    <span class="keywordtype">void</span>* <a class="code" href="structTLS__IO__INSTANCE__TAG.html#a0a3d2e0a57edaf63aae1c954a1f004cc">on_io_error_context</a>;</div>
<div class="line"><a name="l00063"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">   63</a></span>&#160;    <span class="keywordtype">void</span>* <a class="code" href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">on_open_complete_context</a>;</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">   64</a></span>&#160;    <a class="code" href="structssl__st.html">SSL</a>* <a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>;</div>
<div class="line"><a name="l00065"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">   65</a></span>&#160;    <a class="code" href="structssl__ctx__st.html">SSL_CTX</a>* <a class="code" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">ssl_context</a>;</div>
<div class="line"><a name="l00066"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">   66</a></span>&#160;    <a class="code" href="tlsio__openssl__compact_8c.html#ae6c495f506c21eda4b7f679bbfaa6085">TLSIO_STATE</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a>;</div>
<div class="line"><a name="l00067"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">   67</a></span>&#160;    <a class="code" href="dns__async_8h.html#ab6c695ab47c2f56276485386c0ddd78b">DNS_ASYNC_HANDLE</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a>;</div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">   68</a></span>&#160;    <span class="keywordtype">char</span>* <a class="code" href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">hostname</a>;</div>
<div class="line"><a name="l00069"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#afc802ec89778374b6cd77f8d90776ddd">   69</a></span>&#160;    <a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#afc802ec89778374b6cd77f8d90776ddd">port</a>;</div>
<div class="line"><a name="l00070"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">   70</a></span>&#160;    <a class="code" href="socket__async_8h.html#a5f4aeeddcf346d420aa128662b37963b">SOCKET_ASYNC_HANDLE</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a>;</div>
<div class="line"><a name="l00071"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">   71</a></span>&#160;    <a class="code" href="structSINGLYLINKEDLIST__INSTANCE__TAG.html">SINGLYLINKEDLIST_HANDLE</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a>;</div>
<div class="line"><a name="l00072"></a><span class="lineno"><a class="line" href="structTLS__IO__INSTANCE__TAG.html#a6e11e67d32ba761c7ec8d53940a1f03d">   72</a></span>&#160;    <a class="code" href="structTLSIO__OPTIONS__TAG.html">TLSIO_OPTIONS</a> <a class="code" href="structTLS__IO__INSTANCE__TAG.html#a6e11e67d32ba761c7ec8d53940a1f03d">options</a>;</div>
<div class="line"><a name="l00073"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#a5191b4b5b4e8356d46a902f73568d42f">   73</a></span>&#160;} <a class="code" href="tlsio__openssl__compact_8c.html#a5191b4b5b4e8356d46a902f73568d42f">TLS_IO_INSTANCE</a>;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160; </div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">/* Codes_SRS_TLSIO_30_005: [ The phrase &quot;enter TLSIO_STATE_EXT_ERROR&quot; means the adapter shall call the on_io_error function and pass the on_io_error_context that was supplied in tlsio_open_async. ]*/</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> enter_tlsio_error_state(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;{</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> != <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25">TLSIO_STATE_ERROR</a>)</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;    {</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> = <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25">TLSIO_STATE_ERROR</a>;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#afbe2863585ed2168cdd472157b05a22c">on_io_error</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a0a3d2e0a57edaf63aae1c954a1f004cc">on_io_error_context</a>);</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;    }</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;}</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160; </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">/* Codes_SRS_TLSIO_30_005: [ When the adapter enters TLSIO_STATE_EXT_ERROR it shall call the  on_io_error function and pass the on_io_error_context that were supplied in  tlsio_open . ]*/</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> enter_open_error_state(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;{</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;    <span class="comment">// save instance variables in case the framework destroys this object before we exit</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;    <a class="code" href="xio_8h.html#a3acca89b8b5ff3d42b3eaf0b3dbcf7ca">ON_IO_OPEN_COMPLETE</a> on_open_complete = tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">on_open_complete</a>;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;    <span class="keywordtype">void</span>* on_open_complete_context = tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">on_open_complete_context</a>;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;    enter_tlsio_error_state(tls_io_instance);   </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;    on_open_complete(on_open_complete_context, IO_OPEN_ERROR);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;}</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; </div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment">// Return true if a message was available to remove</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="keyword">static</span> <span class="keywordtype">bool</span> process_and_destroy_head_message(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance, IO_SEND_RESULT send_result)</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;{</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;    <span class="keywordtype">bool</span> result;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;    <a class="code" href="structLIST__ITEM__INSTANCE__TAG.html">LIST_ITEM_HANDLE</a> head_pending_io;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;    <span class="keywordflow">if</span> (send_result == IO_SEND_ERROR)</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;    {</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_095: [ If the send process fails before sending all of the bytes in an enqueued message, the tlsio_dowork shall call the message&#39;s on_send_complete along with its associated callback_context and IO_SEND_ERROR. ]*/</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;        enter_tlsio_error_state(tls_io_instance);</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;    }</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;    head_pending_io = <a class="code" href="singlylinkedlist_8c.html#a2557a2e240bd38a36a240a8386096507">singlylinkedlist_get_head_item</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;    <span class="keywordflow">if</span> (head_pending_io != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;    {</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        <a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>* head_message = (<a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>*)<a class="code" href="singlylinkedlist_8c.html#ae1a394b3f989a78faa77ce2aa11e1c67">singlylinkedlist_item_get_value</a>(head_pending_io);</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;        <span class="comment">// Must remove the item from the list before calling the callback because </span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;        <span class="comment">// SRS_TLSIO_30_091: [ If  tlsio_dowork  is able to send all the bytes in an enqueued message, it shall first dequeue the message then call the messages&#39;s  on_send_complete  along with its associated  callback_context  and  IO_SEND_OK . ]</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;        <span class="keywordflow">if</span> (<a class="code" href="singlylinkedlist_8c.html#a4989115eb394f221a8af5db9a2873d1b">singlylinkedlist_remove</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a>, head_pending_io) != 0)</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        {</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="comment">// This particular situation is a bizarre and unrecoverable internal error</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_094: [ If the send process encounters an internal error or calls on_send_complete with IO_SEND_ERROR due to either failure or timeout, it shall also call on_io_error and pass in the associated on_io_error_context. ]*/</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            enter_tlsio_error_state(tls_io_instance);</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed to remove message from list&quot;</span>);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        }</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;        <span class="comment">// on_send_complete is checked for NULL during PENDING_TRANSMISSION creation</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_095: [ If the send process fails before sending all of the bytes in an enqueued message, the tlsio_dowork shall call the message&#39;s on_send_complete along with its associated callback_context and IO_SEND_ERROR. ]*/</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        head_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ad2f51b61f99c4886dc00607e076b50ba">on_send_complete</a>(head_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2300ca402b1a57a0be31b4b73d9e503b">callback_context</a>, send_result);</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160; </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(head_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">bytes</a>);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(head_message);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;        result = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;    }</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    {</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        result = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;    }</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;}</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160; </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> internal_close(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;{</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;    <span class="comment">/* Codes_SRS_TLSIO_30_009: [ The phrase &quot;enter TLSIO_STATE_EXT_CLOSING&quot; means the adapter shall iterate through any unsent messages in the queue and shall delete each message after calling its on_send_complete with the associated callback_context and IO_SEND_CANCELLED. ]*/</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;    <span class="comment">/* Codes_SRS_TLSIO_30_006: [ The phrase &quot;enter TLSIO_STATE_EXT_CLOSED&quot; means the adapter shall forcibly close any existing connections then call the on_io_close_complete function and pass the on_io_close_complete_context that was supplied in tlsio_close_async. ]*/</span></div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;    <span class="comment">/* Codes_SRS_TLSIO_30_051: [ On success, if the underlying TLS does not support asynchronous closing, then the adapter shall enter TLSIO_STATE_EXT_CLOSED immediately after entering TLSIO_STATE_EX_CLOSING. ]*/</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> == <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a>)</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;    {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;        <span class="comment">// From the OpenSSL manual pages: &quot;According to the TLS standard, it is acceptable </span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;        <span class="comment">// for an application to only send its shutdown alert and then close the </span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;        <span class="comment">// underlying connection without waiting for the peer&#39;s response...&quot;. It goes</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;        <span class="comment">// on to say that waiting for shutdown only makes sense if the underlying</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        <span class="comment">// connection is being re-used, which we do not do. So there&#39;s no need</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        <span class="comment">// to wait for shutdown. The SSL_shutdown result is not logged because the</span></div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;        <span class="comment">// return values are of no interest for unidirectional shutdown, which is</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;        <span class="comment">// what we use.</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)<a class="code" href="openssl_2openssl_2ssl_8h.html#adfe1bc081fa47b1d626cdd43c6449c2b">SSL_shutdown</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>);</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;    }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160; </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;    {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;        <a class="code" href="dns__async_8c.html#ae6b440865355907dff471d002e11975e">dns_async_destroy</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;    }</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;    {</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;        <a class="code" href="openssl_2openssl_2ssl_8h.html#add9f91511b7a494f4910b0e3567d7d99">SSL_free</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">ssl_context</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;    {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;        <a class="code" href="openssl_2openssl_2ssl_8h.html#a9a6dc099d8eccfdde41bf8abfbfeaf26">SSL_CTX_free</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">ssl_context</a>);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">ssl_context</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;    }</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a> &gt;= 0)</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;    {</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;        <span class="comment">// The underlying socket API does not support waiting for close</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;        <span class="comment">// to complete, so it isn&#39;t possible to do so.</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;        <a class="code" href="socket__async_8c.html#ada7ff9d1133d9191839a54bf73304739">socket_async_destroy</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a>);</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a> = -1;</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;    }</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160; </div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;    <span class="keywordflow">while</span> (process_and_destroy_head_message(tls_io_instance, IO_SEND_CANCELLED));</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;    <span class="comment">// singlylinkedlist_destroy gets called in the main destroy</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160; </div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ad56bc8aa8fea9cb57baf06f3fca9420b">on_bytes_received</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#afbe2863585ed2168cdd472157b05a22c">on_io_error</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af81df084101e36976fcdccad12bb9ca5">on_bytes_received_context</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a0a3d2e0a57edaf63aae1c954a1f004cc">on_io_error_context</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> = <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">TLSIO_STATE_CLOSED</a>;</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">on_open_complete</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">on_open_complete_context</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;}</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160; </div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;<span class="comment">// This method tests for hard errors returned from either SSL_write or SSL_connect.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;<span class="comment">// Returns </span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;<span class="comment">//     0 for SSL_ERROR_WANT_READ or SSL_ERROR_WANT_WRITE</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;<span class="comment">//     The actual error for other errors (real failures)</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> is_hard_ssl_error(<a class="code" href="structssl__st.html">SSL</a>* ssl, <span class="keywordtype">int</span> callReturn)</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;{</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;    <span class="keywordtype">int</span> result = <a class="code" href="openssl_2openssl_2ssl_8h.html#ac9d6d11ce6d00fd2c257d38238c133b3">SSL_get_error</a>(ssl, callReturn);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;    <span class="keywordflow">if</span> (result == <a class="code" href="ssl__code_8h.html#a633be46175f7c4094aaace11fb248c66">SSL_ERROR_WANT_READ</a> || result == <a class="code" href="ssl__code_8h.html#affda963e1494dc339c8ab9287f4c0b3c">SSL_ERROR_WANT_WRITE</a>)</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;    {</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        result = 0;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;}</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160; </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> tlsio_openssl_destroy(<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tls_io)</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;{</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;    <span class="keywordflow">if</span> (tls_io == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;    {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_020: [ If tlsio_handle is NULL, tlsio_destroy shall do nothing. ]*/</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tlsio&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;    }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;    {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;        <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance = (<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>*)tls_io;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;        <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> != <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">TLSIO_STATE_CLOSED</a>)</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;        {</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_022: [ If the adapter is in any state other than TLSIO_STATE_EX_CLOSED when tlsio_destroy is called, the adapter shall enter TLSIO_STATE_EX_CLOSING and then enter TLSIO_STATE_EX_CLOSED before completing the destroy process. ]*/</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;tlsio_openssl_destroy called while not in TLSIO_STATE_CLOSED.&quot;</span>);</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            internal_close(tls_io_instance);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        }</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_021: [ The tlsio_destroy shall release all allocated resources and then release tlsio_handle. ]*/</span></div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;        <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">hostname</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;        {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">hostname</a>);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;        }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;        </div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;        <a class="code" href="tlsio__options_8h.html#ae9460d63e5798643cd727939bec0871c">tlsio_options_release_resources</a>(&amp;tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a6e11e67d32ba761c7ec8d53940a1f03d">options</a>);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160; </div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;        <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a> != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;        {</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="comment">/* Pending messages were cleared in internal_close */</span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <a class="code" href="singlylinkedlist_8c.html#af882d0a8dedb9091e5e77df980e631ff">singlylinkedlist_destroy</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a>);</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;        }</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160; </div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;        <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(tls_io_instance);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;    }</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;}</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160; </div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">/* Codes_SRS_TLSIO_30_010: [ The tlsio_create shall allocate and initialize all necessary resources and return an instance of the tlsio_openssl_compact. ]*/</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;<span class="keyword">static</span> <a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tlsio_openssl_create(<span class="keywordtype">void</span>* io_create_parameters)</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;{</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;    <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* result;</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160; </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;    <span class="keywordflow">if</span> (io_create_parameters == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;    {</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_013: [ If the io_create_parameters value is NULL, tlsio_create shall log an error and return NULL. ]*/</span></div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tls_io_config&quot;</span>);</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;    }</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;    {</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_012: [ The tlsio_create shall receive the connection configuration as a TLSIO_CONFIG* in io_create_parameters. ]*/</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;        <a class="code" href="structTLSIO__CONFIG__TAG.html">TLSIO_CONFIG</a>* tls_io_config = (<a class="code" href="structTLSIO__CONFIG__TAG.html">TLSIO_CONFIG</a>*)io_create_parameters;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;        <span class="keywordflow">if</span> (tls_io_config-&gt;<a class="code" href="structTLSIO__CONFIG__TAG.html#ab54037cac27a086058ebb5bd9c2eedc1">hostname</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;        {</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_014: [ If the hostname member of io_create_parameters value is NULL, tlsio_create shall log an error and return NULL. ]*/</span></div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tls_io_config-&gt;hostname&quot;</span>);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;        }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (tls_io_config-&gt;<a class="code" href="structTLSIO__CONFIG__TAG.html#af994b29a2e2ab444e5dfb60f2be8339b">port</a> &lt; 0 || tls_io_config-&gt;<a class="code" href="structTLSIO__CONFIG__TAG.html#af994b29a2e2ab444e5dfb60f2be8339b">port</a> &gt; <a class="code" href="tlsio__openssl__compact_8c.html#a0f6fc05b9e28a1054693052fb103765d">MAX_VALID_PORT</a>)</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;        {</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_015: [ If the port member of io_create_parameters value is less than 0 or greater than 0xffff, tlsio_create shall log an error and return NULL. ]*/</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;tls_io_config-&gt;port out of range&quot;</span>);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;        }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;        {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;            result = <a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>));</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="keywordflow">if</span> (result == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;            {</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_011: [ If any resource allocation fails, tlsio_create shall return NULL. ]*/</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;malloc failed&quot;</span>);</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            }</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            {</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="keywordtype">int</span> ms_result;</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                memset(result, 0, <span class="keyword">sizeof</span>(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>));</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#afc802ec89778374b6cd77f8d90776ddd">port</a> = (<a class="code" href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a>)tls_io_config-&gt;<a class="code" href="structTLSIO__CONFIG__TAG.html#af994b29a2e2ab444e5dfb60f2be8339b">port</a>;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> = <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">TLSIO_STATE_CLOSED</a>;</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;                result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a> = <a class="code" href="socket__async_8h.html#a86f1ac99e9d9a07cadb0ca3711060920">SOCKET_ASYNC_INVALID_SOCKET</a>;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">hostname</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                <span class="comment">// No options are currently supported</span></div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                <a class="code" href="tlsio__options_8h.html#a115375f6da80364308b8f10cf8406510">tlsio_options_initialize</a>(&amp;result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a6e11e67d32ba761c7ec8d53940a1f03d">options</a>, <a class="code" href="tlsio__options_8h.html#a6acba6fd5750c60b338b6507c65e46cca519db6d0b95c037ad1998359e4627564">TLSIO_OPTION_BIT_NONE</a>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_016: [ tlsio_create shall make a copy of the hostname member of io_create_parameters to allow deletion of hostname immediately after the call. ]*/</span></div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                ms_result = <a class="code" href="crt__abstractions_8c.html#a867b1509b0b0a16b1bae1d829679c484">mallocAndStrcpy_s</a>(&amp;result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">hostname</a>, tls_io_config-&gt;<a class="code" href="structTLSIO__CONFIG__TAG.html#ab54037cac27a086058ebb5bd9c2eedc1">hostname</a>);</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                <span class="keywordflow">if</span> (ms_result != 0)</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                {</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    <span class="comment">/* Codes_SRS_TLSIO_30_011: [ If any resource allocation fails, tlsio_create shall return NULL. ]*/</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;malloc failed&quot;</span>);</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                    tlsio_openssl_destroy(result);</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;                    result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                }</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;                {</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;                    <span class="comment">// Create the message queue</span></div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;                    result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a> = <a class="code" href="singlylinkedlist_8c.html#ab0c5ab1106ca4f392541c044fe8a1f13">singlylinkedlist_create</a>();</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;                    <span class="keywordflow">if</span> (result-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                    {</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                        <span class="comment">/* Codes_SRS_TLSIO_30_011: [ If any resource allocation fails, tlsio_create shall return NULL. ]*/</span></div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed singlylinkedlist_create&quot;</span>);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                        tlsio_openssl_destroy(result);</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                    }</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                }</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;        }</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;    }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160; </div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;    <span class="keywordflow">return</span> (<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a>)result;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;}</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160; </div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160; </div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> tlsio_openssl_open_async(<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tls_io,</div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;    <a class="code" href="xio_8h.html#a3acca89b8b5ff3d42b3eaf0b3dbcf7ca">ON_IO_OPEN_COMPLETE</a> on_io_open_complete, <span class="keywordtype">void</span>* on_io_open_complete_context,</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;    <a class="code" href="xio_8h.html#a13198b46d201d067f60a82c1bf0e5780">ON_BYTES_RECEIVED</a> on_bytes_received, <span class="keywordtype">void</span>* on_bytes_received_context,</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;    <a class="code" href="xio_8h.html#a2761e39867e9372423f77921fc5fd26d">ON_IO_ERROR</a> on_io_error, <span class="keywordtype">void</span>* on_io_error_context)</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;{</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160; </div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;    <span class="keywordflow">if</span> (on_io_open_complete == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;    {</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_031: [ If the on_io_open_complete parameter is NULL, tlsio_open shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Required parameter on_io_open_complete is NULL&quot;</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;    }</div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;    {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;        <span class="keywordflow">if</span> (tls_io == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;        {</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_030: [ If the tlsio_handle parameter is NULL, tlsio_open shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tlsio&quot;</span>);</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;        {</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;            <span class="keywordflow">if</span> (on_bytes_received == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_032: [ If the on_bytes_received parameter is NULL, tlsio_open shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Required parameter on_bytes_received is NULL&quot;</span>);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            {</div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;                <span class="keywordflow">if</span> (on_io_error == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                {</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                    <span class="comment">/* Codes_SRS_TLSIO_30_033: [ If the on_io_error parameter is NULL, tlsio_open shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Required parameter on_io_error is NULL&quot;</span>);</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;                }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;                {</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;                    <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance = (<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>*)tls_io;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160; </div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;                    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> != <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">TLSIO_STATE_CLOSED</a>)</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;                    {</div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;                        <span class="comment">/* Codes_SRS_TLSIO_30_037: [ If the adapter is in any state other than TLSIO_STATE_EXT_CLOSED when tlsio_open  is called, it shall log an error, and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Invalid tlsio_state. Expected state is TLSIO_STATE_CLOSED.&quot;</span>);</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;                        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                    }</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;                    {</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;                        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a> = <a class="code" href="dns__async_8c.html#a7147a57523cf7045e5d892bc20bdbc70">dns_async_create</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">hostname</a>, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;                        <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;                        {</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;                            <span class="comment">/* Codes_SRS_TLSIO_30_038: [ If tlsio_open fails to enter TLSIO_STATE_EX_OPENING it shall return FAILURE. ]*/</span></div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;dns_async_create failed&quot;</span>);</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;                            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;                        }</div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;                        {</div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;                            <span class="comment">/* Codes_SRS_TLSIO_30_034: [ The tlsio_open shall store the provided on_bytes_received, on_bytes_received_context, on_io_error, on_io_error_context, on_io_open_complete, and on_io_open_complete_context parameters for later use as specified and tested per other line entries in this document. ]*/</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;                            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ad56bc8aa8fea9cb57baf06f3fca9420b">on_bytes_received</a> = on_bytes_received;</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;                            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af81df084101e36976fcdccad12bb9ca5">on_bytes_received_context</a> = on_bytes_received_context;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160; </div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;                            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#afbe2863585ed2168cdd472157b05a22c">on_io_error</a> = on_io_error;</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;                            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a0a3d2e0a57edaf63aae1c954a1f004cc">on_io_error_context</a> = on_io_error_context;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160; </div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">on_open_complete</a> = on_io_open_complete;</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">on_open_complete_context</a> = on_io_open_complete_context;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160; </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                            <span class="comment">/* Codes_SRS_TLSIO_30_035: [ On tlsio_open success the adapter shall enter TLSIO_STATE_EX_OPENING and return 0. ]*/</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                            <span class="comment">// All the real work happens in dowork</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> = <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a88599a6fae5c08edccc76a16ac49b25d">TLSIO_STATE_OPENING_WAITING_DNS</a>;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                            result = 0;</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                        }</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                    }</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                }</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            }</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;        }</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_039: [ On failure, tlsio_open_async shall not call on_io_open_complete. ]*/</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;    }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160; </div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;}</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160; </div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="comment">// This implementation does not have asynchronous close, but uses the _async name for consistency with the spec</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> tlsio_openssl_close_async(<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tls_io, <a class="code" href="xio_8h.html#afdff4c121fba1278335064c5686cc419">ON_IO_CLOSE_COMPLETE</a> on_io_close_complete, <span class="keywordtype">void</span>* callback_context)</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;{</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160; </div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;    <span class="keywordflow">if</span> (tls_io == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;    {</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_050: [ If the tlsio_handle parameter is NULL, tlsio_openssl_close_async shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tlsio&quot;</span>);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;    }</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;    {</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;        <span class="keywordflow">if</span> (on_io_close_complete == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        {</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_055: [ If the on_io_close_complete parameter is NULL, tlsio_openssl_close_async shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL on_io_close_complete&quot;</span>);</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;        }</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;        {</div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance = (<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>*)tls_io;</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160; </div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> != <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a> &amp;&amp;</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> != <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25">TLSIO_STATE_ERROR</a>)</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;            {</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_053: [ If the adapter is in any state other than TLSIO_STATE_EXT_OPEN or TLSIO_STATE_EXT_ERROR then tlsio_close_async shall log that tlsio_close_async has been called and then continue normally. ]*/</span></div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                <span class="comment">// LogInfo rather than LogError because this is an unusual but not erroneous situation</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                <a class="code" href="xlogging_8h.html#af1461eb0239f8b246b9493167751f4e6">LogInfo</a>(<span class="stringliteral">&quot;tlsio_openssl_close has been called when in neither TLSIO_STATE_OPEN nor TLSIO_STATE_ERROR.&quot;</span>);</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            }</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160; </div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="tlsio__openssl__compact_8c.html#ac7314201431db6a0a996e4d8b66301ee">is_an_opening_state</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a>))</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_057: [ On success, if the adapter is in TLSIO_STATE_EXT_OPENING, it shall call on_io_open_complete with the on_io_open_complete_context supplied in tlsio_open_async and IO_OPEN_CANCELLED. This callback shall be made before changing the internal state of the adapter. ]*/</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">on_open_complete</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">on_open_complete_context</a>, IO_OPEN_CANCELLED);</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            <span class="comment">// This adapter does not support asynchronous closing</span></div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_056: [ On success the adapter shall enter TLSIO_STATE_EX_CLOSING. ]*/</span></div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_051: [ On success, if the underlying TLS does not support asynchronous closing, then the adapter shall enter TLSIO_STATE_EX_CLOSED immediately after entering TLSIO_STATE_EX_CLOSING. ]*/</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_052: [ On success tlsio_close shall return 0. ]*/</span></div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            internal_close(tls_io_instance);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;            on_io_close_complete(callback_context);</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;            result = 0;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;        }</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;    }</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;    <span class="comment">/* Codes_SRS_TLSIO_30_054: [ On failure, the adapter shall not call on_io_close_complete. ]*/</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160; </div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;}</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160; </div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> dowork_read(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;{</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;    <span class="comment">// TRANSFER_BUFFER_SIZE is not very important because if the message is bigger</span></div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;    <span class="comment">// then the framework just calls dowork repeatedly until it gets everything. So</span></div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;    <span class="comment">// a bigger buffer would just use memory without buying anything.</span></div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;    <span class="comment">// Putting this buffer in a small function also allows it to exist on the stack</span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;    <span class="comment">// rather than adding to heap fragmentation.</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> <a class="code" href="structbuffer.html">buffer</a>[<a class="code" href="tlsio__openssl__compact_8c.html#a545a2096a8acb4ba86577a8476836de0">TLSIO_RECEIVE_BUFFER_SIZE</a>];</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;    <span class="keywordtype">int</span> rcv_bytes;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160; </div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> == <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a>)</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;    {</div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;        <span class="comment">// SSL_read is not checked for errors because the &quot;no data&quot; condition is reported as a </span></div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;        <span class="comment">// failure, but the docs do not guarantee that it will always be the same failure,</span></div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;        <span class="comment">// so we have no reliable way to distinguish &quot;no data&quot; from something else.</span></div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;        <span class="comment">//</span></div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;        <span class="comment">// Pump all of the bytes currently available out</span></div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;        rcv_bytes = <a class="code" href="openssl_2openssl_2ssl_8h.html#a83ef9b8562e90bb3fdbd36473e627718">SSL_read</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>, <a class="code" href="structbuffer.html">buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="structbuffer.html">buffer</a>));</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;        <span class="keywordflow">while</span> (rcv_bytes &gt; 0)</div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="comment">// tls_io_instance-&gt;on_bytes_received was already checked for NULL</span></div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="comment">// in the call to tlsio_openssl_open_async</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_100: [ As long as the TLS connection is able to provide received data, tlsio_dowork shall repeatedly read this data and call on_bytes_received with the pointer to the buffer containing the data, the number of bytes received, and the on_bytes_received_context. ]*/</span></div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ad56bc8aa8fea9cb57baf06f3fca9420b">on_bytes_received</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af81df084101e36976fcdccad12bb9ca5">on_bytes_received_context</a>, <a class="code" href="structbuffer.html">buffer</a>, rcv_bytes);</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            rcv_bytes = <a class="code" href="openssl_2openssl_2ssl_8h.html#a83ef9b8562e90bb3fdbd36473e627718">SSL_read</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>, <a class="code" href="structbuffer.html">buffer</a>, <span class="keyword">sizeof</span>(<a class="code" href="structbuffer.html">buffer</a>));</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;        }</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_102: [ If the TLS connection receives no data then tlsio_dowork shall not call the on_bytes_received callback. ]*/</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;    }</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;}</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160; </div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160; </div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> create_ssl(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;{</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;    <span class="keywordtype">int</span> ret;</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160; </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;    tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">ssl_context</a> = <a class="code" href="openssl_2openssl_2ssl_8h.html#afe8c2dc5a7d372b7befabceb17502fa9">SSL_CTX_new</a>(<a class="code" href="openssl_2openssl_2ssl_8h.html#a97ced23c9eaec8cb32f5d675c9048522">TLSv1_2_client_method</a>());</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">ssl_context</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;    {</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_082: [ If the connection process fails for any reason, tlsio_dowork shall log an error, call on_io_open_complete with the on_io_open_complete_context parameter provided in tlsio_open and IO_OPEN_ERROR, and enter TLSIO_STATE_EX_ERROR. ]*/</span></div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;create new SSL CTX failed&quot;</span>);</div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;    }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;    {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a> = <a class="code" href="openssl_2openssl_2ssl_8h.html#a1874e8b72da196e3300b265937aa6da4">SSL_new</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">ssl_context</a>);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;        <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;        {</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_082: [ If the connection process fails for any reason, tlsio_dowork shall log an error, call on_io_open_complete with the on_io_open_complete_context parameter provided in tlsio_open and IO_OPEN_ERROR, and enter TLSIO_STATE_EX_ERROR. ]*/</span></div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;SSL_new failed&quot;</span>);</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;        }</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;        {</div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;            <span class="comment">// returns 1 on success</span></div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;            ret = <a class="code" href="openssl_2openssl_2ssl_8h.html#a5417996a2e395d43707c8283cb51050c">SSL_set_fd</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>, tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a>);</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;            <span class="keywordflow">if</span> (ret != 1)</div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;            {</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_082: [ If the connection process fails for any reason, tlsio_dowork shall log an error, call on_io_open_complete with the on_io_open_complete_context parameter provided in tlsio_open and IO_OPEN_ERROR, and enter TLSIO_STATE_EX_ERROR. ]*/</span></div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;SSL_set_fd failed&quot;</span>);</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            {</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;                result = 0;</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;            }</div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;        }</div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;    }</div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160; </div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;}</div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160; </div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> dowork_send(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00516"></a><span class="lineno">  516</span>&#160;{</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;    <a class="code" href="structLIST__ITEM__INSTANCE__TAG.html">LIST_ITEM_HANDLE</a> first_pending_io = <a class="code" href="singlylinkedlist_8c.html#a2557a2e240bd38a36a240a8386096507">singlylinkedlist_get_head_item</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a>);</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;    <span class="keywordflow">if</span> (first_pending_io != <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;    {</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;        <a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>* pending_message = (<a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>*)<a class="code" href="singlylinkedlist_8c.html#ae1a394b3f989a78faa77ce2aa11e1c67">singlylinkedlist_item_get_value</a>(first_pending_io);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;        <a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a>* <a class="code" href="structbuffer.html">buffer</a> = ((<a class="code" href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a>*)pending_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">bytes</a>) +</div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;            pending_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ab718424c45bd519566c18e78f3f5c0c1">size</a> - pending_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">unsent_size</a>;</div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;        <span class="keywordtype">int</span> write_result = <a class="code" href="openssl_2openssl_2ssl_8h.html#ac5dea2980f91d3c96203e8e951ad79c7">SSL_write</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>, <a class="code" href="structbuffer.html">buffer</a>, pending_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">unsent_size</a>);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;        <span class="comment">// https://wiki.openssl.org/index.php/Manual:SSL_write(3)</span></div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160; </div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        <span class="keywordflow">if</span> (write_result &gt; 0)</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;        {</div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;            pending_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">unsent_size</a> -= write_result;</div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;            <span class="keywordflow">if</span> (pending_message-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">unsent_size</a> == 0)</div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;            {</div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_091: [ If tlsio_openssl_compact_dowork is able to send all the bytes in an enqueued message, it shall call the messages&#39;s on_send_complete along with its associated callback_context and IO_SEND_OK. ]*/</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;                <span class="comment">// The whole message has been sent successfully</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;                process_and_destroy_head_message(tls_io_instance, IO_SEND_OK);</div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;            }</div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00536"></a><span class="lineno">  536</span>&#160;            {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_093: [ If the TLS connection was not able to send an entire enqueued message at once, subsequent calls to tlsio_dowork shall continue to send the remaining bytes. ]*/</span></div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;                <span class="comment">// Repeat the send on the next pass with the rest of the message</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;                <span class="comment">// This empty else compiles to nothing but helps readability</span></div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            }</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;        }</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;        {</div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;            <span class="comment">// SSL_write returned non-success. It may just be busy, or it may be broken.</span></div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;            <span class="keywordtype">int</span> hard_error = is_hard_ssl_error(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>, write_result);</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;            <span class="keywordflow">if</span> (hard_error != 0)</div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;            {</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_002: [ The phrase &quot;destroy the failed message&quot; means that the adapter shall remove the message from the queue and destroy it after calling the message&#39;s on_send_complete along with its associated callback_context and IO_SEND_ERROR. ]*/</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_005: [ When the adapter enters TLSIO_STATE_EXT_ERROR it shall call the  on_io_error function and pass the on_io_error_context that were supplied in  tlsio_open . ]*/</span></div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_095: [ If the send process fails before sending all of the bytes in an enqueued message, tlsio_dowork shall destroy the failed message and enter TLSIO_STATE_EX_ERROR. ]*/</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                <span class="comment">// This is an unexpected error, and we need to bail out. Probably lost internet connection.</span></div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;                <a class="code" href="xlogging_8h.html#af1461eb0239f8b246b9493167751f4e6">LogInfo</a>(<span class="stringliteral">&quot;Error from SSL_write: %d&quot;</span>, hard_error);</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;                process_and_destroy_head_message(tls_io_instance, IO_SEND_ERROR);</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;            }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;        }</div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;    }</div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;    {</div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_096: [ If there are no enqueued messages available, tlsio_openssl_compact_dowork shall do nothing. ]*/</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;    }</div>
<div class="line"><a name="l00561"></a><span class="lineno">  561</span>&#160;}</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160; </div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> dowork_poll_dns(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;{</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;    <span class="keywordtype">bool</span> dns_is_complete = <a class="code" href="dns__async_8c.html#a6bc968f010fd2fb97f971ed2662bcdd1">dns_async_is_lookup_complete</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a>);</div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160; </div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;    <span class="keywordflow">if</span> (dns_is_complete)</div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;    {</div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;        <a class="code" href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a> host_ipV4_address = <a class="code" href="dns__async_8c.html#aec6fcd05a663ec1ce3049aa815060bc8">dns_async_get_ipv4</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a>);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        <a class="code" href="dns__async_8c.html#ae6b440865355907dff471d002e11975e">dns_async_destroy</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a>);</div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">dns</a> = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;        <span class="keywordflow">if</span> (host_ipV4_address == 0)</div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;        {</div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;            <span class="comment">// Transition to TSLIO_STATE_ERROR</span></div>
<div class="line"><a name="l00575"></a><span class="lineno">  575</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_082: [ If the connection process fails for any reason, tlsio_dowork shall log an error, call on_io_open_complete with the on_io_open_complete_context parameter provided in tlsio_open and IO_OPEN_ERROR, and enter TLSIO_STATE_EX_ERROR. ]*/</span></div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="comment">// The DNS failure has already been logged</span></div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            enter_open_error_state(tls_io_instance);</div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;        }</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;        {</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            <a class="code" href="socket__async_8h.html#a5f4aeeddcf346d420aa128662b37963b">SOCKET_ASYNC_HANDLE</a> sock = <a class="code" href="socket__async_8c.html#afc3f6d86a1eee4e8a5411c68efb01d3d">socket_async_create</a>(host_ipV4_address, tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#afc802ec89778374b6cd77f8d90776ddd">port</a>, <span class="keyword">false</span>, <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            <span class="keywordflow">if</span> (sock &lt; 0)</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            {</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;                <span class="comment">// This is a communication interruption rather than a program bug</span></div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_082: [ If the connection process fails for any reason, tlsio_dowork shall log an error, call on_io_open_complete with the on_io_open_complete_context parameter provided in tlsio_open and IO_OPEN_ERROR, and enter TLSIO_STATE_EX_ERROR. ]*/</span></div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;                <a class="code" href="xlogging_8h.html#af1461eb0239f8b246b9493167751f4e6">LogInfo</a>(<span class="stringliteral">&quot;Could not open the socket&quot;</span>);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;                enter_open_error_state(tls_io_instance);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            }</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            {</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;                <span class="comment">// The socket has been created successfully, so now wait for it to</span></div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;                <span class="comment">// finish the TCP handshake.</span></div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;                tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a> = sock;</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;                tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> = <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a821f2aa54b2d0b60a2a5a370800996cd">TLSIO_STATE_OPENING_WAITING_SOCKET</a>;</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            }</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        }</div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;    }</div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;}</div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160; </div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> dowork_poll_socket(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00601"></a><span class="lineno">  601</span>&#160;{</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;    <span class="keywordtype">bool</span> is_complete;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;    <span class="keywordtype">int</span> result = <a class="code" href="socket__async_8c.html#ab2ecaa7c2a0e3dc893e14520d2c99082">socket_async_is_create_complete</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">sock</a>, &amp;is_complete);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;    <span class="keywordflow">if</span> (result != 0)</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;    {</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;        <span class="comment">// Transition to TSLIO_STATE_ERROR</span></div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;        <a class="code" href="xlogging_8h.html#af1461eb0239f8b246b9493167751f4e6">LogInfo</a>(<span class="stringliteral">&quot;socket_async_is_create_complete failure&quot;</span>);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;        enter_open_error_state(tls_io_instance);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;    }</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;    {</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;        <span class="keywordflow">if</span> (is_complete)</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;        {</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            <span class="comment">// Attempt to transition to TLSIO_STATE_OPENING_WAITING_SSL</span></div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            <span class="keywordtype">int</span> create_ssl_result = create_ssl(tls_io_instance);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            <span class="keywordflow">if</span> (create_ssl_result != 0)</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            {</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;                <span class="comment">// Transition to TSLIO_STATE_ERROR</span></div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;                <span class="comment">// create_ssl already did error logging</span></div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;                enter_open_error_state(tls_io_instance);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            }</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;            {</div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;                tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> = <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a56c79a97f9e20830f5239e6d11623ed1">TLSIO_STATE_OPENING_WAITING_SSL</a>;</div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;            }</div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;        }</div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;    }</div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;}</div>
<div class="line"><a name="l00629"></a><span class="lineno">  629</span>&#160; </div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> dowork_poll_open_ssl(<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance)</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;{</div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;    <span class="comment">// https://www.openssl.org/docs/man1.0.2/ssl/SSL_connect.html</span></div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160; </div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;    <span class="comment">// &quot;If the underlying BIO is non - blocking, SSL_connect() will also </span></div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;    <span class="comment">// return when the underlying BIO could not satisfy the needs of </span></div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;    <span class="comment">// SSL_connect() to continue the handshake, indicating the </span></div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;    <span class="comment">// problem by the return value -1. In this case a call to </span></div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;    <span class="comment">// SSL_get_error() with the return value of SSL_connect() will </span></div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;    <span class="comment">// yield SSL_ERROR_WANT_READ or SSL_ERROR_WANT_WRITE.The calling </span></div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;    <span class="comment">// process then must repeat the call after taking appropriate </span></div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;    <span class="comment">// action to satisfy the needs of SSL_connect().The action </span></div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;    <span class="comment">// depends on the underlying BIO. When using a non - blocking </span></div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;    <span class="comment">// socket, nothing is to be done, but select() can be used to </span></div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;    <span class="comment">// check for the required condition.&quot;</span></div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160; </div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;    <span class="keywordtype">int</span> connect_result = <a class="code" href="openssl_2openssl_2ssl_8h.html#a652e4f10d91b1ba4f994b0c8e19c7585">SSL_connect</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>);</div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160; </div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;    <span class="comment">// The following note applies to the Espressif ESP32 implementation</span></div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;    <span class="comment">// of OpenSSL:</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;    <span class="comment">// The manual pages say that 0 is a failure,</span></div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;    <span class="comment">// but by experiment, 0 is the success result, at least when using</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;    <span class="comment">// SSL_set_fd instead of custom BIO.</span></div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;    <span class="comment">// https://www.openssl.org/docs/man1.0.2/ssl/SSL_connect.html</span></div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;    <span class="comment">// Update: Later versions of the Espressif SDK seem to adhere to the</span></div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;    <span class="comment">// documentation.</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;    <span class="keywordflow">if</span> (connect_result == 1)</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;    {</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_080: [ The tlsio_dowork shall establish a TLS connection using the hostName and port provided during tlsio_open. ]*/</span></div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;        <span class="comment">// Connect succeeded</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> = <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a>;</div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_007: [ The phrase &quot;enter TLSIO_STATE_EXT_OPEN&quot; means the adapter shall call the on_io_open_complete function and pass IO_OPEN_OK and the on_io_open_complete_context that was supplied in tlsio_open . ]*/</span></div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_083: [ If tlsio_dowork successfully opens the TLS connection it shall enter TLSIO_STATE_EX_OPEN. ]*/</span></div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;        tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">on_open_complete</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">on_open_complete_context</a>, IO_OPEN_OK);</div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;    }</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;    {</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;        <span class="keywordtype">int</span> hard_error = is_hard_ssl_error(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">ssl</a>, connect_result);</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;        <span class="keywordflow">if</span> (hard_error != 0)</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;        {</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;            <a class="code" href="xlogging_8h.html#af1461eb0239f8b246b9493167751f4e6">LogInfo</a>(<span class="stringliteral">&quot;Hard error from SSL_connect: %d&quot;</span>, hard_error);</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            enter_open_error_state(tls_io_instance);</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;        }</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;    }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;}</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160; </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;<span class="keyword">static</span> <span class="keywordtype">void</span> tlsio_openssl_dowork(<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tls_io)</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;{</div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;    <span class="keywordflow">if</span> (tls_io == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00679"></a><span class="lineno">  679</span>&#160;    {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_070: [ If the tlsio_handle parameter is NULL, tlsio_dowork shall do nothing except log an error. ]*/</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tlsio&quot;</span>);</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;    }</div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;    {</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;        <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance = (<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>*)tls_io;</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160; </div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        <span class="comment">// This switch statement handles all of the state transitions during the opening process</span></div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;        <span class="keywordflow">switch</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a>)</div>
<div class="line"><a name="l00689"></a><span class="lineno">  689</span>&#160;        {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">TLSIO_STATE_CLOSED</a>:</div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_075: [ If the adapter is in TLSIO_STATE_EXT_CLOSED then  tlsio_dowork  shall do nothing. ]*/</span></div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="comment">// Waiting to be opened, nothing to do</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a88599a6fae5c08edccc76a16ac49b25d">TLSIO_STATE_OPENING_WAITING_DNS</a>:</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            dowork_poll_dns(tls_io_instance);</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a821f2aa54b2d0b60a2a5a370800996cd">TLSIO_STATE_OPENING_WAITING_SOCKET</a>:</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;            dowork_poll_socket(tls_io_instance);</div>
<div class="line"><a name="l00699"></a><span class="lineno">  699</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a56c79a97f9e20830f5239e6d11623ed1">TLSIO_STATE_OPENING_WAITING_SSL</a>:</div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;            dowork_poll_open_ssl(tls_io_instance);</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a>:</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;            dowork_read(tls_io_instance);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            dowork_send(tls_io_instance);</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        <span class="keywordflow">case</span> <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25">TLSIO_STATE_ERROR</a>:</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_071: [ If the adapter is in TLSIO_STATE_EXT_ERROR then tlsio_dowork shall do nothing. ]*/</span></div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;            <span class="comment">// There&#39;s nothing valid to do here but wait to be retried</span></div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00711"></a><span class="lineno">  711</span>&#160;        <span class="keywordflow">default</span>:</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Unexpected internal tlsio state&quot;</span>);</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;        }</div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;    }</div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;}</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160; </div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> tlsio_openssl_send_async(<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tls_io, <span class="keyword">const</span> <span class="keywordtype">void</span>* <a class="code" href="structbuffer.html">buffer</a>, <span class="keywordtype">size_t</span> <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>, <a class="code" href="xio_8h.html#a9275b2e616c2abadf629ca3d94d7871f">ON_SEND_COMPLETE</a> on_send_complete, <span class="keywordtype">void</span>* callback_context)</div>
<div class="line"><a name="l00719"></a><span class="lineno">  719</span>&#160;{</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;    <span class="keywordflow">if</span> (on_send_complete == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;    {</div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_062: [ If the on_send_complete is NULL, tlsio_openssl_compact_send shall log the error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL on_send_complete&quot;</span>);</div>
<div class="line"><a name="l00726"></a><span class="lineno">  726</span>&#160;    }</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;    {</div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;        <span class="keywordflow">if</span> (tls_io == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;        {</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="comment">/* Codes_SRS_TLSIO_30_060: [ If the tlsio_handle parameter is NULL, tlsio_openssl_compact_send shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tlsio&quot;</span>);</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;        }</div>
<div class="line"><a name="l00735"></a><span class="lineno">  735</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="structbuffer.html">buffer</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;            {</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;                <span class="comment">/* Codes_SRS_TLSIO_30_061: [ If the buffer is NULL, tlsio_openssl_compact_send shall log the error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL buffer&quot;</span>);</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            }</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;            {</div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a> == 0)</div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;                {</div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;                    <span class="comment">/* Codes_SRS_TLSIO_30_067: [ If the  size  is 0,  tlsio_send  shall log the error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00749"></a><span class="lineno">  749</span>&#160;                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;0 size&quot;</span>);</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;                }</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;                {</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;                    <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance = (<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>*)tls_io;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;                    <span class="keywordflow">if</span> (tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">tlsio_state</a> != <a class="code" href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a>)</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;                    {</div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;                        <span class="comment">/* Codes_SRS_TLSIO_30_065: [ If tlsio_openssl_compact_open has not been called or the opening process has not been completed, tlsio_openssl_compact_send shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;                        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;                        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;tlsio_openssl_send_async without a prior successful open&quot;</span>);</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;                    }</div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;                    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;                    {</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;                        <a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>* pending_transmission = (<a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<span class="keyword">sizeof</span>(<a class="code" href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a>));</div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;                        <span class="keywordflow">if</span> (pending_transmission == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;                        {</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;                            <span class="comment">/* Codes_SRS_TLSIO_30_064: [ If the supplied message cannot be enqueued for transmission, tlsio_openssl_compact_send shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;                            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;                            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;malloc failed&quot;</span>);</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;                        }</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;                        {</div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;                            <span class="comment">/* Codes_SRS_TLSIO_30_063: [ The tlsio_openssl_compact_send shall enqueue for transmission the on_send_complete, the callback_context, the size, and the contents of buffer. ]*/</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;                            pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">bytes</a> = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)<a class="code" href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a>(<a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>);</div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160; </div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;                            <span class="keywordflow">if</span> (pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">bytes</a> == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00775"></a><span class="lineno">  775</span>&#160;                            {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;                                <span class="comment">/* Codes_SRS_TLSIO_30_064: [ If the supplied message cannot be enqueued for transmission, tlsio_openssl_compact_send shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;                                <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;malloc failed&quot;</span>);</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;                                <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(pending_transmission);</div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;                                result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;                            }</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;                            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;                            {</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;                                pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ab718424c45bd519566c18e78f3f5c0c1">size</a> = <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>;</div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;                                pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">unsent_size</a> = <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;                                pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#ad2f51b61f99c4886dc00607e076b50ba">on_send_complete</a> = on_send_complete;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160;                                pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2300ca402b1a57a0be31b4b73d9e503b">callback_context</a> = callback_context;</div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;                                (<a class="code" href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a>)memcpy(pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">bytes</a>, <a class="code" href="structbuffer.html">buffer</a>, <a class="code" href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a>);</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160; </div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;                                <span class="keywordflow">if</span> (<a class="code" href="singlylinkedlist_8c.html#a42bf74145425439976828ec33f4642e9">singlylinkedlist_add</a>(tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">pending_transmission_list</a>, pending_transmission) == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;                                {</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                                    <span class="comment">/* Codes_SRS_TLSIO_30_064: [ If the supplied message cannot be enqueued for transmission, tlsio_openssl_compact_send shall log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                                    <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Unable to add socket to pending list.&quot;</span>);</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                                    <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(pending_transmission-&gt;<a class="code" href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">bytes</a>);</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                                    <a class="code" href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a>(pending_transmission);</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                                    result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                                }</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;                                <span class="keywordflow">else</span></div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;                                {</div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;                                    <span class="comment">/* Codes_SRS_TLSIO_30_063: [ On success,  tlsio_send  shall enqueue for transmission the  on_send_complete , the  callback_context , the  size , and the contents of  buffer  and then return 0. ]*/</span></div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                                    dowork_send(tls_io_instance);</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;                                    result = 0;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;                                }</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;                            }</div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;                        }</div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;                    }</div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                }</div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            }</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_066: [ On failure, on_send_complete shall not be called. ]*/</span></div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;    }</div>
<div class="line"><a name="l00811"></a><span class="lineno">  811</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;}</div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160; </div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;<span class="keyword">static</span> <span class="keywordtype">int</span> tlsio_openssl_setoption(<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tls_io, <span class="keyword">const</span> <span class="keywordtype">char</span>* optionName, <span class="keyword">const</span> <span class="keywordtype">void</span>* <a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>)</div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;{</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;    <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance = (<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>*)tls_io;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;    <span class="comment">/* Codes_SRS_TLSIO_30_120: [ If the tlsio_handle parameter is NULL, tlsio_openssl_compact_setoption shall do nothing except log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;    <span class="keywordtype">int</span> result;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;    {</div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tlsio&quot;</span>);</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;        result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;    }</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;    {</div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_121: [ If the optionName parameter is NULL, tlsio_openssl_compact_setoption shall do nothing except log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_30_122: [ If the value parameter is NULL, tlsio_openssl_compact_setoption shall do nothing except log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;        <span class="comment">/* Codes_SRS_TLSIO_OPENSSL_COMPACT_30_520 [ The tlsio_setoption shall do nothing and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00829"></a><span class="lineno">  829</span>&#160;        <a class="code" href="tlsio__options_8h.html#a4e7f45c8052fd0627d0e4f2bccc44c5a">TLSIO_OPTIONS_RESULT</a> options_result = <a class="code" href="tlsio__options_8h.html#a86406f7c310560e3cc5a88d82c177bd2">tlsio_options_set</a>(&amp;tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a6e11e67d32ba761c7ec8d53940a1f03d">options</a>, optionName, <a class="code" href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a>);</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;        <span class="keywordflow">if</span> (options_result != <a class="code" href="tlsio__options_8h.html#af3d9edb55c69f085b98072676a7eaf83a4a43d2e6539859a458accc6e6d3af752">TLSIO_OPTIONS_RESULT_SUCCESS</a>)</div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;        {</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;Failed tlsio_options_set&quot;</span>);</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;            result = <a class="code" href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a>;</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;        }</div>
<div class="line"><a name="l00835"></a><span class="lineno">  835</span>&#160;        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;        {</div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;            result = 0;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;        }</div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;    }</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;}</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160; </div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;<span class="comment">/* Codes_SRS_TLSIO_OPENSSL_COMPACT_30_560: [ The  tlsio_retrieveoptions  shall do nothing and return an empty options handler. ]*/</span></div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;<span class="keyword">static</span> <a class="code" href="structOPTIONHANDLER__HANDLE__DATA__TAG.html">OPTIONHANDLER_HANDLE</a> tlsio_openssl_retrieveoptions(<a class="code" href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a> tls_io)</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;{</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;    <a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>* tls_io_instance = (<a class="code" href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE</a>*)tls_io;</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;    <span class="comment">/* Codes_SRS_TLSIO_30_160: [ If the tlsio_handle parameter is NULL, tlsio_openssl_compact_retrieveoptions shall do nothing except log an error and return FAILURE. ]*/</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;    <a class="code" href="structOPTIONHANDLER__HANDLE__DATA__TAG.html">OPTIONHANDLER_HANDLE</a> result;</div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;    <span class="keywordflow">if</span> (tls_io_instance == <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;    {</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;        <a class="code" href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a>(<span class="stringliteral">&quot;NULL tlsio&quot;</span>);</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;        result = <a class="code" href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;    }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;    <span class="keywordflow">else</span></div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;    {</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;        result = <a class="code" href="tlsio__options_8h.html#a4776b44c506e9a498ba2a3b59c8a40c4">tlsio_options_retrieve_options</a>(&amp;tls_io_instance-&gt;<a class="code" href="structTLS__IO__INSTANCE__TAG.html#a6e11e67d32ba761c7ec8d53940a1f03d">options</a>, tlsio_openssl_setoption);</div>
<div class="line"><a name="l00857"></a><span class="lineno">  857</span>&#160;    }</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;    <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;}</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160; </div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;<span class="comment">/* Codes_SRS_TLSIO_30_008: [ The tlsio_get_interface_description shall return the VTable IO_INTERFACE_DESCRIPTION. ]*/</span></div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;<span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="structIO__INTERFACE__DESCRIPTION__TAG.html">IO_INTERFACE_DESCRIPTION</a> tlsio_openssl_interface_description =</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;{</div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;    tlsio_openssl_retrieveoptions,</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;    tlsio_openssl_create,</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;    tlsio_openssl_destroy,</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;    tlsio_openssl_open_async,</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;    tlsio_openssl_close_async,</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;    tlsio_openssl_send_async,</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;    tlsio_openssl_dowork,</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;    tlsio_openssl_setoption</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;};</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160; </div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;<span class="comment">/* Codes_SRS_TLSIO_30_001: [ The tlsio_openssl_compact shall implement and export all the Concrete functions in the VTable IO_INTERFACE_DESCRIPTION defined in the xio.h. ]*/</span></div>
<div class="line"><a name="l00875"></a><span class="lineno"><a class="line" href="tlsio__openssl__compact_8c.html#a5e76afab2312577818d2fc94c12affe3">  875</a></span>&#160;<span class="keyword">const</span> <a class="code" href="structIO__INTERFACE__DESCRIPTION__TAG.html">IO_INTERFACE_DESCRIPTION</a>* <a class="code" href="tlsio__openssl__compact_8c.html#a5e76afab2312577818d2fc94c12affe3">tlsio_pal_get_interface_description</a>(<span class="keywordtype">void</span>)</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;{</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;    <span class="keywordflow">return</span> &amp;tlsio_openssl_interface_description;</div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;}</div>
</div><!-- fragment --></div><!-- contents -->
<div class="ttc" id="amacro__utils_8h_html_aa8c798c7579b5c5a23a87b213f9accd6"><div class="ttname"><a href="macro__utils_8h.html#aa8c798c7579b5c5a23a87b213f9accd6">__FAILURE__</a></div><div class="ttdeci">#define __FAILURE__</div><div class="ttdef"><b>Definition:</b> <a href="macro__utils_8h_source.html#l00019">macro_utils.h:18</a></div></div>
<div class="ttc" id="asocket__async_8c_html_ada7ff9d1133d9191839a54bf73304739"><div class="ttname"><a href="socket__async_8c.html#ada7ff9d1133d9191839a54bf73304739">socket_async_destroy</a></div><div class="ttdeci">void socket_async_destroy(SOCKET_ASYNC_HANDLE sock)</div><div class="ttdef"><b>Definition:</b> <a href="socket__async_8c_source.html#l00333">socket_async.c:333</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_acd6601038ddd6c6e00807a290dcc1b71"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#acd6601038ddd6c6e00807a290dcc1b71">TLS_IO_INSTANCE_TAG::ssl_context</a></div><div class="ttdeci">SSL_CTX * ssl_context</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00065">tlsio_openssl_compact.c:65</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9ad28b6b6e3e658fb9433de0eec9f4e257">TLSIO_STATE_OPEN</a></div><div class="ttdeci">@ TLSIO_STATE_OPEN</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00043">tlsio_openssl_compact.c:43</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_a0a3d2e0a57edaf63aae1c954a1f004cc"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#a0a3d2e0a57edaf63aae1c954a1f004cc">TLS_IO_INSTANCE_TAG::on_io_error_context</a></div><div class="ttdeci">void * on_io_error_context</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00062">tlsio_openssl_compact.c:62</a></div></div>
<div class="ttc" id="atlsio__options_8h_html_a4776b44c506e9a498ba2a3b59c8a40c4"><div class="ttname"><a href="tlsio__options_8h.html#a4776b44c506e9a498ba2a3b59c8a40c4">tlsio_options_retrieve_options</a></div><div class="ttdeci">OPTIONHANDLER_HANDLE tlsio_options_retrieve_options(TLSIO_OPTIONS *options, pfSetOption setOption)</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__options_8c_source.html#l00242">tlsio_options.c:242</a></div></div>
<div class="ttc" id="atlsio__options_8h_html_a115375f6da80364308b8f10cf8406510"><div class="ttname"><a href="tlsio__options_8h.html#a115375f6da80364308b8f10cf8406510">tlsio_options_initialize</a></div><div class="ttdeci">void tlsio_options_initialize(TLSIO_OPTIONS *options, int option_caps)</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__options_8c_source.html#l00014">tlsio_options.c:14</a></div></div>
<div class="ttc" id="astdint_8h_html_a281b4b5562236420969a830503b0ba19"><div class="ttname"><a href="stdint_8h.html#a281b4b5562236420969a830503b0ba19">uint16_t</a></div><div class="ttdeci">__uint16_t uint16_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00033">stdint.h:33</a></div></div>
<div class="ttc" id="adns__async_8c_html_a7147a57523cf7045e5d892bc20bdbc70"><div class="ttname"><a href="dns__async_8c.html#a7147a57523cf7045e5d892bc20bdbc70">dns_async_create</a></div><div class="ttdeci">DNS_ASYNC_HANDLE dns_async_create(const char *hostname, DNS_ASYNC_OPTIONS *options)</div><div class="ttdef"><b>Definition:</b> <a href="dns__async_8c_source.html#l00035">dns_async.c:35</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_a0f6fc05b9e28a1054693052fb103765d"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#a0f6fc05b9e28a1054693052fb103765d">MAX_VALID_PORT</a></div><div class="ttdeci">#define MAX_VALID_PORT</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00031">tlsio_openssl_compact.c:30</a></div></div>
<div class="ttc" id="asocket__async_8c_html_afc3f6d86a1eee4e8a5411c68efb01d3d"><div class="ttname"><a href="socket__async_8c.html#afc3f6d86a1eee4e8a5411c68efb01d3d">socket_async_create</a></div><div class="ttdeci">SOCKET_ASYNC_HANDLE socket_async_create(uint32_t serverIPv4, uint16_t port, bool is_UDP, SOCKET_ASYNC_OPTIONS_HANDLE options)</div><div class="ttdef"><b>Definition:</b> <a href="socket__async_8c_source.html#l00023">socket_async.c:23</a></div></div>
<div class="ttc" id="astructPENDING__TRANSMISSION_html_a2300ca402b1a57a0be31b4b73d9e503b"><div class="ttname"><a href="structPENDING__TRANSMISSION.html#a2300ca402b1a57a0be31b4b73d9e503b">PENDING_TRANSMISSION::callback_context</a></div><div class="ttdeci">void * callback_context</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00027">tlsio_openssl_compact.c:27</a></div></div>
<div class="ttc" id="acrt__abstractions_8c_html_a867b1509b0b0a16b1bae1d829679c484"><div class="ttname"><a href="crt__abstractions_8c.html#a867b1509b0b0a16b1bae1d829679c484">mallocAndStrcpy_s</a></div><div class="ttdeci">int mallocAndStrcpy_s(char **destination, const char *source)</div><div class="ttdef"><b>Definition:</b> <a href="crt__abstractions_8c_source.html#l00681">crt_abstractions.c:681</a></div></div>
<div class="ttc" id="assl__code_8h_html_a633be46175f7c4094aaace11fb248c66"><div class="ttname"><a href="ssl__code_8h.html#a633be46175f7c4094aaace11fb248c66">SSL_ERROR_WANT_READ</a></div><div class="ttdeci">#define SSL_ERROR_WANT_READ</div><div class="ttdef"><b>Definition:</b> <a href="ssl__code_8h_source.html#l00054">ssl_code.h:53</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_ac9d6d11ce6d00fd2c257d38238c133b3"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#ac9d6d11ce6d00fd2c257d38238c133b3">SSL_get_error</a></div><div class="ttdeci">int SSL_get_error(const SSL *ssl, int ret_code)</div><div class="ttdoc">get SSL error code</div></div>
<div class="ttc" id="adns__async_8c_html_a6bc968f010fd2fb97f971ed2662bcdd1"><div class="ttname"><a href="dns__async_8c.html#a6bc968f010fd2fb97f971ed2662bcdd1">dns_async_is_lookup_complete</a></div><div class="ttdeci">bool dns_async_is_lookup_complete(DNS_ASYNC_HANDLE dns_in)</div><div class="ttdef"><b>Definition:</b> <a href="dns__async_8c_source.html#l00075">dns_async.c:75</a></div></div>
<div class="ttc" id="axio_8h_html_a9275b2e616c2abadf629ca3d94d7871f"><div class="ttname"><a href="xio_8h.html#a9275b2e616c2abadf629ca3d94d7871f">ON_SEND_COMPLETE</a></div><div class="ttdeci">void(* ON_SEND_COMPLETE)(void *context, IO_SEND_RESULT send_result)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8h_source.html#l00037">xio.h:37</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html">ssl.h</a></div></div>
<div class="ttc" id="aRPSL_8txt_html_ae227cfd33a5880ffce840d383c2fbff3"><div class="ttname"><a href="RPSL_8txt.html#ae227cfd33a5880ffce840d383c2fbff3">free</a></div><div class="ttdeci">Conditions &amp;Restrictions Subject to the terms and conditions of this Licensor hereby grants effective on the date You accept this a royalty free</div><div class="ttdef"><b>Definition:</b> <a href="RPSL_8txt_source.html#l00105">RPSL.txt:105</a></div></div>
<div class="ttc" id="astructPENDING__TRANSMISSION_html"><div class="ttname"><a href="structPENDING__TRANSMISSION.html">PENDING_TRANSMISSION</a></div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00021">tlsio_openssl_compact.c:22</a></div></div>
<div class="ttc" id="assl__code_8h_html_affda963e1494dc339c8ab9287f4c0b3c"><div class="ttname"><a href="ssl__code_8h.html#affda963e1494dc339c8ab9287f4c0b3c">SSL_ERROR_WANT_WRITE</a></div><div class="ttdeci">#define SSL_ERROR_WANT_WRITE</div><div class="ttdef"><b>Definition:</b> <a href="ssl__code_8h_source.html#l00055">ssl_code.h:54</a></div></div>
<div class="ttc" id="axlogging_8h_html_af1461eb0239f8b246b9493167751f4e6"><div class="ttname"><a href="xlogging_8h.html#af1461eb0239f8b246b9493167751f4e6">LogInfo</a></div><div class="ttdeci">#define LogInfo(FORMAT,...)</div><div class="ttdef"><b>Definition:</b> <a href="xlogging_8h_source.html#l00119">xlogging.h:118</a></div></div>
<div class="ttc" id="astructssl__ctx__st_html"><div class="ttname"><a href="structssl__ctx__st.html">ssl_ctx_st</a></div><div class="ttdef"><b>Definition:</b> <a href="ssl__types_8h_source.html#l00169">ssl_types.h:170</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_a5e76afab2312577818d2fc94c12affe3"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#a5e76afab2312577818d2fc94c12affe3">tlsio_pal_get_interface_description</a></div><div class="ttdeci">const IO_INTERFACE_DESCRIPTION * tlsio_pal_get_interface_description(void)</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00875">tlsio_openssl_compact.c:875</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_a1874e8b72da196e3300b265937aa6da4"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#a1874e8b72da196e3300b265937aa6da4">SSL_new</a></div><div class="ttdeci">SSL * SSL_new(SSL_CTX *ctx)</div><div class="ttdoc">create a SSL</div></div>
<div class="ttc" id="atlsio__options_8h_html_a4e7f45c8052fd0627d0e4f2bccc44c5a"><div class="ttname"><a href="tlsio__options_8h.html#a4e7f45c8052fd0627d0e4f2bccc44c5a">TLSIO_OPTIONS_RESULT</a></div><div class="ttdeci">enum TLSIO_OPTIONS_RESULT_TAG TLSIO_OPTIONS_RESULT</div></div>
<div class="ttc" id="adns__async_8c_html_aec6fcd05a663ec1ce3049aa815060bc8"><div class="ttname"><a href="dns__async_8c.html#aec6fcd05a663ec1ce3049aa815060bc8">dns_async_get_ipv4</a></div><div class="ttdeci">uint32_t dns_async_get_ipv4(DNS_ASYNC_HANDLE dns_in)</div><div class="ttdef"><b>Definition:</b> <a href="dns__async_8c_source.html#l00168">dns_async.c:168</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_acadb2f8d6cb99e125d3240d0ef9427f9a88599a6fae5c08edccc76a16ac49b25d"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a88599a6fae5c08edccc76a16ac49b25d">TLSIO_STATE_OPENING_WAITING_DNS</a></div><div class="ttdeci">@ TLSIO_STATE_OPENING_WAITING_DNS</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00040">tlsio_openssl_compact.c:40</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_af9f4071fbcf354fb1d603cba7d0beb43"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#af9f4071fbcf354fb1d603cba7d0beb43">TLS_IO_INSTANCE_TAG::hostname</a></div><div class="ttdeci">char * hostname</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00068">tlsio_openssl_compact.c:68</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_afe8c2dc5a7d372b7befabceb17502fa9"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#afe8c2dc5a7d372b7befabceb17502fa9">SSL_CTX_new</a></div><div class="ttdeci">SSL_CTX * SSL_CTX_new(const SSL_METHOD *method)</div><div class="ttdoc">create a SSL context</div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_a7c34906d8cc92d3fd51e9d454fc91915"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#a7c34906d8cc92d3fd51e9d454fc91915">TLS_IO_INSTANCE_TAG::ssl</a></div><div class="ttdeci">SSL * ssl</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00064">tlsio_openssl_compact.c:64</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html">TLS_IO_INSTANCE_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00056">tlsio_openssl_compact.c:57</a></div></div>
<div class="ttc" id="adns__async_8h_html_ab6c695ab47c2f56276485386c0ddd78b"><div class="ttname"><a href="dns__async_8h.html#ab6c695ab47c2f56276485386c0ddd78b">DNS_ASYNC_HANDLE</a></div><div class="ttdeci">void * DNS_ASYNC_HANDLE</div><div class="ttdef"><b>Definition:</b> <a href="dns__async_8h_source.html#l00018">dns_async.h:18</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_a96970218d322b85be92b0587300a0a30"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#a96970218d322b85be92b0587300a0a30">TLS_IO_INSTANCE_TAG::on_open_complete_context</a></div><div class="ttdeci">void * on_open_complete_context</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00063">tlsio_openssl_compact.c:63</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_ac7314201431db6a0a996e4d8b66301ee"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#ac7314201431db6a0a996e4d8b66301ee">is_an_opening_state</a></div><div class="ttdeci">bool is_an_opening_state(TLSIO_STATE state)</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00047">tlsio_openssl_compact.c:47</a></div></div>
<div class="ttc" id="axio_8h_html_a2761e39867e9372423f77921fc5fd26d"><div class="ttname"><a href="xio_8h.html#a2761e39867e9372423f77921fc5fd26d">ON_IO_ERROR</a></div><div class="ttdeci">void(* ON_IO_ERROR)(void *context)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8h_source.html#l00040">xio.h:40</a></div></div>
<div class="ttc" id="asinglylinkedlist_8c_html_a2557a2e240bd38a36a240a8386096507"><div class="ttname"><a href="singlylinkedlist_8c.html#a2557a2e240bd38a36a240a8386096507">singlylinkedlist_get_head_item</a></div><div class="ttdeci">LIST_ITEM_HANDLE singlylinkedlist_get_head_item(SINGLYLINKEDLIST_HANDLE list)</div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00155">singlylinkedlist.c:155</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_a6e11e67d32ba761c7ec8d53940a1f03d"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#a6e11e67d32ba761c7ec8d53940a1f03d">TLS_IO_INSTANCE_TAG::options</a></div><div class="ttdeci">TLSIO_OPTIONS options</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00072">tlsio_openssl_compact.c:72</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a000501845ad8d199f5ba633ed22d0877">TLSIO_STATE_CLOSED</a></div><div class="ttdeci">@ TLSIO_STATE_CLOSED</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00039">tlsio_openssl_compact.c:39</a></div></div>
<div class="ttc" id="astructssl__st_html"><div class="ttname"><a href="structssl__st.html">ssl_st</a></div><div class="ttdef"><b>Definition:</b> <a href="ssl__types_8h_source.html#l00198">ssl_types.h:199</a></div></div>
<div class="ttc" id="asinglylinkedlist_8c_html_a4989115eb394f221a8af5db9a2873d1b"><div class="ttname"><a href="singlylinkedlist_8c.html#a4989115eb394f221a8af5db9a2873d1b">singlylinkedlist_remove</a></div><div class="ttdeci">int singlylinkedlist_remove(SINGLYLINKEDLIST_HANDLE list, LIST_ITEM_HANDLE item)</div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00102">singlylinkedlist.c:102</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_acadb2f8d6cb99e125d3240d0ef9427f9a56c79a97f9e20830f5239e6d11623ed1"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a56c79a97f9e20830f5239e6d11623ed1">TLSIO_STATE_OPENING_WAITING_SSL</a></div><div class="ttdeci">@ TLSIO_STATE_OPENING_WAITING_SSL</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00042">tlsio_openssl_compact.c:42</a></div></div>
<div class="ttc" id="atlsio__options_8h_html_ae9460d63e5798643cd727939bec0871c"><div class="ttname"><a href="tlsio__options_8h.html#ae9460d63e5798643cd727939bec0871c">tlsio_options_release_resources</a></div><div class="ttdeci">void tlsio_options_release_resources(TLSIO_OPTIONS *options)</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__options_8c_source.html#l00057">tlsio_options.c:57</a></div></div>
<div class="ttc" id="asinglylinkedlist_8c_html_a42bf74145425439976828ec33f4642e9"><div class="ttname"><a href="singlylinkedlist_8c.html#a42bf74145425439976828ec33f4642e9">singlylinkedlist_add</a></div><div class="ttdeci">LIST_ITEM_HANDLE singlylinkedlist_add(SINGLYLINKEDLIST_HANDLE list, const void *item)</div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00055">singlylinkedlist.c:55</a></div></div>
<div class="ttc" id="atlsio__options_8h_html_af3d9edb55c69f085b98072676a7eaf83a4a43d2e6539859a458accc6e6d3af752"><div class="ttname"><a href="tlsio__options_8h.html#af3d9edb55c69f085b98072676a7eaf83a4a43d2e6539859a458accc6e6d3af752">TLSIO_OPTIONS_RESULT_SUCCESS</a></div><div class="ttdeci">@ TLSIO_OPTIONS_RESULT_SUCCESS</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__options_8h_source.html#l00035">tlsio_options.h:35</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a33c70415d416f2b74c7b4911d4e50b25">TLSIO_STATE_ERROR</a></div><div class="ttdeci">@ TLSIO_STATE_ERROR</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00044">tlsio_openssl_compact.c:44</a></div></div>
<div class="ttc" id="asinglylinkedlist_8h_html"><div class="ttname"><a href="singlylinkedlist_8h.html">singlylinkedlist.h</a></div></div>
<div class="ttc" id="astructTLSIO__CONFIG__TAG_html_ab54037cac27a086058ebb5bd9c2eedc1"><div class="ttname"><a href="structTLSIO__CONFIG__TAG.html#ab54037cac27a086058ebb5bd9c2eedc1">TLSIO_CONFIG_TAG::hostname</a></div><div class="ttdeci">const char * hostname</div><div class="ttdef"><b>Definition:</b> <a href="tlsio_8h_source.html#l00015">tlsio.h:15</a></div></div>
<div class="ttc" id="astructIO__INTERFACE__DESCRIPTION__TAG_html"><div class="ttname"><a href="structIO__INTERFACE__DESCRIPTION__TAG.html">IO_INTERFACE_DESCRIPTION_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="xio_8h_source.html#l00052">xio.h:53</a></div></div>
<div class="ttc" id="asocket__async_8c_html_ab2ecaa7c2a0e3dc893e14520d2c99082"><div class="ttname"><a href="socket__async_8c.html#ab2ecaa7c2a0e3dc893e14520d2c99082">socket_async_is_create_complete</a></div><div class="ttdeci">int socket_async_is_create_complete(SOCKET_ASYNC_HANDLE sock, bool *is_complete)</div><div class="ttdef"><b>Definition:</b> <a href="socket__async_8c_source.html#l00160">socket_async.c:160</a></div></div>
<div class="ttc" id="atlsio__options_8h_html_a86406f7c310560e3cc5a88d82c177bd2"><div class="ttname"><a href="tlsio__options_8h.html#a86406f7c310560e3cc5a88d82c177bd2">tlsio_options_set</a></div><div class="ttdeci">TLSIO_OPTIONS_RESULT tlsio_options_set(TLSIO_OPTIONS *options, const char *optionName, const void *value)</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__options_8c_source.html#l00131">tlsio_options.c:131</a></div></div>
<div class="ttc" id="adef_8h_html_a070d2ce7b6bb7e5c05602aa8c308d0c4"><div class="ttname"><a href="def_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a></div><div class="ttdeci">#define NULL</div><div class="ttdef"><b>Definition:</b> <a href="def_8h_source.html#l00071">def.h:70</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_af81df084101e36976fcdccad12bb9ca5"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#af81df084101e36976fcdccad12bb9ca5">TLS_IO_INSTANCE_TAG::on_bytes_received_context</a></div><div class="ttdeci">void * on_bytes_received_context</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00061">tlsio_openssl_compact.c:61</a></div></div>
<div class="ttc" id="aArduino-IRremote_2LICENSE_8txt_html_a3b083519fd2b41d83363afcfd5ebad9d"><div class="ttname"><a href="Arduino-IRremote_2LICENSE_8txt.html#a3b083519fd2b41d83363afcfd5ebad9d">void</a></div><div class="ttdeci">if the work is an executable linked with the with the complete machine readable work that uses the as object code and or source so that the user can modify the Library and then relink to produce a modified executable containing the modified rather than copying library functions into the if the user installs as long as the modified version is interface compatible with the version that the work was made with c Accompany the work with a written valid for at least three to give the same user the materials specified in for a charge no more than the cost of performing this distribution d If distribution of the work is made by offering access to copy from a designated offer equivalent access to copy the above specified materials from the same place e Verify that the user has already received a copy of these materials or that you have already sent this user a copy For an the required form of the work that uses the Library must include any data and utility programs needed for reproducing the executable from it as a special the materials to be distributed need not include anything that is normally and so on of the operating system on which the executable unless that component itself accompanies the executable It may happen that this requirement contradicts the license restrictions of other proprietary libraries that do not normally accompany the operating system Such a contradiction means you cannot use both them and the Library together in an executable that you distribute You may place library facilities that are a work based on the Library side by side in a single library together with other library facilities not covered by this and distribute such a combined provided that the separate distribution of the work based on the Library and of the other library facilities is otherwise and provided that you do these two uncombined with any other library facilities This must be distributed under the terms of the Sections above b Give prominent notice with the combined library of the fact that part of it is a work based on the and explaining where to find the accompanying uncombined form of the same work You may not link or distribute the Library except as expressly provided under this License Any attempt otherwise to link or distribute the Library is void</div><div class="ttdef"><b>Definition:</b> <a href="Arduino-IRremote_2LICENSE_8txt_source.html#l00353">LICENSE.txt:353</a></div></div>
<div class="ttc" id="asinglylinkedlist_8c_html_ae1a394b3f989a78faa77ce2aa11e1c67"><div class="ttname"><a href="singlylinkedlist_8c.html#ae1a394b3f989a78faa77ce2aa11e1c67">singlylinkedlist_item_get_value</a></div><div class="ttdeci">const void * singlylinkedlist_item_get_value(LIST_ITEM_HANDLE item_handle)</div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00196">singlylinkedlist.c:196</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_ae0e50e786873d10a981ab172f82de723"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#ae0e50e786873d10a981ab172f82de723">TLS_IO_INSTANCE_TAG::on_open_complete</a></div><div class="ttdeci">ON_IO_OPEN_COMPLETE on_open_complete</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00060">tlsio_openssl_compact.c:60</a></div></div>
<div class="ttc" id="astructPENDING__TRANSMISSION_html_a2c5f6c0ff0704ea621e5bd65f5d41dd3"><div class="ttname"><a href="structPENDING__TRANSMISSION.html#a2c5f6c0ff0704ea621e5bd65f5d41dd3">PENDING_TRANSMISSION::bytes</a></div><div class="ttdeci">unsigned char * bytes</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00023">tlsio_openssl_compact.c:23</a></div></div>
<div class="ttc" id="astructbuffer_html"><div class="ttname"><a href="structbuffer.html">buffer</a></div><div class="ttdef"><b>Definition:</b> <a href="zconf_8lex_8c_source.html#l01095">zconf.lex.c:1095</a></div></div>
<div class="ttc" id="aunity__fixture__malloc__overrides_8h_html_acf143577800376dd931c059ecc61ba06"><div class="ttname"><a href="unity__fixture__malloc__overrides_8h.html#acf143577800376dd931c059ecc61ba06">malloc</a></div><div class="ttdeci">#define malloc</div><div class="ttdef"><b>Definition:</b> <a href="unity__fixture__malloc__overrides_8h_source.html#l00038">unity_fixture_malloc_overrides.h:37</a></div></div>
<div class="ttc" id="astdint_8h_html"><div class="ttname"><a href="stdint_8h.html">stdint.h</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_abf395d07967850b05e8cd39627670a13"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#abf395d07967850b05e8cd39627670a13">TLS_IO_INSTANCE_TAG::pending_transmission_list</a></div><div class="ttdeci">SINGLYLINKEDLIST_HANDLE pending_transmission_list</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00071">tlsio_openssl_compact.c:71</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_adfe1bc081fa47b1d626cdd43c6449c2b"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#adfe1bc081fa47b1d626cdd43c6449c2b">SSL_shutdown</a></div><div class="ttdeci">int SSL_shutdown(SSL *ssl)</div><div class="ttdoc">shutdown the connection</div></div>
<div class="ttc" id="astructPENDING__TRANSMISSION_html_ab4664776ffc91dbaae338410a07bf0d0"><div class="ttname"><a href="structPENDING__TRANSMISSION.html#ab4664776ffc91dbaae338410a07bf0d0">PENDING_TRANSMISSION::unsent_size</a></div><div class="ttdeci">size_t unsent_size</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00025">tlsio_openssl_compact.c:25</a></div></div>
<div class="ttc" id="asocket__async_8h_html_a5f4aeeddcf346d420aa128662b37963b"><div class="ttname"><a href="socket__async_8h.html#a5f4aeeddcf346d420aa128662b37963b">SOCKET_ASYNC_HANDLE</a></div><div class="ttdeci">int SOCKET_ASYNC_HANDLE</div><div class="ttdef"><b>Definition:</b> <a href="socket__async_8h_source.html#l00040">socket_async.h:40</a></div></div>
<div class="ttc" id="asinglylinkedlist_8c_html_af882d0a8dedb9091e5e77df980e631ff"><div class="ttname"><a href="singlylinkedlist_8c.html#af882d0a8dedb9091e5e77df980e631ff">singlylinkedlist_destroy</a></div><div class="ttdeci">void singlylinkedlist_destroy(SINGLYLINKEDLIST_HANDLE list)</div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00036">singlylinkedlist.c:36</a></div></div>
<div class="ttc" id="astructTLSIO__CONFIG__TAG_html"><div class="ttname"><a href="structTLSIO__CONFIG__TAG.html">TLSIO_CONFIG_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="tlsio_8h_source.html#l00013">tlsio.h:14</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_ae6c495f506c21eda4b7f679bbfaa6085"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#ae6c495f506c21eda4b7f679bbfaa6085">TLSIO_STATE</a></div><div class="ttdeci">enum TLSIO_STATE_TAG TLSIO_STATE</div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_a59f49ed726fdd46ae4c67348a781d833"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#a59f49ed726fdd46ae4c67348a781d833">TLS_IO_INSTANCE_TAG::dns</a></div><div class="ttdeci">DNS_ASYNC_HANDLE dns</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00067">tlsio_openssl_compact.c:67</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_a545a2096a8acb4ba86577a8476836de0"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#a545a2096a8acb4ba86577a8476836de0">TLSIO_RECEIVE_BUFFER_SIZE</a></div><div class="ttdeci">#define TLSIO_RECEIVE_BUFFER_SIZE</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00035">tlsio_openssl_compact.c:34</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_af7f5cd549c91efa6dbd97792cb43a67d"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#af7f5cd549c91efa6dbd97792cb43a67d">TLS_IO_INSTANCE_TAG::tlsio_state</a></div><div class="ttdeci">TLSIO_STATE tlsio_state</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00066">tlsio_openssl_compact.c:66</a></div></div>
<div class="ttc" id="astructLIST__ITEM__INSTANCE__TAG_html"><div class="ttname"><a href="structLIST__ITEM__INSTANCE__TAG.html">LIST_ITEM_INSTANCE_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00010">singlylinkedlist.c:11</a></div></div>
<div class="ttc" id="astdint_8h_html_a0238af00180b6d9278fa1c6aa790fdf4"><div class="ttname"><a href="stdint_8h.html#a0238af00180b6d9278fa1c6aa790fdf4">uint32_t</a></div><div class="ttdeci">__uint32_t uint32_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00045">stdint.h:45</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_a652e4f10d91b1ba4f994b0c8e19c7585"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#a652e4f10d91b1ba4f994b0c8e19c7585">SSL_connect</a></div><div class="ttdeci">int SSL_connect(SSL *ssl)</div><div class="ttdoc">connect to the remote SSL server</div></div>
<div class="ttc" id="atlsio__options_8h_html_a6acba6fd5750c60b338b6507c65e46cca519db6d0b95c037ad1998359e4627564"><div class="ttname"><a href="tlsio__options_8h.html#a6acba6fd5750c60b338b6507c65e46cca519db6d0b95c037ad1998359e4627564">TLSIO_OPTION_BIT_NONE</a></div><div class="ttdeci">@ TLSIO_OPTION_BIT_NONE</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__options_8h_source.html#l00020">tlsio_options.h:20</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_ab4f3bd6ac52c6626a5f4d126cf0f0886"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#ab4f3bd6ac52c6626a5f4d126cf0f0886">TLS_IO_INSTANCE_TAG::sock</a></div><div class="ttdeci">SOCKET_ASYNC_HANDLE sock</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00070">tlsio_openssl_compact.c:70</a></div></div>
<div class="ttc" id="acJSON__Utils_8h_html_a0dff3c76a075649fa412b1c429ffe382"><div class="ttname"><a href="cJSON__Utils_8h.html#a0dff3c76a075649fa412b1c429ffe382">value</a></div><div class="ttdeci">const char *const const char *const const cJSON *const value</div><div class="ttdef"><b>Definition:</b> <a href="cJSON__Utils_8h_source.html#l00042">cJSON_Utils.h:42</a></div></div>
<div class="ttc" id="axio_8h_html_afdff4c121fba1278335064c5686cc419"><div class="ttname"><a href="xio_8h.html#afdff4c121fba1278335064c5686cc419">ON_IO_CLOSE_COMPLETE</a></div><div class="ttdeci">void(* ON_IO_CLOSE_COMPLETE)(void *context)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8h_source.html#l00039">xio.h:39</a></div></div>
<div class="ttc" id="acrt__abstractions_8h_html"><div class="ttname"><a href="crt__abstractions_8h.html">crt_abstractions.h</a></div></div>
<div class="ttc" id="astructPENDING__TRANSMISSION_html_ad2f51b61f99c4886dc00607e076b50ba"><div class="ttname"><a href="structPENDING__TRANSMISSION.html#ad2f51b61f99c4886dc00607e076b50ba">PENDING_TRANSMISSION::on_send_complete</a></div><div class="ttdeci">ON_SEND_COMPLETE on_send_complete</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00026">tlsio_openssl_compact.c:26</a></div></div>
<div class="ttc" id="axio_8h_html_a13198b46d201d067f60a82c1bf0e5780"><div class="ttname"><a href="xio_8h.html#a13198b46d201d067f60a82c1bf0e5780">ON_BYTES_RECEIVED</a></div><div class="ttdeci">void(* ON_BYTES_RECEIVED)(void *context, const unsigned char *buffer, size_t size)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8h_source.html#l00036">xio.h:36</a></div></div>
<div class="ttc" id="agballoc_8h_html"><div class="ttname"><a href="gballoc_8h.html">gballoc.h</a></div></div>
<div class="ttc" id="astructPENDING__TRANSMISSION_html_ab718424c45bd519566c18e78f3f5c0c1"><div class="ttname"><a href="structPENDING__TRANSMISSION.html#ab718424c45bd519566c18e78f3f5c0c1">PENDING_TRANSMISSION::size</a></div><div class="ttdeci">size_t size</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00024">tlsio_openssl_compact.c:24</a></div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_afc802ec89778374b6cd77f8d90776ddd"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#afc802ec89778374b6cd77f8d90776ddd">TLS_IO_INSTANCE_TAG::port</a></div><div class="ttdeci">uint16_t port</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00069">tlsio_openssl_compact.c:69</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_a9a6dc099d8eccfdde41bf8abfbfeaf26"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#a9a6dc099d8eccfdde41bf8abfbfeaf26">SSL_CTX_free</a></div><div class="ttdeci">void SSL_CTX_free(SSL_CTX *ctx)</div><div class="ttdoc">free a SSL context</div></div>
<div class="ttc" id="atlsio__options_8h_html"><div class="ttname"><a href="tlsio__options_8h.html">tlsio_options.h</a></div></div>
<div class="ttc" id="astructTLSIO__OPTIONS__TAG_html"><div class="ttname"><a href="structTLSIO__OPTIONS__TAG.html">TLSIO_OPTIONS_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="tlsio__options_8h_source.html#l00043">tlsio_options.h:44</a></div></div>
<div class="ttc" id="axlogging_8h_html_aec0857f05ae0368bb1cb6efdc63cd420"><div class="ttname"><a href="xlogging_8h.html#aec0857f05ae0368bb1cb6efdc63cd420">LogError</a></div><div class="ttdeci">#define LogError(FORMAT,...)</div><div class="ttdef"><b>Definition:</b> <a href="xlogging_8h_source.html#l00164">xlogging.h:163</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_acadb2f8d6cb99e125d3240d0ef9427f9"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9">TLSIO_STATE_TAG</a></div><div class="ttdeci">TLSIO_STATE_TAG</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00037">tlsio_openssl_compact.c:38</a></div></div>
<div class="ttc" id="astructstate_html"><div class="ttname"><a href="structstate.html">state</a></div><div class="ttdef"><b>Definition:</b> <a href="tinyexpr_8c_source.html#l00064">tinyexpr.c:64</a></div></div>
<div class="ttc" id="adns__async_8c_html_ae6b440865355907dff471d002e11975e"><div class="ttname"><a href="dns__async_8c.html#ae6b440865355907dff471d002e11975e">dns_async_destroy</a></div><div class="ttdeci">void dns_async_destroy(DNS_ASYNC_HANDLE dns_in)</div><div class="ttdef"><b>Definition:</b> <a href="dns__async_8c_source.html#l00152">dns_async.c:152</a></div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_a5191b4b5b4e8356d46a902f73568d42f"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#a5191b4b5b4e8356d46a902f73568d42f">TLS_IO_INSTANCE</a></div><div class="ttdeci">struct TLS_IO_INSTANCE_TAG TLS_IO_INSTANCE</div></div>
<div class="ttc" id="axlogging_8h_html"><div class="ttname"><a href="xlogging_8h.html">xlogging.h</a></div></div>
<div class="ttc" id="aagenttime_8h_html"><div class="ttname"><a href="agenttime_8h.html">agenttime.h</a></div><div class="ttdoc">Function prototypes for time related functions.</div></div>
<div class="ttc" id="axio_8h_html_aa71532538adc618acbebd20396c0f83f"><div class="ttname"><a href="xio_8h.html#aa71532538adc618acbebd20396c0f83f">CONCRETE_IO_HANDLE</a></div><div class="ttdeci">void * CONCRETE_IO_HANDLE</div><div class="ttdef"><b>Definition:</b> <a href="xio_8h_source.html#l00020">xio.h:20</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_a97ced23c9eaec8cb32f5d675c9048522"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#a97ced23c9eaec8cb32f5d675c9048522">TLSv1_2_client_method</a></div><div class="ttdeci">const SSL_METHOD * TLSv1_2_client_method(void)</div><div class="ttdoc">create the target SSL context client method</div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_afbe2863585ed2168cdd472157b05a22c"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#afbe2863585ed2168cdd472157b05a22c">TLS_IO_INSTANCE_TAG::on_io_error</a></div><div class="ttdeci">ON_IO_ERROR on_io_error</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00059">tlsio_openssl_compact.c:59</a></div></div>
<div class="ttc" id="asocket__async_8h_html_a86f1ac99e9d9a07cadb0ca3711060920"><div class="ttname"><a href="socket__async_8h.html#a86f1ac99e9d9a07cadb0ca3711060920">SOCKET_ASYNC_INVALID_SOCKET</a></div><div class="ttdeci">#define SOCKET_ASYNC_INVALID_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="socket__async_8h_source.html#l00024">socket_async.h:23</a></div></div>
<div class="ttc" id="axio_8h_html_a3acca89b8b5ff3d42b3eaf0b3dbcf7ca"><div class="ttname"><a href="xio_8h.html#a3acca89b8b5ff3d42b3eaf0b3dbcf7ca">ON_IO_OPEN_COMPLETE</a></div><div class="ttdeci">void(* ON_IO_OPEN_COMPLETE)(void *context, IO_OPEN_RESULT open_result)</div><div class="ttdef"><b>Definition:</b> <a href="xio_8h_source.html#l00038">xio.h:38</a></div></div>
<div class="ttc" id="acacheasm_8h_html_a296a4dfa224096b538c66a9bab58cb9e"><div class="ttname"><a href="cacheasm_8h.html#a296a4dfa224096b538c66a9bab58cb9e">size</a></div><div class="ttdeci">macro cache_index_all size</div><div class="ttdef"><b>Definition:</b> <a href="cacheasm_8h_source.html#l00158">cacheasm.h:158</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_ac5dea2980f91d3c96203e8e951ad79c7"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#ac5dea2980f91d3c96203e8e951ad79c7">SSL_write</a></div><div class="ttdeci">int SSL_write(SSL *ssl, const void *buffer, int len)</div><div class="ttdoc">send the data to remote</div></div>
<div class="ttc" id="astructTLSIO__CONFIG__TAG_html_af994b29a2e2ab444e5dfb60f2be8339b"><div class="ttname"><a href="structTLSIO__CONFIG__TAG.html#af994b29a2e2ab444e5dfb60f2be8339b">TLSIO_CONFIG_TAG::port</a></div><div class="ttdeci">int port</div><div class="ttdef"><b>Definition:</b> <a href="tlsio_8h_source.html#l00016">tlsio.h:16</a></div></div>
<div class="ttc" id="astdint_8h_html_a2aff71146ab4942b2b38860c749c4074"><div class="ttname"><a href="stdint_8h.html#a2aff71146ab4942b2b38860c749c4074">uint8_t</a></div><div class="ttdeci">__uint8_t uint8_t</div><div class="ttdef"><b>Definition:</b> <a href="stdint_8h_source.html#l00021">stdint.h:21</a></div></div>
<div class="ttc" id="asinglylinkedlist_8c_html_ab0c5ab1106ca4f392541c044fe8a1f13"><div class="ttname"><a href="singlylinkedlist_8c.html#ab0c5ab1106ca4f392541c044fe8a1f13">singlylinkedlist_create</a></div><div class="ttdeci">SINGLYLINKEDLIST_HANDLE singlylinkedlist_create(void)</div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00021">singlylinkedlist.c:21</a></div></div>
<div class="ttc" id="astructOPTIONHANDLER__HANDLE__DATA__TAG_html"><div class="ttname"><a href="structOPTIONHANDLER__HANDLE__DATA__TAG.html">OPTIONHANDLER_HANDLE_DATA_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="optionhandler_8c_source.html#l00016">optionhandler.c:17</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_a5417996a2e395d43707c8283cb51050c"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#a5417996a2e395d43707c8283cb51050c">SSL_set_fd</a></div><div class="ttdeci">int SSL_set_fd(SSL *ssl, int fd)</div><div class="ttdoc">bind the socket file description into the SSL</div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_add9f91511b7a494f4910b0e3567d7d99"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#add9f91511b7a494f4910b0e3567d7d99">SSL_free</a></div><div class="ttdeci">void SSL_free(SSL *ssl)</div><div class="ttdoc">free the SSL</div></div>
<div class="ttc" id="astructTLS__IO__INSTANCE__TAG_html_ad56bc8aa8fea9cb57baf06f3fca9420b"><div class="ttname"><a href="structTLS__IO__INSTANCE__TAG.html#ad56bc8aa8fea9cb57baf06f3fca9420b">TLS_IO_INSTANCE_TAG::on_bytes_received</a></div><div class="ttdeci">ON_BYTES_RECEIVED on_bytes_received</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00058">tlsio_openssl_compact.c:58</a></div></div>
<div class="ttc" id="astructSINGLYLINKEDLIST__INSTANCE__TAG_html"><div class="ttname"><a href="structSINGLYLINKEDLIST__INSTANCE__TAG.html">SINGLYLINKEDLIST_INSTANCE_TAG</a></div><div class="ttdef"><b>Definition:</b> <a href="singlylinkedlist_8c_source.html#l00016">singlylinkedlist.c:17</a></div></div>
<div class="ttc" id="aopenssl_2openssl_2ssl_8h_html_a83ef9b8562e90bb3fdbd36473e627718"><div class="ttname"><a href="openssl_2openssl_2ssl_8h.html#a83ef9b8562e90bb3fdbd36473e627718">SSL_read</a></div><div class="ttdeci">int SSL_read(SSL *ssl, void *buffer, int len)</div><div class="ttdoc">read data from to remote</div></div>
<div class="ttc" id="atlsio__openssl__compact_8c_html_acadb2f8d6cb99e125d3240d0ef9427f9a821f2aa54b2d0b60a2a5a370800996cd"><div class="ttname"><a href="tlsio__openssl__compact_8c.html#acadb2f8d6cb99e125d3240d0ef9427f9a821f2aa54b2d0b60a2a5a370800996cd">TLSIO_STATE_OPENING_WAITING_SOCKET</a></div><div class="ttdeci">@ TLSIO_STATE_OPENING_WAITING_SOCKET</div><div class="ttdef"><b>Definition:</b> <a href="tlsio__openssl__compact_8c_source.html#l00041">tlsio_openssl_compact.c:41</a></div></div>
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.18
</small></address>
</body>
</html>
